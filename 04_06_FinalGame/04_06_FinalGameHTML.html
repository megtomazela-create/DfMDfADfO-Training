<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Day Zero — The Investigation | Act 4 Assessment</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           CSS VARIABLES (BRAND)
           ============================================ */
        :root {
            /* Core palette */
            --darkest: #1F2937;
            --dark: #2C3A44;
            --medium-dark: #354450;
            --medium-light: #9BABC2;
            --light: #D1D9E0;
            --lightest: #F7F8FA;
            
            /* Accent */
            --warm-gold: #B8860B;
            --gold-light: #D4A84B;
            --gold-glow: rgba(184, 134, 11, 0.3);
            
            /* Status colours */
            --money-red: #DC2626;
            --danger-red: #C62828;
            --warning-amber: #FFB300;
            --success-green: #2E7D32;
            
            /* Game specific */
            --evidence-blue: #1565C0;
            --highlight-yellow: #FFC107;
            
            /* Typography */
            --font-heading: 'Rajdhani', sans-serif;
            --font-body: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', 'Consolas', monospace;
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
        }

        /* ============================================
           RESET & BASE
           ============================================ */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: var(--font-body);
            background: var(--darkest);
            color: var(--light);
            line-height: 1.6;
            font-size: 16px;
        }

        /* ============================================
           UTILITIES
           ============================================ */
        .hidden {
            display: none !important;
        }

        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
        }

        /* ============================================
           BUTTONS
           ============================================ */
        .btn-primary {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: var(--space-md) var(--space-xl);
            background: linear-gradient(135deg, var(--warm-gold), var(--gold-light));
            color: var(--darkest);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--gold-glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px var(--gold-glow);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            font-family: var(--font-heading);
            font-size: 1rem;
            font-weight: 500;
            padding: var(--space-sm) var(--space-lg);
            background: transparent;
            color: var(--medium-light);
            border: 1px solid var(--medium-dark);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            border-color: var(--warm-gold);
            color: var(--gold-light);
        }

        .btn-danger {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: var(--space-md) var(--space-xl);
            background: linear-gradient(135deg, var(--danger-red), #E53935);
            color: var(--lightest);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(198, 40, 40, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(198, 40, 40, 0.4);
        }

        .btn-large {
            font-size: 1.3rem;
            padding: var(--space-lg) var(--space-2xl);
        }

        /* ============================================
           INTRO SCREEN
           ============================================ */
        #intro-screen {
            background: linear-gradient(180deg, rgba(17, 24, 32, 0.85) 0%, rgba(21, 28, 36, 0.9) 100%),
                        url('images/IMAGE_SCENE_02.png');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ============================================
           CINEMATIC INTRO STYLES
           ============================================ */
        .cinematic-intro {
            position: relative;
            width: 100%;
            height: 100%;
            background: var(--darkest);
            overflow: hidden;
        }

        .intro-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        .intro-slide.active {
            opacity: 1;
            visibility: visible;
        }

        .slide-image {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .slide-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.7);
        }

        .slide-image::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(to top, var(--darkest) 0%, transparent 100%);
            pointer-events: none;
        }

        .slide-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: var(--space-2xl) var(--space-2xl) 120px;
            background: linear-gradient(to top, var(--darkest) 30%, transparent 100%);
        }

        .slide-time {
            font-family: var(--font-mono);
            font-size: 0.85rem;
            color: var(--warm-gold);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin-bottom: var(--space-md);
        }

        .slide-text {
            max-width: 700px;
        }

        .slide-text p {
            font-size: 1.25rem;
            color: var(--light);
            line-height: 1.7;
            margin-bottom: var(--space-md);
        }

        .slide-text p:last-child {
            margin-bottom: 0;
        }

        .radio-call-container {
            margin-bottom: var(--space-md);
        }

        .btn-radio-play {
            background: rgba(220, 38, 38, 0.3);
            color: var(--lightest);
            border: 2px solid var(--money-red);
            padding: var(--space-sm) var(--space-lg);
            border-radius: 4px;
            font-family: var(--font-heading);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            transition: all 0.2s ease;
        }

        .btn-radio-play:hover {
            background: rgba(220, 38, 38, 0.5);
        }

        .btn-radio-play.playing {
            background: var(--money-red);
            animation: radio-pulse 1.5s infinite;
        }

        @keyframes radio-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
        }

        .radio-icon {
            font-size: 1.2rem;
        }

        .slide-text .radio-call {
            font-family: var(--font-mono);
            font-size: 1.3rem;
            color: var(--money-red);
            background: rgba(220, 38, 38, 0.15);
            padding: var(--space-md) var(--space-lg);
            border-radius: 4px;
            border-left: 3px solid var(--money-red);
            margin: var(--space-lg) 0;
            display: block;
        }

        .slide-text .regulatory-note {
            font-size: 1rem;
            color: var(--warning-amber);
            background: rgba(217, 119, 6, 0.1);
            padding: var(--space-sm) var(--space-md);
            border-radius: 4px;
            border-left: 3px solid var(--warning-amber);
            margin-top: var(--space-lg);
        }

        .slide-text .highlight {
            font-size: 1.5rem;
            color: var(--warm-gold);
            font-weight: 600;
        }

        .slide-text strong {
            color: var(--lightest);
        }

        .slide-next-btn {
            position: absolute;
            bottom: var(--space-2xl);
            right: var(--space-2xl);
            background: var(--warm-gold);
            color: var(--darkest);
            border: none;
            padding: var(--space-md) var(--space-xl);
            font-family: var(--font-heading);
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .slide-next-btn:hover {
            background: var(--lightest);
            transform: translateX(5px);
        }

        .skip-intro-btn {
            position: absolute;
            top: var(--space-lg);
            right: var(--space-lg);
            background: transparent;
            color: var(--muted);
            border: 1px solid var(--medium-dark);
            padding: var(--space-sm) var(--space-md);
            font-size: 0.85rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 20;
        }

        .skip-intro-btn:hover {
            color: var(--light);
            border-color: var(--light);
        }

        .slide-progress {
            position: absolute;
            bottom: var(--space-lg);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: var(--space-sm);
            z-index: 10;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--medium-dark);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: var(--warm-gold);
            transform: scale(1.2);
        }

        .progress-dot:hover {
            background: var(--light);
        }

        /* Mission slide (final slide) */
        /* Mission slide background */
        .mission-bg {
            position: absolute !important;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            height: 100% !important;
        }
        
        .mission-bg img {
            filter: brightness(0.3) blur(2px);
        }
        
        .mission-bg::after {
            background: linear-gradient(to bottom, 
                rgba(31, 41, 55, 0.7) 0%, 
                rgba(31, 41, 55, 0.9) 50%,
                var(--darkest) 100%
            );
        }
        
        .mission-slide {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            text-align: center;
            padding: var(--space-2xl);
            background: transparent;
            z-index: 1;
        }

        .mission-logo {
            width: 180px;
            height: auto;
            margin-bottom: var(--space-xl);
            opacity: 0.9;
        }

        .mission-slide h1 {
            font-family: var(--font-heading);
            font-size: 4rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--lightest);
            margin-bottom: var(--space-xs);
            text-shadow: 0 0 60px rgba(184, 134, 11, 0.4);
        }

        .mission-slide h2 {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 500;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: var(--warm-gold);
            margin-bottom: var(--space-2xl);
        }

        .mission-brief {
            max-width: 600px;
            margin-bottom: var(--space-2xl);
        }

        .mission-brief p {
            font-size: 1.2rem;
            color: var(--light);
            margin-bottom: var(--space-md);
        }

        .mission-brief .highlight {
            font-size: 1.6rem;
            color: var(--warm-gold);
            font-weight: 600;
            margin: var(--space-lg) 0;
        }

        /* Legacy intro styles for compatibility */
        .intro-container {
            max-width: 700px;
            padding: var(--space-2xl);
            text-align: center;
            background: rgba(17, 24, 32, 0.7);
            border-radius: 16px;
            border: 1px solid rgba(184, 134, 11, 0.2);
            backdrop-filter: blur(10px);
        }

        .intro-logo {
            width: 180px;
            height: auto;
            margin-bottom: var(--space-xl);
            opacity: 0.9;
        }

        .intro-container h1 {
            font-family: var(--font-heading);
            font-size: 3.5rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--lightest);
            margin-bottom: var(--space-xs);
            text-shadow: 0 0 40px rgba(184, 134, 11, 0.3);
        }

        .intro-container h2 {
            font-family: var(--font-heading);
            font-size: 1.4rem;
            font-weight: 500;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: var(--warm-gold);
            margin-bottom: var(--space-2xl);
        }

        .intro-narrative {
            text-align: left;
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid var(--warm-gold);
            padding: var(--space-lg) var(--space-xl);
            margin-bottom: var(--space-2xl);
            border-radius: 0 8px 8px 0;
        }
        
        .intro-image {
            margin-bottom: var(--space-xl);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            border: 2px solid var(--warm-gold);
        }
        
        .intro-image img {
            width: 100%;
            max-width: 700px;
            height: auto;
            display: block;
        }

        .intro-narrative p {
            margin-bottom: var(--space-md);
            color: var(--light);
            font-size: 1.05rem;
        }

        .intro-narrative p:last-child {
            margin-bottom: 0;
        }

        .intro-narrative .radio-call {
            font-family: var(--font-mono);
            font-size: 1.1rem;
            color: var(--money-red);
            background: rgba(220, 38, 38, 0.1);
            padding: var(--space-sm) var(--space-md);
            border-radius: 4px;
            margin: var(--space-md) 0;
        }
        
        .intro-narrative .regulatory-note {
            font-size: 0.9rem;
            color: var(--warning-amber);
            background: rgba(217, 119, 6, 0.1);
            padding: var(--space-sm) var(--space-md);
            border-radius: 4px;
            border-left: 3px solid var(--warning-amber);
            margin: var(--space-md) 0;
        }

        .intro-narrative strong {
            color: var(--lightest);
        }

        /* Intro Buttons */
        .intro-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-md);
        }

        .intro-buttons .btn-secondary {
            font-size: 0.9rem;
        }

        /* How to Play Modal */
        .how-to-play-content {
            width: 550px;
            text-align: center;
        }

        .how-to-play-content h2 {
            font-family: var(--font-heading);
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--warm-gold);
            margin-bottom: var(--space-md);
        }

        .mission-intro {
            color: var(--light);
            margin-bottom: var(--space-xl);
        }

        .mission-intro strong {
            color: var(--lightest);
        }

        .mission-objectives {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            text-align: left;
        }

        .objective {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-sm) 0;
        }

        .objective-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
            width: 40px;
            text-align: center;
        }

        .objective-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .objective-text strong {
            font-family: var(--font-heading);
            font-size: 0.95rem;
            color: var(--lightest);
        }

        .objective-text span {
            font-size: 0.85rem;
            color: var(--medium-light);
        }

        .mission-warning {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 6px;
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            text-align: left;
        }
        
        .mission-warning.regulatory {
            background: rgba(217, 119, 6, 0.1);
            border: 1px solid rgba(217, 119, 6, 0.3);
            margin-bottom: var(--space-xl);
        }
        
        .mission-warning.regulatory .warning-text strong {
            color: var(--warning-amber);
        }

        .warning-icon {
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .warning-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
            font-size: 0.85rem;
            color: var(--light);
        }

        .warning-text strong {
            color: var(--money-red);
            font-size: 0.9rem;
        }

        /* ============================================
           GAME SCREEN
           ============================================ */
        #game-screen {
            display: block;
            position: relative;
            background: var(--darkest);
        }

        /* Header Bar - Now overlays the image */
        .game-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: var(--space-md) var(--space-lg);
            background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, transparent 100%);
            z-index: 10;
            pointer-events: none;
        }
        
        .game-header > * {
            pointer-events: auto;
        }

        .header-logo {
            height: 40px;
            width: auto;
            opacity: 0.8;
        }

        /* Money Counter - Overlay position top-right */
        #money-counter {
            background: linear-gradient(135deg, rgba(0,0,0,0.85) 0%, rgba(30,20,20,0.95) 100%);
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 8px;
            padding: var(--space-md) var(--space-lg);
            min-width: 280px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .counter-header {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--medium-light);
            margin-bottom: var(--space-xs);
        }

        .counter-total {
            font-family: var(--font-mono);
            font-size: 2.2rem;
            font-weight: 500;
            color: var(--money-red);
            text-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
            margin-bottom: var(--space-sm);
            transition: text-shadow 0.1s ease;
        }

        .counter-total.pulse {
            text-shadow: 0 0 30px rgba(220, 38, 38, 0.8);
        }

        .counter-breakdown {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: var(--space-sm);
        }

        .cost-line {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--medium-light);
            padding: 2px 0;
            opacity: 0.7;
        }

        .cost-line .cost-label {
            font-family: var(--font-body);
        }

        .cost-line .cost-rate {
            font-family: var(--font-mono);
            color: var(--light);
        }

        .cost-line.total-line {
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: var(--space-xs);
            padding-top: var(--space-xs);
            opacity: 1;
        }

        .cost-line.total-line .cost-label {
            font-weight: 600;
            color: var(--light);
        }

        .cost-line.total-line .cost-rate {
            color: var(--money-red);
            font-weight: 500;
        }

        /* Main Scene Area - Full viewport */
        .game-main {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* Investigation Scene - Full bleed */
        .investigation-scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .scene-background {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        /* Scene Hotspots - Elegant pulsing dots */
        .scene-hotspot {
            position: absolute;
            width: 36px;
            height: 36px;
            background: #D97706; /* Amber - not seen */
            border: 3px solid var(--lightest);
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            z-index: 5;
            animation: dotPulseAmber 2s ease-in-out infinite;
        }

        @keyframes dotPulseAmber {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 0 rgba(217, 119, 6, 0.6);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 14px rgba(217, 119, 6, 0);
                transform: scale(1.08);
            }
        }

        /* Seen state - green, still pulsing */
        .scene-hotspot.seen {
            background: var(--success-green);
            animation: dotPulseGreen 2s ease-in-out infinite;
        }

        @keyframes dotPulseGreen {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 0 rgba(34, 197, 94, 0.6);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 14px rgba(34, 197, 94, 0);
                transform: scale(1.08);
            }
        }

        /* Collected state - green with tick, still pulsing */
        .scene-hotspot.collected {
            background: var(--success-green);
            animation: dotPulseGreen 2s ease-in-out infinite;
        }

        .scene-hotspot.collected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--darkest);
            font-size: 16px;
            font-weight: bold;
        }

        .scene-hotspot:hover {
            transform: scale(1.2);
            z-index: 20; /* Bring hovered hotspot above others */
        }

        /* Keep hover card working */
        .scene-hotspot:hover .hotspot-card {
            opacity: 1;
            visibility: visible;
        }
        
        /* Active preview state (mobile tap) */
        .scene-hotspot.preview-active {
            z-index: 30; /* Higher than other hotspots */
        }

        /* Hover card with thumbnail */
        .hotspot-card {
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--darkest);
            border: 1px solid var(--warm-gold);
            border-radius: 8px;
            padding: 8px;
            width: 160px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            pointer-events: none;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            z-index: 100; /* High z-index to appear above everything */
        }

        .scene-hotspot:hover .hotspot-card {
            opacity: 1;
            visibility: visible;
        }

        .hotspot-card img {
            width: 100%;
            height: 70px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 6px;
        }

        .hotspot-card .hotspot-label {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--lightest);
            text-align: center;
            display: block;
        }

        .hotspot-card .hotspot-doc {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            color: var(--warm-gold);
            text-align: center;
            display: block;
            margin-top: 2px;
            opacity: 0.9;
        }

        /* Arrow pointing down from card */
        .hotspot-card::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--warm-gold);
        }

        /* Phone hotspot - same amber as others, no special styling needed */

        .game-main::before {
            display: none;
        }

        /* Game Hint Bar */
        .game-hint {
            position: absolute;
            top: 28%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 15;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid var(--warm-gold);
            border-radius: 8px;
            padding: var(--space-sm) var(--space-md);
            max-width: 90%;
            animation: slideDown 0.5s ease;
            backdrop-filter: blur(8px);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .hint-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .hint-text {
            font-size: 0.85rem;
            color: var(--light);
        }

        .hint-text strong {
            color: var(--warm-gold);
        }

        .hint-dismiss {
            background: none;
            border: none;
            color: var(--medium-light);
            font-size: 1rem;
            cursor: pointer;
            padding: var(--space-xs);
            margin-left: var(--space-sm);
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .hint-dismiss:hover {
            opacity: 1;
        }

        /* Evidence Locations Grid */
        #evidence-locations {
            position: relative;
            z-index: 1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-lg);
            padding: var(--space-xl);
            max-width: 900px;
            width: 100%;
        }

        .evidence-btn {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-lg);
            background: rgba(31, 41, 55, 0.85);
            border: 2px solid var(--medium-dark);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            backdrop-filter: blur(8px);
        }

        .evidence-btn:hover {
            border-color: var(--warm-gold);
            background: rgba(44, 58, 68, 0.9);
            transform: translateY(-4px);
            box-shadow: 0 8px 30px var(--gold-glow);
        }

        .evidence-btn:active {
            transform: translateY(-2px);
        }

        .evidence-btn .evidence-icon {
            font-size: 2rem;
            margin-bottom: var(--space-sm);
        }

        .evidence-btn .evidence-label {
            font-family: var(--font-heading);
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--light);
            text-align: center;
        }

        .evidence-btn.examined {
            border-color: var(--success-green);
            opacity: 0.7;
        }

        .evidence-btn.examined::after {
            content: '✓';
            position: absolute;
            top: 8px;
            right: 8px;
            color: var(--success-green);
            font-size: 1rem;
        }

        /* Action Buttons (Phone & Submit) */
        .game-actions {
            position: absolute;
            bottom: var(--space-lg);
            right: var(--space-lg);
            display: flex;
            gap: var(--space-md);
            z-index: 1;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            background: rgba(31, 41, 55, 0.9);
            border: 2px solid var(--medium-dark);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .action-btn:hover {
            border-color: var(--warm-gold);
            transform: translateY(-2px);
        }

        .action-btn .action-icon {
            font-size: 1.3rem;
        }

        .action-btn .action-label {
            font-family: var(--font-heading);
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--light);
        }

        #submit-btn {
            border-color: var(--warning-amber);
            background: rgba(245, 124, 0, 0.1);
        }

        #submit-btn:hover {
            background: rgba(245, 124, 0, 0.2);
            border-color: var(--warning-amber);
            box-shadow: 0 4px 20px rgba(245, 124, 0, 0.3);
        }

        /* Evidence Cards Bar */
        .evidence-bar {
            background: linear-gradient(0deg, rgba(0,0,0,0.5) 0%, rgba(31,41,55,0.8) 100%);
            border-top: 1px solid var(--medium-dark);
            padding: var(--space-md) var(--space-lg);
            min-height: 140px;
        }

        .evidence-bar-header {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--medium-light);
            margin-bottom: var(--space-sm);
        }

        #evidence-cards-bar {
            display: flex;
            gap: var(--space-md);
            overflow-x: auto;
            padding-bottom: var(--space-sm);
        }

        #evidence-cards-bar::-webkit-scrollbar {
            height: 6px;
        }

        #evidence-cards-bar::-webkit-scrollbar-track {
            background: var(--dark);
            border-radius: 3px;
        }

        #evidence-cards-bar::-webkit-scrollbar-thumb {
            background: var(--medium-dark);
            border-radius: 3px;
        }

        .evidence-card {
            flex-shrink: 0;
            width: 280px;
            background: var(--dark);
            border: 1px solid var(--medium-dark);
            border-radius: 8px;
            padding: var(--space-md);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .evidence-card h5 {
            font-family: var(--font-heading);
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--warm-gold);
            margin-bottom: var(--space-xs);
        }

        .evidence-card p {
            font-size: 0.8rem;
            color: var(--medium-light);
            line-height: 1.5;
        }

        .evidence-card.critical {
            border-color: var(--money-red);
            background: linear-gradient(135deg, var(--dark) 0%, rgba(220, 38, 38, 0.1) 100%);
        }

        .evidence-bar-empty {
            color: var(--medium-dark);
            font-style: italic;
            font-size: 0.9rem;
            padding: var(--space-md);
        }

        /* Evidence Collection Panel - Bottom bar */
        .collection-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(31, 41, 55, 0.95);
            border-top: 1px solid var(--warm-gold);
            padding: var(--space-sm) var(--space-lg);
            z-index: 10;
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }

        .collection-header {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 100px;
        }

        .collection-header h3 {
            font-family: var(--font-heading);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--lightest);
            margin: 0;
        }

        .collection-count {
            font-family: var(--font-mono);
            font-size: 1.1rem;
            color: var(--warm-gold);
            font-weight: 600;
        }

        .collection-slots {
            display: flex;
            gap: var(--space-sm);
            flex: 1;
        }

        .collection-slot {
            width: 60px;
            height: 50px;
            background: rgba(0,0,0,0.3);
            border: 2px dashed var(--medium-dark);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .collection-slot.empty .slot-number {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--medium-dark);
        }

        .collection-slot.filled {
            border: 2px solid var(--warm-gold);
            background: rgba(184, 134, 11, 0.1);
        }

        .collection-slot.filled .slot-number {
            display: none;
        }

        .collection-slot .slot-evidence {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4px;
        }

        .collection-slot .slot-evidence img {
            width: 100%;
            height: 60%;
            object-fit: cover;
            border-radius: 4px;
        }

        .collection-slot .slot-evidence span {
            font-size: 0.5rem;
            color: var(--light);
            text-align: center;
            margin-top: 2px;
            line-height: 1.1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
        }

        .collection-slot.phone-slot {
            width: 60px;
        }

        .collection-actions {
            margin-left: auto;
        }

        .collection-actions .btn-primary {
            font-size: 0.75rem;
            padding: var(--space-sm) var(--space-md);
            white-space: nowrap;
        }

        #open-board-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: var(--medium-dark);
            box-shadow: none;
        }

        #open-board-btn:disabled:hover {
            transform: none;
        }

        .board-btn-text {
            display: inline;
        }

        /* ============================================
           EVIDENCE BOARD - Fresh Design
           Full table with cards you can read, 
           classification slots at bottom
           ============================================ */
        
        #board-modal {
            background: none;
        }
        
        #board-modal.modal {
            backdrop-filter: none;
        }
        
        .board-screen {
            width: 100vw;
            height: 100vh;
            background-image: url('images/IMAGE_UI_03.png');
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* Close button */
        .board-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background: rgba(0,0,0,0.6);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .board-close-btn:hover {
            background: rgba(220, 38, 38, 0.8);
        }
        
        /* Top area - Evidence cards spread on table */
        .table-area {
            flex: 1;
            padding: 60px 30px 30px;
            padding-bottom: 280px; /* Space for classification slots on table */
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-content: center;
            justify-content: center;
            overflow-y: auto;
        }
        
        /* Evidence cards - readable, full content */
        .evidence-card {
            width: 280px;
            background: #fffef8;
            border-radius: 4px;
            padding: 16px 18px;
            cursor: grab;
            box-shadow: 
                0 2px 8px rgba(0,0,0,0.2),
                0 8px 20px rgba(0,0,0,0.15);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            transform: rotate(var(--rotate, 0deg));
        }
        
        .evidence-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background: var(--warm-gold);
            border-radius: 4px 0 0 4px;
        }
        
        .evidence-card:hover {
            transform: rotate(0deg) translateY(-5px) scale(1.02);
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.25),
                0 15px 40px rgba(0,0,0,0.2);
            z-index: 50;
        }
        
        .evidence-card.dragging {
            opacity: 0.8;
            cursor: grabbing;
            z-index: 100;
        }
        
        .evidence-card.classified {
            opacity: 0.4;
            transform: scale(0.95);
            pointer-events: none;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .card-title {
            font-family: var(--font-heading);
            font-size: 0.95rem;
            font-weight: 700;
            color: #1a1a1a;
            line-height: 1.3;
            flex: 1;
        }
        
        .card-source {
            font-size: 0.65rem;
            color: #888;
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            white-space: nowrap;
        }
        
        .card-body {
            font-family: Georgia, serif;
            font-size: 0.8rem;
            color: #333;
            line-height: 1.55;
        }
        
        /* Classification slots - ON the table, not a bar */
        .classification-bar {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            align-items: stretch;
            z-index: 90;
            padding: 15px;
            background: transparent;
            border: none;
        }
        
        /* Classification slots */
        .classification-slot {
            width: 200px;
            min-height: 120px;
            background: rgba(255,255,255,0.1);
            border: 3px dashed rgba(255,255,255,0.4);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            transition: all 0.2s;
            backdrop-filter: blur(2px);
        }
        
        .classification-slot.drag-over {
            border-color: var(--warm-gold);
            background: rgba(184, 134, 11, 0.2);
            box-shadow: 0 0 20px rgba(184, 134, 11, 0.3);
        }
        
        .slot-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .slot-icon {
            font-size: 1.1rem;
        }
        
        .slot-label {
            font-family: var(--font-heading);
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--lightest);
        }
        
        .slot-hint {
            font-size: 0.6rem;
            color: var(--medium-light);
            margin-left: auto;
        }
        
        .slot-content {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-content: flex-start;
        }
        
        /* Root cause slot - special styling */
        .slot-root {
            border-color: rgba(220, 38, 38, 0.6);
            background: rgba(220, 38, 38, 0.15);
        }
        
        .slot-root .slot-label {
            color: #ff6b6b;
        }
        
        .slot-root.drag-over {
            border-color: var(--money-red);
            background: rgba(220, 38, 38, 0.3);
        }
        
        /* Contributing slot */
        .slot-contributing {
            width: 350px;
            border-color: rgba(217, 119, 6, 0.6);
            background: rgba(217, 119, 6, 0.15);
        }
        
        .slot-contributing .slot-label {
            color: var(--warning-amber);
        }
        
        .slot-contributing.drag-over {
            border-color: var(--warning-amber);
            background: rgba(217, 119, 6, 0.3);
        }
        
        /* Red herring slot */
        .slot-redherring {
            border-color: rgba(150, 150, 150, 0.5);
            background: rgba(100, 100, 100, 0.15);
        }
        
        .slot-redherring .slot-label {
            color: var(--medium-light);
        }
        
        .slot-redherring.drag-over {
            border-color: var(--medium-light);
            background: rgba(150, 150, 150, 0.25);
        }
        
        /* Mini cards in slots */
        .mini-card {
            background: rgba(255,255,255,0.95);
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            color: #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: grab;
            max-width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .mini-card:hover {
            background: white;
        }
        
        /* Submit button area */
        .submit-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0 15px;
        }
        
        .board-status {
            font-size: 0.7rem;
            color: var(--lightest);
            margin-bottom: 8px;
            text-align: center;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        
        .btn-submit-board {
            background: linear-gradient(180deg, var(--warm-gold) 0%, #9a7209 100%);
            border: none;
            color: var(--darkest);
            font-family: var(--font-heading);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .btn-submit-board:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(184, 134, 11, 0.4);
        }
        
        .btn-submit-board:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--medium-dark);
        }

        /* ============================================
           MODALS
           ============================================ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(180deg, var(--dark) 0%, var(--darkest) 100%);
            border: 1px solid var(--medium-dark);
            border-radius: 12px;
            padding: var(--space-xl);
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
            animation: scaleIn 0.2s ease;
        }

        @keyframes scaleIn {
            from { 
                opacity: 0;
                transform: scale(0.95);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-close {
            position: absolute;
            top: var(--space-md);
            right: var(--space-md);
            background: none;
            border: none;
            color: var(--medium-light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s ease;
            line-height: 1;
            padding: var(--space-xs);
        }

        .modal-close:hover {
            color: var(--lightest);
        }

        /* Evidence Modal */
        .evidence-viewer {
            width: 1000px;
        }

        .evidence-viewer h2 {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--lightest);
            margin-bottom: var(--space-lg);
            padding-right: var(--space-2xl);
        }

        #evidence-image-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16/10;
            background: var(--darkest);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: var(--space-lg);
        }

        #evidence-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Hotspots */
        .hotspot {
            position: absolute;
            width: 44px;
            height: 44px;
            background: #D97706; /* Amber - not seen */
            border: 3px solid var(--lightest);
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            transition: background 0.3s ease;
            animation: hotspotPulseAmber 2s ease-in-out infinite;
        }

        @keyframes hotspotPulseAmber {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 0 rgba(217, 119, 6, 0.6);
            }
            50% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 12px rgba(217, 119, 6, 0);
            }
        }

        .hotspot:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* Seen state - green, still pulsing */
        .hotspot.seen {
            background: var(--success-green);
            animation: hotspotPulseGreen 2s ease-in-out infinite;
        }

        @keyframes hotspotPulseGreen {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 0 rgba(34, 197, 94, 0.6);
            }
            50% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 12px rgba(34, 197, 94, 0);
            }
        }

        /* Collected state - green with tick, still pulsing */
        .hotspot.collected {
            background: var(--success-green);
            animation: hotspotPulseGreen 2s ease-in-out infinite;
        }

        .hotspot.collected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--darkest);
            font-size: 18px;
            font-weight: bold;
        }

        .hotspot-label {
            position: absolute;
            top: 50%;
            left: calc(100% + 10px);
            transform: translateY(-50%);
            white-space: nowrap;
            font-family: var(--font-heading);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--lightest);
            background: rgba(31, 41, 55, 0.9);
            padding: var(--space-xs) var(--space-sm);
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }

        .hotspot:hover .hotspot-label {
            opacity: 1;
        }

        /* Remove old pulse span - not needed anymore */
        .hotspot .hotspot-pulse {
            display: none;
        }

        /* Findings Panel */
        #evidence-findings {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
            min-height: 100px;
            max-height: 200px;
            overflow-y: auto;
        }

        .findings-hint {
            color: var(--medium-light);
            font-style: italic;
            text-align: center;
            padding: var(--space-lg);
        }

        .finding-card {
            background: var(--dark);
            border: 1px solid var(--medium-dark);
            border-radius: 6px;
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            animation: slideIn 0.3s ease;
        }

        .finding-card:last-child {
            margin-bottom: 0;
        }

        .finding-card h4 {
            font-family: var(--font-heading);
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--lightest);
            margin-bottom: var(--space-xs);
        }

        .finding-card p {
            font-size: 0.85rem;
            color: var(--light);
            margin-bottom: var(--space-sm);
            line-height: 1.6;
        }

        .finding-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-sm);
            padding-top: var(--space-sm);
            border-top: 1px solid var(--medium-dark);
        }

        .btn-take {
            font-family: var(--font-heading);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: var(--space-sm) var(--space-md);
            background: linear-gradient(135deg, var(--warm-gold), var(--gold-light));
            color: var(--darkest);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-take:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px var(--gold-glow);
        }

        .btn-leave {
            font-family: var(--font-heading);
            font-size: 0.8rem;
            font-weight: 500;
            padding: var(--space-sm) var(--space-md);
            background: transparent;
            color: var(--medium-light);
            border: 1px solid var(--medium-dark);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-leave:hover {
            border-color: var(--medium-light);
            color: var(--light);
        }

        .already-collected {
            font-size: 0.8rem;
            color: var(--success-green);
            font-weight: 500;
        }

        .dismissed {
            font-size: 0.8rem;
            color: var(--medium-light);
            font-style: italic;
        }

        /* Phone Modal */
        .phone-interface {
            width: 420px;
            background: linear-gradient(145deg, #1a1a2e 0%, #0f0f1a 100%);
            border: 2px solid #2a2a4a;
            border-radius: 24px;
            padding: 0;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.05);
        }

        .phone-header {
            background: linear-gradient(180deg, #2a2a4a 0%, #1a1a2e 100%);
            padding: var(--space-lg) var(--space-xl);
            text-align: center;
            border-bottom: 1px solid #3a3a5a;
        }

        .phone-header h2 {
            font-family: var(--font-heading);
            font-size: 1.2rem;
            color: var(--lightest);
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
        }

        .phone-header-icon {
            font-size: 1.5rem;
        }

        .phone-body {
            padding: var(--space-lg);
        }

        .phone-subtitle {
            text-align: center;
            font-size: 0.85rem;
            color: var(--medium-light);
            margin-bottom: var(--space-lg);
        }

        #phone-contacts {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .phone-contact {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) var(--space-lg);
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .phone-contact:hover:not(.called):not(.collected) {
            border-color: var(--warm-gold);
            background: rgba(212, 175, 55, 0.1);
            transform: translateX(4px);
        }

        .phone-contact.called {
            opacity: 0.6;
        }

        .phone-contact.collected {
            border-color: var(--success-green);
            background: rgba(34, 197, 94, 0.1);
        }

        .contact-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--warm-gold) 0%, #b8860b 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .phone-contact.called .contact-avatar {
            background: linear-gradient(135deg, #4a4a4a 0%, #2a2a2a 100%);
        }

        .phone-contact.collected .contact-avatar {
            background: linear-gradient(135deg, var(--success-green) 0%, #15803d 100%);
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-family: var(--font-heading);
            font-weight: 600;
            color: var(--lightest);
            font-size: 1rem;
            margin-bottom: 2px;
        }

        .contact-role {
            font-size: 0.75rem;
            color: var(--medium-light);
        }

        .contact-status {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
        }

        .contact-status.available {
            color: var(--warm-gold);
            background: rgba(212, 175, 55, 0.15);
        }

        .contact-status.called {
            color: var(--medium-light);
            background: rgba(255,255,255,0.08);
        }

        .contact-status.collected {
            color: var(--success-green);
            background: rgba(34, 197, 94, 0.15);
        }

        .phone-current-evidence {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
            text-align: center;
        }

        .phone-current-evidence-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--success-green);
            margin-bottom: var(--space-xs);
        }

        .phone-current-evidence-title {
            font-family: var(--font-heading);
            font-size: 0.9rem;
            color: var(--lightest);
        }

        .phone-footer {
            padding: var(--space-md) var(--space-lg) var(--space-lg);
            text-align: center;
        }

        #close-phone-btn {
            width: 100%;
            border-radius: 12px;
        }

        #phone-call-active {
            text-align: center;
            padding: var(--space-lg);
        }

        #phone-call-active h3 {
            font-family: var(--font-heading);
            font-size: 1.4rem;
            color: var(--lightest);
            margin-bottom: var(--space-xs);
        }

        .call-subtitle {
            font-size: 0.85rem;
            color: var(--warm-gold);
            margin-bottom: var(--space-lg);
        }

        #call-timer {
            font-family: var(--font-mono);
            font-size: 2rem;
            color: var(--lightest);
            margin-bottom: var(--space-lg);
        }

        .call-audio-container {
            position: absolute;
            top: var(--space-md);
            right: var(--space-md);
        }

        .btn-audio-mini {
            background: rgba(255,255,255,0.1);
            color: var(--light);
            border: 1px solid rgba(255,255,255,0.2);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-audio-mini:hover {
            background: rgba(255,255,255,0.2);
            border-color: var(--warm-gold);
        }

        .btn-audio-mini.playing {
            background: rgba(212, 175, 55, 0.3);
            border-color: var(--warm-gold);
            color: var(--warm-gold);
        }

        .btn-audio {
            background: var(--warm-gold);
            color: var(--darkest);
            border: none;
            padding: var(--space-sm) var(--space-lg);
            border-radius: 4px;
            font-family: var(--font-heading);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            transition: all 0.2s ease;
        }

        .btn-audio:hover {
            background: var(--lightest);
        }

        .btn-audio.playing {
            background: var(--money-red);
            color: var(--lightest);
        }

        .btn-audio.playing .audio-icon {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .audio-status {
            font-size: 0.85rem;
            color: var(--muted);
            font-style: italic;
        }

        .call-transcript-label {
            font-size: 0.8rem;
            color: var(--warm-gold);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: var(--space-xs);
        }

        #call-dialogue {
            text-align: left;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: var(--space-md);
            min-height: 100px;
            margin-bottom: var(--space-lg);
            font-style: italic;
            color: var(--light);
            line-height: 1.7;
        }

        .call-actions {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            margin-bottom: var(--space-md);
        }

        #call-complete-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            padding-top: var(--space-md);
            border-top: 1px solid var(--medium-dark);
        }

        #call-complete-actions .btn-primary {
            width: 100%;
        }

        #call-complete-actions .btn-secondary {
            width: 100%;
        }

        .phone-note {
            font-size: 0.8rem;
            color: var(--medium-light);
            text-align: center;
            padding: var(--space-md);
            margin-top: var(--space-md);
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
        }

        .phone-note.collected {
            color: var(--success-green);
            background: rgba(34, 197, 94, 0.1);
        }

        /* Submit Modal */
        .submit-form {
            width: 600px;
        }

        .submit-form h2 {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            color: var(--lightest);
            margin-bottom: var(--space-lg);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-group label {
            display: block;
            font-family: var(--font-heading);
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--medium-light);
            margin-bottom: var(--space-sm);
        }

        .form-group select {
            width: 100%;
            padding: var(--space-md);
            background: var(--dark);
            border: 1px solid var(--medium-dark);
            border-radius: 6px;
            color: var(--lightest);
            font-family: var(--font-body);
            font-size: 1rem;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .form-group select:hover,
        .form-group select:focus {
            border-color: var(--warm-gold);
            outline: none;
        }

        .current-cost-display {
            font-family: var(--font-mono);
            font-size: 1.3rem;
            color: var(--money-red);
            text-align: center;
            padding: var(--space-md);
            background: rgba(220, 38, 38, 0.1);
            border-radius: 6px;
            margin-bottom: var(--space-md);
        }

        .classification-summary {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .classification-summary h3 {
            font-family: var(--font-heading);
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--warm-gold);
            margin-bottom: var(--space-md);
        }

        .review-category {
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--medium-dark);
            font-size: 0.9rem;
            color: var(--light);
        }

        .review-category:last-child {
            border-bottom: none;
        }

        .review-category strong {
            color: var(--lightest);
        }

        .submit-warning {
            color: var(--warning-amber);
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: var(--space-lg);
        }

        .submit-buttons {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
        }

        /* Fix Modal */
        /* ============================================
           SOLUTION SELECTION MODAL
           ============================================ */
        .solution-content {
            width: 95%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .solution-counter-mini {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            gap: 12px;
            font-family: var(--font-mono);
            font-size: 0.75rem;
            padding: 6px 12px;
            background: rgba(0,0,0,0.4);
            border-radius: 4px;
            border: 1px solid var(--medium-dark);
        }
        
        .counter-time-mini {
            color: var(--lightest);
        }
        
        .counter-cost-mini {
            color: var(--money-red);
        }

        .solution-progress {
            text-align: center;
            margin-bottom: var(--space-lg);
            padding-top: var(--space-md);
        }
        
        #solution-progress-text {
            font-family: var(--font-heading);
            font-size: 0.85rem;
            color: var(--medium-light);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        .solution-progress-bar {
            width: 100%;
            height: 6px;
            background: var(--medium-dark);
            border-radius: 3px;
            margin-top: var(--space-sm);
            overflow: hidden;
        }
        
        .solution-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--warm-gold), #d4a817);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        #current-solution-step {
            margin-bottom: var(--space-lg);
        }

        .solution-step {
            background: rgba(0, 0, 0, 0.25);
            border-radius: 8px;
            padding: var(--space-lg);
            border-left: 4px solid var(--medium-dark);
        }

        .solution-step.root-cause-step {
            border-left-color: var(--money-red);
        }

        .solution-step.contributing-step,
        .solution-step.issue-step {
            border-left-color: var(--warning-amber);
        }

        .solution-step-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .solution-step-badge {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            padding: 4px 10px;
            border-radius: 4px;
            background: var(--money-red);
            color: var(--lightest);
        }

        .contributing-step .solution-step-badge,
        .issue-step .solution-step-badge {
            background: var(--warning-amber);
            color: var(--darkest);
        }

        .solution-step-title {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            color: var(--lightest);
        }
        
        .solution-step-description {
            color: var(--medium-light);
            font-size: 0.85rem;
            line-height: 1.5;
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }

        .solution-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .solution-option {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--dark);
            border: 2px solid var(--medium-dark);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .solution-option:hover {
            border-color: var(--warm-gold);
            background: rgba(184, 134, 11, 0.05);
        }

        .solution-option.selected {
            border-color: var(--warm-gold);
            background: rgba(184, 134, 11, 0.15);
        }

        .solution-option input[type="radio"] {
            margin-top: 3px;
            accent-color: var(--warm-gold);
            flex-shrink: 0;
            width: 18px;
            height: 18px;
        }

        .solution-option-content {
            flex: 1;
        }

        .solution-option-text {
            color: var(--lightest);
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: var(--space-xs);
        }

        .solution-option-cost {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: var(--money-red);
        }

        .solution-actions {
            display: flex;
            justify-content: center;
            padding-top: var(--space-md);
            border-top: 1px solid var(--medium-dark);
        }

        #submit-solution-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ============================================
           RESULTS SCREEN - PAGINATED REPORT
           ============================================ */
        #results-screen {
            background: linear-gradient(180deg, #1a1f2e 0%, #0d1117 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-lg);
            overflow: hidden;
        }

        .report-book {
            max-width: 800px;
            width: 100%;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 40px);
            max-height: 900px;
        }
        
        /* Report Navigation Tabs */
        .report-nav {
            display: flex;
            gap: 2px;
            background: rgba(0,0,0,0.3);
            padding: 4px;
            border-radius: 8px 8px 0 0;
        }
        
        .report-nav-btn {
            flex: 1;
            padding: var(--space-sm) var(--space-md);
            background: transparent;
            border: none;
            color: var(--medium-light);
            font-family: var(--font-heading);
            font-size: 0.85rem;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .report-nav-btn:hover {
            background: rgba(255,255,255,0.05);
            color: var(--light);
        }
        
        .report-nav-btn.active {
            background: var(--warm-gold);
            color: var(--darkest);
        }
        
        /* Pages Container */
        .report-pages-container {
            flex: 1;
            background: linear-gradient(145deg, #1e2433 0%, #161b26 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 0 0 8px 8px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05);
        }
        
        /* Individual Pages */
        .report-page {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.3s ease;
            pointer-events: none;
            overflow: hidden;
        }
        
        .report-page.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
        }
        
        .page-content {
            flex: 1;
            padding: var(--space-xl);
            overflow-y: auto;
        }
        
        /* Custom Scrollbar */
        .page-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .page-content::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }
        
        .page-content::-webkit-scrollbar-thumb {
            background: rgba(212, 175, 55, 0.4);
            border-radius: 3px;
        }
        
        .page-content::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 175, 55, 0.6);
        }
        
        /* Firefox scrollbar */
        .page-content {
            scrollbar-width: thin;
            scrollbar-color: rgba(212, 175, 55, 0.4) rgba(0,0,0,0.2);
        }
        
        .page-header {
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .page-number {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: var(--medium);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: var(--space-sm);
        }
        
        .report-title {
            font-family: var(--font-heading);
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--lightest);
            margin: 0;
        }
        
        .report-subtitle {
            font-size: 0.9rem;
            color: var(--medium-light);
            margin-top: var(--space-xs);
        }
        
        .page-title {
            font-family: var(--font-heading);
            font-size: 1.4rem;
            color: var(--lightest);
            margin: 0;
        }
        
        .page-intro {
            color: var(--medium-light);
            font-size: 0.9rem;
            margin-top: var(--space-xs);
        }
        
        /* Page Footer with Navigation */
        .page-footer {
            display: flex;
            justify-content: space-between;
            padding: var(--space-md) var(--space-xl);
            background: rgba(0,0,0,0.2);
            border-top: 1px solid rgba(255,255,255,0.05);
        }
        
        .page-turn-btn {
            padding: var(--space-sm) var(--space-lg);
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--light);
            font-family: var(--font-heading);
            font-size: 0.85rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .page-turn-btn:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: var(--warm-gold);
            color: var(--warm-gold);
        }
        
        .page-turn-btn.prev { margin-right: auto; }
        .page-turn-btn.next { margin-left: auto; }
        
        /* Report Actions */
        .report-actions {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            padding: var(--space-lg) 0 var(--space-sm) 0;
        }
        
        .navigation-hint {
            text-align: center;
            color: var(--medium);
            font-size: 0.85rem;
            font-style: italic;
            padding-bottom: var(--space-md);
        }
        
        /* Executive Summary Styles */
        .executive-summary {
            margin-bottom: var(--space-lg);
        }
        
        /* Dual Score Display */
        .dual-score-display {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .score-card {
            flex: 1;
            text-align: center;
            padding: var(--space-lg);
            border-radius: 8px;
            border: 2px solid;
        }
        
        .score-card.cost-card {
            background: rgba(220, 38, 38, 0.1);
            border-color: rgba(220, 38, 38, 0.3);
        }
        
        .score-card.avoid-card {
            background: rgba(46, 125, 50, 0.1);
            border-color: rgba(46, 125, 50, 0.3);
        }
        
        .score-card-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--medium-light);
            margin-bottom: var(--space-xs);
        }
        
        .score-card-value {
            font-family: var(--font-mono);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: var(--space-xs);
        }
        
        .cost-card .score-card-value { color: var(--money-red); }
        .avoid-card .score-card-value { color: var(--success-green); }
        
        .score-card-target {
            font-size: 0.75rem;
            color: var(--medium);
            margin-bottom: var(--space-sm);
        }
        
        .score-card-rating {
            font-size: 1rem;
            letter-spacing: 2px;
        }
        
        .cost-card .score-card-rating { color: var(--money-red); }
        .avoid-card .score-card-rating { color: var(--success-green); }
        
        .summary-stats {
            display: flex;
            justify-content: space-around;
            padding-top: var(--space-md);
            border-top: 1px solid var(--medium-dark);
        }
        
        .summary-stat-item {
            text-align: center;
        }
        
        .summary-stat-item .stat-label {
            display: block;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--medium);
            margin-bottom: 2px;
        }
        
        .summary-stat-item .stat-value {
            font-family: var(--font-mono);
            font-size: 1rem;
            color: var(--lightest);
        }
        
        .summary-stat-item .stat-value.good { color: var(--success-green); }
        .summary-stat-item .stat-value.bad { color: var(--money-red); }
        .summary-stat-item .stat-value.partial { color: var(--warning-amber); }
        
        /* Classification Warning */
        .classification-warning {
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.4);
            border-radius: 6px;
            padding: var(--space-sm) var(--space-md);
            margin-bottom: var(--space-md);
            font-size: 0.85rem;
            color: var(--warning-amber);
            text-align: center;
        }

        /* Dual Breakdown */
        .dual-breakdown {
            display: flex;
            gap: var(--space-lg);
        }
        
        .breakdown-column {
            flex: 1;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .breakdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            font-family: var(--font-heading);
        }
        
        .breakdown-header.cost-header {
            background: rgba(220, 38, 38, 0.15);
            border-bottom: 2px solid rgba(220, 38, 38, 0.3);
        }
        
        .breakdown-header.avoid-header {
            background: rgba(46, 125, 50, 0.15);
            border-bottom: 2px solid rgba(46, 125, 50, 0.3);
        }
        
        .breakdown-title {
            font-size: 0.85rem;
            color: var(--lightest);
        }
        
        .breakdown-total {
            font-family: var(--font-mono);
            font-size: 1.1rem;
            font-weight: 700;
        }
        
        .cost-header .breakdown-total { color: var(--money-red); }
        .avoid-header .breakdown-total { color: var(--success-green); }
        
        .breakdown-rows {
            padding: var(--space-md);
        }
        
        .breakdown-row {
            display: flex;
            justify-content: space-between;
            padding: var(--space-xs) 0;
            font-size: 0.8rem;
            color: var(--light);
        }
        
        .breakdown-row .value {
            font-family: var(--font-mono);
        }
        
        .breakdown-row.positive .value { color: var(--success-green); }
        .breakdown-row.negative .value { color: var(--money-red); }
        .breakdown-row.missed {
            color: var(--medium);
            font-style: italic;
        }
        
        .breakdown-target {
            padding: var(--space-sm) var(--space-md);
            font-size: 0.7rem;
            text-align: center;
            color: var(--medium);
            background: rgba(0,0,0,0.2);
        }
        
        .breakdown-target.achieved {
            color: var(--success-green);
            background: rgba(46, 125, 50, 0.1);
        }

        .report-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .report-section h2 {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--lightest);
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid var(--medium-dark);
        }

        /* Epilogue */
        #epilogue-section {
            border-left: 3px solid var(--warm-gold);
            background: rgba(184, 134, 11, 0.05);
        }

        #epilogue-section h2 {
            color: var(--warm-gold);
            border-bottom: none;
            font-size: 1rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-top: var(--space-lg);
        }

        #epilogue-section h2:first-child {
            margin-top: 0;
        }

        #epilogue-section p {
            color: var(--light);
            line-height: 1.7;
        }

        /* Conclusion Cards */
        .findings-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .findings-table th {
            text-align: left;
            padding: var(--space-sm) var(--space-md);
            background: rgba(0,0,0,0.3);
            color: var(--warm-gold);
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid var(--medium-dark);
        }
        
        .findings-table td {
            padding: var(--space-sm) var(--space-md);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            color: var(--light);
        }
        
        .findings-table .clickable-row {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .findings-table .clickable-row:hover td {
            background: rgba(255,255,255,0.05);
        }
        
        .findings-table .row-success td { background: rgba(34, 197, 94, 0.08); }
        .findings-table .row-partial td { background: rgba(217, 119, 6, 0.08); }
        .findings-table .row-missed td { background: rgba(239, 68, 68, 0.08); }
        
        .findings-table .problem-name { font-weight: 500; color: var(--lightest); }
        .findings-table .problem-location { color: var(--medium-light); font-size: 0.85rem; }
        .findings-table .status-cell { text-align: center; font-size: 1.1rem; }
        .findings-table .arrow-cell { text-align: center; color: var(--medium); font-size: 1.2rem; }
        
        .status-icon.good { color: var(--success-green); }
        .status-icon.bad { color: var(--money-red); }
        .status-icon.neutral { color: var(--medium); }
        .status-icon.partial { color: var(--warning-amber); font-weight: bold; }
        
        .findings-table .row-misclassified td { background: rgba(255, 179, 0, 0.12); }

        .conclusion-card {
            background: var(--dark);
            border-radius: 8px;
            overflow: hidden;
            border-left: 4px solid var(--medium-dark);
        }
        
        .conclusion-card.correct { border-left-color: var(--success-green); }
        .conclusion-card.partial { border-left-color: var(--warning-amber); }
        .conclusion-card.wrong { border-left-color: var(--money-red); }
        .conclusion-card.wasted { border-left-color: var(--money-red); }
        
        /* Actions Page Styles */
        .actions-summary-cards {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .summary-card {
            flex: 1;
            padding: var(--space-lg);
            border-radius: 8px;
            text-align: center;
        }
        
        .summary-card.cost-card {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.3);
        }
        
        .summary-card.avoid-card {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .summary-card .card-label {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--medium-light);
            margin-bottom: var(--space-xs);
        }
        
        .summary-card .card-value {
            font-family: var(--font-mono);
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .summary-card .card-value.cost { color: var(--money-red); }
        .summary-card .card-value.avoided { color: var(--success-green); }
        
        .summary-card .card-note {
            font-size: 0.8rem;
            color: var(--medium);
            margin-top: var(--space-xs);
        }
        
        .actions-subtitle {
            font-family: var(--font-heading);
            font-size: 1rem;
            color: var(--lightest);
            margin: var(--space-lg) 0 var(--space-md) 0;
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .actions-subtitle.missed-subtitle {
            color: var(--money-red);
            border-bottom-color: rgba(239, 68, 68, 0.3);
        }
        
        .actions-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        .actions-table th {
            text-align: left;
            padding: var(--space-sm);
            background: rgba(0,0,0,0.3);
            color: var(--warm-gold);
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            border-bottom: 2px solid var(--medium-dark);
        }
        
        .actions-table td {
            padding: var(--space-sm);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            color: var(--light);
            vertical-align: top;
        }
        
        .actions-table .num-col {
            text-align: right;
            font-family: var(--font-mono);
            white-space: nowrap;
        }
        
        .actions-table .action-text {
            color: var(--medium-light);
            font-size: 0.8rem;
            max-width: 200px;
        }
        
        .actions-table .cost-val { color: var(--money-red); }
        .actions-table .avoided-val { color: var(--success-green); }
        .actions-table .missed-val { color: var(--warning-amber); font-style: italic; }
        .actions-table .partial-val { color: var(--warning-amber); }
        
        .actions-table .time-row td { background: rgba(255,255,255,0.02); }
        .actions-table .success-row td { background: rgba(34, 197, 94, 0.06); }
        .actions-table .wrong-row td { background: rgba(217, 119, 6, 0.06); }
        .actions-table .wasted-row td { background: rgba(239, 68, 68, 0.06); }
        .actions-table .missed-row td { background: rgba(239, 68, 68, 0.04); }
        .actions-table .misclassified-row td { background: rgba(255, 179, 0, 0.1); }
        
        .wasted-badge {
            display: inline-block;
            font-size: 0.65rem;
            padding: 1px 5px;
            background: rgba(239, 68, 68, 0.2);
            color: var(--money-red);
            border-radius: 3px;
            margin-left: var(--space-xs);
            font-weight: 600;
        }
        
        .misclass-badge {
            display: inline-block;
            font-size: 0.6rem;
            padding: 1px 5px;
            background: rgba(255, 179, 0, 0.25);
            color: var(--warning-amber);
            border-radius: 3px;
            margin-left: var(--space-xs);
            font-weight: 600;
        }
        
        .saving-reduced {
            font-size: 0.75rem;
            color: var(--warning-amber);
            font-style: italic;
        }
        
        /* Missed Opportunities Cards */
        .missed-intro {
            color: var(--medium-light);
            font-size: 0.85rem;
            margin-bottom: var(--space-md);
            font-style: italic;
        }
        
        .missed-opportunity-card {
            background: rgba(239, 68, 68, 0.05);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-left: 4px solid var(--money-red);
            border-radius: 8px;
            margin-bottom: var(--space-md);
            overflow: hidden;
        }
        
        .missed-card-header {
            padding: var(--space-md);
            background: rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .missed-card-title {
            font-weight: 600;
            color: var(--lightest);
        }
        
        .missed-card-location {
            font-size: 0.8rem;
            color: var(--medium);
        }
        
        .missed-card-body {
            padding: var(--space-md);
        }
        
        .missed-card-fix {
            margin-bottom: var(--space-sm);
            padding: var(--space-sm);
            background: rgba(34, 197, 94, 0.1);
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        .missed-card-fix strong {
            color: var(--success-green);
        }
        
        .missed-card-why {
            font-size: 0.85rem;
            padding: var(--space-sm);
            background: rgba(245, 158, 11, 0.1);
            border-radius: 4px;
        }
        
        .missed-card-why strong {
            color: var(--warning-amber);
        }
        
        .missed-card-costs {
            display: flex;
            gap: var(--space-sm);
            padding: var(--space-md);
            background: rgba(0,0,0,0.2);
        }
        
        .missed-card-costs .cost-item {
            flex: 1;
            text-align: center;
            padding: var(--space-sm);
            border-radius: 4px;
            background: rgba(0,0,0,0.2);
        }
        
        .missed-card-costs .cost-label {
            display: block;
            font-size: 0.7rem;
            color: var(--medium);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 2px;
        }
        
        .missed-card-costs .cost-value {
            font-family: var(--font-mono);
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .missed-card-costs .cost-item.avoided .cost-value {
            color: var(--warning-amber);
        }
        
        .missed-card-costs .cost-item.net .cost-value {
            color: var(--money-red);
        }
        
        /* Summary Table Styles */
        .summary-table-section {
            background: var(--dark);
            border-radius: 12px;
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
        }
        
        .summary-table-section h3 {
            font-family: var(--font-heading);
            font-size: 1.3rem;
            color: var(--lightest);
            margin-bottom: var(--space-sm);
        }
        
        .summary-table-intro {
            color: var(--medium-light);
            margin-bottom: var(--space-lg);
            font-size: 0.9rem;
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .summary-table th {
            text-align: left;
            padding: var(--space-sm) var(--space-md);
            background: rgba(0,0,0,0.3);
            color: var(--warm-gold);
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid var(--medium-dark);
        }
        
        .summary-table td {
            padding: var(--space-sm) var(--space-md);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            color: var(--light);
        }
        
        .summary-table tr:hover td {
            background: rgba(255,255,255,0.03);
        }
        
        .table-location {
            color: var(--medium-light);
            font-size: 0.85rem;
        }
        
        .table-problem {
            color: var(--lightest);
            font-weight: 500;
        }
        
        .table-badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .badge-root {
            background: rgba(220, 38, 38, 0.25);
            color: #ff6b6b;
        }
        
        .badge-other {
            background: rgba(217, 119, 6, 0.25);
            color: var(--warning-amber);
        }
        
        .table-check {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .cell-correct {
            color: var(--success-green);
        }
        
        .cell-wrong {
            color: var(--money-red);
        }
        
        .cell-na {
            color: var(--medium);
        }
        
        .row-success td {
            background: rgba(34, 197, 94, 0.08);
        }
        
        .row-partial td {
            background: rgba(217, 119, 6, 0.08);
        }
        
        .row-missed td {
            background: rgba(239, 68, 68, 0.08);
        }
        
        /* Results section titles */
        .results-section-title {
            font-family: var(--font-heading);
            font-size: 1.2rem;
            color: var(--success-green);
            margin: var(--space-xl) 0 var(--space-md) 0;
            padding-bottom: var(--space-sm);
            border-bottom: 2px solid var(--success-green);
        }
        
        .results-section-title.missed-title {
            color: var(--money-red);
            border-bottom-color: var(--money-red);
        }
        
        .results-section-title.decoy-title {
            color: var(--warning-amber);
            border-bottom-color: var(--warning-amber);
        }
        
        .no-findings, .all-found, .decoy-intro {
            color: var(--medium-light);
            font-style: italic;
            padding: var(--space-md);
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: var(--space-md);
        }
        
        .all-found {
            color: var(--success-green);
            background: rgba(34, 197, 94, 0.1);
        }
        
        .problem-location {
            color: var(--medium-light);
            font-size: 0.85rem;
            margin-bottom: var(--space-sm);
        }
        
        .outcome-good {
            color: var(--success-green);
            font-weight: 600;
        }
        
        .outcome-bad {
            color: var(--money-red);
            font-weight: 600;
        }
        
        .correct-action, .wrong-action {
            margin: var(--space-sm) 0;
            padding: var(--space-sm) var(--space-md);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .correct-action {
            background: rgba(34, 197, 94, 0.1);
            border-left: 3px solid var(--success-green);
        }
        
        .wrong-action {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid var(--money-red);
        }
        
        .regulatory-note {
            margin: var(--space-sm) 0;
            padding: var(--space-sm) var(--space-md);
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        .regulatory-note.success {
            background: rgba(34, 197, 94, 0.1);
            color: var(--light);
        }
        
        .regulatory-note.warning {
            background: rgba(239, 68, 68, 0.1);
            color: var(--light);
        }
        
        .consequence-note {
            margin: var(--space-sm) 0;
            padding: var(--space-sm) var(--space-md);
            background: rgba(239, 68, 68, 0.15);
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--money-red);
        }
        
        /* Missed item body styling */
        .missed-body {
            padding: var(--space-lg);
        }
        
        .missed-body > div {
            margin-bottom: var(--space-sm);
        }
        
        .conclusion-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) var(--space-lg);
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .conclusion-status {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
        }
        
        .correct .conclusion-status { background: var(--success-green); color: white; }
        .partial .conclusion-status { background: var(--warning-amber); color: var(--darkest); }
        .wrong .conclusion-status { background: var(--money-red); color: white; }
        .wasted .conclusion-status { background: var(--money-red); color: white; }
        
        .conclusion-title {
            flex: 1;
            font-family: var(--font-heading);
            font-size: 1rem;
            color: var(--lightest);
        }
        
        .conclusion-category {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .conclusion-category.root-cause { background: rgba(220, 38, 38, 0.25); color: #ff6b6b; }
        .conclusion-category.contributing { background: rgba(217, 119, 6, 0.25); color: var(--warning-amber); }
        .conclusion-category.other-problem { background: rgba(217, 119, 6, 0.25); color: var(--warning-amber); }
        .conclusion-category.not-a-problem { background: rgba(100, 100, 100, 0.25); color: var(--medium-light); }
        .conclusion-category.red-herring { background: rgba(100, 100, 100, 0.25); color: var(--medium-light); }
        .conclusion-category.irrelevant { background: rgba(50, 50, 50, 0.25); color: var(--medium); }
        
        .conclusion-body {
            padding: var(--space-lg);
        }
        
        .your-decision {
            font-size: 0.85rem;
            color: var(--medium-light);
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            line-height: 1.6;
        }
        
        .conclusion-result {
            font-size: 0.9rem;
            color: var(--lightest);
            line-height: 1.5;
            margin-bottom: var(--space-md);
        }
        
        .conclusion-lesson {
            background: rgba(184, 134, 11, 0.1);
            border: 1px solid rgba(184, 134, 11, 0.3);
            border-radius: 6px;
            padding: var(--space-md);
            font-size: 0.85rem;
            color: var(--lightest);
            line-height: 1.5;
        }
        
        .conclusion-lesson strong {
            color: var(--warm-gold);
        }
        
        .conclusion-financials {
            display: flex;
            gap: var(--space-lg);
            padding: var(--space-md) var(--space-lg);
            background: rgba(0,0,0,0.2);
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .fin-item {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: var(--medium-light);
        }
        
        .fin-item.positive { color: var(--success-green); }
        .fin-item.negative { color: var(--money-red); }

        /* Missed Section */
        #missed-section.hidden { display: none; }

        .missed-item {
            background: var(--dark);
            border-left: 4px solid var(--warning-amber);
            border-radius: 0 8px 8px 0;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
        }
        
        .missed-item.critical {
            border-left-color: var(--money-red);
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.1) 0%, var(--dark) 100%);
        }
        
        .missed-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }
        
        .missed-badge {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--warning-amber);
            color: var(--darkest);
        }
        
        .missed-badge.critical {
            background: var(--money-red);
            color: white;
        }

        .missed-item h4 {
            font-family: var(--font-heading);
            font-size: 1rem;
            color: var(--lightest);
            margin: 0;
        }

        .missed-location {
            font-size: 0.8rem;
            color: var(--medium-light);
            margin-bottom: var(--space-md);
        }

        .missed-consequence,
        .missed-regulatory,
        .missed-fix,
        .missed-financial {
            font-size: 0.85rem;
            color: var(--light);
            margin-bottom: var(--space-md);
            line-height: 1.5;
            padding: var(--space-sm) var(--space-md);
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        
        .missed-consequence strong,
        .missed-regulatory strong,
        .missed-fix strong,
        .missed-financial strong {
            display: block;
            margin-bottom: var(--space-xs);
        }
        
        .missed-consequence strong { color: var(--lightest); }
        .missed-regulatory strong { color: var(--money-red); }
        .missed-fix strong { color: var(--success-green); }
        .missed-financial strong { color: var(--warm-gold); }

        /* Score Breakdown */
        .score-breakdown-new {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .score-row {
            display: flex;
            justify-content: space-between;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .score-row:last-child { border-bottom: none; }

        .score-row .label { color: var(--medium-light); }
        .score-row .value {
            font-family: var(--font-mono);
            color: var(--light);
        }
        
        .score-row .value.positive { color: var(--success-green); }
        .score-row .value.negative { color: var(--money-red); }
        
        .score-section-title {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            color: var(--medium);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: var(--space-md);
            margin-bottom: var(--space-xs);
        }
        
        .score-section-title:first-child {
            margin-top: 0;
        }
        
        .score-row.positive-section {
            background: rgba(46, 125, 50, 0.1);
            margin: 0 calc(var(--space-md) * -1);
            padding-left: var(--space-md);
            padding-right: var(--space-md);
            border-radius: 4px;
        }

        .score-row.total {
            border-top: 2px solid var(--medium-dark);
            margin-top: var(--space-md);
            padding-top: var(--space-md);
        }

        .score-row.total .label {
            font-family: var(--font-heading);
            font-weight: 600;
            color: var(--lightest);
        }

        .score-row.total .value {
            font-size: 1.3rem;
        }

        .score-row.total .value.positive { color: var(--success-green); }
        .score-row.total .value.negative { color: var(--money-red); }
        
        .score-summary {
            display: flex;
            justify-content: space-around;
            margin-top: var(--space-lg);
            padding-top: var(--space-md);
            border-top: 1px solid var(--medium-dark);
        }
        
        .summary-stat {
            text-align: center;
        }
        
        .summary-stat .stat-label {
            display: block;
            font-size: 0.7rem;
            color: var(--medium);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-xs);
        }
        
        .summary-stat .stat-value {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--lightest);
        }
        
        .summary-stat .stat-value.good { color: var(--success-green); }
        .summary-stat .stat-value.bad { color: var(--money-red); }

        /* Rating Section */
        .rating-section {
            text-align: center;
            padding: var(--space-xl);
        }

        #rank-display { margin-bottom: 0; }

        #rank-stars {
            font-size: 3rem;
            color: var(--warm-gold);
            text-shadow: 0 0 20px var(--gold-glow);
            margin-bottom: var(--space-sm);
            animation: starsIn 0.5s ease;
        }

        @keyframes starsIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        #rank-title {
            font-family: var(--font-heading);
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--lightest);
            margin-bottom: var(--space-xs);
        }
        
        #rank-band {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: var(--warm-gold);
            background: rgba(184, 134, 11, 0.15);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: var(--space-sm);
        }

        #rank-desc {
            font-size: 0.9rem;
            color: var(--medium-light);
            margin-bottom: var(--space-md);
        }
        
        #rank-criteria {
            text-align: left;
            display: inline-block;
            background: rgba(0,0,0,0.2);
            padding: var(--space-md);
            border-radius: 8px;
            margin-top: var(--space-sm);
        }
        
        #rank-criteria .criterion {
            font-size: 0.8rem;
            color: var(--light);
            margin-bottom: var(--space-xs);
            line-height: 1.4;
        }
        
        #rank-criteria .criterion:last-child {
            margin-bottom: 0;
        }
        
        #rank-criteria .criterion.good {
            color: var(--success-green);
        }
        
        #rank-criteria .criterion.partial {
            color: var(--warning-amber);
        }
        
        #rank-criteria .criterion.bad {
            color: var(--money-red);
        }

        /* Learning Points */
        #learning-points {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        /* Takeaway Cards */
        .takeaway-card {
            display: flex;
            gap: var(--space-md);
            padding: var(--space-md);
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: var(--space-md);
            border-left: 3px solid var(--warm-gold);
        }
        
        .takeaway-card.highlight {
            background: rgba(212, 175, 55, 0.1);
            border-left-width: 4px;
        }
        
        .takeaway-number {
            width: 32px;
            height: 32px;
            background: var(--warm-gold);
            color: var(--darkest);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .takeaway-card.highlight .takeaway-number {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            font-size: 1rem;
        }
        
        .takeaway-content h4 {
            font-family: var(--font-heading);
            font-size: 0.95rem;
            color: var(--lightest);
            margin: 0 0 var(--space-xs) 0;
        }
        
        .takeaway-content p {
            font-size: 0.85rem;
            color: var(--light);
            line-height: 1.5;
            margin: 0;
            margin-bottom: var(--space-sm);
        }
        
        .takeaway-content p:last-child {
            margin-bottom: 0;
        }
        
        /* Regulatory takeaway card */
        .takeaway-card.regulatory {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            margin-top: var(--space-lg);
        }
        
        .takeaway-card.regulatory .takeaway-number {
            background: #3b82f6;
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
        }
        
        .takeaway-card.regulatory h4 {
            color: #60a5fa;
        }
        
        .takeaway-card.regulatory strong {
            color: var(--lightest);
        }
        
        .takeaway-card.regulatory em {
            color: #60a5fa;
            font-style: normal;
            font-weight: 600;
        }
        
        /* CDM Warning takeaway card - red/danger theme */
        .takeaway-card.cdm-warning {
            background: rgba(220, 38, 38, 0.12);
            border-left: 4px solid #dc2626;
            margin-top: var(--space-md);
        }
        
        .takeaway-card.cdm-warning .takeaway-number {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            width: 44px;
            height: 44px;
            font-size: 1.4rem;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.4);
        }
        
        .takeaway-card.cdm-warning h4 {
            color: #f87171;
        }
        
        .takeaway-card.cdm-warning strong {
            color: #fecaca;
        }
        
        .takeaway-card.cdm-warning em {
            color: #f87171;
            font-style: normal;
            font-weight: 600;
        }

        /* Perfect Solution Section */
        .perfect-solution-section {
            padding: var(--space-md) 0;
        }
        
        .full-solution-section {
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .full-solution-section h4 {
            font-family: var(--font-heading);
            font-size: 1rem;
            margin: 0 0 var(--space-sm) 0;
        }
        
        .full-solution-section p {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--light);
        }

        /* Reveal Toggle - keep for backwards compat */
        .reveal-toggle {
            width: 100%;
            background: var(--dark);
            border: 1px solid var(--medium-dark);
            border-radius: 6px;
            padding: var(--space-md);
            color: var(--lightest);
            font-family: var(--font-heading);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .reveal-toggle:hover {
            border-color: var(--warm-gold);
            background: rgba(184, 134, 11, 0.1);
        }

        .reveal-toggle.open {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }

        .reveal-content {
            background: var(--dark);
            border: 1px solid var(--medium-dark);
            border-top: none;
            border-radius: 0 0 6px 6px;
            padding: var(--space-lg);
        }

        .reveal-content.hidden { display: none; }

        .full-solution-section {
            margin-bottom: var(--space-lg);
        }

        .full-solution-section:last-child { margin-bottom: 0; }

        .full-solution-section h4 {
            font-family: var(--font-heading);
            font-size: 0.9rem;
            color: var(--warm-gold);
            margin-bottom: var(--space-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .full-solution-section p {
            font-size: 0.85rem;
            color: var(--light);
            line-height: 1.6;
            margin-bottom: var(--space-sm);
        }

        .correct-fix {
            background: rgba(46, 125, 50, 0.1);
            border-left: 3px solid var(--success-green);
            padding: var(--space-sm) var(--space-md);
            border-radius: 0 4px 4px 0;
            font-size: 0.85rem;
            color: var(--success-green);
        }
        
        .fix-note {
            display: block;
            font-size: 0.85rem;
            color: var(--success-green);
            margin-top: 4px;
            padding-left: var(--space-md);
        }
        
        .decoy-list {
            list-style: none;
            padding: 0;
            margin: var(--space-md) 0;
        }
        
        .decoy-list li {
            padding: var(--space-xs) 0;
            color: var(--medium-light);
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .decoy-list li:last-child {
            border-bottom: none;
        }

        /* Detail Modal for clicking findings */
        .detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: var(--space-lg);
        }
        
        .detail-modal.hidden {
            display: none;
        }
        
        .detail-modal-content {
            background: linear-gradient(145deg, #1e2433 0%, #161b26 100%);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        
        .detail-close {
            position: absolute;
            top: var(--space-md);
            right: var(--space-md);
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 50%;
            color: var(--light);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .detail-close:hover {
            background: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
        
        #detail-modal-body {
            padding: var(--space-xl);
        }
        
        .detail-header {
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-lg);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .detail-header h3 {
            font-family: var(--font-heading);
            font-size: 1.3rem;
            color: var(--lightest);
            margin: var(--space-sm) 0;
        }
        
        .detail-location {
            font-size: 0.85rem;
            color: var(--medium);
        }
        
        .detail-status {
            display: inline-block;
            padding: var(--space-xs) var(--space-md);
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-top: var(--space-sm);
        }
        
        .detail-status.correct {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success-green);
        }
        
        .detail-status.wrong {
            background: rgba(239, 68, 68, 0.2);
            color: var(--money-red);
        }
        
        .detail-status.partial {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning-amber);
        }
        
        .detail-badge {
            display: inline-block;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .detail-badge.root {
            background: rgba(220, 38, 38, 0.25);
            color: #ff6b6b;
        }
        
        .detail-badge.other {
            background: rgba(217, 119, 6, 0.25);
            color: var(--warning-amber);
        }
        
        .detail-section {
            margin-bottom: var(--space-md);
            padding: var(--space-md);
            border-radius: 8px;
            background: rgba(0,0,0,0.2);
        }
        
        .detail-section h4 {
            font-family: var(--font-heading);
            font-size: 0.85rem;
            margin: 0 0 var(--space-sm) 0;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .detail-section p {
            color: var(--light);
            line-height: 1.6;
            margin: 0;
            font-size: 0.9rem;
        }
        
        /* Coloured detail sections */
        .detail-section.solution-section {
            border-left: 3px solid var(--success-green);
        }
        .detail-section.solution-section h4 { color: var(--success-green); }
        
        .detail-section.wrong-section {
            border-left: 3px solid var(--money-red);
        }
        .detail-section.wrong-section h4 { color: var(--money-red); }
        
        .detail-section.partial-solution-section {
            border-left: 3px solid var(--warning-amber);
        }
        .detail-section.partial-solution-section h4 { color: var(--warning-amber); }
        
        .detail-section.misclassified-section {
            border-left: 3px solid var(--warning-amber);
            background: rgba(255, 179, 0, 0.1);
        }
        .detail-section.misclassified-section h4 { color: var(--warning-amber); }
        .detail-section.misclassified-section p { margin-bottom: var(--space-sm); }
        .detail-section.misclassified-section p:last-child { margin-bottom: 0; }
        .detail-section.misclassified-section strong { color: var(--lightest); }
        .detail-section.misclassified-section em { color: var(--warning-amber); font-style: normal; }
        
        .detail-section.consequence-section {
            border-left: 3px solid var(--warning-amber);
            background: rgba(245, 158, 11, 0.08);
        }
        .detail-section.consequence-section h4 { color: var(--warning-amber); }
        
        .detail-section.regulatory-section {
            border-left: 3px solid #f97316;
            background: rgba(249, 115, 22, 0.08);
        }
        .detail-section.regulatory-section h4 { color: #f97316; }
        
        .detail-section.financial-section {
            border-left: 3px solid var(--money-red);
            background: rgba(239, 68, 68, 0.08);
        }
        .detail-section.financial-section h4 { color: var(--money-red); }
        
        .detail-section.learning-section {
            border-left: 3px solid var(--warm-gold);
            background: rgba(212, 175, 55, 0.08);
        }
        .detail-section.learning-section h4 { color: var(--warm-gold); }
        
        /* Misclassified status styling */
        .detail-status.misclassified {
            color: var(--warning-amber);
            background: rgba(255, 179, 0, 0.15);
        }
        
        .detail-header.misclassified {
            border-left-color: var(--warning-amber);
        }
        
        .solution-correct {
            color: var(--success-green);
        }
        
        .solution-wrong {
            color: var(--money-red);
        }
        
        .click-hint {
            text-align: center;
            color: var(--medium);
            font-size: 0.8rem;
            margin-bottom: var(--space-md);
            font-style: italic;
        }

        /* Clickable Finding Row */
        .finding-row-clickable {
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            gap: var(--space-md);
            align-items: center;
            padding: var(--space-md);
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            margin-bottom: var(--space-xs);
            cursor: pointer;
            border-left: 4px solid transparent;
            transition: all 0.2s ease;
        }
        
        .finding-row-clickable:hover {
            background: rgba(255,255,255,0.05);
            transform: translateX(4px);
        }
        
        .finding-row-clickable.status-correct {
            border-left-color: var(--success-green);
        }
        
        .finding-row-clickable.status-wrong {
            border-left-color: var(--money-red);
        }
        
        .finding-row-clickable.status-partial {
            border-left-color: var(--warning-amber);
        }
        
        .finding-problem {
            font-weight: 500;
            color: var(--lightest);
        }
        
        .finding-location {
            font-size: 0.8rem;
            color: var(--medium);
        }
        
        .finding-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .finding-badge.root { background: rgba(220, 38, 38, 0.25); color: #ff6b6b; }
        .finding-badge.other { background: rgba(217, 119, 6, 0.25); color: var(--warning-amber); }
        
        .finding-status {
            font-size: 1.2rem;
            width: 28px;
            text-align: center;
        }
        
        .finding-arrow {
            color: var(--medium);
            font-size: 0.9rem;
        }
        
        /* Outcome Section */
        .outcome-section {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            border-left: 4px solid var(--warning-amber);
        }
        
        .outcome-section h2 {
            font-family: var(--font-heading);
            font-size: 0.9rem;
            color: var(--warning-amber);
            margin: 0 0 var(--space-sm) 0;
            letter-spacing: 0.1em;
        }
        
        .outcome-section p {
            color: var(--light);
            line-height: 1.6;
            margin: 0;
            margin-bottom: var(--space-md);
        }
        
        .outcome-section p:last-child {
            margin-bottom: 0;
        }
        
        /* Regulatory Note in Epilogue */
        .regulatory-note {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-left: 4px solid #3b82f6;
            border-radius: 6px;
            padding: var(--space-md);
            margin-top: var(--space-md);
        }
        
        .regulatory-note h3 {
            font-family: var(--font-heading);
            font-size: 0.85rem;
            color: #60a5fa;
            margin: 0 0 var(--space-sm) 0;
        }
        
        .regulatory-note p {
            font-size: 0.9rem;
            color: var(--light);
            margin: 0;
        }
        
        /* Rating Card Compact */
        .rating-card {
            text-align: center;
            padding: var(--space-lg);
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .rating-card .stars {
            font-size: 2rem;
            color: var(--warm-gold);
            letter-spacing: 4px;
        }
        
        .rating-card .rank-title {
            font-family: var(--font-heading);
            font-size: 1.2rem;
            color: var(--lightest);
            margin: var(--space-sm) 0;
        }
        
        .rating-card .rank-desc {
            font-size: 0.85rem;
            color: var(--medium-light);
        }
        
        /* Solution Reveal */
        .solution-reveal {
            margin-top: var(--space-xl);
            padding-top: var(--space-lg);
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* Results Buttons */
        .results-buttons {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            margin-top: var(--space-xl);
        }

        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (max-width: 1100px) {
            .evidence-viewer {
                width: 95%;
            }
            
            .phone-interface {
                width: 95%;
                max-width: 420px;
            }
            
            .contact-avatar {
                width: 38px;
                height: 38px;
                font-size: 1rem;
            }
            
            .contact-name {
                font-size: 0.9rem;
            }
            
            .finding-row {
                grid-template-columns: 80px 1fr 100px;
            }
            
            .finding-row .finding-solution {
                display: none;
            }
        }

        @media (max-width: 900px) {
            #evidence-locations {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--space-md);
                padding: var(--space-lg);
            }
            
            .game-header {
                flex-direction: column;
                gap: var(--space-md);
                padding: var(--space-md);
            }
            
            #money-counter {
                width: 100%;
                min-width: unset;
            }
            
            .intro-container h1 {
                font-size: 2.5rem;
            }
            
            .results-container h1 {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 700px) {
            :root {
                font-size: 14px;
            }
            
            /* ============================================
               MOBILE-FIRST COMPLETE REDESIGN
               ============================================ */
            
            /* Prevent horizontal scroll on all screens */
            body, html {
                overflow-x: hidden;
                max-width: 100vw;
            }
            
            .screen {
                overflow-x: hidden;
            }
            
            /* --- CINEMATIC INTRO MOBILE - FULL SCREEN --- */
            .cinematic-intro {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
            }
            
            .intro-slide {
                flex-direction: column;
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
            }
            
            .slide-image {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 45%;
            }
            
            .slide-content {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: auto;
                max-height: 60%;
                padding: var(--space-md);
                padding-bottom: 70px;
                background: linear-gradient(to top, var(--darkest) 70%, transparent 100%);
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .slide-time {
                font-size: 0.7rem;
                margin-bottom: var(--space-xs);
            }
            
            .slide-text {
                max-width: 100%;
            }
            
            .slide-text p {
                font-size: 0.9rem;
                margin-bottom: var(--space-sm);
                line-height: 1.5;
            }
            
            .slide-text .radio-call {
                font-size: 0.85rem;
                padding: var(--space-sm);
                margin: var(--space-sm) 0;
            }
            
            .slide-next-btn {
                position: fixed;
                bottom: var(--space-lg);
                right: var(--space-md);
                padding: var(--space-sm) var(--space-lg);
                font-size: 0.9rem;
                z-index: 100;
            }
            
            .slide-progress {
                position: fixed;
                bottom: var(--space-md);
                left: var(--space-md);
                transform: none;
                z-index: 100;
            }
            
            .skip-intro-btn {
                position: fixed;
                top: var(--space-sm);
                right: var(--space-sm);
                padding: var(--space-xs) var(--space-sm);
                font-size: 0.75rem;
                z-index: 100;
            }
            
            .btn-radio-play {
                padding: var(--space-sm);
                font-size: 0.85rem;
            }
            
            /* --- MISSION SLIDE (SITE DAY ZERO) - FULL SCREEN WITH BACKGROUND --- */
            .intro-slide[data-slide="5"] {
                background: var(--darkest);
            }
            
            .intro-slide[data-slide="5"] .slide-image.mission-bg {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                height: 100%;
            }
            
            .intro-slide[data-slide="5"] .slide-image.mission-bg img {
                filter: brightness(0.25) blur(3px);
            }
            
            .mission-slide {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                height: 100% !important;
                max-height: none !important;
                padding: var(--space-lg) !important;
                padding-top: var(--space-xl) !important;
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: center !important;
                background: transparent !important;
                overflow: visible !important;
                z-index: 2;
            }
            
            .mission-logo {
                width: 100px;
                margin-bottom: var(--space-md);
            }
            
            .mission-slide h1 {
                font-size: 2rem !important;
                margin-bottom: var(--space-xs) !important;
                letter-spacing: 0.08em !important;
                text-shadow: 0 2px 20px rgba(0,0,0,0.8);
            }
            
            .mission-slide h2 {
                font-size: 0.85rem !important;
                margin-bottom: var(--space-lg) !important;
                letter-spacing: 0.15em !important;
            }
            
            .mission-brief {
                margin-bottom: var(--space-lg);
                max-width: 100%;
            }
            
            .mission-brief p {
                font-size: 0.9rem;
                margin-bottom: var(--space-sm);
                text-shadow: 0 1px 10px rgba(0,0,0,0.8);
            }
            
            .mission-brief .highlight {
                font-size: 1.1rem;
                margin: var(--space-sm) 0;
            }
            
            .intro-buttons {
                gap: var(--space-md);
                width: 100%;
                max-width: 300px;
            }
            
            .intro-buttons .btn-secondary {
                font-size: 0.85rem;
                padding: var(--space-sm) var(--space-lg);
                width: 100%;
            }
            
            .intro-buttons .btn-large {
                font-size: 1rem !important;
                padding: var(--space-md) var(--space-xl) !important;
                width: 100%;
            }
            
            /* --- MAIN GAME SCREEN MOBILE --- */
            #game-screen {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                height: 100%;
            }
            
            .game-header {
                flex-direction: column;
                padding: var(--space-xs);
                gap: var(--space-xs);
                flex-shrink: 0;
            }
            
            .header-logo {
                height: 24px;
            }
            
            /* --- COST COUNTER WITH FULL BREAKDOWN ON MOBILE --- */
            #money-counter {
                width: 100%;
                padding: var(--space-xs) var(--space-sm);
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
                gap: var(--space-sm);
            }
            
            .counter-header {
                font-size: 0.45rem;
            }
            
            .counter-total {
                font-size: 1.1rem;
            }
            
            .counter-time {
                font-size: 0.55rem;
            }
            
            /* Show ALL breakdown on mobile - compact grid */
            .counter-breakdown {
                display: grid !important;
                grid-template-columns: repeat(3, auto);
                gap: 1px 8px;
                font-size: 0.45rem;
                opacity: 0.95;
            }
            
            .counter-breakdown .cost-line {
                display: flex !important;
                justify-content: space-between;
                gap: 4px;
            }
            
            .counter-breakdown .cost-line .cost-label {
                font-size: 0.4rem;
                color: var(--medium-light);
            }
            
            .counter-breakdown .cost-line .cost-rate {
                font-size: 0.45rem;
                font-weight: 600;
            }
            
            .counter-breakdown .cost-line.total-line {
                grid-column: span 3;
                background: rgba(220, 38, 38, 0.3);
                padding: 2px 6px;
                border-radius: 3px;
                margin-top: 2px;
                justify-content: center;
            }
            
            .counter-breakdown .cost-line.total-line .cost-label,
            .counter-breakdown .cost-line.total-line .cost-rate {
                font-size: 0.5rem;
            }
            
            /* Main game area */
            .game-main {
                flex: 1;
                min-height: 0;
                overflow: hidden;
                position: relative;
            }
            
            /* Collection panel - FIXED at bottom */
            .collection-panel {
                position: fixed !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                height: 55px !important;
                padding: 6px var(--space-sm) !important;
                z-index: 60 !important;
                background: rgba(31, 41, 55, 0.98) !important;
            }
            
            /* Location grid - 3x2 + 1 compact */
            #evidence-locations {
                grid-template-columns: repeat(3, 1fr);
                gap: 4px;
                padding: var(--space-xs);
                flex: 1;
                align-content: start;
            }
            
            .evidence-btn {
                min-height: 55px;
                padding: 4px;
            }
            
            .evidence-btn .evidence-icon {
                font-size: 1.1rem;
            }
            
            .evidence-btn .evidence-label {
                font-size: 0.55rem;
                line-height: 1.2;
            }
            
            /* --- EVIDENCE BAR - SEE ALL 7 ITEMS --- */
            .evidence-bar {
                min-height: auto;
                max-height: 70px;
                padding: 4px var(--space-xs);
                flex-shrink: 0;
                overflow: hidden;
            }
            
            .evidence-bar-header {
                font-size: 0.55rem;
                margin-bottom: 2px;
            }
            
            #evidence-cards-bar {
                display: flex;
                gap: 4px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 4px;
            }
            
            /* Tiny evidence cards - fit all 7 visible */
            .evidence-card {
                width: calc((100vw - 40px) / 4.5);
                min-width: 70px;
                max-width: 85px;
                padding: 4px;
                flex-shrink: 0;
            }
            
            .evidence-card h5 {
                font-size: 0.5rem;
                margin-bottom: 2px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .evidence-card p {
                display: none; /* Hide description to save space */
            }
            
            .evidence-bar-empty {
                font-size: 0.65rem;
                padding: var(--space-xs);
            }
            
            /* --- ACTION BUTTONS - FIXED ABOVE COLLECTION PANEL --- */
            .game-actions {
                position: fixed !important;
                bottom: 65px !important; /* Above 55px collection panel */
                right: var(--space-sm) !important;
                gap: 6px !important;
                z-index: 70 !important;
                flex-direction: column !important;
                display: flex !important;
            }
            
            .action-btn {
                padding: 10px !important;
                min-width: 48px !important;
                min-height: 48px !important;
                background: rgba(31, 41, 55, 0.98) !important;
                border: 2px solid var(--warm-gold) !important;
                border-radius: 10px !important;
                box-shadow: 0 2px 10px rgba(0,0,0,0.5) !important;
            }
            
            .action-btn .action-label {
                display: none;
            }
            
            .action-btn .action-icon {
                font-size: 1.4rem;
            }
            
            #submit-btn {
                border-color: var(--warning-amber) !important;
            }
            
            #open-board-btn {
                border-color: var(--success-green) !important;
            }
            
            /* --- COLLECTION PANEL - SHOW ALL 7 SLOTS --- */
            .collection-panel {
                padding: var(--space-xs);
                gap: var(--space-sm);
                flex-wrap: wrap;
            }
            
            .collection-header {
                min-width: auto;
                flex-direction: row;
                align-items: center;
                gap: var(--space-xs);
            }
            
            .collection-header h3 {
                font-size: 0.55rem;
            }
            
            .collection-count {
                font-size: 0.8rem;
            }
            
            .collection-slots {
                flex: 1;
                gap: 4px;
                justify-content: center;
            }
            
            .collection-slot {
                width: 38px;
                height: 38px;
                border-radius: 6px;
            }
            
            .collection-slot.empty .slot-number {
                font-size: 0.7rem;
            }
            
            .collection-slot .slot-evidence span {
                display: none;
            }
            
            .collection-slot.phone-slot {
                width: 38px;
            }
            
            /* --- SCENE HOTSPOTS MOBILE --- */
            /* Make hotspots 60% of original size */
            .scene-hotspot {
                width: 22px;
                height: 22px;
                border-width: 2px;
            }
            
            .scene-hotspot.collected::after {
                font-size: 10px;
            }
            
            @keyframes dotPulseAmber {
                0%, 100% {
                    box-shadow: 0 1px 4px rgba(0,0,0,0.4), 0 0 0 0 rgba(217, 119, 6, 0.6);
                    transform: scale(1);
                }
                50% {
                    box-shadow: 0 1px 4px rgba(0,0,0,0.4), 0 0 0 8px rgba(217, 119, 6, 0);
                    transform: scale(1.05);
                }
            }
            
            @keyframes dotPulseGreen {
                0%, 100% {
                    box-shadow: 0 1px 4px rgba(0,0,0,0.4), 0 0 0 0 rgba(34, 197, 94, 0.6);
                    transform: scale(1);
                }
                50% {
                    box-shadow: 0 1px 4px rgba(0,0,0,0.4), 0 0 0 8px rgba(34, 197, 94, 0);
                    transform: scale(1.05);
                }
            }
            
            /* Hotspot preview card for mobile - show on tap */
            .hotspot-card {
                width: 140px;
                padding: 6px;
                bottom: calc(100% + 8px);
                pointer-events: auto; /* Allow clicking the card on mobile */
                z-index: 100; /* Above all other hotspots */
            }
            
            .hotspot-card img {
                height: 55px;
                margin-bottom: 4px;
            }
            
            .hotspot-card .hotspot-label {
                font-size: 0.65rem;
            }
            
            .hotspot-card .hotspot-doc {
                font-size: 0.55rem;
            }
            
            .hotspot-card::after {
                border-width: 6px;
            }
            
            /* Mobile: show card when hotspot has .preview-active class */
            .scene-hotspot.preview-active {
                z-index: 50; /* Bring active hotspot above others */
            }
            
            .scene-hotspot.preview-active .hotspot-card {
                opacity: 1;
                visibility: visible;
            }
            
            /* --- EVIDENCE VIEWER MODAL MOBILE --- */
            .evidence-viewer {
                width: 100%;
                max-width: 100%;
                height: 100vh;
                max-height: 100vh;
                margin: 0;
                border-radius: 0;
            }
            
            .evidence-viewer h2 {
                font-size: 1rem;
                padding: var(--space-sm);
                padding-right: 50px;
            }
            
            .modal-close {
                width: 44px;
                height: 44px;
                font-size: 1.5rem;
            }
            
            #evidence-image-container {
                aspect-ratio: 4/3;
                max-height: 40vh;
            }
            
            /* Hotspots - smaller on mobile */
            .hotspot {
                width: 28px;
                height: 28px;
            }
            
            .hotspot::after {
                width: 16px;
                height: 16px;
            }
            
            .hotspot-label {
                display: none;
            }
            
            #evidence-findings {
                max-height: 35vh;
                padding: var(--space-sm);
            }
            
            .finding-card {
                padding: var(--space-sm);
            }
            
            .finding-card h4 {
                font-size: 0.8rem;
            }
            
            .finding-card p {
                font-size: 0.75rem;
            }
            
            /* --- PHONE INTERFACE MOBILE --- */
            .phone-interface {
                width: 100%;
                max-width: 100%;
                height: 100vh;
                max-height: 100vh;
                margin: 0;
                border-radius: 0;
                display: flex;
                flex-direction: column;
            }
            
            .phone-header {
                padding: var(--space-md);
                flex-shrink: 0;
            }
            
            .phone-header h2 {
                font-size: 1rem;
            }
            
            .phone-body {
                padding: var(--space-sm);
                flex: 1;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .phone-subtitle {
                font-size: 0.8rem;
                margin-bottom: var(--space-md);
            }
            
            .phone-contact {
                padding: var(--space-sm);
                gap: var(--space-sm);
            }
            
            .contact-avatar {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .contact-name {
                font-size: 0.9rem;
            }
            
            .contact-role {
                font-size: 0.7rem;
            }
            
            .contact-status {
                font-size: 0.65rem;
                padding: 3px 8px;
            }
            
            /* Call in progress - mobile */
            #call-in-progress {
                padding: var(--space-md);
            }
            
            .call-status-text {
                font-size: 0.75rem;
            }
            
            #call-timer {
                font-size: 1.3rem;
            }
            
            #call-dialogue {
                font-size: 0.85rem;
                min-height: 60px;
                padding: var(--space-sm);
            }
            
            .call-evidence-found {
                padding: var(--space-sm);
            }
            
            .phone-footer {
                padding: var(--space-md);
            }
            
            .btn-end-call {
                padding: var(--space-sm) var(--space-lg);
            }
            
            /* --- EVIDENCE BOARD MOBILE COMPLETE REDESIGN --- */
            .evidence-board-modal {
                padding: 0;
            }
            
            .evidence-board-container {
                width: 100%;
                max-width: 100%;
                height: 100vh;
                max-height: 100vh;
                margin: 0;
                border-radius: 0;
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }
            
            .board-header {
                padding: var(--space-sm);
                flex-shrink: 0;
            }
            
            .board-header h2 {
                font-size: 1rem;
            }
            
            .board-instructions {
                font-size: 0.75rem;
            }
            
            /* Mobile board layout - vertical stack */
            .board-layout {
                flex: 1;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                padding: 0;
            }
            
            /* Evidence table area - scrollable */
            .table-area {
                flex: 1;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding: var(--space-sm);
                background: rgba(0,0,0,0.3);
                min-height: 100px;
            }
            
            .table-area .evidence-card {
                width: 100%;
                margin-bottom: var(--space-xs);
            }
            
            /* Classification zones - horizontal scroll on mobile */
            .classification-zones {
                position: relative;
                bottom: auto;
                left: auto;
                transform: none;
                display: flex;
                flex-direction: column;
                gap: var(--space-sm);
                padding: var(--space-sm);
                background: rgba(0,0,0,0.5);
                flex-shrink: 0;
                max-height: 45vh;
                overflow-y: auto;
            }
            
            .classification-slot {
                width: 100%;
                min-height: 80px;
                padding: var(--space-sm);
            }
            
            .slot-contributing {
                width: 100%;
            }
            
            .slot-header {
                margin-bottom: var(--space-xs);
                padding-bottom: var(--space-xs);
            }
            
            .slot-label {
                font-size: 0.7rem;
            }
            
            .slot-hint {
                font-size: 0.6rem;
            }
            
            .slot-content {
                gap: var(--space-xs);
            }
            
            .mini-card {
                font-size: 0.65rem;
                padding: 4px 8px;
            }
            
            /* Submit area - fixed at bottom */
            .submit-area {
                padding: var(--space-sm);
                background: rgba(0,0,0,0.6);
                flex-shrink: 0;
            }
            
            .board-status {
                font-size: 0.7rem;
                margin-bottom: var(--space-xs);
            }
            
            .btn-submit-board {
                width: 100%;
                padding: var(--space-sm);
            }
            
            /* --- SOLUTION MODAL MOBILE --- */
            .solution-content {
                width: 100%;
                max-width: 100%;
                height: 100vh;
                max-height: 100vh;
                margin: 0;
                border-radius: 0;
            }
            
            .solution-counter-mini {
                top: var(--space-sm);
                right: var(--space-sm);
                font-size: 0.65rem;
                padding: 4px 8px;
            }
            
            .solution-progress {
                padding-top: var(--space-xl);
                margin-bottom: var(--space-md);
            }
            
            #solution-progress-text {
                font-size: 0.75rem;
            }
            
            .solution-step {
                padding: var(--space-md);
            }
            
            .solution-step-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-xs);
            }
            
            .solution-step-badge {
                font-size: 0.6rem;
            }
            
            .solution-step-title {
                font-size: 0.95rem;
            }
            
            .solution-step-description {
                font-size: 0.8rem;
                padding: var(--space-sm);
            }
            
            .solution-options {
                gap: var(--space-sm);
            }
            
            .solution-option {
                padding: var(--space-sm);
            }
            
            .solution-option-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-xs);
            }
            
            .solution-option-title {
                font-size: 0.85rem;
            }
            
            .solution-option-cost {
                font-size: 0.7rem;
            }
            
            .solution-option-desc {
                font-size: 0.75rem;
            }
            
            /* --- RESULTS/REPORT MOBILE --- */
            .report-container {
                margin: 0;
                border-radius: 0;
                height: 100vh;
            }
            
            .report-nav {
                padding: var(--space-xs);
                gap: 2px;
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            
            .report-nav-btn {
                padding: var(--space-xs);
                font-size: 0.6rem;
                white-space: nowrap;
                flex-shrink: 0;
            }
            
            .page-header {
                padding: var(--space-sm);
            }
            
            .page-number {
                font-size: 0.6rem;
            }
            
            .report-title {
                font-size: 1.1rem;
            }
            
            .page-title {
                font-size: 1rem;
            }
            
            .page-content {
                padding: var(--space-sm);
                max-height: calc(100vh - 250px);
                overflow-y: auto;
            }
            
            .page-footer {
                padding: var(--space-sm);
            }
            
            .page-turn-btn {
                padding: var(--space-xs) var(--space-sm);
                font-size: 0.7rem;
            }
            
            /* Score cards */
            .dual-score-display {
                flex-direction: column;
                gap: var(--space-sm);
            }
            
            .score-card {
                padding: var(--space-sm);
            }
            
            .score-card-label {
                font-size: 0.65rem;
            }
            
            .score-card-value {
                font-size: 1.5rem;
            }
            
            /* Summary stats */
            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--space-xs);
            }
            
            .summary-stat-item {
                padding: var(--space-xs);
            }
            
            .stat-label {
                font-size: 0.6rem;
            }
            
            .stat-value {
                font-size: 0.9rem;
            }
            
            /* Findings table */
            .findings-table {
                font-size: 0.7rem;
            }
            
            .findings-table th {
                font-size: 0.6rem;
                padding: var(--space-xs);
            }
            
            .findings-table td {
                padding: var(--space-xs);
            }
            
            .findings-table .problem-location,
            .findings-table .arrow-cell {
                display: none;
            }
            
            .table-badge {
                font-size: 0.5rem;
                padding: 2px 4px;
            }
            
            /* Takeaway cards */
            .takeaway-card {
                flex-direction: column;
                padding: var(--space-sm);
                gap: var(--space-sm);
            }
            
            .takeaway-number {
                width: 24px;
                height: 24px;
                font-size: 0.75rem;
                align-self: flex-start;
            }
            
            .takeaway-content h4 {
                font-size: 0.85rem;
            }
            
            .takeaway-content p {
                font-size: 0.75rem;
            }
            
            /* Detail modal */
            .detail-modal-content {
                width: 100%;
                max-width: 100%;
                max-height: 100vh;
                margin: 0;
                border-radius: 0;
            }
            
            .detail-header h3 {
                font-size: 0.95rem;
            }
            
            .detail-section {
                padding: var(--space-sm);
            }
            
            .detail-section h4 {
                font-size: 0.8rem;
            }
            
            .detail-section p {
                font-size: 0.75rem;
            }
            
            /* Report actions */
            .report-actions {
                flex-direction: column;
                padding: var(--space-sm);
            }
            
            .report-actions button {
                width: 100%;
            }
            
            /* Intro container adjustments */
            .intro-container {
                padding: var(--space-lg);
            }
            
            .intro-container h1 {
                font-size: 2rem;
                letter-spacing: 0.1em;
            }
            
            .intro-container h2 {
                font-size: 1.1rem;
                letter-spacing: 0.2em;
            }
            
            .intro-narrative {
                padding: var(--space-md);
            }
            
            .intro-narrative p {
                font-size: 0.95rem;
            }
            
            .intro-mission {
                padding: var(--space-md);
            }
            
            .how-to-play-content {
                width: 95%;
            }
            
            .btn-large {
                font-size: 1rem;
                padding: var(--space-md) var(--space-lg);
            }
        }

        @media (max-width: 480px) {
            :root {
                font-size: 13px;
            }
            
            .intro-container h1 {
                font-size: 1.6rem;
            }
            
            #evidence-locations {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .evidence-btn {
                min-height: 80px;
                padding: var(--space-sm);
            }
            
            .counter-total {
                font-size: 1.5rem;
            }
            
            .hotspot {
                width: 30px;
                height: 30px;
            }
        }

        /* Touch device optimisations */
        @media (hover: none) and (pointer: coarse) {
            .evidence-btn:hover {
                transform: none;
                box-shadow: none;
            }
            
            .evidence-btn:active {
                transform: scale(0.98);
                border-color: var(--warm-gold);
            }
            
            .hotspot:hover {
                transform: translate(-50%, -50%);
            }
            
            .hotspot:active {
                transform: translate(-50%, -50%) scale(1.1);
                background: rgba(184, 134, 11, 0.4);
            }
            
            .action-btn:hover {
                transform: none;
            }
            
            .action-btn:active {
                transform: scale(0.98);
            }
            
            .btn-primary:hover,
            .btn-danger:hover {
                transform: none;
            }
            
            .btn-primary:active,
            .btn-danger:active {
                transform: scale(0.98);
            }
            
            /* Mobile tap-to-select for evidence board */
            .evidence-card.selected-for-move,
            .mini-card.selected-for-move {
                outline: 3px solid var(--warm-gold);
                outline-offset: 2px;
                background: rgba(212, 175, 55, 0.3) !important;
                animation: pulse-select 1s infinite;
            }
            
            @keyframes pulse-select {
                0%, 100% { outline-color: var(--warm-gold); }
                50% { outline-color: rgba(212, 175, 55, 0.5); }
            }
            
            /* Hint for classification slots when card is selected */
            .classification-slot.tap-hint {
                border-color: var(--warm-gold) !important;
                background: rgba(212, 175, 55, 0.2) !important;
                animation: pulse-hint 1s infinite;
            }
            
            @keyframes pulse-hint {
                0%, 100% { border-color: var(--warm-gold); }
                50% { border-color: rgba(212, 175, 55, 0.4); }
            }
            
            /* Larger touch targets */
            .modal-close,
            .detail-close {
                width: 44px;
                height: 44px;
                font-size: 1.5rem;
            }
            
            .fix-option,
            .solution-option {
                min-height: 60px;
            }
            
            .findings-table .clickable-row td {
                padding: var(--space-sm) var(--space-md);
            }
        }

        /* Landscape phone */
        @media (max-height: 500px) and (orientation: landscape) {
            .intro-container {
                padding: var(--space-md);
            }
            
            .intro-logo {
                width: 100px;
                margin-bottom: var(--space-sm);
            }
            
            .intro-container h1 {
                font-size: 1.5rem;
                margin-bottom: 0;
            }
            
            .intro-container h2 {
                margin-bottom: var(--space-sm);
            }
            
            .intro-narrative {
                display: none; /* Hide narrative in landscape - too cramped */
            }
            
            .game-main {
                min-height: unset;
            }
            
            #evidence-locations {
                grid-template-columns: repeat(3, 1fr);
                gap: var(--space-xs);
                padding: var(--space-sm);
            }
            
            .evidence-btn {
                min-height: 60px;
                padding: var(--space-xs);
            }
            
            .evidence-bar {
                min-height: 60px;
            }
            
            .modal-content {
                max-height: 95vh;
            }
            
            #evidence-image-container {
                aspect-ratio: 16/8;
            }
        }
    </style>
</head>
<body>
    <!-- ============================================
         INTRO SCREEN
         ============================================ -->
    <div id="intro-screen" class="screen">
        <!-- Cinematic Intro Sequence -->
        <div class="cinematic-intro" id="cinematic-intro">
            <!-- Slide 1: The Lift -->
            <div class="intro-slide active" data-slide="1">
                <div class="slide-image">
                    <img src="images/IMAGE_INTRO_LIFT.png" alt="Module being lifted into position">
                </div>
                <div class="slide-content">
                    <div class="slide-time">06:42 — MILLBROOK SMR CONSTRUCTION SITE</div>
                    <div class="slide-text">
                        <p>Module M-2401 descends toward the reactor building.</p>
                        <p>85 tonnes of SC2 feedwater system, manufactured 200 miles away in Sheffield, guided by a 500-tonne mobile crane.</p>
                    </div>
                </div>
                <button class="slide-next-btn" onclick="nextSlide()">Continue →</button>
            </div>

            <!-- Slide 2: The Module -->
            <div class="intro-slide" data-slide="2">
                <div class="slide-image">
                    <img src="images/IMAGE_MODULE_FRAME.png" alt="Module M-2401 in position">
                </div>
                <div class="slide-content">
                    <div class="slide-time">06:45</div>
                    <div class="slide-text">
                        <p>The module touches down on the survey marks.</p>
                        <p>The rigging crew steps back. The fit-up team moves in to connect the feedwater nozzle to the wall penetration.</p>
                    </div>
                </div>
                <button class="slide-next-btn" onclick="nextSlide()">Continue →</button>
            </div>

            <!-- Slide 3: The Problem -->
            <div class="intro-slide" data-slide="3">
                <div class="slide-image">
                    <img src="images/IMAGE_FLANGE_GAP.png" alt="Flanges don't align - 100mm gap visible">
                </div>
                <div class="slide-content">
                    <div class="slide-time">06:47</div>
                    <div class="slide-text">
                        <div class="radio-call-container">
                            <audio id="intro-radio-audio" src="audio/intro-radio-call.mp3" preload="auto"></audio>
                            <button class="btn-radio-play" onclick="playIntroRadio()">
                                <span class="radio-icon">📻</span> Play Radio Call
                            </button>
                        </div>
                        <p class="radio-call">"STOP. HOLD ALL WORK."</p>
                        <p>Dave Mitchell, senior fitter, keys his radio. His voice is calm but firm.</p>
                        <p class="radio-call">"The flanges don't line up. The module is sitting about 100 millimetres too low. The bolt holes aren't even close."</p>
                    </div>
                </div>
                <button class="slide-next-btn" onclick="nextSlide()">Continue →</button>
            </div>

            <!-- Slide 4: The Stakes -->
            <div class="intro-slide" data-slide="4">
                <div class="slide-image">
                    <img src="images/IMAGE_WALL_PENETRATION.png" alt="Wall penetration that should have connected">
                </div>
                <div class="slide-content">
                    <div class="slide-time">THE SITUATION</div>
                    <div class="slide-text">
                        <p>The module's SC2 feedwater flange is <strong>100mm too low</strong>.</p>
                        <p>The crane is holding the module at <strong>£2,400 per hour</strong>. The entire site is on hold.</p>
                        <p class="regulatory-note">Under <strong>Licence Condition 19</strong>, ONR must be notified of any construction issue that could affect the safety case.</p>
                    </div>
                </div>
                <button class="slide-next-btn" onclick="nextSlide()">Continue →</button>
            </div>

            <!-- Slide 5: Your Mission -->
            <div class="intro-slide" data-slide="5">
                <div class="slide-image mission-bg">
                    <img src="images/IMAGE_INTRO_LIFT.png" alt="Background">
                </div>
                <div class="slide-content mission-slide">
                    <img src="../00_images/Logo_White_Nobackground.png" alt="The Nuclear House" class="mission-logo">
                    <h1>SITE DAY ZERO</h1>
                    <h2>The Investigation</h2>
                    <div class="mission-brief">
                        <p>The Site Construction Director has initiated a formal investigation.</p>
                        <p class="highlight">You are the lead investigator.</p>
                        <p>Find the root cause. Identify other issues. Recommend the fix.</p>
                        <p><strong>The clock starts now.</strong></p>
                    </div>
                    <div class="intro-buttons">
                        <button id="how-to-play-btn" class="btn-secondary">How to Play</button>
                        <button id="start-btn" class="btn-primary btn-large">Begin Investigation</button>
                    </div>
                </div>
            </div>

            <!-- Skip button -->
            <button class="skip-intro-btn" onclick="skipIntro()">Skip Intro ⏭</button>
            
            <!-- Progress dots -->
            <div class="slide-progress">
                <span class="progress-dot active" data-slide="1"></span>
                <span class="progress-dot" data-slide="2"></span>
                <span class="progress-dot" data-slide="3"></span>
                <span class="progress-dot" data-slide="4"></span>
                <span class="progress-dot" data-slide="5"></span>
            </div>
        </div>
    </div>

    <!-- ============================================
         HOW TO PLAY MODAL
         ============================================ -->
    <div id="how-to-play-modal" class="modal hidden">
        <div class="modal-content how-to-play-content">
            <button class="modal-close">&times;</button>
            <h2>YOUR MISSION</h2>
            <p class="mission-intro">You are the lead investigator. Find the <strong>root cause</strong> of this misalignment and recommend the correct fix.</p>
            
            <div class="mission-objectives">
                <div class="objective">
                    <span class="objective-icon">1️⃣</span>
                    <div class="objective-text">
                        <strong>Investigate All 6 Locations</strong>
                        <span>Click items in the room to examine evidence. Each location has multiple findings — collect the ONE you think matters most.</span>
                    </div>
                </div>
                <div class="objective">
                    <span class="objective-icon">2️⃣</span>
                    <div class="objective-text">
                        <strong>Make Phone Calls</strong>
                        <span>Use the phone to interview people. You can make multiple calls, but collect only ONE as evidence.</span>
                    </div>
                </div>
                <div class="objective">
                    <span class="objective-icon">3️⃣</span>
                    <div class="objective-text">
                        <strong>Classify Your 7 Pieces of Evidence</strong>
                        <span>Go to the Evidence Board and categorise each: Root Cause, Other Issue, or Not Relevant.</span>
                    </div>
                </div>
                <div class="objective">
                    <span class="objective-icon">4️⃣</span>
                    <div class="objective-text">
                        <strong>Recommend a Fix</strong>
                        <span>Based on your analysis, choose the best corrective action.</span>
                    </div>
                </div>
            </div>
            
            <div class="mission-warning">
                <span class="warning-icon">💰</span>
                <div class="warning-text">
                    <strong>Every second costs money.</strong> The site is idle at £20,040/hour. Be thorough, but be quick. Wrong answers cost even more.
                </div>
            </div>
            
            <div class="mission-warning regulatory">
                <span class="warning-icon">⚠️</span>
                <div class="warning-text">
                    <strong>ONR is watching.</strong> This is a nuclear licensed site. Your investigation must identify not just the technical cause, but any breaches of Licence Conditions. Missed problems don't go away — they become regulatory issues.
                </div>
            </div>
            
            <button id="close-how-to-play" class="btn-primary">Got It</button>
        </div>
    </div>

    <!-- ============================================
         GAME SCREEN
         ============================================ -->
    <div id="game-screen" class="screen hidden">
        <!-- Header -->
        <div class="game-header">
            <img src="../00_images/Logo_White_Nobackground.png" alt="The Nuclear House" class="header-logo">
            
            <div id="money-counter">
                <div class="counter-header">PROJECT DELAY COST</div>
                <div class="counter-total">£<span id="total-cost">0</span></div>
                <div class="counter-breakdown">
                    <div class="cost-line">
                        <span class="cost-label">Crane standing time</span>
                        <span class="cost-rate">£2,400/hr</span>
                    </div>
                    <div class="cost-line">
                        <span class="cost-label">Rigging crew (8)</span>
                        <span class="cost-rate">£640/hr</span>
                    </div>
                    <div class="cost-line">
                        <span class="cost-label">Fit-up team (6)</span>
                        <span class="cost-rate">£480/hr</span>
                    </div>
                    <div class="cost-line">
                        <span class="cost-label">Concrete crew idle</span>
                        <span class="cost-rate">£1,200/hr</span>
                    </div>
                    <div class="cost-line">
                        <span class="cost-label">Supervision/QA</span>
                        <span class="cost-rate">£320/hr</span>
                    </div>
                    <div class="cost-line">
                        <span class="cost-label">Schedule knock-on</span>
                        <span class="cost-rate">£15,000/hr</span>
                    </div>
                    <div class="cost-line total-line">
                        <span class="cost-label">BURN RATE</span>
                        <span class="cost-rate">£5.50/sec</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Scene -->
        <div class="game-main">
            <!-- First-time hint -->
            <div id="game-hint" class="game-hint">
                <span class="hint-icon">💡</span>
                <span class="hint-text">Click on items in the room to investigate. Collect <strong>one key finding</strong> from each of the <strong>6 locations</strong>, plus <strong>one phone call</strong>.</span>
                <button class="hint-dismiss" onclick="this.parentElement.style.display='none'">✕</button>
            </div>
            
            <!-- Investigation Scene with positioned hotspots -->
            <div class="investigation-scene">
                <img src="images/IMAGE_SCENE_02.png" alt="Investigation Room" class="scene-background">
                
                <!-- Evidence Hotspots - Positioned from editor -->
                
                <!-- Module - on the module itself outside window -->
                <button class="scene-hotspot" data-location="module" style="left: 63.2%; top: 89.8%;">
                    <div class="hotspot-card">
                        <img src="images/IMAGE_MODULE_FRAME.png" alt="Module">
                        <span class="hotspot-label">Module Inspection</span>
                        <span class="hotspot-doc">QC Inspection Report</span>
                    </div>
                </button>
                
                <!-- Transport - map on wall showing route -->
                <button class="scene-hotspot" data-location="transport" style="left: 6%; top: 38.6%;">
                    <div class="hotspot-card">
                        <img src="images/IMAGE_TRANSPORT_TRAILER.png" alt="Transport">
                        <span class="hotspot-label">Transport Records</span>
                        <span class="hotspot-doc">Transport Folder</span>
                    </div>
                </button>
                
                <!-- Lift - crane area visible through window -->
                <button class="scene-hotspot" data-location="lift" style="left: 30.6%; top: 89.9%;">
                    <div class="hotspot-card">
                        <img src="images/IMAGE_SURVEY_SETUP.png" alt="Lift Plan">
                        <span class="hotspot-label">Lift Plan</span>
                        <span class="hotspot-doc">Lift Plan Pack</span>
                    </div>
                </button>
                
                <!-- Factory - laptop/computer on desk -->
                <button class="scene-hotspot" data-location="factory" style="left: 44.9%; top: 81%;">
                    <div class="hotspot-card">
                        <img src="images/IMAGE_QC_DOCUMENTS.png" alt="Factory QC">
                        <span class="hotspot-label">Factory QC Records</span>
                        <span class="hotspot-doc">Manufacturing QA Pack</span>
                    </div>
                </button>
                
                <!-- Drawings - papers/drawings on desk -->
                <button class="scene-hotspot" data-location="drawings" style="left: 23.5%; top: 82.9%;">
                    <div class="hotspot-card">
                        <img src="images/IMAGE_DRAWING_ROOM.png" alt="Drawings">
                        <span class="hotspot-label">Interface Drawings</span>
                        <span class="hotspot-doc">Technical Drawings</span>
                    </div>
                </button>
                
                <!-- Weather/Site Conditions - clipboard area -->
                <button class="scene-hotspot" data-location="weather" style="left: 67.6%; top: 78.9%;">
                    <div class="hotspot-card">
                        <img src="images/IMAGE_SITE_OFFICE.png" alt="Site Conditions">
                        <span class="hotspot-label">Site Conditions</span>
                        <span class="hotspot-doc">Site Diary & Forms</span>
                    </div>
                </button>
                
                <!-- Phone - desk phone -->
                <button class="scene-hotspot phone-hotspot" id="phone-hotspot" style="left: 53.3%; top: 73.3%;">
                    <div class="hotspot-card">
                        <img src="images/IMAGE_SCENE_02.png" alt="Phone">
                        <span class="hotspot-label">📞 Make Calls</span>
                        <span class="hotspot-doc">Interview Witnesses</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- Evidence Collection Panel -->
        <div class="collection-panel">
            <div class="collection-header">
                <h3>📋 Evidence Collected</h3>
                <span class="collection-count"><span id="evidence-count">0</span>/7</span>
            </div>
            <div class="collection-slots" id="collection-slots">
                <!-- 7 slots: 6 locations + 1 phone -->
                <div class="collection-slot empty" data-slot="0">
                    <span class="slot-number">1</span>
                </div>
                <div class="collection-slot empty" data-slot="1">
                    <span class="slot-number">2</span>
                </div>
                <div class="collection-slot empty" data-slot="2">
                    <span class="slot-number">3</span>
                </div>
                <div class="collection-slot empty" data-slot="3">
                    <span class="slot-number">4</span>
                </div>
                <div class="collection-slot empty" data-slot="4">
                    <span class="slot-number">5</span>
                </div>
                <div class="collection-slot empty" data-slot="5">
                    <span class="slot-number">6</span>
                </div>
                <div class="collection-slot empty phone-slot" data-slot="6">
                    <span class="slot-number">📞</span>
                </div>
            </div>
            <div class="collection-actions">
                <button id="open-board-btn" class="btn-primary" disabled>
                    <span class="board-btn-text">Collect all 7 pieces first</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================
         EVIDENCE BOARD - Fresh Design
         ============================================ -->
    <div id="board-modal" class="modal hidden">
        <div class="board-screen">
            <button class="board-close-btn" onclick="closeEvidenceBoard()">&times;</button>
            
            <!-- Cards spread on table - full readable content -->
            <div class="table-area" id="evidence-table">
                <!-- Evidence cards populated by JS -->
            </div>
            
            <!-- Classification bar at bottom -->
            <div class="classification-bar">
                <!-- Root cause slot -->
                <div class="classification-slot slot-root" id="root-cause-zone" data-category="rootCause">
                    <div class="slot-header">
                        <span class="slot-icon">🎯</span>
                        <span class="slot-label">Root Cause</span>
                        <span class="slot-hint">1 only</span>
                    </div>
                    <div class="slot-content"></div>
                </div>
                
                <!-- Contributing factors slot -->
                <div class="classification-slot slot-contributing" id="contributing-zone" data-category="contributing">
                    <div class="slot-header">
                        <span class="slot-icon">⚠️</span>
                        <span class="slot-label">Other Issues</span>
                        <span class="slot-hint">up to 6</span>
                    </div>
                    <div class="slot-content"></div>
                </div>
                
                <!-- Red herrings slot -->
                <div class="classification-slot slot-redherring" id="redherring-zone" data-category="redHerring">
                    <div class="slot-header">
                        <span class="slot-icon">🚫</span>
                        <span class="slot-label">Not Relevant</span>
                    </div>
                    <div class="slot-content"></div>
                </div>
                
                <!-- Submit area -->
                <div class="submit-area">
                    <div class="board-status" id="board-status">Drag cards to classify</div>
                    <button class="btn-submit-board" id="submit-board-btn" disabled>Submit →</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         EVIDENCE MODAL
         ============================================ -->
    <div id="evidence-modal" class="modal hidden">
        <div class="modal-content evidence-viewer">
            <button class="modal-close">&times;</button>
            <h2 id="evidence-title">Evidence Title</h2>
            <div id="evidence-image-container">
                <img id="evidence-image" src="" alt="Evidence">
                <!-- Hotspots will be dynamically added here -->
            </div>
            <div id="evidence-findings">
                <p class="findings-hint">Click on highlighted areas to examine evidence.</p>
            </div>
            <button id="evidence-done" class="btn-primary">Done Examining</button>
        </div>
    </div>

    <!-- ============================================
         PHONE MODAL
         ============================================ -->
    <div id="phone-modal" class="modal hidden">
        <div class="modal-content phone-interface">
            <button class="modal-close">&times;</button>
            
            <!-- Contact List View -->
            <div id="phone-contact-view">
                <div class="phone-header">
                    <h2><span class="phone-header-icon">📱</span> Contacts</h2>
                </div>
                <div class="phone-body">
                    <p class="phone-subtitle">Select someone to call for information</p>
                    <div id="phone-contacts">
                        <!-- Populated by JS -->
                    </div>
                    <div id="phone-evidence-status">
                        <!-- Shows current collected call evidence -->
                    </div>
                </div>
                <div class="phone-footer">
                    <button id="close-phone-btn" class="btn-secondary">Close</button>
                </div>
            </div>
            
            <!-- Active Call View -->
            <div id="phone-call-active" class="hidden">
                <div class="phone-header">
                    <h2><span class="phone-header-icon">📞</span> Active Call</h2>
                </div>
                <div class="phone-body" style="position: relative;">
                    <div class="call-audio-container">
                        <audio id="call-audio" preload="auto"></audio>
                        <button id="audio-toggle-btn" class="btn-audio-mini playing" onclick="toggleCallAudio()" title="Pause/Play audio">
                            🔊
                        </button>
                    </div>
                    <h3 id="call-contact-name">Calling...</h3>
                    <p class="call-subtitle">Call in progress...</p>
                    <div class="call-transcript-label">Transcript:</div>
                    <div id="call-dialogue"></div>
                    <div class="call-actions">
                        <button id="end-call-btn" class="btn-secondary">Skip to End</button>
                    </div>
                    <div id="call-complete-actions" class="hidden">
                        <button id="collect-call-btn" class="btn-primary">📋 Collect as Evidence</button>
                        <button id="back-to-contacts-btn" class="btn-secondary">← Back to Contacts</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         SOLUTION SELECTION MODAL
         ============================================ -->
    <div id="solution-modal" class="modal hidden">
        <div class="modal-content solution-content">
            <div class="solution-counter-mini" id="solution-counter">
                <span class="counter-time-mini" id="solution-time">00:00</span>
                <span class="counter-cost-mini" id="solution-cost">£0</span>
            </div>
            <div class="solution-progress">
                <span id="solution-progress-text">Issue 1 of X</span>
                <div class="solution-progress-bar">
                    <div class="solution-progress-fill" id="solution-progress-fill"></div>
                </div>
            </div>
            
            <div id="current-solution-step">
                <!-- Single issue displayed here -->
            </div>
            
            <div class="solution-actions">
                <button id="submit-solution-btn" class="btn-primary btn-large" disabled>Submit Solution →</button>
            </div>
        </div>
    </div>

    <!-- ============================================
         RESULTS SCREEN - PAGINATED REPORT
         ============================================ -->
    <div id="results-screen" class="screen hidden">
        <div class="report-book">
            <!-- Report Navigation -->
            <div class="report-nav">
                <button class="report-nav-btn" data-page="1" id="nav-summary">Summary</button>
                <button class="report-nav-btn" data-page="2" id="nav-findings">Findings</button>
                <button class="report-nav-btn" data-page="3" id="nav-actions">Financial</button>
                <button class="report-nav-btn" data-page="4" id="nav-lessons">Takeaways</button>
                <button class="report-nav-btn" data-page="5" id="nav-solution">5★ Solution</button>
            </div>
            
            <!-- Page Container -->
            <div class="report-pages-container">
                
                <!-- PAGE 1: Executive Summary -->
                <div class="report-page active" id="report-page-1">
                    <div class="page-content">
                        <div class="page-header">
                            <div class="page-number">Page 1 of 5</div>
                            <h1 class="report-title">INVESTIGATION REPORT</h1>
                            <div class="report-subtitle">Module M-2401 Installation Incident</div>
                        </div>
                        
                        <div class="executive-summary" id="summary-box">
                            <!-- Populated by JS -->
                        </div>
                        
                        <div class="outcome-section" id="epilogue-section">
                            <!-- Populated by JS -->
                        </div>
                        
                        <div class="rating-card" id="rank-display">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="page-footer">
                        <button class="page-turn-btn next" onclick="goToReportPage(2)">Next: Findings →</button>
                    </div>
                </div>
                
                <!-- PAGE 2: Investigation Findings -->
                <div class="report-page" id="report-page-2">
                    <div class="page-content">
                        <div class="page-header">
                            <div class="page-number">Page 2 of 5</div>
                            <h2 class="page-title">Investigation Findings</h2>
                            <p class="page-intro">7 real problems existed. Click any row for details.</p>
                        </div>
                        
                        <!-- Single Clickable Table -->
                        <div class="findings-table-container" id="findings-comparison">
                            <!-- Populated by JS - single clickable table -->
                        </div>
                    </div>
                    <div class="page-footer">
                        <button class="page-turn-btn prev" onclick="goToReportPage(1)">← Summary</button>
                        <button class="page-turn-btn next" onclick="goToReportPage(3)">Next: Financial →</button>
                    </div>
                </div>
                
                <!-- PAGE 3: Actions & Costs -->
                <div class="report-page" id="report-page-3">
                    <div class="page-content">
                        <div class="page-header">
                            <div class="page-number">Page 3 of 5</div>
                            <h2 class="page-title">Financial Impact</h2>
                        </div>
                        
                        <div class="cost-analysis" id="score-breakdown">
                            <!-- Populated by JS -->
                        </div>
                        
                        <div class="actions-taken" id="actions-section">
                            <!-- Populated by JS - solutions chosen -->
                        </div>
                    </div>
                    <div class="page-footer">
                        <button class="page-turn-btn prev" onclick="goToReportPage(2)">← Findings</button>
                        <button class="page-turn-btn next" onclick="goToReportPage(4)">Next: Takeaways →</button>
                    </div>
                </div>
                
                <!-- PAGE 4: Key Takeaways -->
                <div class="report-page" id="report-page-4">
                    <div class="page-content">
                        <div class="page-header">
                            <div class="page-number">Page 4 of 5</div>
                            <h2 class="page-title">Key Takeaways</h2>
                            <p class="page-intro">Lessons from this investigation</p>
                        </div>
                        
                        <div class="learning-section" id="learning-points">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="page-footer">
                        <button class="page-turn-btn prev" onclick="goToReportPage(3)">← Financial</button>
                        <button class="page-turn-btn next" onclick="goToReportPage(5)">Next: 5★ Solution →</button>
                    </div>
                </div>
                
                <!-- PAGE 5: Perfect Solution -->
                <div class="report-page" id="report-page-5">
                    <div class="page-content">
                        <div class="page-header">
                            <div class="page-number">Page 5 of 5</div>
                            <h2 class="page-title">⭐⭐⭐⭐⭐ The Perfect Solution</h2>
                            <p class="page-intro">What a 5-star investigation looks like</p>
                        </div>
                        
                        <div class="perfect-solution-section" id="full-solution">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="page-footer">
                        <button class="page-turn-btn prev" onclick="goToReportPage(4)">← Takeaways</button>
                    </div>
                </div>
            </div>
            
            <!-- Final Actions (always visible) -->
            <div class="report-actions">
                <button id="try-again-btn" class="btn-primary">Try Again</button>
            </div>
            <p class="navigation-hint">When finished, use the course navigation at the top of the page to continue to Act 5.</p>
        </div>
        
        <!-- Detail Modal for clicking on findings -->
        <div class="detail-modal hidden" id="finding-detail-modal">
            <div class="detail-modal-content">
                <button class="detail-close" onclick="closeDetailModal()">×</button>
                <div id="detail-modal-body">
                    <!-- Populated when clicking a finding -->
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden section for missed items data (used by JS) -->
    <div id="missed-section" class="hidden"></div>
    <div id="missed-items" class="hidden"></div>

    <script>
        // ============================================
        // PHASE 2: GAME STATE & MONEY COUNTER
        // ============================================

        // --------------------------------------------
        // 2.1 Game State Object
        // --------------------------------------------
        const gameState = {
            // Timing
            startTime: null,
            elapsedSeconds: 0,
            counterPaused: false,
            counterInterval: null,
            
            // Costs
            currentCost: 0,
            burnRatePerSecond: 5.50,
            
            // Progress
            evidenceExamined: [],
            evidenceCards: [],
            collectedEvidence: [], // Evidence taken to the board
            phoneCallsMade: [],
            contributingOrder: [],
            
            // Solutions
            selectedSolutions: {}, // { evidenceId: solutionId }
            
            // Results
            submitted: false,
            foundRootCause: false,
            missedContributing: [],
            
            // Legacy submission (for compatibility)
            submission: {
                primaryCause: null,
                contributing1: null,
                contributing2: null,
                recommendedFix: null
            },
            
            // Scoring
            finalScore: {
                timeCost: 0,
                accuracyPenalty: 0,
                efficiencyBonus: 0,
                fixPenalty: 0,
                total: 0
            }
        };

        // --------------------------------------------
        // 2.2 Cinematic Intro Functions
        // --------------------------------------------
        let currentSlide = 1;
        const totalSlides = 5;

        function nextSlide() {
            if (currentSlide < totalSlides) {
                goToSlide(currentSlide + 1);
            }
        }

        function goToSlide(slideNum) {
            // Stop intro audio if playing when leaving slide 3
            if (currentSlide === 3) {
                const introAudio = document.getElementById('intro-radio-audio');
                if (introAudio) {
                    introAudio.pause();
                    introAudio.currentTime = 0;
                    const btn = document.querySelector('.btn-radio-play');
                    if (btn) btn.classList.remove('playing');
                }
            }
            
            // Remove active from current slide
            document.querySelector(`.intro-slide[data-slide="${currentSlide}"]`).classList.remove('active');
            document.querySelector(`.progress-dot[data-slide="${currentSlide}"]`).classList.remove('active');
            
            // Set new slide
            currentSlide = slideNum;
            
            // Add active to new slide
            document.querySelector(`.intro-slide[data-slide="${currentSlide}"]`).classList.add('active');
            document.querySelector(`.progress-dot[data-slide="${currentSlide}"]`).classList.add('active');
        }

        function skipIntro() {
            // Stop any intro audio
            const introAudio = document.getElementById('intro-radio-audio');
            if (introAudio) {
                introAudio.pause();
                introAudio.currentTime = 0;
            }
            goToSlide(totalSlides);
        }

        function playIntroRadio() {
            const audioElement = document.getElementById('intro-radio-audio');
            const playBtn = document.querySelector('.btn-radio-play');
            
            if (audioElement.paused) {
                audioElement.play();
                playBtn.classList.add('playing');
                playBtn.innerHTML = '<span class="radio-icon">📻</span> Playing...';
            } else {
                audioElement.pause();
                playBtn.classList.remove('playing');
                playBtn.innerHTML = '<span class="radio-icon">📻</span> Play Radio Call';
            }
        }

        // Intro audio ended handler
        document.addEventListener('DOMContentLoaded', function() {
            const introAudio = document.getElementById('intro-radio-audio');
            if (introAudio) {
                introAudio.addEventListener('ended', function() {
                    const playBtn = document.querySelector('.btn-radio-play');
                    if (playBtn) {
                        playBtn.classList.remove('playing');
                        playBtn.innerHTML = '<span class="radio-icon">📻</span> Play Again';
                    }
                });
            }
        });

        // Add click handlers to progress dots
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.progress-dot').forEach(dot => {
                dot.addEventListener('click', function() {
                    goToSlide(parseInt(this.dataset.slide));
                });
            });
        });

        // --------------------------------------------
        // 2.3 Screen Management Functions
        // --------------------------------------------
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            // Show requested screen
            document.getElementById(screenId).classList.remove('hidden');
        }

        function startGame() {
            showScreen('game-screen');
            gameState.startTime = Date.now();
            startCounter();
        }

        // --------------------------------------------
        // 2.4 Money Counter Functions
        // --------------------------------------------
        function startCounter() {
            // Update 10x per second for smooth animation
            gameState.counterInterval = setInterval(updateCounter, 100);
        }

        function pauseCounter() {
            gameState.counterPaused = true;
        }

        function resumeCounter() {
            gameState.counterPaused = false;
        }

        function stopCounter() {
            clearInterval(gameState.counterInterval);
        }

        function updateCounter() {
            if (gameState.counterPaused) return;
            
            gameState.elapsedSeconds = (Date.now() - gameState.startTime) / 1000;
            gameState.currentCost = gameState.elapsedSeconds * gameState.burnRatePerSecond;
            
            // Update main display
            const costElement = document.getElementById('total-cost');
            if (costElement) {
                costElement.textContent = gameState.currentCost.toLocaleString('en-GB', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                });
            }
            
            // Update solution modal mini counter
            const solutionTime = document.getElementById('solution-time');
            const solutionCost = document.getElementById('solution-cost');
            if (solutionTime && solutionCost) {
                const mins = Math.floor(gameState.elapsedSeconds / 60);
                const secs = Math.floor(gameState.elapsedSeconds % 60);
                solutionTime.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                solutionCost.textContent = `£${Math.floor(gameState.currentCost).toLocaleString()}`;
            }
            
            // Add pulse effect every second
            if (Math.floor(gameState.elapsedSeconds) !== Math.floor(gameState.elapsedSeconds - 0.1)) {
                const counterTotal = document.querySelector('.counter-total');
                if (counterTotal) {
                    counterTotal.classList.add('pulse');
                    setTimeout(() => counterTotal.classList.remove('pulse'), 100);
                }
            }
        }

        // ============================================
        // PHASE 3: EVIDENCE SYSTEM
        // ============================================

        // --------------------------------------------
        // 3.1 Evidence Data Structure
        // --------------------------------------------
        // Evidence Categories: ROOT_CAUSE, CONTRIBUTING, OTHER_PROBLEM, NOT_A_PROBLEM
        const evidenceData = {
            module: {
                title: "Module Inspection Report",
                previewImage: "images/IMAGE_MODULE_FRAME.png",
                documentImage: "images/01_ModuleIns.png",
                documentDesc: "QC Inspection Report",
                hotspots: [
                    {
                        id: "coating-degradation",
                        x: 36.4,
                        y: 33.1,
                        label: "Coating Report",
                        category: "OTHER_PROBLEM",
                        trainingPoint: "4.4 Preservation during storage",
                        finding: {
                            title: "Coating Degradation Record",
                            description: "Photos show rust spots on module frame steelwork. Inspector's note: 'Surface corrosion on non-SC surfaces. Preservation coating breakdown after 8 months extended storage. Recommend remediation before grouting.'"
                        }
                    },
                    {
                        id: "flange-offset",
                        x: 64.4,
                        y: 39.1,
                        label: "Flange Measurement",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.4 Tolerance stack-up",
                        finding: {
                            title: "Flange Offset Measurement",
                            description: "Photo shows 100mm vertical gap between module flange and wall flange. Tape measure visible in image. Fitter's note attached: 'Bolt holes do not overlap. Cannot proceed with connection.'"
                        }
                    },
                    {
                        id: "frame-damage",
                        x: 30.4,
                        y: 74.6,
                        label: "Frame Damage",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.1 Transport limits",
                        finding: {
                            title: "Transport Frame Damage Photo",
                            description: "Photo shows scraped corner angle with paint transfer marks. Annotation on photo: 'Sacrificial member — no structural concern. Module frame intact.'"
                        }
                    },
                    {
                        id: "fme-signoff",
                        x: 57.8,
                        y: 76.7,
                        label: "FME Sign-Off",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.4 FME (Foreign Material Exclusion)",
                        finding: {
                            title: "FME Recovery Sign-Off",
                            description: "Borescope photos show nozzle bore interior. FME engineer signature dated yesterday confirms: 'Foreign material recovered and logged. Bore verified clear. FME-2401-003 closed.'"
                        }
                    }
                ],
                summaryCard: "QC inspection report from this morning with attached photographs."
            },
            
            transport: {
                title: "Transport Records",
                previewImage: "images/IMAGE_TRANSPORT_TRAILER.png",
                documentImage: "images/02_TransportRec.png",
                documentDesc: "Transport Folder",
                hotspots: [
                    {
                        id: "route-deviation",
                        x: 30.9,
                        y: 71.5,
                        label: "Route Report",
                        category: "CONTRIBUTING",
                        trainingPoint: "4.1 Transport limits (road width, height)",
                        finding: {
                            title: "Route Deviation Report",
                            description: "Driver's log notes diversion at Bridgwater due to road closure. Escort report: 'Minor contact with structure at railway bridge on unapproved route. Frame corner damaged, FME cover dislodged.' Handwritten note: 'No eng. assessment — schedule pressure.'"
                        }
                    },
                    {
                        id: "weighbridge",
                        x: 43.6,
                        y: 30.1,
                        label: "Weighbridge",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.1 Weight limits",
                        finding: {
                            title: "Weighbridge Ticket",
                            description: "Printed ticket showing gross weight 85.2 tonnes. Permit limit stated as 90 tonnes. All axle weights recorded within individual limits. Operator signature and timestamp present."
                        }
                    },
                    {
                        id: "departure-log",
                        x: 76.5,
                        y: 12.8,
                        label: "Departure Log",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.1 Transport limits",
                        finding: {
                            title: "Departure Time Log",
                            description: "Log shows convoy departed 23 minutes behind schedule. Reason noted: 'Driver rest period adjustment per regulations.' Revised ETA communicated to site."
                        }
                    },
                    {
                        id: "escort-checklist",
                        x: 93.3,
                        y: 41.1,
                        label: "Escort Checklist",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.1 Transport planning",
                        finding: {
                            title: "Escort Vehicle Checklist",
                            description: "Pre-departure checklist completed. All boxes ticked: vehicles roadworthy, radios tested, route cards distributed, permits verified. Signed by convoy leader."
                        }
                    }
                ],
                summaryCard: "Transport documentation folder containing route permit, driver's log, weighbridge ticket, and escort report."
            },
            
            lift: {
                title: "Lift Plan Documents",
                previewImage: "images/IMAGE_SURVEY_SETUP.png",
                documentImage: "images/03_Liftplants.png",
                documentDesc: "Lift Plan Pack",
                hotspots: [
                    {
                        id: "verification-requirements",
                        x: 18.6,
                        y: 38.3,
                        label: "Verification Section",
                        category: "CONTRIBUTING",
                        trainingPoint: "4.2 Lift point design, load distribution",
                        finding: {
                            title: "Verification Requirements Section",
                            description: "Lift plan Section 7 'Final Position Verification' states: 'Module to be placed on survey marks. Confirm visually aligned to wall penetration before releasing rigging.' Survey verification of interface flange alignment not listed in requirements."
                        }
                    },
                    {
                        id: "crane-calc",
                        x: 43.7,
                        y: 51.2,
                        label: "Crane Calculation",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.2 Overhead cranes",
                        finding: {
                            title: "Crane Capacity Calculation",
                            description: "Calculation sheet shows 78% utilisation at planned radius and load. Maximum permitted is 85%. Signed off by Appointed Person with CPCS certification number noted."
                        }
                    },
                    {
                        id: "rigging-config",
                        x: 76.1,
                        y: 19.1,
                        label: "3-Point Lift Note",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.2 Load distribution and rigging",
                        finding: {
                            title: "3-Point Lift Configuration Note",
                            description: "Technical note appended to lift plan: 'Revised from 4-point to 3-point lift due to Lug #3 corrosion findings. Load distribution recalculated. Centre of gravity within acceptable envelope. Approved by Lifting Engineer.'"
                        }
                    },
                    {
                        id: "weather-assessment",
                        x: 86.0,
                        y: 63.5,
                        label: "Weather Check",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.2 Lift conditions",
                        finding: {
                            title: "Weather Assessment",
                            description: "Morning weather check recorded: Wind 12mph (limit 20mph), visibility 8km (limit 1km), temperature 8°C. Crane supervisor signature confirming 'Conditions within lift plan parameters.'"
                        }
                    }
                ],
                summaryCard: "The approved lift plan, risk assessment, and verification requirements."
            },
            
            factory: {
                title: "Factory QC Records",
                previewImage: "images/IMAGE_QC_DOCUMENTS.png",
                documentImage: "images/04_FactoryQC.png",
                documentDesc: "Manufacturing QA Pack",
                hotspots: [
                    {
                        id: "lug-corrosion",
                        x: 18.5,
                        y: 22.4,
                        label: "Storage Inspection",
                        category: "OTHER_PROBLEM",
                        trainingPoint: "4.2 Lift point design",
                        finding: {
                            title: "Storage Inspection Log — Lug Corrosion",
                            description: "Monthly storage inspection dated 3 months ago. Entry reads: 'Surface corrosion observed on Lug #3. Structural assessment performed — adequate capacity retained for lift. Preservation coating has degraded. Module in storage 8 months.'"
                        }
                    },
                    {
                        id: "weld-reports",
                        x: 50.1,
                        y: 19.6,
                        label: "Weld Reports",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.3 Factory welds higher quality",
                        finding: {
                            title: "Weld Inspection Reports",
                            description: "Radiographic test reports for all SC2 pressure boundary welds. 100% RT coverage. All results marked 'Acceptable' per ASME standards. Inspector certification number and signature on each report."
                        }
                    },
                    {
                        id: "cmm-report",
                        x: 42.8,
                        y: 72.3,
                        label: "CMM Report",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.3 Factory vs site quality",
                        finding: {
                            title: "CMM Dimensional Report",
                            description: "Coordinate Measuring Machine report dated at factory release. 847 critical dimensions checked. All within tolerance. Nozzle centreline elevation recorded as +2,099.8mm from module base datum (drawing nominal: +2,100mm)."
                        }
                    },
                    {
                        id: "material-certs",
                        x: 80.5,
                        y: 64.0,
                        label: "Material Certs",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.3 Factory QA",
                        finding: {
                            title: "Material Certificates",
                            description: "Material traceability pack for pressure-retaining components. Mill certificates present for all plate and pipe. Heat numbers cross-referenced to weld maps. Chemical composition and mechanical properties recorded."
                        }
                    }
                ],
                summaryCard: "The manufacturing QA pack from Sheffield — certificates, inspection records, and storage logs."
            },
            
            drawings: {
                title: "Interface Drawings",
                previewImage: "images/IMAGE_DRAWING_ROOM.png",
                documentImage: "images/05_InterfaceDr.png",
                documentDesc: "Technical Drawings",
                hotspots: [
                    {
                        id: "overlay-analysis",
                        x: 19.9,
                        y: 38.2,
                        label: "Drawing Overlay",
                        category: "ROOT_CAUSE",
                        trainingPoint: "4.4 Tolerance stack-up, Interface management",
                        finding: {
                            title: "Drawing Overlay Analysis",
                            description: "Someone has overlaid the module drawing (DR-ME-4401) onto the civil drawing (DR-CV-2201). Handwritten note in margin: 'Checked datum references — module uses Z from base, civil uses AOD. See ICD-2401 Section 4.3.' The ICD section referenced is marked 'TBC'."
                        }
                    },
                    {
                        id: "module-drawing",
                        x: 71.4,
                        y: 11.3,
                        label: "Module Drawing",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.4 Interface management",
                        finding: {
                            title: "Module Drawing Approval Stamp",
                            description: "Drawing DR-ME-4401 Rev B. Title block shows approval signatures from Design Engineer, Checker, and QA dated 14 months ago. Nozzle elevation dimensioned as +2,100mm from module base datum."
                        }
                    },
                    {
                        id: "civil-drawing",
                        x: 81.0,
                        y: 75.7,
                        label: "Civil Drawing",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.4 Interface management",
                        finding: {
                            title: "Civil Drawing Revision History",
                            description: "Drawing DR-CV-2201 Rev C. Revision history shows: Rev A (initial), Rev B (rebar clash resolution), Rev C (concrete mix specification update). Wall penetration elevation dimensioned as +18,350mm AOD."
                        }
                    },
                    {
                        id: "sleeve-spec",
                        x: 22.4,
                        y: 62.4,
                        label: "Sleeve Specification",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.4 Interface management",
                        finding: {
                            title: "Penetration Sleeve Specification",
                            description: "Specification sheet for wall penetration sleeve. Internal diameter: 404mm. Module flange OD noted as 400mm. Annular gap allowance: 2mm each side for alignment tolerance."
                        }
                    }
                ],
                summaryCard: "A stack of technical drawings — module drawing, civil drawing, and the Interface Control Document."
            },
            
            weather: {
                title: "Site Conditions Log",
                previewImage: "images/IMAGE_SITE_OFFICE.png",
                documentImage: "images/06_SiteCondi.png",
                documentDesc: "Site Diary & Forms",
                hotspots: [
                    {
                        id: "ground-assessment-date",
                        x: 40.7,
                        y: 60.4,
                        label: "Ground Assessment",
                        category: "OTHER_PROBLEM",
                        trainingPoint: "4.2 Ground bearing",
                        finding: {
                            title: "Ground Assessment Date",
                            description: "Ground bearing capacity certificate dated 6 months ago. Site diary entry from 2 weeks ago reads: 'Significant rainfall overnight — areas of site waterlogged.' No subsequent re-assessment document in file for crane pad area."
                        }
                    },
                    {
                        id: "fme-log",
                        x: 32.9,
                        y: 13.1,
                        label: "FME Log",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "4.4 FME (Foreign Material Exclusion)",
                        finding: {
                            title: "FME Incident Log",
                            description: "FME incident log entry FME-2401-003 dated yesterday. Description: 'Debris found in nozzle bore following transport cover dislodgement.' Status: 'Closed — borescope verification complete, bore clear.'"
                        }
                    },
                    {
                        id: "weather-forecast",
                        x: 79.5,
                        y: 26.0,
                        label: "Weather Forecast",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "General",
                        finding: {
                            title: "Weather Forecast Printout",
                            description: "Met Office regional forecast printout for lift date. Light rain overnight clearing by 0500. Wind speeds 10-15mph from southwest. Temperature range 6-9°C. Visibility good."
                        }
                    },
                    {
                        id: "permit-to-dig",
                        x: 76.3,
                        y: 60.4,
                        label: "Permit to Dig",
                        category: "NOT_A_PROBLEM",
                        trainingPoint: "General",
                        finding: {
                            title: "Permit to Dig Records",
                            description: "Permit to dig reference PTD-2401-017. CAT scan and service drawings attached. Marked up area shows crane outrigger positions. Note: 'No buried services identified in outrigger footprint.'"
                        }
                    }
                ],
                summaryCard: "Site diary, weather printouts, and ground condition assessment forms."
            }
        };

        // Evidence categories for scoring
        // Evidence categories for scoring - matches category field in evidenceData
        const evidenceCategories = {
            rootCause: ['overlay-analysis'],
            // All 6 "Other Issues" that need to be found (CONTRIBUTING + OTHER_PROBLEM)
            otherIssues: [
                'route-deviation',
                'verification-requirements',
                'coating-degradation',
                'lug-corrosion',
                'ground-assessment-date',
                'call-engineer'
            ],
            notAProblem: [
                'flange-offset',
                'frame-damage',
                'fme-signoff',
                'weighbridge',
                'departure-log',
                'escort-checklist',
                'crane-calc',
                'rigging-config',
                'weather-assessment',
                'weld-reports',
                'cmm-report',
                'material-certs',
                'module-drawing',
                'civil-drawing',
                'sleeve-spec',
                'fme-log',
                'weather-forecast',
                'permit-to-dig',
                'call-driver',
                'call-crane-supervisor',
                'call-surveyor',
                'call-qc-manager'
            ]
        };

        // --------------------------------------------
        // 3.2 Evidence Examination Functions
        // --------------------------------------------
        function openEvidence(locationId) {
            const evidence = evidenceData[locationId];
            if (!evidence) return;
            
            // Track that this location was examined (for stats, not visual)
            if (!gameState.evidenceExamined.includes(locationId)) {
                gameState.evidenceExamined.push(locationId);
            }
            
            // Pause the counter while examining
            pauseCounter();
            
            // Populate modal - use documentImage for the actual investigation view
            document.getElementById('evidence-title').textContent = evidence.title;
            document.getElementById('evidence-image').src = evidence.documentImage || evidence.previewImage;
            
            // Clear previous hotspots
            const container = document.getElementById('evidence-image-container');
            container.querySelectorAll('.hotspot').forEach(h => h.remove());
            
            // Check what's currently collected from this location
            const collectedFromHere = gameState.collectedEvidence.find(e => e.locationId === locationId);
            
            // Add hotspots with correct states
            evidence.hotspots.forEach(hotspot => {
                const btn = document.createElement('button');
                btn.className = 'hotspot';
                
                // Check if this hotspot is the collected one
                if (collectedFromHere && collectedFromHere.id === hotspot.id) {
                    btn.classList.add('collected');
                }
                
                btn.style.left = hotspot.x + '%';
                btn.style.top = hotspot.y + '%';
                btn.setAttribute('data-hotspot-id', hotspot.id);
                btn.setAttribute('data-location', locationId);
                btn.innerHTML = `<span class="hotspot-label">${hotspot.label}</span>`;
                btn.addEventListener('click', () => revealFinding(locationId, hotspot.id));
                container.appendChild(btn);
            });
            
            // Clear findings panel
            document.getElementById('evidence-findings').innerHTML = '<p class="findings-hint">Click on highlighted areas to examine evidence.</p>';
            
            // Show modal
            document.getElementById('evidence-modal').classList.remove('hidden');
        }

        function revealFinding(locationId, hotspotId) {
            const evidence = evidenceData[locationId];
            const hotspot = evidence.hotspots.find(h => h.id === hotspotId);
            if (!hotspot) return;
            
            // Mark hotspot as seen (green) - but not collected yet
            const btn = document.querySelector(`[data-hotspot-id="${hotspotId}"]`);
            if (!btn.classList.contains('collected')) {
                btn.classList.add('seen');
            }
            
            // Clear the findings panel - only show one finding at a time
            const findingsPanel = document.getElementById('evidence-findings');
            findingsPanel.innerHTML = '';
            
            // Check if this specific finding is currently collected
            const thisCollected = gameState.collectedEvidence.some(e => e.id === hotspotId && e.locationId === locationId);
            
            // Determine button state
            let actionsHtml = '';
            if (thisCollected) {
                actionsHtml = '<span class="already-collected">✓ Collected</span>';
            } else {
                actionsHtml = `<button class="btn-take" onclick="collectEvidence('${locationId}', '${hotspotId}')">Collect This Evidence</button>`;
            }
            
            // Create finding card
            const findingCard = document.createElement('div');
            findingCard.className = 'finding-card';
            findingCard.setAttribute('data-finding', hotspotId);
            findingCard.innerHTML = `
                <h4>${hotspot.finding.title}</h4>
                <p>${hotspot.finding.description}</p>
                <div class="finding-actions">${actionsHtml}</div>
            `;
            findingsPanel.appendChild(findingCard);
        }

        function collectEvidence(locationId, hotspotId) {
            const evidence = evidenceData[locationId];
            const hotspot = evidence.hotspots.find(h => h.id === hotspotId);
            if (!hotspot) return;
            
            // Check if already collected something from this location - if so, swap it
            const existingIndex = gameState.collectedEvidence.findIndex(e => e.locationId === locationId);
            if (existingIndex !== -1) {
                // Remove old evidence and update its hotspot state (inside modal)
                const oldEvidence = gameState.collectedEvidence[existingIndex];
                const oldHotspotBtn = document.querySelector(`[data-hotspot-id="${oldEvidence.id}"]`);
                if (oldHotspotBtn) {
                    oldHotspotBtn.classList.remove('collected');
                    oldHotspotBtn.classList.add('seen');
                }
                gameState.collectedEvidence.splice(existingIndex, 1);
            }
            
            // Add new evidence
            gameState.collectedEvidence.push({
                id: hotspotId,
                locationId: locationId,
                title: hotspot.finding.title,
                description: hotspot.finding.description,
                category: null
            });
            
            // Mark this hotspot as collected (green with tick) - inside modal
            const newHotspotBtn = document.querySelector(`[data-hotspot-id="${hotspotId}"]`);
            if (newHotspotBtn) {
                newHotspotBtn.classList.remove('seen');
                newHotspotBtn.classList.add('collected');
            }
            
            // Mark main scene hotspot as collected (green with tick)
            const sceneHotspot = document.querySelector(`.scene-hotspot[data-location="${locationId}"]`);
            if (sceneHotspot) {
                sceneHotspot.classList.remove('seen');
                sceneHotspot.classList.add('collected');
            }
            
            // Update the finding card UI
            const findingCard = document.querySelector(`[data-finding="${hotspotId}"]`);
            if (findingCard) {
                const actionsDiv = findingCard.querySelector('.finding-actions');
                if (actionsDiv) {
                    actionsDiv.innerHTML = '<span class="already-collected">✓ Collected</span>';
                }
            }
            
            // Update evidence count display
            updateEvidenceCount();
        }

        function updateEvidenceCount() {
            const count = gameState.collectedEvidence.length;
            const countDisplay = document.getElementById('evidence-count');
            if (countDisplay) {
                countDisplay.textContent = count;
            }
            
            // Update visual collection slots
            updateCollectionSlots();
            
            // Enable board button only when all 7 evidence collected
            const boardBtn = document.getElementById('open-board-btn');
            const btnText = boardBtn.querySelector('.board-btn-text');
            
            const allCollected = gameState.collectedEvidence.length >= 7;
            
            if (allCollected) {
                boardBtn.disabled = false;
                btnText.textContent = 'Go to Evidence Board →';
            } else {
                boardBtn.disabled = true;
                const remaining = 7 - gameState.collectedEvidence.length;
                const hasPhone = gameState.collectedEvidence.some(e => e.locationId === 'phone');
                const locationCount = gameState.collectedEvidence.filter(e => e.locationId !== 'phone').length;
                
                if (locationCount >= 6 && !hasPhone) {
                    btnText.textContent = 'Make a phone call';
                } else {
                    btnText.textContent = `${remaining} more to collect`;
                }
            }
        }

        function updateCollectionSlots() {
            const slots = document.querySelectorAll('.collection-slot');
            
            // Location evidence mapping for thumbnails
            const locationThumbnails = {
                'module': 'images/IMAGE_MODULE_FRAME.png',
                'transport': 'images/IMAGE_TRANSPORT_TRAILER.png',
                'lift': 'images/IMAGE_SURVEY_SETUP.png',
                'factory': 'images/IMAGE_QC_DOCUMENTS.png',
                'drawings': 'images/IMAGE_DRAWING_ROOM.png',
                'weather': 'images/IMAGE_SITE_OFFICE.png',
                'phone': 'images/IMAGE_UI_01.png'
            };
            
            // Separate location evidence and phone evidence
            const locationEvidence = gameState.collectedEvidence.filter(e => e.locationId !== 'phone');
            const phoneEvidence = gameState.collectedEvidence.find(e => e.locationId === 'phone');
            
            // Fill location slots (0-5)
            for (let i = 0; i < 6; i++) {
                const slot = slots[i];
                const evidence = locationEvidence[i];
                
                if (evidence) {
                    slot.classList.remove('empty');
                    slot.classList.add('filled');
                    const thumbnail = locationThumbnails[evidence.locationId] || 'images/IMAGE_SCENE_03.png';
                    slot.innerHTML = `
                        <div class="slot-evidence">
                            <img src="${thumbnail}" alt="${evidence.title}">
                            <span>${evidence.title}</span>
                        </div>
                    `;
                } else {
                    slot.classList.add('empty');
                    slot.classList.remove('filled');
                    slot.innerHTML = `<span class="slot-number">${i + 1}</span>`;
                }
            }
            
            // Fill phone slot (6)
            const phoneSlot = slots[6];
            if (phoneEvidence) {
                phoneSlot.classList.remove('empty');
                phoneSlot.classList.add('filled');
                phoneSlot.innerHTML = `
                    <div class="slot-evidence">
                        <img src="${locationThumbnails['phone']}" alt="${phoneEvidence.title}">
                        <span>${phoneEvidence.title}</span>
                    </div>
                `;
            } else {
                phoneSlot.classList.add('empty');
                phoneSlot.classList.remove('filled');
                phoneSlot.innerHTML = `<span class="slot-number">📞</span>`;
            }
        }

        // ============================================
        // EVIDENCE BOARD FUNCTIONS
        // ============================================
        
        function openEvidenceBoard() {
            populateEvidenceBoard();
            document.getElementById('board-modal').classList.remove('hidden');
            pauseCounter();
        }

        function closeEvidenceBoard() {
            document.getElementById('board-modal').classList.add('hidden');
            resumeCounter();
        }

        function populateEvidenceBoard() {
            const tableArea = document.getElementById('evidence-table');
            const rootSlot = document.querySelector('#root-cause-zone .slot-content');
            const contribSlot = document.querySelector('#contributing-zone .slot-content');
            const redherringSlot = document.querySelector('#redherring-zone .slot-content');
            
            // Clear everything
            tableArea.innerHTML = '';
            rootSlot.innerHTML = '';
            contribSlot.innerHTML = '';
            redherringSlot.innerHTML = '';
            
            // Create cards for all collected evidence
            gameState.collectedEvidence.forEach((evidence, index) => {
                // Check if already classified
                if (evidence.category === 'rootCause') {
                    rootSlot.appendChild(createMiniCard(evidence));
                } else if (evidence.category === 'contributing') {
                    contribSlot.appendChild(createMiniCard(evidence));
                } else if (evidence.category === 'redHerring') {
                    redherringSlot.appendChild(createMiniCard(evidence));
                } else {
                    // Unclassified - show as full card on table
                    const card = createFullCard(evidence, index);
                    tableArea.appendChild(card);
                }
            });
            
            setupBoardDragDrop();
            updateBoardStatus();
        }

        function createFullCard(evidence, index) {
            const card = document.createElement('div');
            card.className = 'evidence-card';
            card.draggable = true;
            card.setAttribute('data-evidence-id', evidence.id);
            
            // Random rotation for natural look
            const rotation = (Math.random() - 0.5) * 3;
            card.style.setProperty('--rotate', `${rotation}deg`);
            
            // Get source name
            let source = evidence.locationId || 'Phone';
            const sourceMap = {
                'module': 'Module',
                'transport': 'Transport',
                'lift': 'Lift Plan',
                'factory': 'Factory QC',
                'drawings': 'Drawings',
                'weather': 'Weather'
            };
            source = sourceMap[evidence.locationId] || source;
            if (evidence.id.startsWith('call-')) source = '📞 Call';
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="card-title">${evidence.title}</div>
                    <span class="card-source">${source}</span>
                </div>
                <div class="card-body">${evidence.description}</div>
            `;
            
            return card;
        }

        function createMiniCard(evidence) {
            const card = document.createElement('div');
            card.className = 'mini-card';
            card.draggable = true;
            card.setAttribute('data-evidence-id', evidence.id);
            card.textContent = evidence.title;
            return card;
        }

        function setupBoardDragDrop() {
            // Full cards on table
            document.querySelectorAll('.evidence-card').forEach(card => {
                card.addEventListener('dragstart', handleCardDragStart);
                card.addEventListener('dragend', handleCardDragEnd);
            });
            
            // Mini cards in slots
            document.querySelectorAll('.mini-card').forEach(card => {
                card.addEventListener('dragstart', handleCardDragStart);
                card.addEventListener('dragend', handleCardDragEnd);
            });
            
            // Classification slots
            document.querySelectorAll('.classification-slot').forEach(slot => {
                slot.addEventListener('dragover', handleSlotDragOver);
                slot.addEventListener('dragleave', handleSlotDragLeave);
                slot.addEventListener('drop', handleSlotDrop);
            });
            
            // Table area (for unclassifying)
            const tableArea = document.getElementById('evidence-table');
            tableArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            });
            tableArea.addEventListener('drop', handleTableDrop);
            
            // Setup touch support for mobile
            setupMobileTouchSupport();
        }
        
        // ============================================
        // MOBILE TOUCH SUPPORT FOR EVIDENCE BOARD
        // ============================================
        let selectedCardForMove = null;
        
        function setupMobileTouchSupport() {
            // Check if touch device
            const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
            
            if (!isTouchDevice) return;
            
            // Add tap-to-select for evidence cards
            document.querySelectorAll('.evidence-card, .mini-card').forEach(card => {
                card.addEventListener('click', handleCardTapSelect);
            });
            
            // Add tap-to-drop for classification slots
            document.querySelectorAll('.classification-slot').forEach(slot => {
                slot.addEventListener('click', handleSlotTapDrop);
            });
            
            // Add tap to return to table
            const tableArea = document.getElementById('evidence-table');
            if (tableArea) {
                tableArea.addEventListener('click', handleTableTapDrop);
            }
        }
        
        function handleCardTapSelect(e) {
            e.stopPropagation();
            const card = e.currentTarget;
            
            // If already selected, deselect
            if (card.classList.contains('selected-for-move')) {
                card.classList.remove('selected-for-move');
                selectedCardForMove = null;
                hideMobileDropHints();
                return;
            }
            
            // Deselect any previously selected card
            document.querySelectorAll('.selected-for-move').forEach(c => c.classList.remove('selected-for-move'));
            
            // Select this card
            card.classList.add('selected-for-move');
            selectedCardForMove = card;
            
            // Show drop zone hints
            showMobileDropHints();
        }
        
        function handleSlotTapDrop(e) {
            if (!selectedCardForMove) return;
            
            const slot = e.currentTarget;
            const category = slot.getAttribute('data-category');
            const evidenceId = selectedCardForMove.getAttribute('data-evidence-id');
            const evidence = gameState.collectedEvidence.find(ev => ev.id === evidenceId);
            
            if (!evidence) return;
            
            // Check limits
            if (category === 'rootCause') {
                const existing = slot.querySelector('.mini-card');
                if (existing && existing.getAttribute('data-evidence-id') !== evidenceId) {
                    alert('Only one root cause can be selected. Remove the current one first.');
                    return;
                }
            }
            if (category === 'contributing') {
                const count = slot.querySelectorAll('.mini-card').length;
                const alreadyInSlot = slot.querySelector(`[data-evidence-id="${evidenceId}"]`);
                if (count >= 6 && !alreadyInSlot) {
                    alert('Maximum 6 contributing factors allowed.');
                    return;
                }
            }
            
            // Remove from current location
            selectedCardForMove.remove();
            
            // Update evidence category
            evidence.category = category;
            
            // Add mini card to slot
            const miniCard = createMiniCard(evidence);
            miniCard.addEventListener('click', handleCardTapSelect);
            slot.appendChild(miniCard);
            
            // Clear selection
            selectedCardForMove = null;
            hideMobileDropHints();
            
            // Update board status
            updateBoardStatus();
        }
        
        function handleTableTapDrop(e) {
            // Only handle if we have a selected card and clicked directly on table area
            if (!selectedCardForMove) return;
            if (e.target.closest('.evidence-card') || e.target.closest('.mini-card')) return;
            
            const evidenceId = selectedCardForMove.getAttribute('data-evidence-id');
            const evidence = gameState.collectedEvidence.find(ev => ev.id === evidenceId);
            
            if (!evidence) return;
            
            // Only unclassify if it was classified
            if (evidence.category) {
                selectedCardForMove.remove();
                evidence.category = null;
                
                // Add card back to table
                const tableArea = document.getElementById('evidence-table');
                const fullCard = createFullCard(evidence);
                fullCard.addEventListener('click', handleCardTapSelect);
                tableArea.appendChild(fullCard);
            }
            
            // Clear selection
            selectedCardForMove = null;
            hideMobileDropHints();
            
            // Update board status
            updateBoardStatus();
        }
        
        function showMobileDropHints() {
            document.querySelectorAll('.classification-slot').forEach(slot => {
                slot.classList.add('tap-hint');
            });
        }
        
        function hideMobileDropHints() {
            document.querySelectorAll('.classification-slot').forEach(slot => {
                slot.classList.remove('tap-hint');
            });
            document.querySelectorAll('.selected-for-move').forEach(c => c.classList.remove('selected-for-move'));
        }

        let draggedCard = null;

        function handleCardDragStart(e) {
            draggedCard = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', e.target.getAttribute('data-evidence-id'));
        }

        function handleCardDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedCard = null;
            document.querySelectorAll('.classification-slot').forEach(s => s.classList.remove('drag-over'));
        }

        function handleSlotDragOver(e) {
            e.preventDefault();
            const slot = e.currentTarget;
            const category = slot.getAttribute('data-category');
            
            // Check limits
            if (category === 'rootCause') {
                const existing = slot.querySelector('.mini-card');
                if (existing && !slot.contains(draggedCard)) return;
            }
            if (category === 'contributing') {
                const count = slot.querySelectorAll('.mini-card').length;
                if (count >= 6 && !slot.contains(draggedCard)) return;
            }
            
            e.dataTransfer.dropEffect = 'move';
            slot.classList.add('drag-over');
        }

        function handleSlotDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleSlotDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const slot = e.currentTarget;
            const category = slot.getAttribute('data-category');
            const evidenceId = e.dataTransfer.getData('text/plain');
            const evidence = gameState.collectedEvidence.find(ev => ev.id === evidenceId);
            
            if (!evidence) return;
            
            // Check limits
            if (category === 'rootCause') {
                const existing = slot.querySelector('.mini-card');
                if (existing && existing.getAttribute('data-evidence-id') !== evidenceId) return;
            }
            if (category === 'contributing') {
                const count = slot.querySelectorAll('.mini-card').length;
                const alreadyInSlot = slot.querySelector(`[data-evidence-id="${evidenceId}"]`);
                if (count >= 6 && !alreadyInSlot) return;
            }
            
            // Update category
            evidence.category = category;
            
            // Re-render the board
            populateEvidenceBoard();
        }

        function handleTableDrop(e) {
            e.preventDefault();
            const evidenceId = e.dataTransfer.getData('text/plain');
            const evidence = gameState.collectedEvidence.find(ev => ev.id === evidenceId);
            
            if (evidence) {
                evidence.category = null;
                populateEvidenceBoard();
            }
        }

        function updateBoardStatus() {
            const unclassifiedCount = gameState.collectedEvidence.filter(e => !e.category).length;
            const hasRootCause = gameState.collectedEvidence.some(e => e.category === 'rootCause');
            
            const statusEl = document.getElementById('board-status');
            const submitBtn = document.getElementById('submit-board-btn');
            
            if (unclassifiedCount > 0) {
                statusEl.textContent = `${unclassifiedCount} card${unclassifiedCount > 1 ? 's' : ''} left`;
                submitBtn.disabled = true;
            } else if (!hasRootCause) {
                statusEl.textContent = 'Select a root cause';
                submitBtn.disabled = true;
            } else {
                statusEl.textContent = 'Ready!';
                submitBtn.disabled = false;
            }
        }

        function saveEvidenceBoard() {
            closeEvidenceBoard();
        }

        function submitEvidenceBoard() {
            const hasRootCause = gameState.collectedEvidence.some(e => e.category === 'rootCause');
            const unclassifiedCount = gameState.collectedEvidence.filter(e => !e.category).length;
            
            if (!hasRootCause) {
                alert('Please identify the Root Cause before submitting.');
                return;
            }
            
            if (unclassifiedCount > 0) {
                alert('Please classify all evidence before submitting.');
                return;
            }
            
            // Save contributing order
            gameState.contributingOrder = gameState.collectedEvidence
                .filter(e => e.category === 'contributing')
                .map(e => e.id);
            
            // Keep counter running during solution phase
            // (don't stop it - cost continues while deciding)
            
            closeEvidenceBoard();
            openSolutionModal();
        }

        // ============================================
        // SOLUTION SELECTION FUNCTIONS (One at a time)
        // ============================================
        
        let solutionQueue = [];
        let currentSolutionIndex = 0;
        
        function openSolutionModal() {
            // Build queue of all evidence that needs solutions
            solutionQueue = [];
            
            // Get root cause evidence (if player found it)
            const rootCauseEvidence = gameState.collectedEvidence.find(e => e.category === 'rootCause');
            if (rootCauseEvidence) {
                solutionQueue.push({ evidence: rootCauseEvidence, type: 'root-cause' });
            }
            
            // Get contributing factor evidence
            const contributingEvidence = gameState.collectedEvidence.filter(e => e.category === 'contributing');
            contributingEvidence.forEach(e => {
                solutionQueue.push({ evidence: e, type: 'contributing' });
            });
            
            // Get red herring evidence (player classified as problems)
            const redHerringEvidence = gameState.collectedEvidence.filter(e => e.category === 'redHerring');
            redHerringEvidence.forEach(e => {
                solutionQueue.push({ evidence: e, type: 'issue' });
            });
            
            // Initialize
            currentSolutionIndex = 0;
            gameState.selectedSolutions = {};
            
            // Show first
            showCurrentSolution();
            document.getElementById('solution-modal').classList.remove('hidden');
        }

        function closeSolutionModal() {
            document.getElementById('solution-modal').classList.add('hidden');
        }
        
        function showCurrentSolution() {
            const container = document.getElementById('current-solution-step');
            const progressText = document.getElementById('solution-progress-text');
            const progressFill = document.getElementById('solution-progress-fill');
            const submitBtn = document.getElementById('submit-solution-btn');
            
            const total = solutionQueue.length;
            const current = currentSolutionIndex + 1;
            
            // Update progress
            progressText.textContent = `Issue ${current} of ${total}`;
            progressFill.style.width = `${(currentSolutionIndex / total) * 100}%`;
            
            // Get current item
            const item = solutionQueue[currentSolutionIndex];
            const evidence = item.evidence;
            const type = item.type;
            
            // Get solutions
            const solutions = solutionData[evidence.id]?.solutions || [];
            
            // Build options HTML
            let optionsHTML = '';
            solutions.forEach((solution) => {
                optionsHTML += `
                    <label class="solution-option" data-solution-id="${solution.id}">
                        <input type="radio" name="current-solution" value="${solution.id}">
                        <div class="solution-option-content">
                            <div class="solution-option-text">${solution.text}</div>
                            <div class="solution-option-cost">Cost: £${solution.cost.toLocaleString()}</div>
                        </div>
                    </label>
                `;
            });
            
            // Determine badge and class
            let badgeText = '⚠️ Other Issue';
            let stepClass = 'solution-step issue-step';
            if (type === 'root-cause') {
                badgeText = '🎯 Root Cause';
                stepClass = 'solution-step root-cause-step';
            } else if (type === 'contributing' || type === 'issue') {
                badgeText = '⚠️ Other Issue';
                stepClass = 'solution-step contributing-step';
            }
            
            container.innerHTML = `
                <div class="${stepClass}">
                    <div class="solution-step-header">
                        <span class="solution-step-badge">${badgeText}</span>
                        <span class="solution-step-title">${evidence.title}</span>
                    </div>
                    <div class="solution-step-description">${evidence.description}</div>
                    <div class="solution-options">
                        ${optionsHTML || '<p class="no-solutions">No solutions available.</p>'}
                    </div>
                </div>
            `;
            
            // Add click handlers
            container.querySelectorAll('.solution-option').forEach(option => {
                option.addEventListener('click', () => {
                    container.querySelectorAll('.solution-option').forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    option.querySelector('input').checked = true;
                    submitBtn.disabled = false;
                });
            });
            
            // Reset button state
            submitBtn.disabled = true;
            
            // Change button text on last item
            if (currentSolutionIndex === total - 1) {
                submitBtn.textContent = 'Finish & View Results →';
            } else {
                submitBtn.textContent = 'Submit Solution →';
            }
        }
        
        function submitCurrentSolution() {
            const container = document.getElementById('current-solution-step');
            const selectedOption = container.querySelector('.solution-option.selected');
            
            if (!selectedOption) {
                return;
            }
            
            // Store the selection
            const item = solutionQueue[currentSolutionIndex];
            const solutionId = parseInt(selectedOption.getAttribute('data-solution-id'));
            gameState.selectedSolutions[item.evidence.id] = solutionId;
            
            // Move to next or finish
            currentSolutionIndex++;
            
            if (currentSolutionIndex >= solutionQueue.length) {
                // All done - show results
                closeSolutionModal();
                showResults();
            } else {
                // Show next
                showCurrentSolution();
            }
        }

        // Solution Modal Event Listeners
        document.getElementById('submit-solution-btn').addEventListener('click', submitCurrentSolution);

        // Evidence Board Event Listeners
        document.getElementById('open-board-btn').addEventListener('click', openEvidenceBoard);
        document.getElementById('submit-board-btn').addEventListener('click', submitEvidenceBoard);
        document.querySelector('.board-close-btn').addEventListener('click', closeEvidenceBoard);

        function closeEvidence() {
            document.getElementById('evidence-modal').classList.add('hidden');
            
            // Resume counter
            resumeCounter();
        }

        // --------------------------------------------
        // 3.3 Event Listeners for Evidence
        // --------------------------------------------
        
        // Check if touch device
        const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
        
        document.querySelectorAll('.scene-hotspot[data-location]').forEach(btn => {
            if (isTouchDevice) {
                // Mobile: first tap shows preview, second tap (on card) opens location
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    // If already showing preview, open location
                    if (btn.classList.contains('preview-active')) {
                        openEvidence(btn.getAttribute('data-location'));
                        btn.classList.remove('preview-active');
                    } else {
                        // Remove preview from all other hotspots
                        document.querySelectorAll('.scene-hotspot.preview-active').forEach(h => {
                            h.classList.remove('preview-active');
                        });
                        // Show preview for this one
                        btn.classList.add('preview-active');
                    }
                });
                
                // Also allow clicking the card directly to open
                const card = btn.querySelector('.hotspot-card');
                if (card) {
                    card.addEventListener('click', (e) => {
                        e.stopPropagation();
                        openEvidence(btn.getAttribute('data-location'));
                        btn.classList.remove('preview-active');
                    });
                }
            } else {
                // Desktop: click goes directly to location (hover shows preview)
                btn.addEventListener('click', () => {
                    openEvidence(btn.getAttribute('data-location'));
                });
            }
        });
        
        // Close preview when clicking elsewhere on mobile
        if (isTouchDevice) {
            document.querySelector('.game-main').addEventListener('click', (e) => {
                if (!e.target.closest('.scene-hotspot')) {
                    document.querySelectorAll('.scene-hotspot.preview-active').forEach(h => {
                        h.classList.remove('preview-active');
                    });
                }
            });
        }

        // Close evidence modal
        document.getElementById('evidence-done').addEventListener('click', closeEvidence);
        document.querySelector('#evidence-modal .modal-close').addEventListener('click', closeEvidence);

        // --------------------------------------------
        // 2.4 Event Listeners (Original)
        // --------------------------------------------
        document.getElementById('start-btn').addEventListener('click', startGame);

        // ============================================
        // PHASE 4: PHONE CALL SYSTEM
        // ============================================

        // --------------------------------------------
        // 4.1 Phone Call Data
        // --------------------------------------------
        const phoneCallData = {
            "qc-manager": {
                name: "Factory QC Manager",
                duration: 15,
                cost: 83,
                category: "NOT_A_PROBLEM",
                trainingPoint: "4.3 Factory QC",
                audioFile: "audio/call-qc-manager.mp3",
                dialogue: "Module dimensions were perfect — I can show you the CMM report. All 847 checked dimensions within tolerance. SC2 nozzle position exactly per drawing. Welds passed 100% RT first time. Our reject rate is 2.1%. Whatever caused this misalignment, it wasn't manufacturing quality. The module left here perfect.",
                evidenceTitle: "Factory QC Manager Statement",
                evidenceDescription: "QC Manager confirms all 847 dimensions checked and within tolerance. Nozzle position exactly per drawing. Welds passed 100% RT. States: 'The module left here perfect.'"
            },
            driver: {
                name: "Transport Driver",
                duration: 15,
                cost: 83,
                category: "NOT_A_PROBLEM",
                trainingPoint: "4.1 Transport limits",
                audioFile: "audio/call-driver.mp3",
                dialogue: "Yeah, we had to divert — road closure. The bridge was tight. Look, we scraped the corner but the load stayed secure. I checked everything. The module didn't move on the trailer. Transport loads? They were all calculated before we left — everything within limits.",
                evidenceTitle: "Transport Driver Statement",
                evidenceDescription: "Driver confirms route diversion due to road closure, minor bridge scrape. States load stayed secure and module didn't move on trailer. Transport loads calculated and within limits."
            },
            "crane-supervisor": {
                name: "Crane Supervisor",
                duration: 12,
                cost: 66,
                category: "NOT_A_PROBLEM",
                trainingPoint: "4.2 Lift points",
                audioFile: "audio/call-crane-supervisor.mp3",
                dialogue: "Lug 3 was too far gone — corrosion. Three-point lift worked fine. Set it right on the marks — I signed it off. The nozzle not lining up with the wall? That's not my job. I place it where the survey marks are. I did exactly what the lift plan said.",
                evidenceTitle: "Crane Supervisor Statement",
                evidenceDescription: "Crane Supervisor confirms 3-point lift due to Lug 3 corrosion. Module placed on survey marks as instructed. States: 'I place it where the survey marks are. I did exactly what the lift plan said.'"
            },
            engineer: {
                name: "Design Engineer",
                duration: 20,
                cost: 110,
                category: "OTHER_PROBLEM",
                trainingPoint: "4.4 Interface management, tolerance stack-up",
                audioFile: "audio/call-engineer.mp3",
                dialogue: "The datum transformation section? Yes, I saw it was marked TBC. I assumed the civil team would convert to our datum, or that the interface manager would complete it. We always dimension from module base — that's standard vendor practice. I didn't think it was my responsibility to chase it. Nobody owned the interface.",
                evidenceTitle: "Design Engineer Statement",
                evidenceDescription: "Engineer admits seeing ICD Section 4.3 marked 'TBC' but assumed others would complete it. States: 'I didn't think it was my responsibility to chase it. Nobody owned the interface.'"
            },
            surveyor: {
                name: "Site Surveyor",
                duration: 10,
                cost: 55,
                category: "NOT_A_PROBLEM",
                trainingPoint: "4.4 Survey methods",
                audioFile: "audio/call-surveyor.mp3",
                dialogue: "I put the marks exactly where the drawings said. Used total station, calibrated last month. I set them out from the building grid per DR-CV-2201. If the nozzle doesn't line up, that's not my survey being wrong. Nobody gave me both drawings to check against each other. I just set out what's on the drawing.",
                evidenceTitle: "Site Surveyor Statement",
                evidenceDescription: "Surveyor confirms marks placed exactly per civil drawing DR-CV-2201. Equipment calibrated. States: 'Nobody gave me both drawings to check against each other. I just set out what's on the drawing.'"
            }
        };

        // ============================================
        // SOLUTION DATA - 28 findings (7 real + 21 decoys)
        // ============================================
        // For real problems: 3 solutions + no action
        // For decoys: no action is correct (any solution is wasted money)
        
        const solutionData = {
            // ========== 1. INTERFACE DRAWINGS (ROOT CAUSE) ==========
            "overlay-analysis": {
                realCategory: "ROOT_CAUSE",
                lesson: "The datum mismatch was the root cause. Module drawing DR-ME-4401 used module base datum (+2,100mm), civil drawing DR-CV-2201 used AOD (+18,350mm). ICD-2401 Section 4.3 was marked 'TBC' and never completed. Under LC17, configuration control requires complete documentation.",
                solutions: [
                    {
                        id: 1,
                        text: "Implement mandatory datum reconciliation procedure for all ICDs. Require sign-off that transformation matrix is complete before design approval.",
                        cost: 25000,
                        saving: 2500000,
                        impact: 2500000,
                        correct: true,
                        explanation: "Addresses root cause directly. Prevents future occurrences at lowest cost."
                    },
                    {
                        id: 2,
                        text: "Hire dedicated Interface Manager role to own all ICDs and verify completeness.",
                        cost: 180000,
                        saving: 2500000,
                        impact: 2500000,
                        correct: false,
                        explanation: "Effective but expensive. Procedure change achieves same outcome at lower cost."
                    },
                    {
                        id: 3,
                        text: "Add automated ICD completeness check to document management system — reject any document with TBC in critical fields.",
                        cost: 75000,
                        saving: 2500000,
                        impact: 2500000,
                        correct: false,
                        explanation: "Good technical solution but higher cost than procedural fix."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 2500000,
                        correct: false,
                        explanation: "Problem recurs on future modules. Each instance costs £2-3M to remediate."
                    }
                ]
            },
            "module-drawing": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The module drawing was properly approved through the correct process. The drawing itself is correct to its own datum — the problem was the lack of datum reconciliation in the ICD.",
                solutions: [
                    {
                        id: 1,
                        text: "Re-issue module drawing with site datum reference",
                        cost: 35000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Unnecessary — drawing is correct. This treats symptom not cause."
                    },
                    {
                        id: 2,
                        text: "Add additional approval gate for interface drawings",
                        cost: 20000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "More approvals don't help if the datum reconciliation isn't done."
                    },
                    {
                        id: 3,
                        text: "Require vendor to use site datum on all drawings",
                        cost: 45000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Not practical — vendors use their own datums by standard practice."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — the drawing approval was not the problem."
                    }
                ]
            },
            "civil-drawing": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The civil drawing revision history shows normal design development. The revisions were for rebar clashes and concrete mix changes, unrelated to penetration position. The civil drawing is correct to building datum.",
                solutions: [
                    {
                        id: 1,
                        text: "Audit all civil drawing revisions for interface impacts",
                        cost: 40000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "The revisions weren't the issue — the datum reconciliation was."
                    },
                    {
                        id: 2,
                        text: "Require interface review on every civil drawing revision",
                        cost: 25000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Adds bureaucracy without addressing root cause."
                    },
                    {
                        id: 3,
                        text: "Freeze civil drawings earlier in design process",
                        cost: 60000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Reduces design flexibility without fixing the coordination issue."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — civil drawing revisions were not the problem."
                    }
                ]
            },
            "sleeve-spec": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The penetration sleeve specification is correct — 404mm ID matches the module flange OD. The dimensional compatibility is fine; the sleeve is just at the wrong elevation due to the datum mismatch.",
                solutions: [
                    {
                        id: 1,
                        text: "Review all sleeve specifications for dimensional compatibility",
                        cost: 15000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Sleeve dimensions are correct — this misses the real issue."
                    },
                    {
                        id: 2,
                        text: "Add tolerance analysis to sleeve specifications",
                        cost: 22000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Tolerance wasn't the issue — it was absolute position."
                    },
                    {
                        id: 3,
                        text: "Require physical mock-up before sleeve installation",
                        cost: 80000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Expensive and doesn't address datum reconciliation."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — sleeve specification was not the problem."
                    }
                ]
            },
            
            // ========== 2. TRANSPORT RECORDS (CONTRIBUTING) ==========
            "route-deviation": {
                realCategory: "CONTRIBUTING",
                lesson: "The route deviation through an unsurveyed road led to the bridge strike, frame damage, and FME breach. The driver did not escalate for engineering assessment despite the contact. Route management procedures are as critical as module sizing for safe transport.",
                solutions: [
                    {
                        id: 1,
                        text: "Implement mandatory stop-and-escalate procedure for any route deviation. Driver empowered and required to refuse unsurveyed routes.",
                        cost: 15000,
                        saving: 500000,
                        impact: 500000,
                        correct: true,
                        explanation: "Addresses the procedural gap at lowest cost. Empowers drivers to stop."
                    },
                    {
                        id: 2,
                        text: "Require real-time GPS tracking with geofence alerts. Any deviation triggers automatic notification to transport manager.",
                        cost: 45000,
                        saving: 500000,
                        impact: 500000,
                        correct: false,
                        explanation: "Good technology solution but higher cost than procedural fix."
                    },
                    {
                        id: 3,
                        text: "Pre-survey three alternative routes for each transport. Approved deviations available if primary route blocked.",
                        cost: 120000,
                        saving: 500000,
                        impact: 500000,
                        correct: false,
                        explanation: "Thorough but expensive. Most transports don't need alternatives."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 500000,
                        correct: false,
                        explanation: "Future transport incidents. Risk of module damage, delays, regulatory scrutiny."
                    }
                ]
            },
            "weighbridge": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The weighbridge ticket confirms the load was within permit limits at 85.2 tonnes. Weight was acceptable and is unrelated to the alignment issue.",
                solutions: [
                    {
                        id: 1,
                        text: "Install on-site weighbridge for arrival verification",
                        cost: 95000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Weight wasn't the issue — wasted investment."
                    },
                    {
                        id: 2,
                        text: "Require multiple weighbridge checks en route",
                        cost: 8000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Unnecessary — weight was within limits."
                    },
                    {
                        id: 3,
                        text: "Add weight monitoring sensors to transport frame",
                        cost: 45000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Technology solution for a non-problem."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — weight was within limits and not related to alignment."
                    }
                ]
            },
            "departure-log": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The 23-minute late departure was due to driver rest period adjustment. This is a mandatory safety requirement under driver hours regulations. Minor schedule variance with no safety impact.",
                solutions: [
                    {
                        id: 1,
                        text: "Review transport scheduling to allow rest period buffer",
                        cost: 5000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Nice to have but 23 minutes didn't cause the problem."
                    },
                    {
                        id: 2,
                        text: "Arrange driver changeover to eliminate rest delays",
                        cost: 25000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Overcomplicated solution for a non-issue."
                    },
                    {
                        id: 3,
                        text: "Add schedule contingency to all transport plans",
                        cost: 3000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Good practice but not related to this incident."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — schedule variance was minor and not related to alignment."
                    }
                ]
            },
            "escort-checklist": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The escort vehicle checklist was properly completed. All vehicles roadworthy, radios tested, route cards distributed. The failure was in route deviation management, not pre-departure checks.",
                solutions: [
                    {
                        id: 1,
                        text: "Enhance escort checklist with deviation protocols",
                        cost: 3000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "The checklist was fine — the issue was the deviation decision."
                    },
                    {
                        id: 2,
                        text: "Add escort supervisor role for complex transports",
                        cost: 35000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "More people don't help if procedures aren't followed."
                    },
                    {
                        id: 3,
                        text: "Digital checklist with photographic verification",
                        cost: 18000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Technology for a non-problem."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — pre-departure checks were properly completed."
                    }
                ]
            },
            
            // ========== 3. LIFT PLAN DOCUMENTS (CONTRIBUTING) ==========
            "verification-requirements": {
                realCategory: "CONTRIBUTING",
                lesson: "The lift plan only required visual alignment to survey marks. No independent surveyor verification of the flange-to-flange alignment was required before crane release. Under LC19, 'visually aligned' is not adequate verification for safety-related interfaces.",
                solutions: [
                    {
                        id: 1,
                        text: "Update lift plan template to require independent survey verification of all safety-related interface alignments before crane release.",
                        cost: 10000,
                        saving: 800000,
                        impact: 800000,
                        correct: true,
                        explanation: "Simple procedural fix that catches misalignments before crane release."
                    },
                    {
                        id: 2,
                        text: "Implement laser alignment verification system for all module-to-building interfaces.",
                        cost: 250000,
                        saving: 800000,
                        impact: 800000,
                        correct: false,
                        explanation: "Expensive technology solution. Procedural change achieves same outcome."
                    },
                    {
                        id: 3,
                        text: "Require dual sign-off (crane supervisor + surveyor) for all safety-related module installations.",
                        cost: 35000,
                        saving: 800000,
                        impact: 800000,
                        correct: false,
                        explanation: "Reasonable but more expensive than updating the procedure."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 800000,
                        correct: false,
                        explanation: "Future misalignments not caught until too late. Crane time wasted. Rework costs."
                    }
                ]
            },
            "crane-calc": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The crane capacity calculation showed 78% utilisation — well within safe limits. Correctly calculated and signed by Appointed Person. Crane capacity was not the issue.",
                solutions: [
                    {
                        id: 1,
                        text: "Reduce maximum utilisation to 70% for safety-related modules",
                        cost: 15000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "78% is safe. This adds cost without benefit."
                    },
                    {
                        id: 2,
                        text: "Require third-party verification of crane calculations",
                        cost: 25000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Calculations were correct — unnecessary duplication."
                    },
                    {
                        id: 3,
                        text: "Use larger crane for additional margin",
                        cost: 40000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Bigger crane doesn't fix interface alignment."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — crane capacity was adequate and not related to alignment."
                    }
                ]
            },
            "rigging-config": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The 3-point lift configuration was properly assessed and approved. Calculations showed stable geometry. The lift was stable throughout — this was not a related issue.",
                solutions: [
                    {
                        id: 1,
                        text: "Require 4-point lift for all safety-related modules regardless of lug condition",
                        cost: 55000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "3-point was safe and stable. This misses the real issue."
                    },
                    {
                        id: 2,
                        text: "Add load cells to all lift points for real-time monitoring",
                        cost: 28000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Rigging wasn't the problem — technology for a non-issue."
                    },
                    {
                        id: 3,
                        text: "Independent rigging verification for safety-related modules",
                        cost: 18000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Rigging was correctly done — unnecessary check."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — 3-point lift was properly assessed and stable."
                    }
                ]
            },
            "weather-assessment": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "Weather conditions were acceptable — wind 12mph, visibility good, temperature 8°C. All within lift plan criteria. Weather did not affect the lift or cause the alignment issue.",
                solutions: [
                    {
                        id: 1,
                        text: "Reduce wind speed limit for safety-related module lifts",
                        cost: 8000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Wind was well within limits — unnecessary restriction."
                    },
                    {
                        id: 2,
                        text: "Install on-site weather station for real-time monitoring",
                        cost: 35000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Weather wasn't the issue — wasted investment."
                    },
                    {
                        id: 3,
                        text: "Require weather forecast 48 hours before lift decision",
                        cost: 2000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Good practice but not related to this incident."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — weather conditions were acceptable."
                    }
                ]
            },
            
            // ========== 4. MODULE INSPECTION REPORT (OTHER PROBLEM) ==========
            "coating-degradation": {
                realCategory: "OTHER_PROBLEM",
                lesson: "Coating degradation after 8 months storage indicates inadequate preservation regime for extended storage duration. Same underlying issue as lifting lug corrosion. Under LC28, equipment must remain fit for purpose.",
                solutions: [
                    {
                        id: 1,
                        text: "Implement enhanced preservation procedure for any module stored beyond 3 months. Monthly coating inspections and touch-up.",
                        cost: 20000,
                        saving: 150000,
                        impact: 150000,
                        correct: true,
                        explanation: "Addresses storage preservation at reasonable cost."
                    },
                    {
                        id: 2,
                        text: "Construct covered storage facility for modules awaiting installation.",
                        cost: 450000,
                        saving: 150000,
                        impact: 150000,
                        correct: false,
                        explanation: "Effective but cost exceeds benefit. Overkill for this issue."
                    },
                    {
                        id: 3,
                        text: "Apply enhanced marine-grade coating system to all modules at manufacture.",
                        cost: 85000,
                        saving: 150000,
                        impact: 150000,
                        correct: false,
                        explanation: "Reasonable but more expensive than procedural monitoring."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 150000,
                        correct: false,
                        explanation: "Continued coating degradation on stored modules. Remediation costs."
                    }
                ]
            },
            "flange-offset": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The flange offset measurement documents the symptom — it is evidence of the problem, not the cause. The 100mm vertical gap is what needs explaining, not what needs fixing directly.",
                solutions: [
                    {
                        id: 1,
                        text: "Commission detailed dimensional survey of offset",
                        cost: 18000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "We know the offset is 100mm — more measurement doesn't find root cause."
                    },
                    {
                        id: 2,
                        text: "3D laser scan of entire interface zone",
                        cost: 45000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Expensive documentation of what we already know."
                    },
                    {
                        id: 3,
                        text: "Install temporary shims to test alignment",
                        cost: 12000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Doesn't address why the offset exists."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — measurement is evidence, not a problem to fix."
                    }
                ]
            },
            "frame-damage": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The transport frame damage photo shows the sacrificial corner angle did its job — it protected the module. The damage is confined to the sacrificial element. Module itself is undamaged.",
                solutions: [
                    {
                        id: 1,
                        text: "Strengthen transport frame corner angles",
                        cost: 22000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Sacrificial angles worked as designed. No change needed."
                    },
                    {
                        id: 2,
                        text: "Add proximity sensors to transport frame",
                        cost: 35000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Technology for a non-problem — frame did its job."
                    },
                    {
                        id: 3,
                        text: "Replace damaged frame section before future transports",
                        cost: 8000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Standard maintenance — not a investigation finding."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — sacrificial element did its job."
                    }
                ]
            },
            "fme-signoff": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The FME recovery was properly completed. Borescope photos confirm clean nozzle bore. FME engineer signed off 'No foreign material remaining.' Issue was properly resolved — no remaining problem.",
                solutions: [
                    {
                        id: 1,
                        text: "Require second FME verification after transport",
                        cost: 8000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "FME was already properly verified and closed."
                    },
                    {
                        id: 2,
                        text: "Install permanent FME covers that cannot be dislodged",
                        cost: 25000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Cover design wasn't the issue — route deviation was."
                    },
                    {
                        id: 3,
                        text: "Add FME inspection to pre-lift checklist",
                        cost: 2000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Already done — this is standard practice."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — FME issue was properly resolved."
                    }
                ]
            },
            
            // ========== 5. FACTORY QC RECORDS (OTHER PROBLEM) ==========
            "lug-corrosion": {
                realCategory: "OTHER_PROBLEM",
                lesson: "Lifting Lug #3 developed corrosion after 8 months outdoor storage. Same preservation failure as coating degradation. Under LC28, lifting equipment must be maintained fit for purpose throughout storage.",
                solutions: [
                    {
                        id: 1,
                        text: "Implement lifting lug preservation covers and monthly inspection for stored modules. Re-assess capacity before any lift after extended storage.",
                        cost: 18000,
                        saving: 200000,
                        impact: 200000,
                        correct: true,
                        explanation: "Targeted fix for lifting lug preservation at reasonable cost."
                    },
                    {
                        id: 2,
                        text: "Specify stainless steel lifting lugs for all future modules.",
                        cost: 120000,
                        saving: 200000,
                        impact: 200000,
                        correct: false,
                        explanation: "Effective but expensive. Better preservation is cheaper."
                    },
                    {
                        id: 3,
                        text: "Limit maximum storage duration to 3 months. Accelerate site readiness or delay manufacture.",
                        cost: 300000,
                        saving: 200000,
                        impact: 200000,
                        correct: false,
                        explanation: "Impractical — schedule is driven by many factors. Cost exceeds benefit."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 200000,
                        correct: false,
                        explanation: "Future lug degradation. Risk of lift plan changes, delays, or unsafe conditions."
                    }
                ]
            },
            "weld-reports": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "All SC2 pressure boundary welds passed 100% radiographic testing. Reports signed by ASME-qualified inspector. Welds are fine — excellent quality work in factory conditions.",
                solutions: [
                    {
                        id: 1,
                        text: "Require additional ultrasonic testing on all safety-related welds",
                        cost: 35000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "RT already confirmed weld quality — unnecessary duplication."
                    },
                    {
                        id: 2,
                        text: "Third-party weld inspection verification",
                        cost: 28000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Welds were properly inspected — not the issue."
                    },
                    {
                        id: 3,
                        text: "Increase weld inspection sample rate to 120%",
                        cost: 15000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Already at 100% for safety-related welds — can't improve."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — weld quality was excellent."
                    }
                ]
            },
            "cmm-report": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "All 847 dimensions verified within tolerance by CMM. Nozzle elevation +2,099.8mm (nominal +2,100mm). Module was built correctly to its own drawing — the module is perfect to its own datum.",
                solutions: [
                    {
                        id: 1,
                        text: "Require site re-verification of CMM dimensions",
                        cost: 22000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Module dimensions are correct — re-measuring wastes time."
                    },
                    {
                        id: 2,
                        text: "Add interface dimensions to CMM check list",
                        cost: 8000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Interface dimensions were checked — to wrong datum."
                    },
                    {
                        id: 3,
                        text: "Photogrammetric verification of critical dimensions",
                        cost: 45000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "More measurement doesn't fix datum mismatch."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — module was built correctly to its drawing."
                    }
                ]
            },
            "material-certs": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "Full material traceability in place. Heat numbers, mill certificates, all compliant with specification. Proper QA documentation — no issue with material quality.",
                solutions: [
                    {
                        id: 1,
                        text: "Implement blockchain-based material traceability",
                        cost: 120000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Materials were fine — expensive technology for no benefit."
                    },
                    {
                        id: 2,
                        text: "Require independent verification of material certificates",
                        cost: 25000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Certificates were valid — unnecessary checking."
                    },
                    {
                        id: 3,
                        text: "Add material testing at site arrival",
                        cost: 18000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Materials were to spec — not the issue."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — material quality was not an issue."
                    }
                ]
            },
            
            // ========== 6. SITE CONDITIONS LOG (OTHER PROBLEM) ==========
            "ground-assessment-date": {
                realCategory: "OTHER_PROBLEM",
                lesson: "Ground bearing assessment was 6 months old. Not re-validated despite site diary entries noting significant rainfall and waterlogged conditions. Under LC19, ground conditions directly affect lift safety.",
                solutions: [
                    {
                        id: 1,
                        text: "Update procedure to require ground re-assessment within 7 days of any heavy lift, and after any significant weather event.",
                        cost: 8000,
                        saving: 350000,
                        impact: 350000,
                        correct: true,
                        explanation: "Simple procedural fix ensures current ground data for critical lifts."
                    },
                    {
                        id: 2,
                        text: "Install permanent instrumented crane pads with real-time settlement monitoring.",
                        cost: 180000,
                        saving: 350000,
                        impact: 350000,
                        correct: false,
                        explanation: "Effective but expensive. Procedural change is cheaper."
                    },
                    {
                        id: 3,
                        text: "Concrete all designated crane pad areas to eliminate ground variability.",
                        cost: 280000,
                        saving: 350000,
                        impact: 350000,
                        correct: false,
                        explanation: "Permanent fix but cost approaches benefit. Procedure is better."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 350000,
                        correct: false,
                        explanation: "Risk of crane instability in future lifts. Potential for serious incident."
                    }
                ]
            },
            "fme-log": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "The FME incident log shows yesterday's nozzle debris issue was properly closed out with borescope verification. Issue was already resolved and properly documented — no remaining problem.",
                solutions: [
                    {
                        id: 1,
                        text: "Enhance FME log with photographic evidence requirement",
                        cost: 5000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Borescope photos were already taken — this is done."
                    },
                    {
                        id: 2,
                        text: "Require FME engineer sign-off before any lift",
                        cost: 12000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Already required — this is standard practice."
                    },
                    {
                        id: 3,
                        text: "Implement FME tracking database",
                        cost: 35000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Logging was adequate — not the issue."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — FME issue was properly resolved and closed."
                    }
                ]
            },
            "weather-forecast": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "Met Office forecast showed conditions acceptable for lifting operations. Light rain overnight, wind 10-15mph — within limits. Weather conditions were not a problem.",
                solutions: [
                    {
                        id: 1,
                        text: "Require forecast from multiple providers",
                        cost: 3000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Forecast was accurate — not the issue."
                    },
                    {
                        id: 2,
                        text: "Install on-site weather monitoring",
                        cost: 45000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Weather was acceptable — wasted investment."
                    },
                    {
                        id: 3,
                        text: "Extend weather monitoring period before lifts",
                        cost: 2000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Weather wasn't the issue."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — weather conditions were acceptable."
                    }
                ]
            },
            "permit-to-dig": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "Utilities survey completed. No services in crane pad area. Proper preparation was completed — not related to the alignment issue.",
                solutions: [
                    {
                        id: 1,
                        text: "Require permit refresh for each lift operation",
                        cost: 8000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Permit was valid — unnecessary bureaucracy."
                    },
                    {
                        id: 2,
                        text: "Ground penetrating radar survey before each lift",
                        cost: 25000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "No buried services — wasted effort."
                    },
                    {
                        id: 3,
                        text: "Extend permit to dig radius for heavy lifts",
                        cost: 5000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Permit coverage was adequate."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — permit to dig was not related to the issue."
                    }
                ]
            },
            
            // ========== 7. PHONE CALLS ==========
            "call-engineer": {
                realCategory: "OTHER_PROBLEM",
                lesson: "The design engineer admitted seeing 'TBC' in ICD Section 4.3 but assumed someone else would complete it. This reveals organisational failure — unclear responsibilities for interface completion. Under LC17, clear accountability is fundamental to nuclear safety culture.",
                solutions: [
                    {
                        id: 1,
                        text: "Clarify RACI matrix for ICD completion. Named individual responsible for each interface. Cannot close design phase with any TBC in SC-related documents.",
                        cost: 12000,
                        saving: 400000,
                        impact: 400000,
                        correct: true,
                        explanation: "Clear accountability prevents 'someone else will do it' mindset."
                    },
                    {
                        id: 2,
                        text: "Implement interface coordination meetings (weekly during design phase) with mandatory attendance from all parties.",
                        cost: 60000,
                        saving: 400000,
                        impact: 400000,
                        correct: false,
                        explanation: "Meetings help but don't guarantee completion. RACI is clearer."
                    },
                    {
                        id: 3,
                        text: "Require formal interface sign-off from both sides of every safety-related interface before design freeze.",
                        cost: 25000,
                        saving: 400000,
                        impact: 400000,
                        correct: false,
                        explanation: "Good practice but more expensive than RACI clarification."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 400000,
                        correct: false,
                        explanation: "Continued ambiguity on interface ownership. Future 'someone else' errors."
                    }
                ]
            },
            "call-qc-manager": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "QC Manager confirmed module was correctly designed and built to vendor standards. All dimensions verified. 'The module left here perfect' — module manufacturing is not the issue.",
                solutions: [
                    {
                        id: 1,
                        text: "Require QC to verify against site datum as well as module datum",
                        cost: 25000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "QC can only check what they're given — datum reconciliation is design's job."
                    },
                    {
                        id: 2,
                        text: "Add factory-to-site dimension handover meeting",
                        cost: 15000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Doesn't address datum reconciliation issue."
                    },
                    {
                        id: 3,
                        text: "Extend QC hold point to include interface verification",
                        cost: 20000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "QC verified correctly — the drawings were the issue."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — factory QC did their job properly."
                    }
                ]
            },
            "call-driver": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "Transport driver confirms loads were properly checked and within limits. Module didn't shift during transport. Transport loading is not the cause of the alignment issue.",
                solutions: [
                    {
                        id: 1,
                        text: "Require driver training on interface awareness",
                        cost: 8000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Driver can't verify interface alignment — not their job."
                    },
                    {
                        id: 2,
                        text: "Add driver checklist for interface protection",
                        cost: 3000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Transport was fine — alignment is a design issue."
                    },
                    {
                        id: 3,
                        text: "Driver debrief required for all safety-related module transports",
                        cost: 5000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Driver did their job correctly."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — transport loading was not the issue."
                    }
                ]
            },
            "call-crane-supervisor": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "Crane supervisor confirms module placed exactly on survey marks as instructed. Lift was stable. 'I place it where the survey marks are' — the crane operation was correct.",
                solutions: [
                    {
                        id: 1,
                        text: "Require crane supervisor to verify interface alignment",
                        cost: 12000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Crane supervisor places on marks — alignment check is surveyor's job."
                    },
                    {
                        id: 2,
                        text: "Add interface awareness training for crane crews",
                        cost: 18000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Crane crew did their job correctly."
                    },
                    {
                        id: 3,
                        text: "Crane supervisor sign-off on interface alignment",
                        cost: 8000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Not the right person for this check."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — crane operation was performed correctly."
                    }
                ]
            },
            "call-surveyor": {
                realCategory: "NOT_A_PROBLEM",
                lesson: "Site surveyor confirms marks placed correctly per civil drawing. Equipment calibrated. 'Nobody gave me both drawings to check' — the surveyor did their job correctly with the information provided.",
                solutions: [
                    {
                        id: 1,
                        text: "Require surveyor to check both module and civil drawings",
                        cost: 15000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Surveyor can only set out what they're given — datum reconciliation is design's job."
                    },
                    {
                        id: 2,
                        text: "Surveyor sign-off on interface compatibility",
                        cost: 10000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Surveyor isn't responsible for datum reconciliation."
                    },
                    {
                        id: 3,
                        text: "Add survey verification hold point before lift",
                        cost: 8000,
                        saving: 0,
                        impact: 0,
                        correct: false,
                        explanation: "Survey was correct to the drawing they were given."
                    },
                    {
                        id: 4,
                        text: "No action",
                        cost: 0,
                        saving: 0,
                        impact: 0,
                        correct: true,
                        explanation: "Correct — surveyor performed their job correctly."
                    }
                ]
            }
        };


        // Detailed consequences for problems left unfixed
        const missedConsequences = {
            "overlay-analysis": {
                title: "Drawing Overlay Analysis",
                location: "Interface Drawings",
                consequence: "Without identifying the datum mismatch, all future module-to-building interfaces will suffer the same systematic offset. Each misaligned connection requires emergency remediation and ONR notification under LC19. The ICD 'TBC' issue will recur on every interface.",
                regulatoryRisk: "ONR will likely issue a Regulatory Issue for repeated installation non-conformances. LC17 (Management Systems) concerns about configuration control when 'TBC' appears in approved documents. <strong>CDM 2015 Regulation 9:</strong> The designer who left 'TBC' in a safety-critical document failed their duty to provide sufficient information. If workers are injured during remediation, personal criminal prosecution is possible — fines up to £900,000 and imprisonment up to 18 years for gross negligence manslaughter.",
                recommendedFix: "Implement mandatory datum reconciliation procedure for all ICDs. Require sign-off that transformation matrix is complete before design approval.",
                financialImpact: "£2,500,000 cost per occurrence if unfixed. Future modules will repeat this problem."
            },
            "route-deviation": {
                title: "Transport Route Deviation",
                location: "Transport Records",
                consequence: "The route deviation and bridge strike damaged the frame corner and dislodged the FME cover. Driver did not escalate for engineering assessment. Without stop-and-escalate procedures, future transports will take similar risks.",
                regulatoryRisk: "Route deviations without engineering assessment may constitute inadequate transport arrangements. Impact damage on safety-related components requires formal evaluation under LC28.",
                recommendedFix: "Implement mandatory stop-and-escalate procedure for any route deviation. Driver empowered and required to refuse unsurveyed routes.",
                financialImpact: "£500,000 potential future costs from transport incidents, module damage, and regulatory scrutiny."
            },
            "verification-requirements": {
                title: "Lift Plan Verification Requirements",
                location: "Lift Plan Documents",
                consequence: "The lift plan only required 'visual alignment to survey marks' — no independent surveyor verification of flange-to-flange alignment. Future modules may be released with misalignments undetected until too late.",
                regulatoryRisk: "LC19 requires adequate construction control. 'Visually aligned' is not adequate verification for safety-related interfaces.",
                recommendedFix: "Update lift plan template to require independent survey verification of all safety-related interface alignments before crane release.",
                financialImpact: "£800,000 potential costs from future misalignments not caught until crane release, wasting crane time and causing rework."
            },
            "coating-degradation": {
                title: "Coating Degradation",
                location: "Module Inspection Report",
                consequence: "Coating breakdown after 8 months extended storage indicates inadequate preservation regime. Same underlying issue as lifting lug corrosion. Future stored modules will suffer similar degradation.",
                regulatoryRisk: "LC28 requires equipment to remain fit for purpose. Preservation is part of quality management.",
                recommendedFix: "Implement enhanced preservation procedure for any module stored beyond 3 months. Monthly coating inspections and touch-up.",
                financialImpact: "£150,000 potential costs from continued degradation on stored modules, remediation, and structural concerns."
            },
            "lug-corrosion": {
                title: "Lifting Lug Corrosion",
                location: "Factory QC Records",
                consequence: "Lug #3 corrosion after 8 months outdoor storage forced switch to 3-point lift. Same preservation failure as coating degradation. Future modules at risk of lug degradation affecting lift safety.",
                regulatoryRisk: "LC28 requires that safety-related equipment remains fit for purpose. Lifting equipment must be maintained throughout storage.",
                recommendedFix: "Implement lifting lug preservation covers and monthly inspection for stored modules. Re-assess capacity before any lift after extended storage.",
                financialImpact: "£200,000 potential costs from future lug degradation causing lift plan changes, delays, or unsafe conditions."
            },
            "ground-assessment-date": {
                title: "Ground Assessment Date",
                location: "Site Conditions Log",
                consequence: "Ground bearing assessment was 6 months old and not re-validated despite significant rainfall and waterlogged conditions. Future lifts may proceed on inadequate ground data, risking crane instability.",
                regulatoryRisk: "LC19 construction control. Ground conditions directly affect lift safety. HSE may become involved alongside ONR.",
                recommendedFix: "Update procedure to require ground re-assessment within 7 days of any heavy lift, and after any significant weather event.",
                financialImpact: "£350,000 potential costs from crane instability, lift failures, or serious incidents if ground fails under load."
            },
            "call-engineer": {
                title: "Design Engineer Admission",
                location: "Phone Call",
                consequence: "Engineer admitted seeing 'TBC' in ICD but assumed someone else would complete it. 'Nobody owned the interface.' Without clear accountability, this coordination failure will persist across all interfaces.",
                regulatoryRisk: "LC17 management systems require clear accountability. 'Someone else' mindset is a fundamental nuclear safety culture concern. <strong>CDM 2015:</strong> The Principal Designer has a duty under Regulation 11 to coordinate health and safety matters during the pre-construction phase. Allowing 'TBC' to reach construction is a failure to ensure designers have discharged their Regulation 9 duties. Both the individual designer and the Principal Designer could face prosecution if this leads to injury.",
                recommendedFix: "Clarify RACI matrix for ICD completion. Named individual responsible for each interface. Cannot close design phase with any TBC in SC-related documents.",
                financialImpact: "£400,000 potential costs from continued ambiguity on interface ownership and future 'someone else' errors."
            }
        };

        let currentCallInterval = null;
        let currentCallId = null;

        // Contact role descriptions
        const contactRoles = {
            "qc-manager": "Sheffield Manufacturing",
            "driver": "Haulage Contractor",
            "crane-supervisor": "Site Crane Team",
            "engineer": "Design Office",
            "surveyor": "Site Survey Team"
        };

        // Contact avatar icons
        const contactAvatars = {
            "qc-manager": "🏭",
            "driver": "🚛",
            "crane-supervisor": "🏗️",
            "engineer": "📐",
            "surveyor": "📍"
        };

        // --------------------------------------------
        // 4.2 Phone Functions
        // --------------------------------------------
        function openPhone() {
            const contactsContainer = document.getElementById('phone-contacts');
            contactsContainer.innerHTML = '';
            
            // Check if already collected phone evidence
            const phoneEvidence = gameState.collectedEvidence.find(e => e.locationId === 'phone');
            
            Object.entries(phoneCallData).forEach(([id, contact]) => {
                const alreadyCalled = gameState.phoneCallsMade.includes(id);
                const isCollected = phoneEvidence && phoneEvidence.id === 'call-' + id;
                
                const btn = document.createElement('button');
                let statusClass = 'available';
                let statusText = 'Available';
                
                if (isCollected) {
                    btn.className = 'phone-contact collected';
                    statusClass = 'collected';
                    statusText = '✓ Collected';
                } else if (alreadyCalled) {
                    btn.className = 'phone-contact called';
                    statusClass = 'called';
                    statusText = 'Called';
                } else {
                    btn.className = 'phone-contact';
                }
                
                btn.innerHTML = `
                    <div class="contact-avatar">${contactAvatars[id] || '👤'}</div>
                    <div class="contact-info">
                        <div class="contact-name">${contact.name}</div>
                        <div class="contact-role">${contactRoles[id] || ''}</div>
                    </div>
                    <span class="contact-status ${statusClass}">${statusText}</span>
                `;
                btn.addEventListener('click', () => startCall(id));
                contactsContainer.appendChild(btn);
            });
            
            // Show current evidence status
            const statusContainer = document.getElementById('phone-evidence-status');
            if (phoneEvidence) {
                statusContainer.innerHTML = `
                    <div class="phone-current-evidence">
                        <div class="phone-current-evidence-label">Current Evidence</div>
                        <div class="phone-current-evidence-title">${phoneEvidence.title}</div>
                    </div>
                `;
            } else {
                statusContainer.innerHTML = '';
            }
            
            document.getElementById('phone-contact-view').classList.remove('hidden');
            document.getElementById('phone-call-active').classList.add('hidden');
            document.getElementById('phone-modal').classList.remove('hidden');
        }

        function startCall(contactId) {
            const contact = phoneCallData[contactId];
            currentCallId = contactId;
            
            // Mark as called if not already
            if (!gameState.phoneCallsMade.includes(contactId)) {
                gameState.phoneCallsMade.push(contactId);
            }
            
            document.getElementById('phone-contact-view').classList.add('hidden');
            document.getElementById('phone-call-active').classList.remove('hidden');
            document.getElementById('call-contact-name').textContent = contact.name;
            document.querySelector('.call-subtitle').textContent = contactRoles[contactId] || 'Call in progress...';
            document.getElementById('call-dialogue').textContent = '';
            
            // Set up audio and auto-play
            const audioElement = document.getElementById('call-audio');
            const audioBtn = document.getElementById('audio-toggle-btn');
            
            if (contact.audioFile) {
                audioElement.src = contact.audioFile;
                audioBtn.style.display = 'flex';
                audioBtn.classList.add('playing');
                audioBtn.textContent = '🔊';
                // Auto-play audio
                audioElement.play().catch(e => {
                    // Auto-play blocked by browser, show play button
                    audioBtn.classList.remove('playing');
                    audioBtn.textContent = '🔇';
                });
            } else {
                audioBtn.style.display = 'none';
            }
            
            // Hide complete actions initially, show skip button
            document.getElementById('call-complete-actions').classList.add('hidden');
            document.querySelector('.call-actions').classList.remove('hidden');
            
            let charIndex = 0;
            const revealSpeed = 30;
            
            currentCallInterval = setInterval(() => {
                charIndex += 2;
                document.getElementById('call-dialogue').textContent = contact.dialogue.substring(0, charIndex);
                
                if (charIndex >= contact.dialogue.length) {
                    clearInterval(currentCallInterval);
                    currentCallInterval = null;
                    showCallComplete();
                }
            }, revealSpeed);
        }

        function toggleCallAudio() {
            const audioElement = document.getElementById('call-audio');
            const audioBtn = document.getElementById('audio-toggle-btn');
            
            if (audioElement.paused) {
                audioElement.play();
                audioBtn.classList.add('playing');
                audioBtn.textContent = '🔊';
            } else {
                audioElement.pause();
                audioBtn.classList.remove('playing');
                audioBtn.textContent = '🔇';
            }
        }

        // Audio ended handler
        document.addEventListener('DOMContentLoaded', function() {
            const audioElement = document.getElementById('call-audio');
            if (audioElement) {
                audioElement.addEventListener('ended', function() {
                    const audioBtn = document.getElementById('audio-toggle-btn');
                    if (audioBtn) {
                        audioBtn.classList.remove('playing');
                        audioBtn.textContent = '🔄';
                        audioBtn.title = 'Play again';
                    }
                });
            }
        });

        function skipToEnd() {
            if (currentCallInterval) {
                clearInterval(currentCallInterval);
                currentCallInterval = null;
            }
            const contact = phoneCallData[currentCallId];
            document.getElementById('call-dialogue').textContent = contact.dialogue;
            showCallComplete();
        }

        function showCallComplete() {
            // Hide skip button, show complete actions
            document.querySelector('.call-actions').classList.add('hidden');
            document.getElementById('call-complete-actions').classList.remove('hidden');
            
            // Update collect button text based on whether phone evidence exists
            const phoneEvidence = gameState.collectedEvidence.find(e => e.locationId === 'phone');
            const collectBtn = document.getElementById('collect-call-btn');
            
            if (phoneEvidence) {
                collectBtn.textContent = '🔄 Replace Current Evidence with This Call';
            } else {
                collectBtn.textContent = '📋 Collect This Call as Evidence';
            }
        }

        function collectCallEvidence() {
            if (!currentCallId) return;
            
            const contact = phoneCallData[currentCallId];
            
            // Remove existing phone evidence if any
            const existingIndex = gameState.collectedEvidence.findIndex(e => e.locationId === 'phone');
            if (existingIndex !== -1) {
                gameState.collectedEvidence.splice(existingIndex, 1);
            }
            
            // Add new phone evidence
            gameState.collectedEvidence.push({
                id: 'call-' + currentCallId,
                locationId: 'phone',
                title: contact.evidenceTitle,
                description: contact.evidenceDescription,
                category: null
            });
            
            // Mark phone hotspot as collected (green with tick)
            const phoneHotspot = document.getElementById('phone-hotspot');
            phoneHotspot.classList.remove('seen');
            phoneHotspot.classList.add('collected');
            
            // Update evidence count
            updateEvidenceCount();
            
            // Go back to contacts to show updated state
            backToContacts();
        }

        function backToContacts() {
            // Stop any playing audio
            const audioElement = document.getElementById('call-audio');
            if (audioElement) {
                audioElement.pause();
                audioElement.currentTime = 0;
            }
            
            document.getElementById('phone-call-active').classList.add('hidden');
            document.getElementById('call-complete-actions').classList.add('hidden');
            document.querySelector('.call-actions').classList.remove('hidden');
            currentCallId = null;
            openPhone();
        }

        function closePhone() {
            if (currentCallInterval) {
                clearInterval(currentCallInterval);
                currentCallInterval = null;
            }
            
            // Stop any playing audio
            const audioElement = document.getElementById('call-audio');
            if (audioElement) {
                audioElement.pause();
                audioElement.currentTime = 0;
            }
            
            currentCallId = null;
            document.getElementById('phone-modal').classList.add('hidden');
        }

        // --------------------------------------------
        // 4.3 Phone Event Listeners
        // --------------------------------------------
        document.getElementById('phone-hotspot').addEventListener('click', openPhone);
        document.getElementById('close-phone-btn').addEventListener('click', closePhone);
        document.querySelector('#phone-modal .modal-close').addEventListener('click', closePhone);
        document.getElementById('end-call-btn').addEventListener('click', skipToEnd);
        document.getElementById('collect-call-btn').addEventListener('click', collectCallEvidence);
        document.getElementById('back-to-contacts-btn').addEventListener('click', backToContacts);

        // How to Play modal
        document.getElementById('how-to-play-btn').addEventListener('click', () => {
            document.getElementById('how-to-play-modal').classList.remove('hidden');
        });
        
        document.getElementById('close-how-to-play').addEventListener('click', () => {
            document.getElementById('how-to-play-modal').classList.add('hidden');
        });
        
        document.querySelector('#how-to-play-modal .modal-close').addEventListener('click', () => {
            document.getElementById('how-to-play-modal').classList.add('hidden');
        });

        // Submit button listener moved to Phase 5 section

        // ============================================
        // PHASE 5: SUBMISSION & SCORING
        // ============================================

        // --------------------------------------------
        // 5.1 Correct Answers
        // --------------------------------------------
        const correctAnswers = {
            primaryCause: 'datum',
            contributingFactors: ['lift', 'transport'],
            correctFix: {
                'datum': 'redraw',
                'transport': 'remachine'
            }
        };

        // --------------------------------------------
        // 5.2 Scoring Logic - New Comprehensive System
        // --------------------------------------------
        function calculateScore() {
            const score = {
                // Time cost
                timeCost: Math.round(gameState.currentCost),
                
                // Classification tracking
                rootCauseCorrect: false,
                rootCauseSolutionCorrect: false,
                contributingFound: 0,
                contributingTotal: evidenceCategories.otherIssues.length,
                contributingSolutionsCorrect: 0,
                
                // === SCORE 1: INVESTIGATION COST (minimise) ===
                // Everything you spent or lost
                implementationCost: 0,    // Cost of solutions chosen
                impactCost: 0,            // Damage from wrong solutions
                wastedCost: 0,            // Spent on non-problems
                totalCost: 0,             // Sum of all costs
                
                // === SCORE 2: COST AVOIDANCE (maximise) ===
                // Future costs prevented by correct fixes
                costAvoided: 0,           // Savings from correct solutions
                maxPossibleAvoidance: 0,  // What was available (for %)
                missedAvoidance: 0        // What they didn't capture
            };
            
            // Calculate max possible avoidance (all correct solutions)
            const rootInfo = solutionData['overlay-analysis'];
            if (rootInfo) {
                const correctRootSolution = rootInfo.solutions.find(s => s.correct);
                if (correctRootSolution) {
                    score.maxPossibleAvoidance += correctRootSolution.saving;
                }
            }
            evidenceCategories.otherIssues.forEach(id => {
                const evidenceInfo = solutionData[id];
                if (evidenceInfo) {
                    const correctSolution = evidenceInfo.solutions.find(s => s.correct);
                    if (correctSolution) {
                        score.maxPossibleAvoidance += correctSolution.saving;
                    }
                }
            });
            
            // ========== CHECK ROOT CAUSE SPECIFICALLY ==========
            // Player must have collected 'overlay-analysis' AND classified it as a problem
            const rootCauseEvidence = gameState.collectedEvidence.find(e => e.id === 'overlay-analysis');
            const classifiedAsRootCause = rootCauseEvidence && rootCauseEvidence.category === 'rootCause';
            const classifiedAsContributing = rootCauseEvidence && rootCauseEvidence.category === 'contributing';
            const foundRootCauseAsProblem = classifiedAsRootCause || classifiedAsContributing;
            
            // Track how they classified it for epilogue
            score.rootCauseClassifiedCorrectly = classifiedAsRootCause;
            score.rootCauseClassifiedAsContributing = classifiedAsContributing;
            
            if (foundRootCauseAsProblem) {
                score.rootCauseCorrect = true;
                // Check if they chose the right solution
                const solutionId = gameState.selectedSolutions['overlay-analysis'];
                const selectedSolution = rootInfo?.solutions?.find(s => s.id === solutionId);
                if (selectedSolution?.correct) {
                    score.rootCauseSolutionCorrect = true;
                    score.implementationCost += selectedSolution.cost;
                    
                    // CRITICAL: Savings depend on whether they identified it AS root cause
                    // If classified as "Root Cause" = full savings (systemic fix, prevents recurrence)
                    // If classified as "Other Issue" = only 20% savings (fixed this instance only)
                    if (classifiedAsRootCause) {
                        score.costAvoided += selectedSolution.saving; // Full £2,500,000
                    } else {
                        // They fixed it but didn't recognise it as root cause
                        // Only get 20% of savings - next modules will have same problem
                        score.costAvoided += Math.round(selectedSolution.saving * 0.2); // £500,000
                        score.missedRootCauseSavings = Math.round(selectedSolution.saving * 0.8); // £2,000,000 lost
                    }
                } else if (selectedSolution) {
                    score.implementationCost += selectedSolution.cost;
                    if (selectedSolution.id !== 4) { // Not "no action"
                        score.impactCost += selectedSolution.impact || 0;
                    }
                }
            }
            
            // ========== PROCESS OTHER ISSUES (the 6 non-root-cause problems) ==========
            evidenceCategories.otherIssues.forEach(issueId => {
                const issueEvidence = gameState.collectedEvidence.find(e => e.id === issueId);
                const evidenceInfo = solutionData[issueId];
                if (!evidenceInfo) return;
                
                // Check if found and classified as an issue (rootCause or contributing both count)
                if (issueEvidence && (issueEvidence.category === 'rootCause' || issueEvidence.category === 'contributing')) {
                    score.contributingFound++;
                    
                    const solutionId = gameState.selectedSolutions[issueId];
                    const selectedSolution = evidenceInfo.solutions?.find(s => s.id === solutionId);
                    
                    if (selectedSolution?.correct) {
                        score.contributingSolutionsCorrect++;
                        score.implementationCost += selectedSolution.cost;
                        score.costAvoided += selectedSolution.saving;
                    } else if (selectedSolution) {
                        score.implementationCost += selectedSolution.cost;
                        if (selectedSolution.id !== 4) { // Not "no action"
                            score.impactCost += selectedSolution.impact || 0;
                        }
                    }
                } else {
                    // Missed this issue - add to missed avoidance
                    const correctSolution = evidenceInfo.solutions?.find(s => s.correct);
                    if (correctSolution) {
                        score.missedAvoidance += correctSolution.saving;
                    }
                }
            });
            
            // Track missed root cause
            if (!score.rootCauseCorrect) {
                const correctSolution = rootInfo?.solutions?.find(s => s.correct);
                if (correctSolution) {
                    score.missedAvoidance += correctSolution.saving;
                }
            }
            
            // ========== PROCESS DECOYS (things that aren't problems) ==========
            const allClassified = gameState.collectedEvidence.filter(e => 
                e.category === 'rootCause' || e.category === 'contributing' || e.category === 'redHerring'
            );
            
            allClassified.forEach(evidence => {
                // Skip root cause and other issues - already processed above
                if (evidence.id === 'overlay-analysis') return;
                if (evidenceCategories.otherIssues.includes(evidence.id)) return;
                
                const evidenceInfo = solutionData[evidence.id];
                if (!evidenceInfo) return;
                
                // This is a decoy - check if player wasted money on it
                const solutionId = gameState.selectedSolutions[evidence.id];
                const selectedSolution = evidenceInfo.solutions?.find(s => s.id === solutionId);
                
                if (selectedSolution && selectedSolution.id !== 4) { // Not "no action"
                    score.wastedCost += selectedSolution.cost;
                }
            });
            
            // Store missed issues for report
            const missedIssues = evidenceCategories.otherIssues.filter(id => {
                const evidence = gameState.collectedEvidence.find(e => e.id === id);
                return !evidence || (evidence.category !== 'rootCause' && evidence.category !== 'contributing');
            });
            gameState.missedContributing = missedIssues;
            gameState.foundRootCause = score.rootCauseCorrect;
            
            // ========== CALCULATE TOTALS ==========
            score.totalCost = score.timeCost + score.implementationCost + score.impactCost + score.wastedCost;
            
            // Calculate percentages for display
            score.avoidancePercent = score.maxPossibleAvoidance > 0 
                ? Math.round((score.costAvoided / score.maxPossibleAvoidance) * 100) 
                : 0;
            
            return score;
        }

        /*
         * DUAL SCORING PERFORMANCE BANDS
         * ===============================
         * 
         * Two independent metrics:
         * 
         * INVESTIGATION COST (minimise):
         * - Perfect: ~£138K (£3K time + £135K implementation)
         * - Good: <£200K
         * - Acceptable: <£350K  
         * - Poor: <£500K
         * - Very Poor: >£500K
         * 
         * COST AVOIDANCE (maximise):
         * - Maximum available: £1,490,000
         * - Perfect: >£1,400,000 (>95%)
         * - Excellent: >£1,100,000 (>75%)
         * - Good: >£700,000 (>50%)
         * - Developing: >£300,000 (>20%)
         * - Poor: <£300,000 (<20%)
         * 
         * STAR RATING based on BOTH metrics:
         */
        
        // The 7 real problems that need to be found
        const realProblems = [
            { id: 'overlay-analysis', location: 'Interface Drawings', title: 'Datum Mismatch (ICD TBC)', category: 'ROOT_CAUSE' },
            { id: 'route-deviation', location: 'Transport Records', title: 'Route Deviation Not Escalated', category: 'OTHER_ISSUE' },
            { id: 'verification-requirements', location: 'Lift Plan Documents', title: 'No Survey Verification Required', category: 'OTHER_ISSUE' },
            { id: 'coating-degradation', location: 'Module Inspection', title: 'Coating Degradation', category: 'OTHER_ISSUE' },
            { id: 'lug-corrosion', location: 'Factory QC Records', title: 'Lifting Lug Corrosion', category: 'OTHER_ISSUE' },
            { id: 'ground-assessment-date', location: 'Site Conditions Log', title: 'Ground Assessment Outdated', category: 'OTHER_ISSUE' },
            { id: 'call-engineer', location: 'Phone Call', title: 'Interface Ownership Unclear', category: 'OTHER_ISSUE' }
        ];
        
        function generateSummaryTable(score) {
            let tableRows = '';
            
            realProblems.forEach(problem => {
                // Check if player collected this evidence and classified it as a problem
                const collected = gameState.collectedEvidence.find(e => e.id === problem.id);
                const foundProblem = collected && (collected.category === 'rootCause' || collected.category === 'contributing');
                
                // Check if player chose correct solution
                const solutionId = gameState.selectedSolutions[problem.id];
                const solutionInfo = solutionData[problem.id];
                const selectedSolution = solutionInfo?.solutions?.find(s => s.id === solutionId);
                const correctSolution = selectedSolution?.correct || false;
                
                // Determine icons - use coloured emoji-style indicators
                const foundIcon = foundProblem ? '<span style="color: #22c55e; font-weight: bold;">✓</span>' : '<span style="color: #ef4444; font-weight: bold;">✗</span>';
                const solutionIcon = correctSolution 
                    ? '<span style="color: #22c55e; font-weight: bold;">✓</span>' 
                    : (foundProblem 
                        ? '<span style="color: #ef4444; font-weight: bold;">✗</span>' 
                        : '<span style="color: #6b7280;">—</span>');
                
                const categoryLabel = problem.category === 'ROOT_CAUSE' ? 'Root Cause' : 'Other Issue';
                const categoryClass = problem.category === 'ROOT_CAUSE' ? 'badge-root' : 'badge-other';
                
                // Row styling based on outcome
                const rowClass = correctSolution ? 'row-success' : (foundProblem ? 'row-partial' : 'row-missed');
                
                tableRows += `
                    <tr class="${rowClass}">
                        <td class="table-location">${problem.location}</td>
                        <td class="table-problem">${problem.title}</td>
                        <td class="table-category"><span class="table-badge ${categoryClass}">${categoryLabel}</span></td>
                        <td class="table-check">${foundIcon}</td>
                        <td class="table-check">${solutionIcon}</td>
                    </tr>
                `;
            });
            
            // Count results
            const foundCount = realProblems.filter(p => {
                const c = gameState.collectedEvidence.find(e => e.id === p.id);
                return c && (c.category === 'rootCause' || c.category === 'contributing');
            }).length;
            
            const fixedCount = realProblems.filter(p => {
                const solutionId = gameState.selectedSolutions[p.id];
                const solutionInfo = solutionData[p.id];
                return solutionInfo?.solutions?.find(s => s.id === solutionId)?.correct;
            }).length;
            
            return `
                <div class="summary-table-section">
                    <h3>📋 Investigation Summary</h3>
                    <p class="summary-table-intro">There were <strong>7 real problems</strong> to find: 1 root cause and 6 other issues requiring action. You found <strong>${foundCount}/7</strong> and correctly fixed <strong>${fixedCount}/7</strong>.</p>
                    <table class="summary-table">
                        <thead>
                            <tr>
                                <th>Location</th>
                                <th>Problem</th>
                                <th>Type</th>
                                <th>Found?</th>
                                <th>Fixed?</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function getRank(score) {
            const cost = score.totalCost;
            const avoided = score.costAvoided;
            const avoidedPct = score.avoidancePercent;
            
            // Calculate investigation quality score
            // Root cause is worth 3 points, each other issue is worth 0.5 points
            let qualityScore = 0;
            
            // Root cause identification is critical
            if (score.rootCauseCorrect && score.rootCauseSolutionCorrect) {
                qualityScore += 3; // Full marks for root cause
            } else if (score.rootCauseCorrect) {
                qualityScore += 1.5; // Found but wrong fix
            }
            // Missing root cause = 0 points (major failure)
            
            // Other issues (6 total, 0.5 points each = 3 points max)
            qualityScore += score.contributingSolutionsCorrect * 0.5;
            
            // Penalty for wasting money on non-issues
            if (score.wastedCost > 50000) qualityScore -= 0.5;
            if (score.wastedCost > 150000) qualityScore -= 0.5;
            
            // Convert to stars (max 6 points = 5 stars)
            // 5 stars: 5.5+ points (root cause + 5+ other issues correctly fixed)
            // 4 stars: 4.5-5.4 points (root cause + 3+ other issues)
            // 3 stars: 3.5-4.4 points (root cause + 1+ other issues, OR no root cause but most others)
            // 2 stars: 2-3.4 points (root cause found OR several other issues)
            // 1 star: <2 points (missed root cause and most issues)
            
            let stars;
            if (qualityScore >= 5.5) stars = 5;
            else if (qualityScore >= 4.5) stars = 4;
            else if (qualityScore >= 3.5) stars = 3;
            else if (qualityScore >= 2) stars = 2;
            else stars = 1;
            
            // Generate description based on performance
            const ranks = {
                5: {
                    title: 'EXPERT INVESTIGATOR',
                    desc: 'Outstanding. You identified the root cause and addressed nearly all related issues. This is the standard we aim for.',
                    costBand: 'Root cause found and fixed',
                    avoidBand: 'Most issues correctly addressed'
                },
                4: {
                    title: 'SENIOR INVESTIGATOR', 
                    desc: 'Excellent work. Root cause identified with most supporting issues addressed.',
                    costBand: 'Root cause found and fixed',
                    avoidBand: 'Several issues correctly addressed'
                },
                3: {
                    title: 'COMPETENT INVESTIGATOR',
                    desc: 'Good foundation. Root cause identified but some issues missed, or strong secondary findings without the root cause.',
                    costBand: 'Core issues identified',
                    avoidBand: 'Room for improvement'
                },
                2: {
                    title: 'DEVELOPING INVESTIGATOR',
                    desc: 'Partial investigation. Key issues were missed. Further training on root cause analysis recommended.',
                    costBand: 'Some issues found',
                    avoidBand: 'Significant gaps remain'
                },
                1: {
                    title: 'REQUIRES MENTORING',
                    desc: 'The investigation missed the root cause and most other issues. Recommend pairing with senior investigator for future work.',
                    costBand: 'Root cause missed',
                    avoidBand: 'Most issues unidentified'
                }
            };
            
            const rank = ranks[stars];
            rank.stars = stars;
            rank.avoidanceRating = Math.ceil(avoidedPct / 20); // For display
            rank.qualityScore = qualityScore;
            
            // Build criteria based on actual performance
            const criteria = [];
            
            // Root cause
            if (score.rootCauseCorrect && score.rootCauseSolutionCorrect) {
                criteria.push('✓ Root cause identified and correctly fixed');
            } else if (score.rootCauseCorrect) {
                criteria.push('~ Root cause found but wrong solution chosen');
            } else {
                criteria.push('✗ Root cause not identified');
            }
            
            // Contributing factors
            if (score.contributingFound === score.contributingTotal) {
                criteria.push(`✓ All ${score.contributingTotal} other issues found`);
            } else if (score.contributingFound > 0) {
                criteria.push(`~ ${score.contributingFound} of ${score.contributingTotal} other issues found`);
            } else {
                criteria.push('✗ No other issues identified');
            }
            
            // Waste
            if (score.wastedCost === 0) {
                criteria.push('✓ No money wasted on non-issues');
            } else {
                criteria.push(`✗ £${score.wastedCost.toLocaleString()} wasted on non-issues`);
            }
            
            // Time efficiency
            if (score.timeCost < 3500) {
                criteria.push('✓ Fast investigation');
            } else if (score.timeCost < 7000) {
                criteria.push('~ Reasonable investigation time');
            } else {
                criteria.push('✗ Investigation took too long');
            }
            
            return {
                stars,
                title: rank.title,
                desc: rank.desc,
                costBand: rank.costBand,
                avoidBand: rank.avoidBand,
                criteria
            };
        }

        // ============================================
        // PHASE 6: RESULTS & EPILOGUE
        // ============================================

        // --------------------------------------------
        // 6.1 Epilogue Content
        // --------------------------------------------
        const epilogues = {
            excellent: {
                title: "6 MONTHS LATER...",
                text: "The foundation interface was modified with a new adapter ring machined to correct the datum offset. The Interface Control Document process was overhauled — no interface now reaches site without verified dimensional compatibility. The maintenance team will never know there was a problem."
            },
            good: {
                title: "6 MONTHS LATER...",
                text: "The interface was successfully corrected. Your thorough investigation took longer but ensured the right fix was implemented. Lessons learned have been incorporated into the design coordination process for all remaining modules."
            },
            shimTrap: {
                title: "6 MONTHS LATER...",
                text: "The shimmed interface passed initial pressure tests. The module was commissioned on schedule.",
                part2Title: "10 YEARS LATER...",
                part2Text: "Routine inspection reveals seal degradation at the shimmed interface. The uneven loading has caused accelerated wear. During the next outage, the shims must be replaced — but the module is now active. The replacement requires 3 additional outage days at £1.8M each. Lifetime cost of the 'cheap' fix: +£2.1M. The maintenance team curses the 2025 decisions daily."
            },
            wrongCause: {
                title: "3 MONTHS LATER...",
                text: "The recommended fix was implemented. The module was re-installed. The flanges still don't align. A second investigation reveals the actual root cause: different datum reference systems in the engineering drawings. The correct fix is now implemented — at additional cost. Your investigation found a real issue, but not THE issue.",
                part2Title: "⚠️ CDM EXPOSURE",
                part2Text: "During emergency remediation, a technician working at height to access the misaligned flange suffers a fall. HSE investigates alongside ONR. The investigation reveals the ICD marked 'TBC' that was never completed. Under CDM 2015, the designer who left the incomplete documentation and the Principal Designer who allowed it to reach construction are both interviewed under caution. The technician's injuries trigger a formal HSE prosecution. The designer faces personal criminal liability — not just a company fine, but potential imprisonment. Design decisions have consequences."
            },
            // NEW: Found and fixed root cause, but classified it as "Other Issue" not "Root Cause"
            partialRootCause: {
                title: "6 MONTHS LATER...",
                text: "Module M-2401 was successfully corrected. Your fix worked perfectly for this interface.",
                part2Title: "12 MONTHS LATER...",
                part2Text: "Module M-2402 arrives on site. During installation, the flanges are misaligned by 95mm. A second emergency investigation reveals the same datum mismatch — the ICD process was never fixed because nobody identified it as the root cause. You fixed the symptom on M-2401, but didn't address the systemic issue. The regulator issues a formal observation: 'Inadequate extent of cause analysis. Corrective actions failed to prevent recurrence.' Emergency remediation costs £2,000,000. Total programme impact: 8 weeks delay.",
                part3Title: "📋 REGULATORY NOTE",
                part3Text: "Under 10 CFR 50 Appendix B (US) and ONR Licence Condition 17 (UK), significant conditions adverse to quality require determination of root cause and corrective action to preclude repetition. Fixing an individual defect without identifying why it occurred — the 'extent of cause' — means the same problem will recur elsewhere. This is why root cause identification matters: it's not just about fixing what's broken, it's about fixing WHY it broke."
            }
        };

        function getEpilogue(score) {
            // Check classification of root cause evidence
            const rootCauseEvidence = gameState.collectedEvidence.find(e => e.id === 'overlay-analysis');
            const classifiedAsRootCause = rootCauseEvidence && rootCauseEvidence.category === 'rootCause';
            const classifiedAsContributing = rootCauseEvidence && rootCauseEvidence.category === 'contributing';
            
            // Check if they selected the correct solution
            let correctSolutionChosen = false;
            if (rootCauseEvidence && gameState.selectedSolutions['overlay-analysis']) {
                const solutionId = gameState.selectedSolutions['overlay-analysis'];
                const solutions = solutionData['overlay-analysis']?.solutions || [];
                const selectedSolution = solutions.find(s => s.id === solutionId);
                correctSolutionChosen = selectedSolution?.correct || false;
            }
            
            // Scenario 1: Didn't find root cause at all
            if (!classifiedAsRootCause && !classifiedAsContributing) {
                return epilogues.wrongCause;
            }
            
            // Scenario 2: Found AND classified as Root Cause AND correct solution
            if (classifiedAsRootCause && correctSolutionChosen) {
                return epilogues.excellent;
            }
            
            // Scenario 3: Found AND classified as Root Cause BUT wrong solution
            if (classifiedAsRootCause && !correctSolutionChosen) {
                return epilogues.shimTrap;
            }
            
            // Scenario 4: Found but classified as "Other Issue" (contributing)
            // They fixed it but didn't recognise it as THE root cause
            if (classifiedAsContributing && correctSolutionChosen) {
                return epilogues.partialRootCause;
            }
            
            // Scenario 5: Found as contributing but wrong solution
            if (classifiedAsContributing && !correctSolutionChosen) {
                return epilogues.wrongCause;
            }
            
            return epilogues.good;
        }

        // --------------------------------------------
        // 6.1b Report Page Navigation
        // --------------------------------------------
        let currentReportPage = 1;
        
        function goToReportPage(pageNum) {
            currentReportPage = pageNum;
            
            // Update pages
            document.querySelectorAll('.report-page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(`report-page-${pageNum}`).classList.add('active');
            
            // Update nav buttons
            document.querySelectorAll('.report-nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.page) === pageNum) {
                    btn.classList.add('active');
                }
            });
        }
        
        function openDetailModal(problemId) {
            const modal = document.getElementById('finding-detail-modal');
            const body = document.getElementById('detail-modal-body');
            
            // Get problem data
            const problem = realProblems.find(p => p.id === problemId);
            const collected = gameState.collectedEvidence.find(e => e.id === problemId);
            const wasClassifiedAsProblem = collected && (collected.category === 'rootCause' || collected.category === 'contributing');
            const wasClassifiedAsRootCause = collected && collected.category === 'rootCause';
            const wasClassifiedAsContributing = collected && collected.category === 'contributing';
            const evidenceData = solutionData[problemId];
            const consequenceData = missedConsequences[problemId];
            const solutionId = gameState.selectedSolutions[problemId];
            const selectedSolution = evidenceData?.solutions?.find(s => s.id === solutionId);
            const correctSolution = evidenceData?.solutions?.find(s => s.correct);
            const choseCorrectSolution = selectedSolution?.correct || false;
            
            // Check if this is THE root cause and was misclassified
            const isTheRootCause = problem.category === 'ROOT_CAUSE';
            const rootCauseMisclassified = isTheRootCause && wasClassifiedAsContributing;
            
            let statusText, statusClass;
            if (!wasClassifiedAsProblem) {
                statusText = '✗ Problem Not Identified';
                statusClass = 'wrong';
            } else if (rootCauseMisclassified && choseCorrectSolution) {
                statusText = '~ Partially Fixed (Misclassified)';
                statusClass = 'misclassified';
            } else if (choseCorrectSolution) {
                statusText = '✓ Correctly Fixed';
                statusClass = 'correct';
            } else {
                statusText = '⚠ Found But Wrong Solution';
                statusClass = 'partial';
            }
            
            // Build the solution section based on scenario
            let solutionSection = '';
            
            if (!wasClassifiedAsProblem) {
                // Missed entirely
                solutionSection = `
                    <div class="detail-section solution-section">
                        <h4>✓ What You Should Have Found</h4>
                        <p>${consequenceData?.recommendedFix || correctSolution?.text}</p>
                    </div>
                `;
            } else if (rootCauseMisclassified && choseCorrectSolution) {
                // Root cause found and fixed, but classified as "Other Issue"
                solutionSection = `
                    <div class="detail-section partial-solution-section">
                        <h4>~ Your Solution (Partial)</h4>
                        <p>${selectedSolution?.text}</p>
                    </div>
                    <div class="detail-section misclassified-section">
                        <h4>⚠ Why This Is Only a Partial Fix</h4>
                        <p>You correctly identified the datum mismatch and implemented the right technical fix for Module M-2401. However, by classifying this as an "Other Issue" rather than the <strong>Root Cause</strong>, the systemic problem was not escalated.</p>
                        <p><strong>What should have happened:</strong> Identifying this as the root cause would have triggered a formal engineering change notice, updating the ICD process across the entire programme. All future module interfaces would use the mandatory datum reconciliation procedure.</p>
                        <p><strong>What actually happened:</strong> You fixed THIS interface, but the engineering team was not alerted to the systemic ICD weakness. Module M-2402 will arrive with the same datum mismatch. The problem will repeat.</p>
                        <p><strong>Regulatory implication:</strong> Under ONR Licence Condition 17 (Management Systems) and 10 CFR 50 Appendix B, you must determine the <em>cause</em> of conditions adverse to quality and take corrective action to <em>preclude repetition</em>. Fixing one instance without addressing extent of cause fails this requirement.</p>
                    </div>
                    <div class="detail-section solution-section">
                        <h4>✓ What Full Root Cause Identification Achieves</h4>
                        <p>Classifying as Root Cause triggers: (1) Formal engineering change notice to design authority, (2) Update to ICD procedure requiring datum transformation matrix, (3) Review of all pending module interfaces, (4) Prevents recurrence on M-2402, M-2403, etc. This captures 100% of the £2,500,000 potential savings rather than just 20%.</p>
                    </div>
                `;
            } else if (choseCorrectSolution) {
                // Fully correct
                solutionSection = `
                    <div class="detail-section solution-section">
                        <h4>✓ Your Solution</h4>
                        <p>${selectedSolution?.text}</p>
                    </div>
                `;
            } else {
                // Found but wrong solution
                solutionSection = `
                    <div class="detail-section wrong-section">
                        <h4>✗ Your Solution</h4>
                        <p>${selectedSolution?.text || 'No action'}</p>
                    </div>
                    <div class="detail-section solution-section">
                        <h4>✓ Correct Solution</h4>
                        <p>${correctSolution?.text}</p>
                    </div>
                `;
            }
            
            // Consequence text - different for misclassified root cause
            let consequenceText = consequenceData?.consequence || 'This issue was not addressed.';
            if (rootCauseMisclassified && choseCorrectSolution) {
                consequenceText = "Module M-2401's interface was successfully corrected. However, without identifying this as the root cause, the ICD process weakness remains. Module M-2402 will arrive in 6 months with identical datum mismatch. Emergency remediation will cost £2,000,000 and delay the programme by 8 weeks.";
            }
            
            // Financial impact - different for misclassified root cause
            let financialText = consequenceData?.financialImpact;
            if (rootCauseMisclassified && choseCorrectSolution) {
                financialText = "Only £500,000 of the potential £2,500,000 savings captured (20%). The remaining £2,000,000 will be lost when M-2402 arrives with the same problem. Total programme impact: £2,000,000 additional remediation + 8 weeks delay.";
            }
            
            body.innerHTML = `
                <div class="detail-header ${statusClass}">
                    <span class="detail-badge ${problem.category === 'ROOT_CAUSE' ? 'root' : 'other'}">${problem.category === 'ROOT_CAUSE' ? 'Root Cause' : 'Other Issue'}</span>
                    <h3>${problem.title}</h3>
                    <p class="detail-location">📍 ${problem.location}</p>
                    <div class="detail-status ${statusClass}">${statusText}</div>
                </div>
                
                ${solutionSection}
                
                <div class="detail-section consequence-section">
                    <h4>⚠ Consequence</h4>
                    <p>${consequenceText}</p>
                </div>
                
                <div class="detail-section regulatory-section">
                    <h4>⚖️ Regulatory Risk</h4>
                    <p>${consequenceData?.regulatoryRisk}</p>
                </div>
                
                <div class="detail-section financial-section">
                    <h4>💷 Financial Impact</h4>
                    <p>${financialText}</p>
                </div>
                
                <div class="detail-section learning-section">
                    <h4>💡 Learning Point</h4>
                    <p>${evidenceData?.lesson}</p>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }
        
        function closeDetailModal() {
            document.getElementById('finding-detail-modal').classList.add('hidden');
        }

        // --------------------------------------------
        // 6.2 Results Display Function - Comprehensive Report
        // --------------------------------------------
        function showResults() {
            // Stop the counter now
            gameState.submitted = true;
            stopCounter();
            
            const score = calculateScore();
            const rank = getRank(score);
            const epilogue = getEpilogue(score);
            
            // Time formatting
            const mins = Math.floor(gameState.elapsedSeconds / 60);
            const secs = Math.floor(gameState.elapsedSeconds % 60);
            
            // ========== SECTION 1: Summary Header - Dual Scores ==========
            const summaryBox = document.getElementById('summary-box');
            
            // Determine root cause status display
            let rootCauseDisplay, rootCauseClass;
            if (score.rootCauseClassifiedCorrectly && score.rootCauseSolutionCorrect) {
                rootCauseDisplay = '✓✓';
                rootCauseClass = 'good';
            } else if (score.rootCauseClassifiedAsContributing && score.rootCauseSolutionCorrect) {
                rootCauseDisplay = '~';
                rootCauseClass = 'partial';
            } else if (score.rootCauseCorrect) {
                rootCauseDisplay = '✓';
                rootCauseClass = 'partial';
            } else {
                rootCauseDisplay = '✗';
                rootCauseClass = 'bad';
            }
            
            summaryBox.innerHTML = `
                <div class="dual-score-display">
                    <div class="score-card cost-card">
                        <div class="score-card-label">Investigation Cost</div>
                        <div class="score-card-value">£${score.totalCost.toLocaleString()}</div>
                        <div class="score-card-target">Target: under £150,000</div>
                    </div>
                    <div class="score-card avoid-card">
                        <div class="score-card-label">Cost Avoidance</div>
                        <div class="score-card-value">£${score.costAvoided.toLocaleString()}</div>
                        <div class="score-card-target">${score.avoidancePercent}% of £${score.maxPossibleAvoidance.toLocaleString()}</div>
                    </div>
                </div>
                ${score.rootCauseClassifiedAsContributing && score.rootCauseSolutionCorrect ? `
                    <div class="classification-warning">
                        ⚠ Root cause was fixed but classified as "Other Issue" — only 20% savings captured. See Takeaways for why this matters.
                    </div>
                ` : ''}
                <div class="summary-stats">
                    <div class="summary-stat-item">
                        <span class="stat-label">Time</span>
                        <span class="stat-value">${mins}m ${secs}s</span>
                    </div>
                    <div class="summary-stat-item">
                        <span class="stat-label">Root Cause</span>
                        <span class="stat-value ${rootCauseClass}">${rootCauseDisplay}</span>
                    </div>
                    <div class="summary-stat-item">
                        <span class="stat-label">Other Issues</span>
                        <span class="stat-value">${score.contributingFound}/6</span>
                    </div>
                    <div class="summary-stat-item">
                        <span class="stat-label">Correct Fixes</span>
                        <span class="stat-value">${score.contributingSolutionsCorrect + (score.rootCauseSolutionCorrect ? 1 : 0)}/7</span>
                    </div>
                </div>
            `;
            
            // ========== SECTION 2: Epilogue ==========
            let epilogueHtml = `<h2>${epilogue.title}</h2><p>${epilogue.text}</p>`;
            if (epilogue.part2Title) {
                epilogueHtml += `<h2>${epilogue.part2Title}</h2><p>${epilogue.part2Text}</p>`;
            }
            if (epilogue.part3Title) {
                epilogueHtml += `<div class="regulatory-note"><h3>${epilogue.part3Title}</h3><p>${epilogue.part3Text}</p></div>`;
            }
            document.getElementById('epilogue-section').innerHTML = epilogueHtml;
            
            // ========== SECTION 3: Findings Table (Single Clickable Table) ==========
            const findingsTable = document.getElementById('findings-comparison');
            
            let findingsHtml = `
                <table class="findings-table">
                    <thead>
                        <tr>
                            <th>Problem</th>
                            <th>Location</th>
                            <th>Type</th>
                            <th>Found</th>
                            <th>Fixed</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // Process all 7 real problems as clickable rows
            realProblems.forEach(problem => {
                const collected = gameState.collectedEvidence.find(e => e.id === problem.id);
                const wasClassifiedAsProblem = collected && (collected.category === 'rootCause' || collected.category === 'contributing');
                const wasClassifiedAsRootCause = collected && collected.category === 'rootCause';
                const wasClassifiedAsContributing = collected && collected.category === 'contributing';
                
                const evidenceData = solutionData[problem.id];
                const solutionId = gameState.selectedSolutions[problem.id];
                const selectedSolution = evidenceData?.solutions?.find(s => s.id === solutionId);
                const choseCorrectSolution = selectedSolution?.correct || false;
                
                // Special handling for THE root cause (overlay-analysis)
                const isTheRootCause = problem.category === 'ROOT_CAUSE';
                const rootCauseMisclassified = isTheRootCause && wasClassifiedAsContributing;
                
                // Determine row status
                let rowClass;
                if (!wasClassifiedAsProblem) {
                    rowClass = 'row-missed';
                } else if (rootCauseMisclassified) {
                    // Found and fixed root cause but classified as "Other Issue" - amber
                    rowClass = choseCorrectSolution ? 'row-misclassified' : 'row-partial';
                } else if (choseCorrectSolution) {
                    rowClass = 'row-success';
                } else {
                    rowClass = 'row-partial';
                }
                
                // Found icon - amber if root cause was misclassified
                let foundIcon;
                if (!wasClassifiedAsProblem) {
                    foundIcon = '<span class="status-icon bad">✗</span>';
                } else if (rootCauseMisclassified) {
                    foundIcon = '<span class="status-icon partial">~</span>';
                } else {
                    foundIcon = '<span class="status-icon good">✓</span>';
                }
                
                // Fixed icon - amber if root cause was misclassified even with correct solution
                let fixedIcon;
                if (!wasClassifiedAsProblem) {
                    fixedIcon = '<span class="status-icon neutral">—</span>';
                } else if (rootCauseMisclassified && choseCorrectSolution) {
                    fixedIcon = '<span class="status-icon partial">~</span>';
                } else if (choseCorrectSolution) {
                    fixedIcon = '<span class="status-icon good">✓</span>';
                } else {
                    fixedIcon = '<span class="status-icon bad">✗</span>';
                }
                
                const badgeClass = problem.category === 'ROOT_CAUSE' ? 'badge-root' : 'badge-other';
                const badgeText = problem.category === 'ROOT_CAUSE' ? 'Root Cause' : 'Other Issue';
                
                findingsHtml += `
                    <tr class="${rowClass} clickable-row" onclick="openDetailModal('${problem.id}')">
                        <td class="problem-name">${problem.title}</td>
                        <td class="problem-location">${problem.location}</td>
                        <td><span class="table-badge ${badgeClass}">${badgeText}</span></td>
                        <td class="status-cell">${foundIcon}</td>
                        <td class="status-cell">${fixedIcon}</td>
                        <td class="arrow-cell">›</td>
                    </tr>
                `;
            });
            
            findingsHtml += `
                    </tbody>
                </table>
            `;
            
            findingsTable.innerHTML = findingsHtml;
            
            // ========== SECTION 5: Actions & Financial Impact ==========
            const scoreBreakdown = document.getElementById('score-breakdown');
            
            // Build detailed actions table
            let actionsHtml = `
                <div class="actions-summary-cards">
                    <div class="summary-card cost-card">
                        <div class="card-label">Total Cost</div>
                        <div class="card-value cost">£${score.totalCost.toLocaleString()}</div>
                        <div class="card-note">Investigation + Implementation</div>
                    </div>
                    <div class="summary-card avoid-card">
                        <div class="card-label">Cost Avoided</div>
                        <div class="card-value avoided">£${score.costAvoided.toLocaleString()}</div>
                        <div class="card-note">${score.avoidancePercent}% of £${score.maxPossibleAvoidance.toLocaleString()}</div>
                    </div>
                </div>
                
                <h3 class="actions-subtitle">Actions Taken</h3>
                <table class="actions-table">
                    <thead>
                        <tr>
                            <th>Problem</th>
                            <th>Your Action</th>
                            <th class="num-col">Cost</th>
                            <th class="num-col">Avoided</th>
                            <th class="num-col">Net</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // Add time cost row
            actionsHtml += `
                <tr class="time-row">
                    <td>Investigation Time</td>
                    <td>${mins}m ${secs}s @ £5.50/sec</td>
                    <td class="num-col cost-val">£${score.timeCost.toLocaleString()}</td>
                    <td class="num-col">—</td>
                    <td class="num-col cost-val">-£${score.timeCost.toLocaleString()}</td>
                </tr>
            `;
            
            // Process each real problem the player addressed
            realProblems.forEach(problem => {
                const collected = gameState.collectedEvidence.find(e => e.id === problem.id);
                const wasClassifiedAsProblem = collected && (collected.category === 'rootCause' || collected.category === 'contributing');
                const wasClassifiedAsContributing = collected && collected.category === 'contributing';
                
                if (!wasClassifiedAsProblem) return; // Only show problems player took action on
                
                const evidenceData = solutionData[problem.id];
                const consequenceData = missedConsequences[problem.id];
                const solutionId = gameState.selectedSolutions[problem.id];
                const selectedSolution = evidenceData?.solutions?.find(s => s.id === solutionId);
                const choseCorrectSolution = selectedSolution?.correct || false;
                
                const cost = selectedSolution?.cost || 0;
                
                // Special handling for root cause misclassification
                const isTheRootCause = problem.category === 'ROOT_CAUSE';
                const rootCauseMisclassified = isTheRootCause && wasClassifiedAsContributing;
                
                let avoided = 0;
                let avoidedNote = '';
                if (choseCorrectSolution) {
                    const fullSaving = selectedSolution?.saving || 0;
                    if (rootCauseMisclassified) {
                        // Only 20% savings when root cause misclassified
                        avoided = Math.round(fullSaving * 0.2);
                        avoidedNote = ` <span class="saving-reduced">(20% of £${fullSaving.toLocaleString()})</span>`;
                    } else {
                        avoided = fullSaving;
                    }
                }
                
                const net = avoided - cost;
                
                let rowClass;
                if (rootCauseMisclassified && choseCorrectSolution) {
                    rowClass = 'misclassified-row';
                } else if (choseCorrectSolution) {
                    rowClass = 'success-row';
                } else {
                    rowClass = 'wrong-row';
                }
                
                const netClass = net >= 0 ? 'avoided-val' : 'cost-val';
                
                actionsHtml += `
                    <tr class="${rowClass}">
                        <td>${problem.title}${rootCauseMisclassified ? ' <span class="misclass-badge">MISCLASSIFIED</span>' : ''}</td>
                        <td class="action-text">${selectedSolution?.text || 'No action'}</td>
                        <td class="num-col cost-val">£${cost.toLocaleString()}</td>
                        <td class="num-col ${avoided > 0 ? (rootCauseMisclassified ? 'partial-val' : 'avoided-val') : ''}">${avoided > 0 ? '£' + avoided.toLocaleString() + avoidedNote : '—'}</td>
                        <td class="num-col ${rootCauseMisclassified ? 'partial-val' : netClass}">${net >= 0 ? '+' : ''}£${net.toLocaleString()}</td>
                    </tr>
                `;
            });
            
            // Process decoys (wasted money)
            const decoyEvidence = gameState.collectedEvidence.filter(e => {
                if (e.id === 'overlay-analysis') return false;
                if (evidenceCategories.otherIssues.includes(e.id)) return false;
                return e.category === 'rootCause' || e.category === 'contributing';
            });
            
            decoyEvidence.forEach(evidence => {
                const evidenceData = solutionData[evidence.id];
                const solutionId = gameState.selectedSolutions[evidence.id];
                const selectedSolution = evidenceData?.solutions?.find(s => s.id === solutionId);
                const wastedCost = (selectedSolution?.id !== 4) ? (selectedSolution?.cost || 0) : 0;
                
                if (wastedCost > 0) {
                    actionsHtml += `
                        <tr class="wasted-row">
                            <td>${evidence.title}</td>
                            <td class="action-text">${selectedSolution?.text} <span class="wasted-badge">NOT A PROBLEM</span></td>
                            <td class="num-col cost-val">£${wastedCost.toLocaleString()}</td>
                            <td class="num-col">—</td>
                            <td class="num-col cost-val">-£${wastedCost.toLocaleString()}</td>
                        </tr>
                    `;
                }
            });
            
            actionsHtml += `
                    </tbody>
                </table>
            `;
            
            // Add missed opportunities section
            const missedProblems = realProblems.filter(problem => {
                const collected = gameState.collectedEvidence.find(e => e.id === problem.id);
                const wasClassifiedAsProblem = collected && (collected.category === 'rootCause' || collected.category === 'contributing');
                return !wasClassifiedAsProblem;
            });
            
            if (missedProblems.length > 0) {
                actionsHtml += `
                    <h3 class="actions-subtitle missed-subtitle">⚠ Missed Opportunities</h3>
                    <p class="missed-intro">These problems were not addressed. The "Would Avoid" column shows future costs that will now occur because these issues remain unfixed.</p>
                `;
                
                missedProblems.forEach(problem => {
                    const evidenceData = solutionData[problem.id];
                    const consequenceData = missedConsequences[problem.id];
                    const correctSolution = evidenceData?.solutions?.find(s => s.correct);
                    const cost = correctSolution?.cost || 0;
                    const saving = correctSolution?.saving || 0;
                    
                    actionsHtml += `
                        <div class="missed-opportunity-card">
                            <div class="missed-card-header">
                                <span class="missed-card-title">${problem.title}</span>
                                <span class="missed-card-location">📍 ${problem.location}</span>
                            </div>
                            <div class="missed-card-body">
                                <div class="missed-card-fix">
                                    <strong>✓ Fix:</strong> ${correctSolution?.text}
                                </div>
                                <div class="missed-card-why">
                                    <strong>⚠ Why it matters:</strong> ${consequenceData?.consequence || 'This issue remains unresolved.'}
                                </div>
                            </div>
                            <div class="missed-card-costs">
                                <div class="cost-item">
                                    <span class="cost-label">Would have cost</span>
                                    <span class="cost-value">£${cost.toLocaleString()}</span>
                                </div>
                                <div class="cost-item avoided">
                                    <span class="cost-label">Would have avoided</span>
                                    <span class="cost-value">£${saving.toLocaleString()}</span>
                                </div>
                                <div class="cost-item net">
                                    <span class="cost-label">Net benefit lost</span>
                                    <span class="cost-value">£${(saving - cost).toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            scoreBreakdown.innerHTML = actionsHtml;
            
            // ========== SECTION 6: Rating ==========
            const rankDisplay = document.getElementById('rank-display');
            rankDisplay.innerHTML = `
                <div class="stars">${'★'.repeat(rank.stars)}${'☆'.repeat(5 - rank.stars)}</div>
                <div class="rank-title">${rank.title}</div>
                <div class="rank-desc">${rank.desc}</div>
            `;
            
            // ========== SECTION 7: Key Takeaways ==========
            const learningPoints = document.getElementById('learning-points');
            
            const takeaways = `
                <div class="takeaway-card">
                    <div class="takeaway-number">1</div>
                    <div class="takeaway-content">
                        <h4>Interface Control Documents Must Be Complete</h4>
                        <p>"TBC" in an approved document is a system failure. Every interface needs a named owner responsible for completion before design freeze. No document should reach site with unresolved placeholders.</p>
                    </div>
                </div>
                
                <div class="takeaway-card">
                    <div class="takeaway-number">2</div>
                    <div class="takeaway-content">
                        <h4>Datum Systems Must Be Reconciled</h4>
                        <p>Different disciplines use different reference systems. The transformation between module datum, civil datum, and site AOD must be explicitly defined and verified. Never assume drawings from different sources share a common datum.</p>
                    </div>
                </div>
                
                <div class="takeaway-card">
                    <div class="takeaway-number">3</div>
                    <div class="takeaway-content">
                        <h4>Stop-and-Escalate Culture Saves Money</h4>
                        <p>When the unexpected happens — route deviation, weather change, equipment issue — the cost of stopping to assess is always less than the cost of pressing on and getting it wrong. Empower people to stop work.</p>
                    </div>
                </div>
                
                <div class="takeaway-card">
                    <div class="takeaway-number">4</div>
                    <div class="takeaway-content">
                        <h4>Verification Must Match Criticality</h4>
                        <p>"Visually aligned" is not adequate verification for safety-related interfaces. The rigour of verification should match the consequence of getting it wrong. Independent survey verification is essential.</p>
                    </div>
                </div>
                
                <div class="takeaway-card">
                    <div class="takeaway-number">5</div>
                    <div class="takeaway-content">
                        <h4>Extended Storage Requires Active Preservation</h4>
                        <p>Modules designed for 3-month storage don't survive 8 months without enhanced preservation. When schedules slip, preservation regimes must be upgraded. Corrosion doesn't wait for your programme.</p>
                    </div>
                </div>
                
                <div class="takeaway-card highlight">
                    <div class="takeaway-number">★</div>
                    <div class="takeaway-content">
                        <h4>Root Cause Analysis: Look Beyond the Symptom</h4>
                        <p>The flange was 100mm low — that's the symptom. Why? Because the drawings used different datums. Why? Because the ICD was incomplete. Why? Because nobody owned the interface. Finding the root cause means asking "why" until you reach a systemic fix.</p>
                    </div>
                </div>
                
                <div class="takeaway-card regulatory">
                    <div class="takeaway-number">⚖️</div>
                    <div class="takeaway-content">
                        <h4>Root Cause vs Contributing Factor: The Regulatory Imperative</h4>
                        <p><strong>Fixing a problem is not the same as identifying it as the root cause.</strong></p>
                        <p>Under 10 CFR 50 Appendix B (US) and ONR Licence Condition 17 (UK), significant conditions adverse to quality require you to determine the <em>cause</em> of the condition and take corrective action to <em>preclude repetition</em>.</p>
                        <p>If you fix a defect but classify it as just "another issue" rather than the root cause, you've addressed the <strong>extent of condition</strong> (this specific instance) but not the <strong>extent of cause</strong> (why it happened). The same problem will recur on future modules.</p>
                        <p>In this scenario: fixing the datum mismatch on Module M-2401 without identifying it as the root cause means M-2402 will arrive with the same problem — because the ICD process was never corrected. The regulator will ask: "Why didn't your corrective actions prevent recurrence?"</p>
                    </div>
                </div>
                
                <div class="takeaway-card cdm-warning">
                    <div class="takeaway-number">⚠️</div>
                    <div class="takeaway-content">
                        <h4>CDM 2015: Designer Duties & Personal Criminal Liability</h4>
                        <p><strong>Design failures can result in imprisonment.</strong> This is not hypothetical.</p>
                        <p>Under <strong>CDM 2015 Regulation 9</strong>, designers must eliminate foreseeable risks so far as reasonably practicable. If elimination isn't possible, they must reduce or control risks and provide information about residual hazards. The ICD marked "TBC" and the unreconciled datums represent a direct failure of these duties.</p>
                        <p><strong>Real consequences:</strong> In 2018, a property developer received 8 months' imprisonment for CDM breaches after a building collapse. Architects have been fined £120,000+ for failing to consider safety in their designs. Since 2016, fines under CDM have reached £900,000, and the threshold for imprisonment has lowered significantly.</p>
                        <p><strong>In this scenario:</strong> If a worker were injured during emergency remediation of the misaligned interface — working at height, in confined spaces, or with heavy lifting equipment — the designer who left "TBC" in a safety-critical document, and the Principal Designer who failed to ensure completion, could face personal prosecution. Gross negligence manslaughter carries sentences of 2-18 years.</p>
                        <p>The question isn't just "did we fix the technical problem?" — it's "could someone have been hurt because of our design decisions?"</p>
                    </div>
                </div>
            `;
            
            learningPoints.innerHTML = takeaways;
            
            // ========== SECTION 8: Full Solution (Hidden) ==========
            const fullSolution = document.getElementById('full-solution');
            fullSolution.innerHTML = `
                <div class="full-solution-section">
                    <h4>🎯 Root Cause</h4>
                    <p><strong>Datum Mismatch in Interface Drawings</strong> — The module drawing DR-ME-4401 dimensioned the nozzle elevation from module base datum (+2,100mm), while the civil drawing DR-CV-2201 dimensioned the wall penetration from AOD (+18,350mm). The Interface Control Document ICD-2401 Section 4.3 "Datum Transformation" was marked "TBC" and never completed. The 100mm vertical offset was inevitable.</p>
                    <div class="correct-fix">✓ FIX: Implement mandatory datum reconciliation procedure for all ICDs. Require sign-off that transformation matrix is complete before design approval. Cost: £25,000. Prevents: £2,500,000 in future remediation.</div>
                </div>
                
                <div class="full-solution-section">
                    <h4>⚠️ Other Issues (6)</h4>
                    <p><strong>1. Route Deviation Not Escalated</strong> (Transport Records) — Driver diverted through unsurveyed road, bridge strike occurred, but did not escalate for engineering assessment.<br>
                    <span class="fix-note">Fix: Mandatory stop-and-escalate procedure for route deviations. Cost: £15,000. Prevents: £500,000.</span></p>
                    
                    <p><strong>2. No Survey Verification Required</strong> (Lift Plan Documents) — Lift plan only required "visual alignment to survey marks", no independent surveyor verification before crane release.<br>
                    <span class="fix-note">Fix: Update lift plan to require independent survey verification of safety-related interface alignments. Cost: £10,000. Prevents: £800,000.</span></p>
                    
                    <p><strong>3. Coating Degradation</strong> (Module Inspection Report) — Surface corrosion on module frame after 8 months storage. Preservation regime inadequate for extended storage.<br>
                    <span class="fix-note">Fix: Enhanced preservation procedure for modules stored beyond 3 months. Cost: £20,000. Prevents: £150,000.</span></p>
                    
                    <p><strong>4. Lifting Lug Corrosion</strong> (Factory QC Records) — Lug #3 developed corrosion after 8 months outdoor storage, forcing 3-point lift configuration.<br>
                    <span class="fix-note">Fix: Lifting lug preservation covers and monthly inspection for stored modules. Cost: £18,000. Prevents: £200,000.</span></p>
                    
                    <p><strong>5. Ground Assessment Outdated</strong> (Site Conditions Log) — Ground bearing assessment was 6 months old, not re-validated despite significant rainfall.<br>
                    <span class="fix-note">Fix: Require ground re-assessment within 7 days of any heavy lift. Cost: £8,000. Prevents: £350,000.</span></p>
                    
                    <p><strong>6. Interface Ownership Unclear</strong> (Phone Call - Design Engineer) — Engineer saw "TBC" in ICD but assumed someone else would complete it. "Nobody owned the interface."<br>
                    <span class="fix-note">Fix: Clarify RACI matrix for ICD completion. Named individual responsible for each interface. Cost: £12,000. Prevents: £400,000.</span></p>
                </div>
                
                <div class="full-solution-section">
                    <h4>🚫 Decoys (Not Real Problems)</h4>
                    <p>The following items looked suspicious but were actually properly managed or not causes of the alignment issue:</p>
                    <ul class="decoy-list">
                        <li><strong>Module Drawing Approval Stamp</strong> — Old date is normal; drawing was properly approved</li>
                        <li><strong>Civil Drawing Revision History</strong> — Multiple revisions are normal design development</li>
                        <li><strong>Penetration Sleeve Specification</strong> — Correct specification, dimensions are fine</li>
                        <li><strong>Weighbridge Ticket</strong> — Load was within permit limits</li>
                        <li><strong>Departure Time Log</strong> — Minor schedule variance, no safety impact</li>
                        <li><strong>Crane Capacity Calculation</strong> — 78% utilisation is within safe limits</li>
                        <li><strong>3-Point Lift Configuration</strong> — Properly assessed and approved, lift was stable</li>
                        <li><strong>Weather Assessment</strong> — Conditions were within acceptable limits</li>
                        <li><strong>Flange Offset Measurement</strong> — This is the symptom, not the cause</li>
                        <li><strong>Transport Frame Damage</strong> — Sacrificial member did its job, module protected</li>
                        <li><strong>FME Recovery Sign-Off</strong> — Issue was properly resolved</li>
                        <li><strong>Weld Inspection Reports</strong> — All welds passed inspection</li>
                        <li><strong>CMM Dimensional Report</strong> — Module built correctly to its own drawing</li>
                        <li><strong>Phone Calls (QC Manager, Driver, Crane Supervisor, Surveyor)</strong> — All confirmed their work was done correctly</li>
                    </ul>
                </div>
            `;
            
            // Initialize page navigation
            goToReportPage(1);
            
            // Set up nav button click handlers
            document.querySelectorAll('.report-nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    goToReportPage(parseInt(btn.dataset.page));
                });
            });
            
            showScreen('results-screen');
        }
        
        // Helper function to get evidence info by ID
        function getEvidenceInfo(evidenceId) {
            // Check location evidence
            for (const [locationId, location] of Object.entries(evidenceData)) {
                const hotspot = location.hotspots?.find(h => h.id === evidenceId);
                if (hotspot) {
                    return {
                        title: hotspot.finding.title,
                        description: hotspot.finding.description,
                        location: location.title
                    };
                }
            }
            
            // Check phone calls
            const callId = evidenceId.replace('call-', '');
            if (phoneCallData[callId]) {
                return {
                    title: phoneCallData[callId].evidenceTitle,
                    description: phoneCallData[callId].evidenceDescription,
                    location: 'Phone Call'
                };
            }
            
            return null;
        }

        // --------------------------------------------
        // 6.3 Reset Game Function
        // --------------------------------------------
        function resetGame() {
            // Reset all state
            gameState.startTime = null;
            gameState.elapsedSeconds = 0;
            gameState.currentCost = 0;
            gameState.counterPaused = false;
            gameState.evidenceExamined = [];
            gameState.evidenceCards = [];
            gameState.collectedEvidence = [];
            gameState.contributingOrder = [];
            gameState.phoneCallsMade = [];
            gameState.submitted = false;
            gameState.foundRootCause = false;
            gameState.selectedSolutions = {};
            gameState.missedContributing = [];
            gameState.submission = {
                primaryCause: null,
                contributing1: null,
                contributing2: null,
                recommendedFix: null
            };
            gameState.finalScore = {
                timeCost: 0,
                accuracyPenalty: 0,
                efficiencyBonus: 0,
                fixPenalty: 0,
                total: 0
            };
            
            // Reset UI
            document.getElementById('total-cost').textContent = '0';
            document.getElementById('evidence-count').textContent = '0';
            
            const boardBtn = document.getElementById('open-board-btn');
            boardBtn.disabled = true;
            boardBtn.querySelector('.board-btn-text').textContent = 'Collect all 7 pieces first';
            
            document.querySelectorAll('input[name="fix"]').forEach(r => r.checked = false);
            
            // Reset scene hotspots - remove all states
            document.querySelectorAll('.scene-hotspot').forEach(btn => {
                btn.classList.remove('seen', 'collected');
            });
            
            // Reset collection slots
            updateCollectionSlots();
            
            // Show game hint again
            const hint = document.getElementById('game-hint');
            if (hint) hint.style.display = 'flex';
            
            showScreen('intro-screen');
        }

        // --------------------------------------------
        // 6.4 Results Event Listeners
        // --------------------------------------------
        document.getElementById('try-again-btn').addEventListener('click', resetGame);

        console.log('Site Day Zero - All Phases Complete');

        // Modal close buttons - basic functionality
        document.querySelectorAll('.modal-close').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.modal').classList.add('hidden');
                resumeCounter();
            });
        });

        // ============================================
        // HOTSPOT EDITOR MODE
        // Press 'E' to toggle editor mode
        // Works on main page AND inside location modals
        // ============================================
        let editorMode = false;
        let editorPanel = null;
        let currentEditContext = 'main'; // 'main' or location ID
        
        function createEditorPanel() {
            const panel = document.createElement('div');
            panel.id = 'hotspot-editor';
            panel.innerHTML = `
                <style>
                    #hotspot-editor {
                        position: fixed;
                        top: 10px;
                        left: 10px;
                        background: rgba(0,0,0,0.95);
                        border: 2px solid #00ff00;
                        border-radius: 8px;
                        padding: 15px;
                        z-index: 99999;
                        font-family: monospace;
                        font-size: 12px;
                        color: #00ff00;
                        min-width: 350px;
                        max-height: 80vh;
                        overflow-y: auto;
                    }
                    #hotspot-editor h3 {
                        margin: 0 0 10px 0;
                        color: #00ff00;
                        font-size: 14px;
                    }
                    #hotspot-editor .context-label {
                        background: #00ff00;
                        color: #000;
                        padding: 3px 8px;
                        border-radius: 4px;
                        font-weight: bold;
                        margin-bottom: 10px;
                        display: inline-block;
                    }
                    #hotspot-editor .coords {
                        margin: 5px 0;
                        padding: 5px;
                        background: #111;
                        border-radius: 4px;
                    }
                    #hotspot-editor .coord-line {
                        display: flex;
                        justify-content: space-between;
                        padding: 3px 0;
                        border-bottom: 1px solid #333;
                    }
                    #hotspot-editor .coord-line:last-child {
                        border-bottom: none;
                    }
                    #hotspot-editor .hotspot-name {
                        color: #ffaa00;
                    }
                    #hotspot-editor .hotspot-id {
                        color: #00aaff;
                        font-size: 10px;
                    }
                    #hotspot-editor .copy-btn {
                        background: #00ff00;
                        color: #000;
                        border: none;
                        padding: 5px 10px;
                        margin-top: 10px;
                        cursor: pointer;
                        border-radius: 4px;
                        font-family: monospace;
                    }
                    #hotspot-editor .instructions {
                        color: #888;
                        font-size: 10px;
                        margin-top: 10px;
                    }
                    .scene-hotspot.editor-mode,
                    .hotspot.editor-mode {
                        cursor: move !important;
                    }
                    .scene-hotspot.editor-mode::after {
                        content: attr(data-location);
                        position: absolute;
                        top: -20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: #000;
                        color: #00ff00;
                        padding: 2px 6px;
                        font-size: 10px;
                        font-family: monospace;
                        border-radius: 3px;
                        white-space: nowrap;
                    }
                    .hotspot.editor-mode::after {
                        content: attr(data-hotspot-id);
                        position: absolute;
                        top: -20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: #000;
                        color: #00ff00;
                        padding: 2px 6px;
                        font-size: 10px;
                        font-family: monospace;
                        border-radius: 3px;
                        white-space: nowrap;
                    }
                </style>
                <h3>🔧 HOTSPOT EDITOR (Press E to close)</h3>
                <div class="context-label" id="editor-context">MAIN PAGE</div>
                <div class="coords" id="coord-display">
                    Loading coordinates...
                </div>
                <button class="copy-btn" onclick="copyCoords()">📋 Copy All Coordinates</button>
                <div class="instructions">
                    Drag hotspots to reposition.<br>
                    Coordinates update in real-time.<br>
                    Works on main page & inside locations.
                </div>
            `;
            document.body.appendChild(panel);
            return panel;
        }
        
        function updateCoordDisplay() {
            const display = document.getElementById('coord-display');
            const contextLabel = document.getElementById('editor-context');
            if (!display) return;
            
            // Check if we're in a location modal
            const evidenceModal = document.getElementById('evidence-modal');
            const isInModal = evidenceModal && !evidenceModal.classList.contains('hidden');
            
            let html = '';
            
            if (isInModal) {
                // Get location hotspots inside modal
                const container = document.getElementById('evidence-image-container');
                const hotspots = container.querySelectorAll('.hotspot');
                const locationTitle = document.getElementById('evidence-title').textContent;
                
                if (contextLabel) contextLabel.textContent = locationTitle.toUpperCase();
                currentEditContext = locationTitle;
                
                hotspots.forEach(h => {
                    const id = h.getAttribute('data-hotspot-id') || 'unknown';
                    const left = h.style.left || '0%';
                    const top = h.style.top || '0%';
                    
                    html += `<div class="coord-line">
                        <span class="hotspot-id">${id}</span>
                        <span>x: ${parseFloat(left).toFixed(1)}, y: ${parseFloat(top).toFixed(1)}</span>
                    </div>`;
                });
            } else {
                // Main page hotspots
                if (contextLabel) contextLabel.textContent = 'MAIN PAGE';
                currentEditContext = 'main';
                
                const hotspots = document.querySelectorAll('.scene-hotspot');
                
                hotspots.forEach(h => {
                    const loc = h.getAttribute('data-location') || h.id || 'phone';
                    const top = h.style.top || '0%';
                    const left = h.style.left || '';
                    const right = h.style.right || '';
                    
                    const posStr = left ? `left: ${left}; top: ${top}` : `right: ${right}; top: ${top}`;
                    
                    html += `<div class="coord-line">
                        <span class="hotspot-name">${loc}</span>
                        <span>${posStr}</span>
                    </div>`;
                });
            }
            
            display.innerHTML = html || '<em>No hotspots found</em>';
        }
        
        window.copyCoords = function() {
            const evidenceModal = document.getElementById('evidence-modal');
            const isInModal = evidenceModal && !evidenceModal.classList.contains('hidden');
            
            let text = '';
            
            if (isInModal) {
                const container = document.getElementById('evidence-image-container');
                const hotspots = container.querySelectorAll('.hotspot');
                const locationTitle = document.getElementById('evidence-title').textContent;
                
                text = `// ${locationTitle} hotspot positions:\n`;
                hotspots.forEach(h => {
                    const id = h.getAttribute('data-hotspot-id') || 'unknown';
                    const left = parseFloat(h.style.left) || 0;
                    const top = parseFloat(h.style.top) || 0;
                    text += `{ id: "${id}", x: ${left.toFixed(1)}, y: ${top.toFixed(1)} },\n`;
                });
            } else {
                text = '// Main page hotspot positions:\n';
                const hotspots = document.querySelectorAll('.scene-hotspot');
                
                hotspots.forEach(h => {
                    const loc = h.getAttribute('data-location') || h.id || 'phone';
                    const top = h.style.top || '0%';
                    const left = h.style.left || '';
                    const right = h.style.right || '';
                    
                    const posStr = left ? `style="left: ${left}; top: ${top}"` : `style="right: ${right}; top: ${top}"`;
                    text += `// ${loc}: ${posStr}\n`;
                });
            }
            
            navigator.clipboard.writeText(text).then(() => {
                alert('Coordinates copied to clipboard!');
            });
        };
        
        function enableDragging(hotspot, container) {
            let isDragging = false;
            let startX, startY, startLeft, startTop;
            
            hotspot.addEventListener('mousedown', (e) => {
                if (!editorMode) return;
                e.preventDefault();
                e.stopPropagation();
                
                isDragging = true;
                hotspot.style.zIndex = '1000';
                
                startX = e.clientX;
                startY = e.clientY;
                
                // Get current position as percentage
                startTop = parseFloat(hotspot.style.top) || 0;
                startLeft = parseFloat(hotspot.style.left) || 0;
                
                // If using 'right', convert to left
                if (hotspot.style.right && !hotspot.style.left) {
                    const rect = container.getBoundingClientRect();
                    const rightPct = parseFloat(hotspot.style.right);
                    startLeft = 100 - rightPct - (hotspot.offsetWidth / rect.width * 100);
                    hotspot.style.left = startLeft + '%';
                    hotspot.style.right = '';
                }
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging || !editorMode) return;
                
                const rect = container.getBoundingClientRect();
                
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                const deltaXPct = (deltaX / rect.width) * 100;
                const deltaYPct = (deltaY / rect.height) * 100;
                
                let newLeft = startLeft + deltaXPct;
                let newTop = startTop + deltaYPct;
                
                // Clamp values
                newLeft = Math.max(0, Math.min(98, newLeft));
                newTop = Math.max(0, Math.min(98, newTop));
                
                hotspot.style.left = newLeft.toFixed(1) + '%';
                hotspot.style.top = newTop.toFixed(1) + '%';
                hotspot.style.right = '';
                
                updateCoordDisplay();
            });
            
            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    hotspot.style.zIndex = '';
                }
            });
        }
        
        function applyEditorToCurrentContext() {
            const evidenceModal = document.getElementById('evidence-modal');
            const isInModal = evidenceModal && !evidenceModal.classList.contains('hidden');
            
            if (isInModal) {
                // Apply to location modal hotspots
                const container = document.getElementById('evidence-image-container');
                const hotspots = container.querySelectorAll('.hotspot');
                
                hotspots.forEach(h => {
                    h.classList.add('editor-mode');
                    enableDragging(h, container);
                });
            } else {
                // Apply to main page hotspots
                const scene = document.querySelector('.investigation-scene');
                document.querySelectorAll('.scene-hotspot').forEach(h => {
                    h.classList.add('editor-mode');
                    enableDragging(h, scene);
                });
            }
            
            updateCoordDisplay();
        }
        
        function removeEditorFromAll() {
            document.querySelectorAll('.scene-hotspot, .hotspot').forEach(h => {
                h.classList.remove('editor-mode');
            });
        }
        
        function toggleEditorMode() {
            editorMode = !editorMode;
            
            if (editorMode) {
                // Create panel if doesn't exist
                if (!editorPanel) {
                    editorPanel = createEditorPanel();
                }
                applyEditorToCurrentContext();
                
                console.log('Editor mode ENABLED - drag hotspots to reposition');
            } else {
                // Remove panel
                if (editorPanel) {
                    editorPanel.remove();
                    editorPanel = null;
                }
                removeEditorFromAll();
                
                console.log('Editor mode DISABLED');
            }
        }
        
        // Re-apply editor when modal opens/closes
        const evidenceModalObserver = new MutationObserver((mutations) => {
            if (editorMode) {
                setTimeout(() => {
                    applyEditorToCurrentContext();
                }, 100);
            }
        });
        
        const evidenceModal = document.getElementById('evidence-modal');
        if (evidenceModal) {
            evidenceModalObserver.observe(evidenceModal, { attributes: true, attributeFilter: ['class'] });
        }
        
        // Press E to toggle editor
        document.addEventListener('keydown', (e) => {
            if (e.key === 'e' || e.key === 'E') {
                // Don't toggle if typing in an input
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                toggleEditorMode();
            }
        });

        console.log('Site Day Zero - All Phases Complete');
        console.log('Press E to toggle hotspot editor mode (works on main page AND inside locations)');
    </script>
</body>
</html>
