<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What's Missing? - Traceability Detective Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Courier+Prime:wght@400;700&family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --cork-dark: #8b6914;
            --cork-medium: #b8956b;
            --cork-light: #d4b896;
            --paper-white: #fafaf8;
            --paper-cream: #f5f0e6;
            --pin-red: #e74c3c;
            --pin-green: #27ae60;
            --pin-blue: #3498db;
            --pin-yellow: #f1c40f;
            --stamp-red: #c0392b;
            --stamp-green: #27ae60;
            --text-dark: #1f2937;
            --text-medium: #4a5568;
            --accent-orange: #cc5500;
            --shadow-paper: 0 4px 15px rgba(0,0,0,0.2);
            --shadow-pin: 0 2px 4px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier Prime', 'Courier New', monospace;
            background: var(--cork-medium);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Cork Board Background */
        .cork-board {
            min-height: 100vh;
            background: 
                url('https://i.ibb.co/HD4nq7Nm/Board.png') center center / cover no-repeat,
                linear-gradient(135deg, var(--cork-medium) 0%, var(--cork-dark) 100%);
            position: relative;
        }

        .cork-board::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0,0,0,0.03) 2px,
                    rgba(0,0,0,0.03) 4px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 2px,
                    rgba(0,0,0,0.03) 2px,
                    rgba(0,0,0,0.03) 4px
                );
            pointer-events: none;
        }

        /* Vignette Effect */
        .cork-board::after {
            content: '';
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.4) 100%);
            pointer-events: none;
            z-index: 1000;
        }

        /* Game Container */
        .game-container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 1.5rem;
            position: relative;
            z-index: 1;
        }

        /* Header Bar */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .case-title {
            background: var(--paper-cream);
            padding: 0.75rem 1.5rem;
            border: 3px solid var(--text-dark);
            transform: rotate(-1deg);
            box-shadow: var(--shadow-paper);
            position: relative;
        }

        .case-title::before {
            content: 'CLASSIFIED';
            position: absolute;
            top: -10px;
            right: 10px;
            background: var(--stamp-red);
            color: white;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.7rem;
            padding: 2px 8px;
            transform: rotate(3deg);
        }

        .case-title h1 {
            font-family: 'Special Elite', cursive;
            font-size: 1.5rem;
            color: var(--text-dark);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .case-title .subtitle {
            font-size: 1rem;
            color: var(--accent-orange);
            font-weight: 700;
        }

        .stats-panel {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .stat-card {
            background: var(--paper-white);
            padding: 0.6rem 1.2rem;
            border: 2px solid var(--text-dark);
            font-family: 'Special Elite', cursive;
            font-size: 0.95rem;
            box-shadow: var(--shadow-paper);
            transform: rotate(1deg);
        }

        .stat-card:nth-child(2) {
            transform: rotate(-1deg);
        }

        .stat-value {
            color: var(--accent-orange);
            font-weight: 700;
        }

        /* Main Game Area */
        .game-area {
            display: grid;
            grid-template-columns: 280px 1fr 260px;
            gap: 1.5rem;
            align-items: start;
        }

        /* Case Notes Card */
        .case-notes {
            background: var(--paper-cream);
            padding: 1.5rem;
            border: none;
            box-shadow: var(--shadow-paper);
            transform: rotate(-2deg);
            position: relative;
        }

        .case-notes::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: radial-gradient(circle at 30% 30%, #ff6b6b, var(--pin-red));
            border-radius: 50%;
            box-shadow: var(--shadow-pin), inset -2px -2px 4px rgba(0,0,0,0.3);
        }

        .case-notes-header {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--stamp-red);
            border-bottom: 2px dashed var(--text-medium);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }

        .case-notes p {
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-dark);
        }

        .case-notes .highlight {
            background: rgba(241, 196, 15, 0.4);
            padding: 0 4px;
        }

        /* Documents Board */
        .documents-board {
            background: rgba(139, 105, 20, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            min-height: 400px;
            position: relative;
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }

        .document-card {
            background: var(--paper-white);
            padding: 1rem;
            border: 1px solid #ddd;
            box-shadow: var(--shadow-paper);
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: pinDocument 0.5s ease-out backwards;
        }

        .document-card:nth-child(1) { transform: rotate(-1deg); animation-delay: 0.1s; }
        .document-card:nth-child(2) { transform: rotate(1deg); animation-delay: 0.2s; }
        .document-card:nth-child(3) { transform: rotate(-0.5deg); animation-delay: 0.3s; }
        .document-card:nth-child(4) { transform: rotate(1.5deg); animation-delay: 0.4s; }
        .document-card:nth-child(5) { transform: rotate(-1.5deg); animation-delay: 0.5s; }
        .document-card:nth-child(6) { transform: rotate(0.5deg); animation-delay: 0.6s; }

        @keyframes pinDocument {
            0% {
                opacity: 0;
                transform: translateY(-30px) rotate(0deg) scale(0.8);
            }
            70% {
                transform: translateY(5px) scale(1.02);
            }
            100% {
                opacity: 1;
            }
        }

        .document-card::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 14px;
            height: 14px;
            border-radius: 50%;
            box-shadow: var(--shadow-pin), inset -1px -1px 3px rgba(0,0,0,0.3);
        }

        .document-card.present::before {
            background: radial-gradient(circle at 30% 30%, #6bd66b, var(--pin-green));
        }

        .document-card.missing::before {
            background: radial-gradient(circle at 30% 30%, #ffcc00, var(--pin-yellow));
            animation: pulse-pin 1.5s ease-in-out infinite;
        }

        @keyframes pulse-pin {
            0%, 100% { box-shadow: var(--shadow-pin), inset -1px -1px 3px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 0 15px var(--pin-yellow), var(--shadow-pin), inset -1px -1px 3px rgba(0,0,0,0.3); }
        }

        .document-card:hover {
            transform: translateY(-3px) rotate(0deg) !important;
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
        }

        .doc-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .document-card.present .doc-icon {
            color: var(--pin-green);
        }

        .document-card.missing .doc-icon {
            color: var(--pin-yellow);
        }

        .doc-status {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 1rem;
        }

        .document-card.present .doc-status {
            color: var(--pin-green);
        }

        .doc-title {
            font-family: 'Courier Prime', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1.4;
        }

        .document-card.missing {
            background: repeating-linear-gradient(
                45deg,
                var(--paper-white),
                var(--paper-white) 10px,
                #fff9e6 10px,
                #fff9e6 20px
            );
            border: 2px dashed var(--pin-yellow);
        }

        .document-card.missing .doc-title {
            color: var(--accent-orange);
            font-size: 1.2rem;
            text-align: center;
        }

        /* Polaroid Photo */
        .polaroid {
            background: white;
            padding: 10px 10px 40px 10px;
            box-shadow: var(--shadow-paper);
            transform: rotate(3deg);
            position: relative;
        }

        .polaroid::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 18px;
            height: 18px;
            background: radial-gradient(circle at 30% 30%, #6b9fff, var(--pin-blue));
            border-radius: 50%;
            box-shadow: var(--shadow-pin), inset -2px -2px 4px rgba(0,0,0,0.3);
        }

        .polaroid img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            filter: contrast(1.05) saturate(0.9);
        }

        .polaroid-caption {
            font-family: 'Special Elite', cursive;
            font-size: 0.8rem;
            color: var(--text-medium);
            text-align: center;
            margin-top: 10px;
            line-height: 1.3;
        }

        /* Question Section */
        .question-section {
            margin-top: 1.5rem;
            background: var(--paper-cream);
            padding: 1.5rem;
            border-left: 4px solid var(--accent-orange);
            box-shadow: var(--shadow-paper);
            transform: rotate(0.5deg);
            position: relative;
        }

        .question-section::before {
            content: '';
            position: absolute;
            top: -6px;
            right: 20px;
            width: 14px;
            height: 14px;
            background: radial-gradient(circle at 30% 30%, #ff9966, var(--accent-orange));
            border-radius: 50%;
            box-shadow: var(--shadow-pin), inset -1px -1px 3px rgba(0,0,0,0.3);
        }

        .question-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            color: var(--accent-orange);
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
        }

        .question-text {
            font-family: 'Special Elite', cursive;
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
        }

        /* Answer Options */
        .answers-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .answer-btn {
            background: var(--paper-white);
            border: 2px solid var(--text-dark);
            padding: 1rem;
            font-family: 'Courier Prime', monospace;
            font-size: 0.9rem;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            position: relative;
        }

        .answer-btn:hover {
            background: #fff9e6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .answer-btn.selected {
            background: #fff3cd;
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 3px rgba(204, 85, 0, 0.2);
        }

        .answer-btn.correct {
            background: #d4edda;
            border-color: var(--stamp-green);
        }

        .answer-btn.incorrect {
            background: #f8d7da;
            border-color: var(--stamp-red);
        }

        .answer-letter {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: var(--text-dark);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-weight: 700;
            margin-right: 0.75rem;
            font-size: 0.8rem;
        }

        /* Submit Button */
        .submit-section {
            margin-top: 1.5rem;
            text-align: center;
        }

        .submit-btn {
            background: linear-gradient(180deg, var(--stamp-red) 0%, #a5281b 100%);
            color: white;
            border: none;
            padding: 1rem 3rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            letter-spacing: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(192, 57, 43, 0.4);
            position: relative;
            overflow: hidden;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(192, 57, 43, 0.5);
        }

        .submit-btn:active:not(:disabled) {
            transform: translateY(2px);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .submit-btn i {
            margin-right: 0.5rem;
        }

        /* Feedback Overlay */
        .feedback-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 2rem;
        }

        .feedback-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .feedback-card {
            background: var(--paper-cream);
            max-width: 600px;
            width: 100%;
            padding: 2.5rem;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stamp-graphic {
            position: absolute;
            top: -20px;
            right: 20px;
            width: 120px;
            height: 120px;
            border: 6px solid currentColor;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            letter-spacing: 2px;
            transform: rotate(-15deg);
            animation: stampDown 0.5s ease-out 0.2s backwards;
        }

        @keyframes stampDown {
            0% {
                opacity: 0;
                transform: rotate(-15deg) scale(2) translateY(-50px);
            }
            60% {
                transform: rotate(-15deg) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: rotate(-15deg) scale(1);
            }
        }

        .stamp-graphic.correct {
            color: var(--stamp-green);
            border-color: var(--stamp-green);
        }

        .stamp-graphic.incorrect {
            color: var(--stamp-red);
            border-color: var(--stamp-red);
        }

        .feedback-title {
            font-family: 'Special Elite', cursive;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            padding-right: 100px;
        }

        .feedback-title.correct {
            color: var(--stamp-green);
        }

        .feedback-title.incorrect {
            color: var(--stamp-red);
        }

        .feedback-text {
            font-size: 0.95rem;
            line-height: 1.8;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
        }

        .feedback-text strong {
            color: var(--accent-orange);
        }

        .inspector-action {
            background: #f8f4e8;
            border-left: 4px solid var(--accent-orange);
            padding: 1rem;
            margin-top: 1rem;
            font-style: italic;
        }

        .inspector-action strong {
            color: var(--text-dark);
            font-style: normal;
        }

        .next-btn {
            background: var(--text-dark);
            color: white;
            border: none;
            padding: 0.875rem 2rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 1rem;
        }

        .next-btn:hover {
            background: var(--accent-orange);
            transform: translateY(-2px);
        }

        .next-btn i {
            margin-left: 0.5rem;
        }

        /* Intro Screen */
        .intro-screen {
            position: fixed;
            inset: 0;
            background: 
                linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)),
                url('https://i.ibb.co/HD4nq7Nm/Board.png') center center / cover;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 2rem;
        }

        .intro-screen.hidden {
            display: none;
        }

        .case-folder {
            background: #d4a574;
            max-width: 550px;
            width: 100%;
            padding: 0;
            position: relative;
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.5),
                inset 0 2px 0 rgba(255,255,255,0.2);
            animation: folderOpen 0.6s ease-out;
        }

        @keyframes folderOpen {
            from {
                opacity: 0;
                transform: perspective(1000px) rotateX(-30deg) translateY(50px);
            }
            to {
                opacity: 1;
                transform: perspective(1000px) rotateX(0) translateY(0);
            }
        }

        .folder-tab {
            position: absolute;
            top: -30px;
            left: 30px;
            background: #d4a574;
            padding: 8px 20px;
            border-radius: 8px 8px 0 0;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 2px;
            color: var(--text-dark);
        }

        .folder-content {
            background: var(--paper-cream);
            margin: 15px;
            padding: 2rem;
        }

        .case-header {
            text-align: center;
            border-bottom: 3px double var(--text-dark);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .case-number {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            color: var(--stamp-red);
            letter-spacing: 3px;
        }

        .case-main-title {
            font-family: 'Special Elite', cursive;
            font-size: 2rem;
            color: var(--text-dark);
            margin: 0.5rem 0;
        }

        .case-classification {
            font-family: 'Courier Prime', monospace;
            font-size: 0.85rem;
            color: var(--text-medium);
        }

        .intro-text {
            background: #fffef5;
            border: 1px solid #ddd;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.8;
        }

        .intro-text p {
            margin-bottom: 1rem;
        }

        .intro-text p:last-child {
            margin-bottom: 0;
        }

        .consequences {
            background: #fff3cd;
            border-left: 4px solid var(--pin-yellow);
            padding: 1rem;
            margin: 1rem 0;
        }

        .consequences strong {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--accent-orange);
        }

        .consequences ul {
            margin: 0;
            padding-left: 1.25rem;
        }

        .consequences li {
            margin-bottom: 0.25rem;
        }

        .start-btn {
            display: block;
            width: 100%;
            background: linear-gradient(180deg, var(--accent-orange) 0%, #a54400 100%);
            color: white;
            border: none;
            padding: 1rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            letter-spacing: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(204, 85, 0, 0.4);
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(204, 85, 0, 0.5);
        }

        .start-btn i {
            margin-right: 0.5rem;
        }

        /* Results Screen */
        .results-screen {
            position: fixed;
            inset: 0;
            background: 
                linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)),
                url('https://i.ibb.co/HD4nq7Nm/Board.png') center center / cover;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 2rem;
            overflow-y: auto;
        }

        .results-screen.active {
            display: flex;
        }

        .results-card {
            background: var(--paper-cream);
            max-width: 650px;
            width: 100%;
            padding: 2.5rem;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideUp 0.5s ease-out;
        }

        .results-stamp {
            width: 150px;
            height: 150px;
            border: 8px solid currentColor;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', sans-serif;
            margin: 0 auto 1.5rem;
            animation: stampDown 0.6s ease-out 0.3s backwards;
        }

        .results-stamp.master {
            color: #d4af37;
            border-color: #d4af37;
        }

        .results-stamp.qualified {
            color: var(--stamp-green);
            border-color: var(--stamp-green);
        }

        .results-stamp.training {
            color: var(--accent-orange);
            border-color: var(--accent-orange);
        }

        .results-stamp.failed {
            color: var(--stamp-red);
            border-color: var(--stamp-red);
        }

        .results-stamp .stamp-label {
            font-size: 0.9rem;
            letter-spacing: 2px;
        }

        .results-stamp .stamp-title {
            font-size: 1.2rem;
            letter-spacing: 1px;
            text-align: center;
            line-height: 1.2;
        }

        .results-title {
            font-family: 'Special Elite', cursive;
            font-size: 1.6rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .results-message {
            background: #f8f4e8;
            border: 1px solid #ddd;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.7;
        }

        .case-summary {
            background: var(--paper-white);
            border: 2px solid var(--text-dark);
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .case-summary-header {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 2px;
            border-bottom: 2px dashed var(--text-medium);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        .case-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px dotted #ddd;
            font-size: 0.9rem;
        }

        .case-row:last-child {
            border-bottom: none;
        }

        .case-row .case-name {
            color: var(--text-medium);
        }

        .case-row .case-result {
            font-weight: 700;
        }

        .case-row .case-result.correct {
            color: var(--stamp-green);
        }

        .case-row .case-result.incorrect {
            color: var(--stamp-red);
        }

        .final-score {
            text-align: center;
            font-family: 'Special Elite', cursive;
            font-size: 1.4rem;
            margin: 1rem 0;
            padding: 1rem;
            background: var(--text-dark);
            color: white;
        }

        .results-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .results-btn {
            flex: 1;
            min-width: 150px;
            padding: 0.875rem 1rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .results-btn.primary {
            background: var(--accent-orange);
            color: white;
        }

        .results-btn.secondary {
            background: var(--text-dark);
            color: white;
        }

        .results-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        /* Responsive - Tablet */
        @media (max-width: 1024px) {
            .game-container {
                padding: 1rem;
            }

            .game-area {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto auto;
            }

            .case-notes {
                grid-column: 1 / -1;
                transform: rotate(0);
                order: -1;
            }

            .documents-board {
                grid-column: 1 / -1;
            }

            .polaroid {
                max-width: 240px;
                margin: 0 auto;
                transform: rotate(2deg);
            }

            .polaroid img {
                height: 140px;
            }

            .answers-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Responsive - Mobile */
        @media (max-width: 768px) {
            .game-container {
                padding: 0.75rem;
            }

            .header-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
                margin-bottom: 1rem;
            }

            .case-title {
                text-align: center;
                transform: rotate(0);
                padding: 0.6rem 1rem;
            }

            .case-title h1 {
                font-size: 1.2rem;
            }

            .case-title .subtitle {
                font-size: 0.85rem;
            }

            .case-title::before {
                font-size: 0.6rem;
                top: -8px;
                right: 8px;
            }

            .stats-panel {
                justify-content: center;
                gap: 0.75rem;
            }

            .stat-card {
                padding: 0.5rem 0.9rem;
                font-size: 0.85rem;
                transform: rotate(0);
            }

            .game-area {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .case-notes {
                padding: 1.25rem;
                transform: rotate(0);
            }

            .case-notes-header {
                font-size: 1rem;
            }

            .case-notes p {
                font-size: 0.9rem;
            }

            .documents-board {
                padding: 1rem;
                min-height: auto;
            }

            .documents-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .document-card {
                padding: 0.75rem;
                transform: rotate(0) !important;
            }

            .document-card::before {
                width: 12px;
                height: 12px;
                top: -5px;
            }

            .doc-icon {
                font-size: 1.25rem;
                margin-bottom: 0.35rem;
            }

            .doc-title {
                font-size: 0.75rem;
            }

            .document-card.missing .doc-title {
                font-size: 1rem;
            }

            .polaroid {
                max-width: 200px;
                padding: 8px 8px 30px 8px;
                transform: rotate(0);
            }

            .polaroid::before {
                width: 14px;
                height: 14px;
                top: -6px;
            }

            .polaroid img {
                height: 120px;
            }

            .polaroid-caption {
                font-size: 0.7rem;
                margin-top: 8px;
            }

            .question-section {
                padding: 1.25rem;
                margin-top: 1rem;
                transform: rotate(0);
            }

            .question-section::before {
                width: 12px;
                height: 12px;
                top: -5px;
            }

            .question-label {
                font-size: 0.8rem;
            }

            .question-text {
                font-size: 1rem;
                margin-bottom: 1.25rem;
            }

            .answers-grid {
                grid-template-columns: 1fr;
                gap: 0.6rem;
            }

            .answer-btn {
                padding: 0.875rem;
                font-size: 0.85rem;
            }

            .answer-letter {
                width: 22px;
                height: 22px;
                line-height: 22px;
                font-size: 0.75rem;
                margin-right: 0.6rem;
            }

            .submit-section {
                margin-top: 1.25rem;
            }

            .submit-btn {
                padding: 0.875rem 2rem;
                font-size: 1.2rem;
            }

            /* Intro Screen Mobile */
            .intro-screen {
                padding: 1rem;
                align-items: flex-start;
                overflow-y: auto;
            }

            .case-folder {
                margin: 0;
                max-width: 100%;
            }

            .folder-tab {
                font-size: 0.75rem;
                padding: 6px 14px;
                top: -26px;
                left: 20px;
            }

            .folder-content {
                margin: 12px;
                padding: 1.25rem;
            }

            .case-header {
                padding-bottom: 0.75rem;
                margin-bottom: 1rem;
            }

            .case-number {
                font-size: 0.8rem;
            }

            .case-main-title {
                font-size: 1.4rem;
            }

            .case-classification {
                font-size: 0.75rem;
            }

            .intro-text {
                padding: 1rem;
                font-size: 0.9rem;
                line-height: 1.7;
            }

            .consequences {
                padding: 0.875rem;
            }

            .consequences strong {
                font-size: 0.9rem;
            }

            .consequences ul {
                font-size: 0.85rem;
            }

            .start-btn {
                padding: 0.875rem;
                font-size: 1.2rem;
            }

            /* Feedback Overlay Mobile */
            .feedback-overlay {
                padding: 1rem;
                align-items: flex-start;
                overflow-y: auto;
            }

            .feedback-card {
                padding: 1.5rem;
                padding-top: 2rem;
                max-width: 100%;
            }

            .stamp-graphic {
                position: relative;
                top: 0;
                right: 0;
                width: 90px;
                height: 90px;
                font-size: 0.75rem;
                margin: 0 auto 1rem;
                transform: rotate(-10deg);
            }

            .feedback-title {
                padding-right: 0;
                font-size: 1.15rem;
                text-align: center;
            }

            .feedback-text {
                font-size: 0.9rem;
                line-height: 1.7;
            }

            .inspector-action {
                padding: 0.875rem;
                font-size: 0.9rem;
            }

            .next-btn {
                width: 100%;
                padding: 0.75rem 1.5rem;
                font-size: 1.1rem;
            }

            /* Results Screen Mobile */
            .results-screen {
                padding: 1rem;
                align-items: flex-start;
                overflow-y: auto;
            }

            .results-card {
                padding: 1.5rem;
                max-width: 100%;
            }

            .results-stamp {
                width: 120px;
                height: 120px;
                border-width: 6px;
                margin-bottom: 1rem;
            }

            .results-stamp .stamp-label {
                font-size: 0.75rem;
            }

            .results-stamp .stamp-title {
                font-size: 1rem;
            }

            .results-title {
                font-size: 1.3rem;
            }

            .results-message {
                padding: 1rem;
                font-size: 0.9rem;
            }

            .case-summary {
                padding: 1rem;
            }

            .case-summary-header {
                font-size: 1rem;
            }

            .case-row {
                font-size: 0.8rem;
                flex-wrap: wrap;
                gap: 0.25rem;
            }

            .case-row .case-name {
                flex: 1 1 100%;
            }

            .final-score {
                font-size: 1.1rem;
                padding: 0.875rem;
            }

            .results-buttons {
                flex-direction: column;
            }

            .results-btn {
                min-width: auto;
                padding: 0.75rem;
                font-size: 1rem;
            }
        }

        /* Responsive - Small Mobile */
        @media (max-width: 400px) {
            .game-container {
                padding: 0.5rem;
            }

            .case-title h1 {
                font-size: 1rem;
                letter-spacing: 1px;
            }

            .stat-card {
                font-size: 0.8rem;
                padding: 0.4rem 0.7rem;
            }

            .documents-grid {
                grid-template-columns: 1fr 1fr;
                gap: 0.5rem;
            }

            .document-card {
                padding: 0.6rem;
            }

            .doc-icon {
                font-size: 1.1rem;
            }

            .doc-title {
                font-size: 0.7rem;
            }

            .polaroid {
                max-width: 160px;
            }

            .polaroid img {
                height: 100px;
            }

            .question-text {
                font-size: 0.95rem;
            }

            .answer-btn {
                padding: 0.75rem;
                font-size: 0.8rem;
            }

            .case-main-title {
                font-size: 1.2rem;
            }

            .intro-text {
                padding: 0.875rem;
                font-size: 0.85rem;
            }
        }

        /* Touch device improvements */
        @media (hover: none) and (pointer: coarse) {
            .document-card:hover {
                transform: none !important;
                box-shadow: var(--shadow-paper);
            }

            .document-card:active {
                transform: scale(0.98) !important;
            }

            .answer-btn:hover {
                background: var(--paper-white);
                transform: none;
                box-shadow: none;
            }

            .answer-btn:active {
                background: #fff9e6;
                transform: scale(0.98);
            }

            .answer-btn.selected {
                background: #fff3cd;
            }

            .submit-btn:hover:not(:disabled),
            .start-btn:hover,
            .next-btn:hover,
            .results-btn:hover {
                transform: none;
            }

            .submit-btn:active:not(:disabled),
            .start-btn:active,
            .next-btn:active,
            .results-btn:active {
                transform: scale(0.98);
            }
        }

        /* Ensure vignette doesn't block touch on mobile */
        @media (max-width: 768px) {
            .cork-board::after {
                background: radial-gradient(ellipse at center, transparent 50%, rgba(0,0,0,0.3) 100%);
            }
        }
    </style>
</head>
<body>
    <!-- Intro Screen -->
    <div class="intro-screen" id="introScreen">
        <div class="case-folder">
            <div class="folder-tab">CASE FILE #TR-2024</div>
            <div class="folder-content">
                <div class="case-header">
                    <div class="case-number">CASE FILE #TR-2024</div>
                    <h1 class="case-main-title">What's Missing?</h1>
                    <div class="case-classification">THE NUCLEAR HOUSE — QA INSPECTOR TRAINING</div>
                </div>
                
                <div class="intro-text">
                    <p>You are a <strong>QA Inspector from The Nuclear House</strong> reviewing documentation packages for nuclear components. Each package should contain complete traceability records — but something's not right.</p>
                    
                    <p><strong>Your mission:</strong> Find the missing document before the component gets approved.</p>
                    
                    <div class="consequences">
                        <strong>One mistake in the traceability chain could mean:</strong>
                        <ul>
                            <li>Untraceable components in a nuclear plant</li>
                            <li>Failed regulatory audits</li>
                            <li>Costly rework and delays</li>
                        </ul>
                    </div>
                    
                    <p style="text-align: center; font-style: italic; margin-top: 1rem;">Can you spot what's missing?</p>
                </div>
                
                <button class="start-btn" id="startBtn">
                    <i class="fas fa-folder-open"></i> OPEN CASE FILE
                </button>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div class="results-screen" id="resultsScreen">
        <div class="results-card">
            <div class="results-stamp" id="resultsStamp">
                <span class="stamp-label">CLASSIFICATION</span>
                <span class="stamp-title" id="stampTitle">MASTER INSPECTOR</span>
            </div>
            
            <h2 class="results-title" id="resultsTitle">All Cases Solved!</h2>
            
            <div class="results-message" id="resultsMessage">
                Outstanding work, Inspector. You've demonstrated expert-level understanding of nuclear material traceability.
            </div>
            
            <div class="case-summary">
                <div class="case-summary-header">CASE SUMMARY REPORT</div>
                <div id="caseSummaryRows"></div>
            </div>
            
            <div class="final-score" id="finalScore">FINAL SCORE: 6/6 Cases Solved</div>
            
            <div class="results-buttons">
                <button class="results-btn primary" id="retryBtn">
                    <i class="fas fa-redo"></i> RETRY INVESTIGATION
                </button>
            </div>
        </div>
    </div>

    <!-- Feedback Overlay -->
    <div class="feedback-overlay" id="feedbackOverlay">
        <div class="feedback-card">
            <div class="stamp-graphic" id="feedbackStamp">
                <span id="stampText">CASE SOLVED</span>
            </div>
            <h3 class="feedback-title" id="feedbackTitle">Case Solved!</h3>
            <div class="feedback-text" id="feedbackText"></div>
            <div class="inspector-action" id="inspectorAction"></div>
            <button class="next-btn" id="nextCaseBtn">NEXT CASE <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>

    <!-- Main Game -->
    <div class="cork-board">
        <div class="game-container" id="gameContainer" style="display: none;">
            <!-- Header -->
            <div class="header-bar">
                <div class="case-title">
                    <h1>Case File: <span class="subtitle">What's Missing?</span></h1>
                </div>
                <div class="stats-panel">
                    <div class="stat-card">
                        Inspection <span class="stat-value" id="currentRound">1</span> of 6
                    </div>
                    <div class="stat-card">
                        Cases Solved: <span class="stat-value" id="scoreDisplay">0</span>/6
                    </div>
                </div>
            </div>

            <!-- Game Area -->
            <div class="game-area">
                <!-- Case Notes -->
                <div class="case-notes">
                    <div class="case-notes-header">
                        <i class="fas fa-file-alt"></i> CASE NOTES
                    </div>
                    <p id="scenarioText">Loading scenario...</p>
                </div>

                <!-- Documents Board -->
                <div class="documents-board">
                    <div class="documents-grid" id="documentsGrid">
                        <!-- Documents will be inserted here -->
                    </div>
                </div>

                <!-- Polaroid Photo -->
                <div class="polaroid">
                    <img id="stagePhoto" src="" alt="Stage photo">
                    <div class="polaroid-caption" id="photoCaption">Loading...</div>
                </div>
            </div>

            <!-- Question Section -->
            <div class="question-section">
                <div class="question-label"><i class="fas fa-search"></i> INVESTIGATION QUESTION</div>
                <p class="question-text" id="questionText">This package is missing a critical document. What is it?</p>
                <div class="answers-grid" id="answersGrid">
                    <!-- Answers will be inserted here -->
                </div>
            </div>

            <!-- Submit Section -->
            <div class="submit-section">
                <button class="submit-btn" id="submitBtn" disabled>
                    <i class="fas fa-stamp"></i> SUBMIT FINDING
                </button>
            </div>
        </div>
    </div>

    <script>
        // Game Data
        const gameData = [
            {
                id: 1,
                title: "Steel Mill Documentation",
                photo: "https://i.ibb.co/TfN5KDp/01-Foundry.png",
                caption: "ArcelorMittal Steel Mill - Heat 87432",
                scenario: "A shipment of steel plates has arrived from the mill. The supplier claims full traceability, but your experienced eye notices something wrong with the documentation package.",
                documents: [
                    "Heat Number stamped on plates: 87432",
                    "Chemical composition report",
                    "Mechanical properties test results",
                    "Dispatch note from mill"
                ],
                answers: [
                    "Independent Inspector Witness Signature (EN10204 3.2 requirement)",
                    "Welder Qualification Certificate",
                    "NDT Report",
                    "Installation Record"
                ],
                correctIndex: 0,
                correctFeedback: {
                    title: "CASE SOLVED!",
                    text: "For SC1 nuclear components, an EN10204 Type 3.2 certificate is required. The key difference from a 3.1 certificate is that a 3.2 requires an <strong>INDEPENDENT third-party inspector</strong> to witness the tests and countersign the certificate.<br><br>Without this independent verification, you only have the mill's word that the tests were performed correctly. For nuclear safety-critical materials, that's not enough.",
                    action: "<strong>Inspector's Action:</strong> Reject the package. Request 3.2 certification from supplier."
                },
                incorrectFeedback: {
                    title: "INCORRECT FINDING",
                    text: "The missing document is: <strong>Independent Inspector Witness Signature (EN10204 3.2 requirement)</strong><br><br>For SC1 nuclear components, a 3.2 certificate requires third-party witness verification. This package only has mill-issued documentation (3.1 level).",
                    action: "<strong>Consequence:</strong> If approved, this material cannot be verified by an independent party. Regulatory audit would fail."
                }
            },
            {
                id: 2,
                title: "Transport Documentation",
                photo: "https://i.ibb.co/yncQHphs/02-Truck.png",
                caption: "Material in transit - Intermediate supplier",
                scenario: "Steel plates are being delivered from a stockist who purchased them from the original mill. The delivery driver hands you a documentation package. Something's not adding up.",
                documents: [
                    "Original Mill Test Certificate (EN10204 3.2)",
                    "Packing list with quantities",
                    "Delivery note with destination",
                    "Transport company details"
                ],
                answers: [
                    "Welder Qualification Certificate",
                    "Certificate of Conformance linking material to original MTR",
                    "Radiographic Test Report",
                    "As-Built Drawing"
                ],
                correctIndex: 1,
                correctFeedback: {
                    title: "CASE SOLVED!",
                    text: "When material passes through a stockist or intermediate supplier, a <strong>Certificate of Conformance</strong> is essential. This document confirms that:<br><br>• The material being delivered is the SAME material described in the original MTR<br>• Heat numbers have been verified and match<br>• The chain of custody is unbroken<br><br>Without this, you cannot prove the plates on the truck are actually from Heat 87432. They could be any steel with a forged marking.",
                    action: "<strong>Inspector's Action:</strong> Reject delivery. Request Certificate of Conformance from stockist with heat number verification."
                },
                incorrectFeedback: {
                    title: "INCORRECT FINDING",
                    text: "The missing document is: <strong>Certificate of Conformance</strong><br><br>When material passes through intermediate suppliers, you need proof that the chain of custody is intact. The Certificate of Conformance bridges the gap between the original mill and your delivery.",
                    action: "<strong>Consequence:</strong> Without it, material could be counterfeit or substituted. Traceability chain is broken."
                }
            },
            {
                id: 3,
                title: "Receiving Inspection Documentation",
                photo: "https://i.ibb.co/3y1Qsms8/03-Checking.png",
                caption: "Receiving bay - Material verification",
                scenario: "Your receiving inspector has completed their check of incoming steel plates. They've verified the heat number stampings match the certificates. But when you review their paperwork before accepting the material into stock, you notice a gap.",
                documents: [
                    "Mill Test Certificate (verified)",
                    "Certificate of Conformance (verified)",
                    "Visual condition noted as acceptable",
                    "Heat numbers recorded"
                ],
                answers: [
                    "Welding Procedure Specification",
                    "Receiving Inspection Report with Inspector Signature and Date",
                    "Final Assembly Certificate",
                    "Hydrostatic Test Report"
                ],
                correctIndex: 1,
                correctFeedback: {
                    title: "CASE SOLVED!",
                    text: "A formal <strong>Receiving Inspection Report</strong> is required to document:<br><br>• WHO performed the verification (inspector name/ID)<br>• WHEN it was performed (date and time)<br>• WHAT was checked (heat number verification, visual condition, dimensions)<br>• The formal ACCEPTANCE decision<br><br>Notes on a Post-it or verbal confirmation isn't enough. You need a signed, dated record that becomes part of the permanent traceability file.",
                    action: "<strong>Inspector's Action:</strong> Inspector must complete formal Receiving Inspection Report before material enters storage."
                },
                incorrectFeedback: {
                    title: "INCORRECT FINDING",
                    text: "The missing document is: <strong>Receiving Inspection Report with Inspector Signature and Date</strong><br><br>Even if all the checks were done correctly, without a formal signed record, you cannot PROVE they were done. Years later, how would you demonstrate this material was properly verified on receipt?",
                    action: "<strong>Consequence:</strong> Regulatory audit failure. No evidence that receiving inspection was performed."
                }
            },
            {
                id: 4,
                title: "Fabrication Documentation",
                photo: "https://i.ibb.co/p6V53Qqh/04-Weld.png",
                caption: "Fabrication shop - Weld WLD-2847",
                scenario: "A welder has just completed a critical pressure boundary weld joining two plates. The welding supervisor hands you the documentation package for this weld. Review it carefully.",
                documents: [
                    "Parent Material 1: Heat Number 87432, MTR attached",
                    "Parent Material 2: Heat Number 87433, MTR attached",
                    "Welding Procedure Specification (WPS-045)",
                    "Welder Qualification Certificate (Valid)",
                    "Weld Log entry with date, location, welder ID"
                ],
                answers: [
                    "NDT Inspector Qualification",
                    "Filler Material Certificate with Heat/Batch Number",
                    "Plant Operating Licence",
                    "Environmental Permit"
                ],
                correctIndex: 1,
                correctFeedback: {
                    title: "CASE SOLVED!",
                    text: "The weld filler material (welding rod, wire, flux) is now <strong>PART of the component!</strong> It must be traceable just like the parent materials.<br><br>For a complete weld record, you need:<br>• Both parent material heat numbers ✓<br>• Filler material heat/batch number and certificate ✗ MISSING<br>• Filler material specification and properties<br><br>If that filler material has a defect, you need to identify every weld where it was used.",
                    action: "<strong>Inspector's Action:</strong> Stop work. Obtain filler material certificate and batch number. Update weld log before any further welding."
                },
                incorrectFeedback: {
                    title: "INCORRECT FINDING",
                    text: "The missing document is: <strong>Filler Material Certificate with Heat/Batch Number</strong><br><br>The welding consumable becomes part of the component. A weld made with untraceable filler material is an untraceable weld — regardless of how good the parent material documentation is.",
                    action: "<strong>Consequence:</strong> Entire weld is untraceable. May require removal and re-welding with documented consumables."
                }
            },
            {
                id: 5,
                title: "Testing Documentation",
                photo: "https://i.ibb.co/7JWQJgxn/05-Weldtest.png",
                caption: "NDT Lab - Ultrasonic examination",
                scenario: "NDT technicians have completed ultrasonic testing on a critical weld. The results show no defects detected. But before you sign off on the inspection, review the documentation package.",
                documents: [
                    "Ultrasonic Test Report - No defects",
                    "Weld identification number (WLD-2847)",
                    "Test procedure reference (UT-PROC-012)",
                    "Test date and location"
                ],
                answers: [
                    "Original Iron Ore Mining Certificate",
                    "NDT Technician Qualification Certificate and Equipment Calibration Record",
                    "Architect's Approval",
                    "Transport Insurance Document"
                ],
                correctIndex: 1,
                correctFeedback: {
                    title: "CASE SOLVED!",
                    text: "An NDT report is only valid if:<br><br>1. The <strong>TECHNICIAN</strong> is qualified to the appropriate level (e.g., PCN Level 2, SNT-TC-1A)<br>2. The <strong>EQUIPMENT</strong> is calibrated with current calibration certificates<br><br>Without these, how do you know:<br>• The technician could correctly interpret the results?<br>• The equipment was actually detecting defects properly?<br><br>A 'clean' report from an unqualified technician or uncalibrated equipment is worthless.",
                    action: "<strong>Inspector's Action:</strong> Verify technician qualification and equipment calibration. If not current, the test must be repeated by qualified personnel with calibrated equipment."
                },
                incorrectFeedback: {
                    title: "INCORRECT FINDING",
                    text: "The missing documents are: <strong>NDT Technician Qualification Certificate and Equipment Calibration Record</strong><br><br>NDT is only as good as the people and equipment performing it. Nuclear regulations require proof that both are qualified and calibrated.",
                    action: "<strong>Consequence:</strong> Test results are invalid. Regulatory inspector would require re-testing. Potential schedule delay."
                }
            },
            {
                id: 6,
                title: "Installation Documentation",
                photo: "https://i.ibb.co/6cSJ7W7k/06-Assembly.png",
                caption: "Nuclear site - Final installation",
                scenario: "A completed pressure vessel has arrived at the nuclear plant ready for installation. The documentation package looks thick and complete. But as the final Quality Inspector before installation, you spot something crucial missing.",
                documents: [
                    "All Mill Test Certificates for materials",
                    "All Weld Records with filler material traceability",
                    "All NDT Reports (UT, RT, PT) - No defects",
                    "Dimensional Inspection Report - Conforms to drawing",
                    "Hydrostatic Test Certificate - Passed",
                    "Heat Treatment Records"
                ],
                answers: [
                    "Cafeteria Menu from the Fabrication Shop",
                    "Quality Release Certificate with Authorised Signature",
                    "Weather Report from Manufacturing Date",
                    "Fabricator's Annual Report"
                ],
                correctIndex: 1,
                correctFeedback: {
                    title: "CASE SOLVED!",
                    text: "Even with every individual document complete, you need a <strong>FORMAL QUALITY RELEASE</strong> that states:<br><br>• All required inspections and tests have been completed<br>• All results meet acceptance criteria<br>• All non-conformances have been dispositioned<br>• The component is APPROVED for installation<br><br>This requires an authorised signature from someone with the delegated authority to release safety-critical components.<br><br>Without this, you have a pile of documents but no formal declaration that the component meets all requirements.",
                    action: "<strong>Inspector's Action:</strong> Return to supplier. Require formal Quality Release Certificate signed by authorised QA representative."
                },
                incorrectFeedback: {
                    title: "INCORRECT FINDING",
                    text: "The missing document is: <strong>Quality Release Certificate with Authorised Signature</strong><br><br>Individual documents prove individual steps were done. The Quality Release Certificate is the formal declaration that EVERYTHING is complete and acceptable. It's the final 'gate' before installation.",
                    action: "<strong>Consequence:</strong> Installing without formal release violates QA procedures. Component may need to be removed if installed without proper release."
                }
            }
        ];

        // Results configurations
        const resultsConfig = {
            master: {
                min: 6,
                stampClass: 'master',
                stampTitle: 'MASTER<br>INSPECTOR',
                title: 'ALL CASES SOLVED! 🏆',
                message: "Outstanding work, Inspector. You've demonstrated expert-level understanding of nuclear material traceability. You caught every missing document and understand why each one matters.<br><br>The Nuclear House is proud to have inspectors like you who never let documentation gaps slip through.<br><br><strong>CLASSIFICATION: Master QA Inspector</strong>"
            },
            qualified: {
                min: 4,
                stampClass: 'qualified',
                stampTitle: 'QUALIFIED<br>INSPECTOR',
                title: 'GOOD WORK, INSPECTOR',
                message: "Strong performance. You understand the fundamentals of traceability documentation. Review the cases you missed to strengthen your knowledge.<br><br>Remember: In nuclear QA, 'almost complete' documentation is the same as incomplete.<br><br><strong>CLASSIFICATION: Qualified Inspector</strong>"
            },
            training: {
                min: 2,
                stampClass: 'training',
                stampTitle: 'TRAINING<br>REQUIRED',
                title: 'NEEDS IMPROVEMENT',
                message: "You're learning, but some critical documentation requirements need review. Each missing document you didn't catch could lead to:<br><br>• Untraceable components in a nuclear plant<br><br>• Failed regulatory audits<br><br>• Costly rework<br><br><strong>Recommendation:</strong> Use the course menu to revisit the 'Follow the Steel' module, then retry this challenge.<br><br><strong>CLASSIFICATION: Trainee Inspector</strong>"
            },
            failed: {
                min: 0,
                stampClass: 'failed',
                stampTitle: 'CASE<br>FAILED',
                title: 'MORE STUDY REQUIRED',
                message: "Material traceability is fundamental to nuclear safety. Without proper documentation, we cannot prove components are safe.<br><br>Please use the course menu to revisit the 'Follow the Steel' module carefully before attempting this challenge again.<br><br><strong>CLASSIFICATION: Requires Retraining</strong>"
            }
        };

        // Game State
        let currentRound = 0;
        let score = 0;
        let selectedAnswer = null;
        let results = [];
        let shuffledAnswers = [];
        let correctAnswerIndex = 0;

        // Shuffle function (Fisher-Yates)
        function shuffleWithCorrectTracking(answers, correctIndex) {
            // Create array of objects with answer text and whether it's correct
            const answerObjects = answers.map((answer, index) => ({
                text: answer,
                isCorrect: index === correctIndex
            }));
            
            // Fisher-Yates shuffle
            for (let i = answerObjects.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [answerObjects[i], answerObjects[j]] = [answerObjects[j], answerObjects[i]];
            }
            
            // Find new position of correct answer
            const newCorrectIndex = answerObjects.findIndex(a => a.isCorrect);
            
            return {
                answers: answerObjects.map(a => a.text),
                correctIndex: newCorrectIndex
            };
        }

        // DOM Elements
        const introScreen = document.getElementById('introScreen');
        const gameContainer = document.getElementById('gameContainer');
        const resultsScreen = document.getElementById('resultsScreen');
        const feedbackOverlay = document.getElementById('feedbackOverlay');

        const startBtn = document.getElementById('startBtn');
        const submitBtn = document.getElementById('submitBtn');
        const nextCaseBtn = document.getElementById('nextCaseBtn');
        const retryBtn = document.getElementById('retryBtn');

        const currentRoundDisplay = document.getElementById('currentRound');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const scenarioText = document.getElementById('scenarioText');
        const stagePhoto = document.getElementById('stagePhoto');
        const photoCaption = document.getElementById('photoCaption');
        const documentsGrid = document.getElementById('documentsGrid');
        const answersGrid = document.getElementById('answersGrid');

        const feedbackStamp = document.getElementById('feedbackStamp');
        const stampText = document.getElementById('stampText');
        const feedbackTitle = document.getElementById('feedbackTitle');
        const feedbackText = document.getElementById('feedbackText');
        const inspectorAction = document.getElementById('inspectorAction');

        const resultsStamp = document.getElementById('resultsStamp');
        const stampTitle = document.getElementById('stampTitle');
        const resultsTitle = document.getElementById('resultsTitle');
        const resultsMessage = document.getElementById('resultsMessage');
        const caseSummaryRows = document.getElementById('caseSummaryRows');
        const finalScore = document.getElementById('finalScore');

        // Functions
        function startGame() {
            introScreen.classList.add('hidden');
            gameContainer.style.display = 'block';
            currentRound = 0;
            score = 0;
            results = [];
            loadRound();
        }

        function loadRound() {
            const round = gameData[currentRound];
            selectedAnswer = null;
            submitBtn.disabled = true;

            // Shuffle answers for this round
            const shuffled = shuffleWithCorrectTracking(round.answers, round.correctIndex);
            shuffledAnswers = shuffled.answers;
            correctAnswerIndex = shuffled.correctIndex;

            // Update displays
            currentRoundDisplay.textContent = currentRound + 1;
            scoreDisplay.textContent = score;

            // Update scenario
            scenarioText.innerHTML = round.scenario;

            // Update photo
            stagePhoto.src = round.photo;
            photoCaption.textContent = round.caption;

            // Generate documents
            documentsGrid.innerHTML = '';
            round.documents.forEach((doc, index) => {
                const card = document.createElement('div');
                card.className = 'document-card present';
                card.innerHTML = `
                    <div class="doc-icon"><i class="fas fa-file-alt"></i></div>
                    <div class="doc-status"><i class="fas fa-check"></i></div>
                    <div class="doc-title">${doc}</div>
                `;
                card.style.animationDelay = `${0.1 + index * 0.1}s`;
                documentsGrid.appendChild(card);
            });

            // Add missing document card
            const missingCard = document.createElement('div');
            missingCard.className = 'document-card missing';
            missingCard.innerHTML = `
                <div class="doc-icon"><i class="fas fa-question"></i></div>
                <div class="doc-title">?</div>
            `;
            missingCard.style.animationDelay = `${0.1 + round.documents.length * 0.1}s`;
            documentsGrid.appendChild(missingCard);

            // Generate answers (now using shuffled answers)
            answersGrid.innerHTML = '';
            const letters = ['A', 'B', 'C', 'D'];
            shuffledAnswers.forEach((answer, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.innerHTML = `<span class="answer-letter">${letters[index]}</span>${answer}`;
                btn.addEventListener('click', () => selectAnswer(index, btn));
                answersGrid.appendChild(btn);
            });
        }

        function selectAnswer(index, btn) {
            // Remove previous selection
            document.querySelectorAll('.answer-btn').forEach(b => b.classList.remove('selected'));
            
            // Add new selection
            btn.classList.add('selected');
            selectedAnswer = index;
            submitBtn.disabled = false;
        }

        function submitAnswer() {
            const round = gameData[currentRound];
            const isCorrect = selectedAnswer === correctAnswerIndex;

            // Update answer buttons
            document.querySelectorAll('.answer-btn').forEach((btn, index) => {
                btn.style.pointerEvents = 'none';
                if (index === correctAnswerIndex) {
                    btn.classList.add('correct');
                } else if (index === selectedAnswer && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });

            // Record result (use original correct answer text from round data)
            results.push({
                round: currentRound + 1,
                title: round.title,
                correct: isCorrect,
                missingDoc: round.answers[round.correctIndex]
            });

            if (isCorrect) {
                score++;
                scoreDisplay.textContent = score;
            }

            // Show feedback
            showFeedback(isCorrect, round);
        }

        function showFeedback(isCorrect, round) {
            const feedback = isCorrect ? round.correctFeedback : round.incorrectFeedback;

            feedbackStamp.className = `stamp-graphic ${isCorrect ? 'correct' : 'incorrect'}`;
            stampText.textContent = isCorrect ? 'CASE SOLVED' : 'INCORRECT';
            feedbackTitle.className = `feedback-title ${isCorrect ? 'correct' : 'incorrect'}`;
            feedbackTitle.innerHTML = isCorrect ? '✅ ' + feedback.title : '❌ ' + feedback.title;
            feedbackText.innerHTML = feedback.text;
            inspectorAction.innerHTML = feedback.action;

            // Update button text for last round
            if (currentRound === gameData.length - 1) {
                nextCaseBtn.innerHTML = 'VIEW RESULTS <i class="fas fa-trophy"></i>';
            } else {
                nextCaseBtn.innerHTML = 'NEXT CASE <i class="fas fa-arrow-right"></i>';
            }

            feedbackOverlay.classList.add('active');
        }

        function nextCase() {
            feedbackOverlay.classList.remove('active');

            if (currentRound < gameData.length - 1) {
                currentRound++;
                loadRound();
            } else {
                showResults();
            }
        }

        function showResults() {
            gameContainer.style.display = 'none';

            // Determine result tier
            let config;
            if (score >= resultsConfig.master.min) {
                config = resultsConfig.master;
            } else if (score >= resultsConfig.qualified.min) {
                config = resultsConfig.qualified;
            } else if (score >= resultsConfig.training.min) {
                config = resultsConfig.training;
            } else {
                config = resultsConfig.failed;
            }

            // Update results display
            resultsStamp.className = `results-stamp ${config.stampClass}`;
            stampTitle.innerHTML = config.stampTitle;
            resultsTitle.textContent = config.title;
            resultsMessage.innerHTML = config.message;
            finalScore.textContent = `FINAL SCORE: ${score}/6 Cases Solved`;

            // Generate case summary
            caseSummaryRows.innerHTML = '';
            results.forEach(result => {
                const row = document.createElement('div');
                row.className = 'case-row';
                row.innerHTML = `
                    <span class="case-name">Case ${result.round} - ${result.title}</span>
                    <span class="case-result ${result.correct ? 'correct' : 'incorrect'}">
                        ${result.correct ? '✅' : '❌'} ${result.correct ? 'Solved' : 'Missed'}
                    </span>
                `;
                caseSummaryRows.appendChild(row);
            });

            resultsScreen.classList.add('active');
        }

        function resetGame() {
            resultsScreen.classList.remove('active');
            currentRound = 0;
            score = 0;
            results = [];
            gameContainer.style.display = 'block';
            loadRound();
        }

        // Event Listeners
        startBtn.addEventListener('click', startGame);
        submitBtn.addEventListener('click', submitAnswer);
        nextCaseBtn.addEventListener('click', nextCase);
        retryBtn.addEventListener('click', resetGame);

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (gameContainer.style.display === 'block' && !feedbackOverlay.classList.contains('active')) {
                const key = e.key.toUpperCase();
                const keyMap = { 'A': 0, 'B': 1, 'C': 2, 'D': 3, '1': 0, '2': 1, '3': 2, '4': 3 };
                
                if (keyMap.hasOwnProperty(key)) {
                    const buttons = document.querySelectorAll('.answer-btn');
                    if (buttons[keyMap[key]]) {
                        selectAnswer(keyMap[key], buttons[keyMap[key]]);
                    }
                } else if (e.key === 'Enter' && !submitBtn.disabled) {
                    submitAnswer();
                }
            } else if (feedbackOverlay.classList.contains('active') && e.key === 'Enter') {
                nextCase();
            }
        });
    </script>
</body>
</html>
