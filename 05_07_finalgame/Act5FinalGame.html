<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The 60-Year Journey</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --white: #f7f8fa;
            --light-grey: #d0d9e0;
            --mid-grey: #9babc2;
            --slate: #4a5d6b;
            --dark-slate: #364451;
            --deep-navy: #1f2937;
            --green: #92d050;
            --blue: #00b0f0;
            --orange: #cc5500;
            --red: #dc2626;
            --amber: #f59e0b;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--deep-navy);
            color: var(--light-grey);
        }
        
        /* ============================================
           CINEMATIC INTRO
           ============================================ */
        #cinematicIntro {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: #000;
        }
        
        #cinematicIntro.hidden { display: none; }
        
        .intro-slide {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.8s ease;
        }
        
        .intro-slide.active { opacity: 1; }
        
        .intro-slide .bg {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            filter: brightness(0.35);
        }
        
        .intro-slide .bg.dark {
            background: linear-gradient(135deg, #0a1628, #1a2a3a, #0d1a2d);
            filter: none;
        }
        
        .intro-content {
            position: relative;
            z-index: 2;
            text-align: center;
            max-width: 700px;
            padding: 40px;
        }
        
        .intro-logo img { max-width: 250px; margin-bottom: 30px; }
        .intro-company { color: var(--blue); text-transform: uppercase; letter-spacing: 4px; margin-bottom: 20px; }
        .intro-title { font-size: 3rem; color: var(--white); margin-bottom: 20px; }
        .intro-subtitle { font-size: 1.2rem; color: var(--light-grey); }
        
        .intro-text-box {
            background: rgba(31, 41, 55, 0.9);
            border-left: 4px solid var(--blue);
            padding: 30px;
            text-align: left;
            border-radius: 8px;
        }
        
        .intro-text-box p { margin-bottom: 15px; font-size: 1.1rem; line-height: 1.7; }
        .intro-text-box p:last-child { margin-bottom: 0; }
        .intro-text-box strong { color: var(--white); }
        .intro-text-box .highlight { color: var(--green); }
        
        .intro-year { font-size: 4rem; color: var(--blue); margin-bottom: 20px; }
        .intro-location { color: var(--mid-grey); text-transform: uppercase; letter-spacing: 3px; margin-bottom: 10px; }
        
        .intro-budget {
            display: inline-block;
            background: var(--green);
            color: var(--deep-navy);
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 20px;
        }
        
        .intro-nav {
            position: absolute;
            bottom: 40px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 10;
        }
        
        .intro-nav button {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .intro-nav .btn-skip { background: transparent; color: var(--mid-grey); border: 1px solid var(--slate); }
        .intro-nav .btn-skip:hover { color: var(--white); border-color: var(--white); }
        .intro-nav .btn-next { background: var(--blue); color: var(--deep-navy); }
        .intro-nav .btn-next:hover { background: #33c0f5; }
        
        .intro-dots {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }
        
        .intro-dot {
            width: 40px;
            height: 4px;
            background: var(--slate);
            border-radius: 2px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .intro-dot.active { background: var(--blue); }
        .intro-dot.done { background: var(--green); }
        
        /* ============================================
           GAME SCREEN (FIXED VIEWPORT)
           ============================================ */
        #gameScreen {
            display: none;
            position: fixed;
            inset: 0;
            flex-direction: column;
        }
        
        #gameScreen.active { display: flex; }
        
        /* Top Bar */
        .top-bar {
            height: 60px;
            background: var(--deep-navy);
            border-bottom: 1px solid var(--dark-slate);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            flex-shrink: 0;
        }
        
        .top-bar-logo img { height: 36px; }
        
        .top-bar-phase {
            background: var(--dark-slate);
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: 600;
        }
        
        .top-bar-phase .year { color: var(--blue); }
        
        .top-bar-right { display: flex; align-items: center; gap: 15px; }
        
        .top-bar-stats {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
        }
        
        .stat { display: flex; align-items: center; gap: 5px; }
        .stat-value { color: var(--white); font-weight: 600; }
        
        .btn-next-stage {
            display: none;
            padding: 10px 20px;
            background: var(--green);
            color: var(--deep-navy);
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            animation: pulse 2s infinite;
        }
        
        .btn-next-stage:hover { background: #a2e060; }
        .btn-next-stage.visible { display: block; }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(146, 208, 80, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(146, 208, 80, 0); }
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 6px;
            background: var(--dark-slate);
            flex-shrink: 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--blue), var(--green));
            transition: width 0.5s ease;
        }
        
        /* Character Banner (for stages 2-5) */
        .character-banner {
            display: none;
            align-items: center;
            gap: 15px;
            background: var(--dark-slate);
            padding: 12px 20px;
            border-left: 4px solid var(--orange);
            flex-shrink: 0;
        }
        
        .character-banner.visible { display: flex; }
        .character-banner.dave { border-color: var(--orange); }
        .character-banner.sarah { border-color: var(--blue); }
        .character-banner.mike { border-color: var(--green); }
        .character-banner.janet { border-color: var(--mid-grey); }
        
        .char-portrait {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: var(--slate);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            overflow: hidden;
        }
        
        .char-portrait img { width: 100%; height: 100%; object-fit: cover; }
        
        .char-info h4 { color: var(--white); margin-bottom: 2px; }
        .char-role { font-size: 0.85rem; color: var(--mid-grey); }
        
        /* Map Container */
        .map-container {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #1a1a2e;
        }
        
        .map-wrapper {
            position: relative;
            max-width: 100%;
            max-height: 100%;
        }
        
        .map-wrapper img {
            display: block;
            max-width: 100%;
            max-height: calc(100vh - 150px);
            object-fit: contain;
        }
        
        /* Hotspots */
        .hotspot {
            position: absolute;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 10;
        }
        
        .hotspot-dot {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(0, 176, 240, 0.3);
            border: 3px solid var(--blue);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            animation: hotspotPulse 2s infinite;
        }
        
        .hotspot:hover .hotspot-dot {
            transform: scale(1.15);
            background: rgba(0, 176, 240, 0.5);
        }
        
        .hotspot-dot.done {
            background: rgba(146, 208, 80, 0.3);
            border-color: var(--green);
            animation: none;
        }
        
        .hotspot-dot.done::after {
            content: '‚úì';
            color: var(--green);
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .hotspot-dot.issue {
            background: rgba(220, 38, 38, 0.3);
            border-color: var(--red);
            animation: none;
        }
        
        .hotspot-dot.issue::after {
            content: '!';
            color: var(--red);
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .hotspot-label {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(31, 41, 55, 0.95);
            color: var(--white);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .hotspot:hover .hotspot-label { opacity: 1; }
        
        @keyframes hotspotPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 176, 240, 0.4); }
            50% { box-shadow: 0 0 0 12px rgba(0, 176, 240, 0); }
        }
        
        /* Bottom Info */
        .bottom-bar {
            height: 50px;
            background: var(--deep-navy);
            border-top: 1px solid var(--dark-slate);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            flex-shrink: 0;
        }
        
        .progress-dots {
            display: flex;
            gap: 8px;
        }
        
        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--slate);
            transition: all 0.3s;
        }
        
        .progress-dot.done { background: var(--green); }
        .progress-dot.current { background: var(--blue); box-shadow: 0 0 0 3px rgba(0, 176, 240, 0.3); }
        
        .progress-label { color: var(--mid-grey); font-size: 0.9rem; }
        
        /* ============================================
           MODAL (POPUP)
           ============================================ */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 500;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay.active { display: flex; }
        
        .modal {
            background: var(--dark-slate);
            border-radius: 12px;
            width: 90%;
            max-width: 550px;
            max-height: 85vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }
        
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--slate);
        }
        
        .modal-header h3 { color: var(--white); font-size: 1.2rem; }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--mid-grey);
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
        }
        
        .modal-close:hover { color: var(--white); }
        
        .modal-body { padding: 20px; }
        
        .modal-description { color: var(--light-grey); margin-bottom: 20px; }
        
        /* Design Choices */
        .choice-list { display: flex; flex-direction: column; gap: 12px; }
        
        .choice-item {
            background: var(--slate);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .choice-item:hover { border-color: var(--blue); }
        .choice-item.selected { border-color: var(--green); background: rgba(146, 208, 80, 0.1); }
        
        .choice-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .choice-name { color: var(--white); font-weight: 500; }
        
        .choice-cost {
            background: var(--deep-navy);
            color: var(--amber);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .choice-desc { color: var(--light-grey); font-size: 0.9rem; }
        
        .choice-image {
            width: 100%;
            height: 60px;
            background: var(--deep-navy);
            border-radius: 4px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--mid-grey);
            font-size: 0.75rem;
        }
        
        /* Outcome Display */
        .outcome-section { margin-bottom: 20px; }
        
        .outcome-character {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            background: var(--slate);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .outcome-character .char-portrait { flex-shrink: 0; }
        
        .outcome-name { color: var(--white); font-weight: 500; margin-bottom: 5px; }
        .outcome-quote { font-style: italic; color: var(--light-grey); line-height: 1.5; }
        
        .outcome-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            background: var(--slate);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .outcome-stat { text-align: center; }
        .outcome-stat-value { font-size: 1.3rem; font-weight: 600; color: var(--white); }
        .outcome-stat-value.bad { color: var(--red); }
        .outcome-stat-label { font-size: 0.75rem; color: var(--mid-grey); text-transform: uppercase; }
        
        .outcome-recall {
            background: var(--deep-navy);
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: var(--mid-grey);
        }
        
        .outcome-recall strong { color: var(--white); }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--slate);
            display: flex;
            justify-content: flex-end;
        }
        
        .modal-footer button {
            padding: 10px 25px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-confirm { background: var(--blue); color: var(--deep-navy); }
        .btn-confirm:hover { background: #33c0f5; }
        .btn-confirm:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* ============================================
           TRANSITION SCREEN
           ============================================ */
        #transitionScreen {
            display: none;
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 600;
            align-items: center;
            justify-content: center;
        }
        
        #transitionScreen.active { display: flex; }
        
        .transition-content {
            text-align: center;
            max-width: 600px;
            padding: 40px;
        }
        
        .transition-years {
            color: var(--mid-grey);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }
        
        .transition-year {
            font-size: 5rem;
            color: var(--white);
            margin-bottom: 30px;
        }
        
        .transition-text {
            background: var(--dark-slate);
            padding: 25px;
            border-radius: 10px;
            text-align: left;
            margin-bottom: 30px;
        }
        
        .transition-text p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        
        .transition-text p:last-child { margin-bottom: 0; }
        
        .btn-continue {
            padding: 12px 30px;
            background: var(--blue);
            color: var(--deep-navy);
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-continue:hover { background: #33c0f5; }
        
        /* ============================================
           SUMMARY SCREEN
           ============================================ */
        #summaryScreen {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--deep-navy);
            z-index: 600;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }
        
        #summaryScreen.active { display: flex; }
        
        .summary-content {
            max-width: 700px;
            padding: 40px 20px;
            text-align: center;
        }
        
        .summary-title { font-size: 2rem; color: var(--white); margin-bottom: 10px; }
        .summary-subtitle { color: var(--mid-grey); margin-bottom: 30px; }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .summary-stat {
            background: var(--dark-slate);
            padding: 20px 10px;
            border-radius: 8px;
        }
        
        .summary-stat-icon { font-size: 1.5rem; margin-bottom: 8px; }
        .summary-stat-value { font-size: 1.3rem; font-weight: 600; color: var(--white); }
        .summary-stat-label { font-size: 0.7rem; color: var(--mid-grey); text-transform: uppercase; margin-top: 5px; }
        
        .summary-decisions {
            background: var(--dark-slate);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: left;
        }
        
        .summary-decisions h4 { color: var(--white); margin-bottom: 15px; }
        
        .decision-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--slate);
        }
        
        .decision-row:last-child { border-bottom: none; }
        
        .decision-element { color: var(--white); }
        
        .decision-result {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-tag {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .result-tag.good { background: var(--green); color: var(--deep-navy); }
        .result-tag.ok { background: var(--amber); color: var(--deep-navy); }
        .result-tag.poor { background: var(--red); color: var(--white); }
        
        .btn-next-phase {
            padding: 12px 30px;
            background: var(--green);
            color: var(--deep-navy);
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-next-phase:hover { background: #a2e060; }
        
        /* ============================================
           FINAL RESULTS
           ============================================ */
        #resultsScreen {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--deep-navy);
            z-index: 600;
            align-items: center;
            justify-content: center;
        }
        
        #resultsScreen.active { display: flex; }
        
        .results-content { text-align: center; max-width: 600px; padding: 40px; }
        
        .results-grade {
            font-size: 8rem;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .results-grade.A { color: var(--green); }
        .results-grade.B { color: var(--blue); }
        .results-grade.C { color: var(--amber); }
        .results-grade.D { color: var(--red); }
        
        .results-title { font-size: 1.5rem; color: var(--white); margin-bottom: 30px; }
        
        .results-totals {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            background: var(--dark-slate);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .results-total { text-align: center; }
        .results-total-value { font-size: 1.5rem; font-weight: 600; color: var(--white); }
        .results-total-label { font-size: 0.8rem; color: var(--mid-grey); }
        
        .btn-restart {
            padding: 12px 30px;
            background: var(--blue);
            color: var(--deep-navy);
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Mobile */
        @media (max-width: 600px) {
            .top-bar-stats { display: none; }
            .summary-stats { grid-template-columns: repeat(2, 1fr); }
            .outcome-stats { grid-template-columns: 1fr; }
            .intro-title { font-size: 2rem; }
        }
    </style>
</head>
<body>

<!-- ============================================
     CINEMATIC INTRO
     ============================================ -->
<div id="cinematicIntro">
    <div class="intro-slide active" data-slide="1">
        <div class="bg dark"></div>
        <div class="intro-content">
            <div class="intro-logo">
                <img src="../00_images/Logo_White_Nobackground.png" alt="The Nuclear House">
            </div>
            <p class="intro-company">Presents</p>
            <h1 class="intro-title">The 60-Year Journey</h1>
            <p class="intro-subtitle">An interactive experience in design for decommissioning</p>
        </div>
    </div>
    
    <div class="intro-slide" data-slide="2">
        <div class="bg" style="background-image: url('images/gamebackground.png');"></div>
        <div class="intro-content">
            <p class="intro-location">Somerset Coast, UK</p>
            <h2 class="intro-year">2025</h2>
            <div class="intro-text-box">
                <p><strong>Thornbury Point Nuclear Power Station.</strong></p>
                <p>A new generation of clean energy. Sixty years of operation ahead.</p>
                <p>And someone needs to design it right.</p>
            </div>
        </div>
    </div>
    
    <div class="intro-slide" data-slide="3">
        <div class="bg" style="background-image: url('images/gamebackground.png');"></div>
        <div class="intro-content">
            <div class="intro-text-box">
                <p>You've just been assigned your first major project: <span class="highlight">Section 4B</span> of Thornbury Point.</p>
                <p>Primary coolant system auxiliaries. Pumps, pipes, welds, and control interfaces.</p>
                <p>Your design will be built, operated, inspected, and eventually decommissioned over <strong>sixty years</strong>.</p>
            </div>
        </div>
    </div>
    
    <div class="intro-slide" data-slide="4">
        <div class="bg dark"></div>
        <div class="intro-content">
            <div class="intro-text-box" style="text-align: center; border-left: none; border: 2px solid var(--blue);">
                <p><strong>Six design decisions. Each has consequences.</strong></p>
                <p>Four people will inherit your choices over the decades.</p>
                <p>Their success ‚Äî or failure ‚Äî depends on what you decide now.</p>
                <div class="intro-budget">Budget: ¬£800,000</div>
            </div>
        </div>
    </div>
    
    <div class="intro-dots">
        <div class="intro-dot active" data-dot="1"></div>
        <div class="intro-dot" data-dot="2"></div>
        <div class="intro-dot" data-dot="3"></div>
        <div class="intro-dot" data-dot="4"></div>
    </div>
    
    <div class="intro-nav">
        <button class="btn-skip" id="btnSkip">Skip</button>
        <button class="btn-next" id="btnIntroNext">Continue ‚Üí</button>
    </div>
</div>

<!-- ============================================
     MAIN GAME SCREEN
     ============================================ -->
<div id="gameScreen">
    <div class="top-bar">
        <div class="top-bar-logo">
            <img src="../00_images/Logo_White_Nobackground.png" alt="Logo">
        </div>
        <div class="top-bar-phase">
            <span id="phaseName">PHASE 1: DESIGN</span> ‚Äî <span class="year" id="phaseYear">2025</span>
        </div>
        <div class="top-bar-right">
            <div class="top-bar-stats" id="topStats">
                <div class="stat">üí∞ <span class="stat-value" id="statBudget">¬£800,000</span></div>
            </div>
            <button class="btn-next-stage" id="btnNextStage">Next Stage ‚Üí</button>
        </div>
    </div>
    
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
    </div>
    
    <div class="character-banner" id="characterBanner">
        <div class="char-portrait" id="charPortrait">üë∑</div>
        <div class="char-info">
            <h4 id="charName">Dave Morton</h4>
            <p class="char-role" id="charRole">Maintenance Supervisor</p>
        </div>
    </div>
    
    <div class="map-container">
        <div class="map-wrapper">
            <img src="images/gamebackground.png" alt="Section 4B">
            
            <div class="hotspot" data-element="pumpAccess" style="left: 18%; top: 52%;">
                <div class="hotspot-dot" id="dotPump"></div>
                <span class="hotspot-label">Pump Access</span>
            </div>
            
            <div class="hotspot" data-element="weldClearance" style="left: 42%; top: 46%;">
                <div class="hotspot-dot" id="dotWeld"></div>
                <span class="hotspot-label">Weld Clearance</span>
            </div>
            
            <div class="hotspot" data-element="controlPanel" style="left: 85%; top: 42%;">
                <div class="hotspot-dot" id="dotControl"></div>
                <span class="hotspot-label">Control Panel</span>
            </div>
            
            <div class="hotspot" data-element="pipeConnections" style="left: 56%; top: 52%;">
                <div class="hotspot-dot" id="dotConnections"></div>
                <span class="hotspot-label">Pipe Connections</span>
            </div>
            
            <div class="hotspot" data-element="pipeRouting" style="left: 62%; top: 82%;">
                <div class="hotspot-dot" id="dotRouting"></div>
                <span class="hotspot-label">Pipe Routing</span>
            </div>
            
            <div class="hotspot" data-element="materialSpec" style="left: 32%; top: 58%;">
                <div class="hotspot-dot" id="dotMaterial"></div>
                <span class="hotspot-label">Material Spec</span>
            </div>
        </div>
    </div>
    
    <div class="bottom-bar">
        <div class="progress-dots" id="progressDots">
            <div class="progress-dot current" data-stage="1"></div>
            <div class="progress-dot" data-stage="2"></div>
            <div class="progress-dot" data-stage="3"></div>
            <div class="progress-dot" data-stage="4"></div>
            <div class="progress-dot" data-stage="5"></div>
        </div>
        <span class="progress-label" id="progressLabel">0 of 6 complete</span>
    </div>
</div>

<!-- ============================================
     MODAL POPUP
     ============================================ -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal">
        <div class="modal-header">
            <h3 id="modalTitle">Element</h3>
            <button class="modal-close" id="modalClose">√ó</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-footer">
            <button class="btn-confirm" id="modalConfirm">Confirm</button>
        </div>
    </div>
</div>

<!-- ============================================
     TRANSITION SCREEN
     ============================================ -->
<div id="transitionScreen">
    <div class="transition-content">
        <p class="transition-years" id="transYears">15 YEARS LATER</p>
        <h2 class="transition-year" id="transYear">2040</h2>
        <div class="transition-text" id="transText"></div>
        <button class="btn-continue" id="btnTransContinue">Continue ‚Üí</button>
    </div>
</div>

<!-- ============================================
     SUMMARY SCREEN
     ============================================ -->
<div id="summaryScreen">
    <div class="summary-content">
        <h2 class="summary-title" id="sumTitle">Phase Complete</h2>
        <p class="summary-subtitle" id="sumSubtitle">Year 2025</p>
        
        <div class="summary-stats" id="sumStats"></div>
        
        <div class="summary-decisions">
            <h4>Decisions</h4>
            <div id="sumDecisions"></div>
        </div>
        
        <button class="btn-next-phase" id="btnNextPhase">Next Phase ‚Üí</button>
    </div>
</div>

<!-- ============================================
     FINAL RESULTS
     ============================================ -->
<div id="resultsScreen">
    <div class="results-content">
        <div class="results-grade" id="resGrade">B</div>
        <h2 class="results-title">60 Years Complete</h2>
        
        <div class="results-totals">
            <div class="results-total">
                <div class="results-total-value" id="resTotalCost">¬£0</div>
                <div class="results-total-label">Total Cost</div>
            </div>
            <div class="results-total">
                <div class="results-total-value" id="resTotalDose">0 mSv</div>
                <div class="results-total-label">Total Dose</div>
            </div>
            <div class="results-total">
                <div class="results-total-value" id="resTotalTime">0 days</div>
                <div class="results-total-label">Total Time</div>
            </div>
        </div>
        
        <button class="btn-restart" onclick="location.reload()">Play Again</button>
    </div>
</div>

<script>
// ============================================
// DATA
// ============================================
const DATA = {
    phases: {
        1: { name: 'DESIGN', year: 2025, budget: 800000 },
        2: { name: 'MAINTENANCE', year: 2040, char: 'dave' },
        3: { name: 'INSPECTION', year: 2055, char: 'sarah' },
        4: { name: 'OPERATIONS', year: 2070, char: 'mike' },
        5: { name: 'DECOMMISSIONING', year: 2085, char: 'janet' }
    },
    
    characters: {
        dave: { name: 'Dave Morton', role: 'Maintenance Supervisor', portrait: 'images/dave.png', emoji: 'üë∑' },
        sarah: { name: 'Sarah Okonkwo', role: 'Principal Inspector', portrait: null, emoji: 'üîç' },
        mike: { name: 'Mike Brennan', role: 'Shift Operations Manager', portrait: null, emoji: 'üë®‚Äçüíº' },
        janet: { name: 'Janet Cole', role: 'Decommissioning Lead', portrait: 'images/janet.png', emoji: 'üë©‚Äçüîß' }
    },
    
    elements: {
        pumpAccess: {
            title: 'Pump Access',
            desc: 'How should the primary coolant pump be positioned?',
            options: [
                { id: 'corner', name: 'Corner Position', desc: 'Tucked in corner. 1.8m clearance.', cost: 120000, quality: 'poor' },
                { id: 'openBay', name: 'Open Bay', desc: '2m clearance all sides, under crane.', cost: 150000, quality: 'good' },
                { id: 'dedicated', name: 'Dedicated Room', desc: 'Shielded room with airlock. Over-spec.', cost: 290000, quality: 'wasteful' }
            ],
            outcomes: {
                2: {
                    corner: { time: 8, dose: 4, cost: 80000, quote: "Who signed off on this? The pump's in a corner." },
                    openBay: { time: 3, dose: 1, cost: 30000, quote: "Full crane coverage. In and out, job done." },
                    dedicated: { time: 4, dose: 0.5, cost: 40000, quote: "Nice room, but overkill for a standard pump." }
                },
                3: {
                    corner: { time: 4, dose: 2, cost: 40000, quote: "Can barely fit equipment in. Limited coverage." },
                    openBay: { time: 2, dose: 0.5, cost: 20000, quote: "Full access. This is how it should be." },
                    dedicated: { time: 2, dose: 0.3, cost: 25000, quote: "Good access, airlock slows things down." }
                },
                4: {
                    corner: { time: 2, dose: 1, cost: 20000, quote: "Emergency access is tight. Precious seconds lost." },
                    openBay: { time: 1, dose: 0.2, cost: 10000, quote: "Clear sightlines, easy access." },
                    dedicated: { time: 1, dose: 0.1, cost: 15000, quote: "Airlock is overkill but accessible." }
                },
                5: {
                    corner: { time: 12, dose: 5, cost: 200000, quote: "Tight space means manual cutting. Months of work." },
                    openBay: { time: 5, dose: 2, cost: 80000, quote: "Straight lift out. Coming apart clean." },
                    dedicated: { time: 6, dose: 1, cost: 100000, quote: "Easy removal, but the room needs decon too." }
                }
            }
        },
        weldClearance: {
            title: 'Weld Clearance',
            desc: 'What clearance around pipe welds for inspection?',
            options: [
                { id: '50mm', name: '50mm (Code Min)', desc: 'Minimum code clearance.', cost: 90000, quality: 'poor' },
                { id: '150mm', name: '150mm Clearance', desc: 'Good for all inspection probes.', cost: 95000, quality: 'good' },
                { id: '300mm', name: '300mm + Scaffold', desc: 'Generous with permanent scaffold.', cost: 180000, quality: 'wasteful' }
            ],
            outcomes: {
                2: {
                    '50mm': { time: 6, dose: 3, cost: 60000, quote: "50mm. Just because you can doesn't mean you should." },
                    '150mm': { time: 2, dose: 1, cost: 20000, quote: "Proper clearance. Job's straightforward." },
                    '300mm': { time: 2, dose: 0.5, cost: 25000, quote: "Plenty of room, but scaffold's contaminated now." }
                },
                3: {
                    '50mm': { time: 5, dose: 3, cost: 50000, quote: "Writing 'limited coverage' on this report." },
                    '150mm': { time: 2, dose: 0.5, cost: 20000, quote: "Adequate probe positioning. No issues." },
                    '300mm': { time: 1, dose: 0.3, cost: 15000, quote: "Easy access, scaffold blocks some angles." }
                },
                4: {
                    '50mm': { time: 1, dose: 0.5, cost: 10000, quote: "Hard to see weld indicators." },
                    '150mm': { time: 0, dose: 0, cost: 5000, quote: "Good visibility of inspection points." },
                    '300mm': { time: 0, dose: 0, cost: 5000, quote: "No operational issues." }
                },
                5: {
                    '50mm': { time: 8, dose: 4, cost: 150000, quote: "Can't get cutting equipment in. Manual job." },
                    '150mm': { time: 3, dose: 1, cost: 50000, quote: "Standard removal. No surprises." },
                    '300mm': { time: 4, dose: 2, cost: 80000, quote: "Contaminated scaffolding to deal with too." }
                }
            }
        },
        controlPanel: {
            title: 'Control Panel',
            desc: 'How should the control panel be organised?',
            options: [
                { id: 'system', name: 'System-Based', desc: 'Grouped by system. Logical for engineers.', cost: 85000, quality: 'poor' },
                { id: 'task', name: 'Task-Based', desc: 'Grouped by workflow. Emergency left-to-right.', cost: 95000, quality: 'good' },
                { id: 'touch', name: 'Touchscreen', desc: 'Sleek displays. Impressive in demos.', cost: 180000, quality: 'poor' }
            ],
            outcomes: {
                2: {
                    system: { time: 1, dose: 0, cost: 5000, quote: "Panel's fine for routine work." },
                    task: { time: 0, dose: 0, cost: 5000, quote: "Easy to isolate systems. Logical layout." },
                    touch: { time: 2, dose: 0, cost: 15000, quote: "Touch screens need calibration. Again." }
                },
                3: {
                    system: { time: 0, dose: 0, cost: 5000, quote: "No inspection issues." },
                    task: { time: 0, dose: 0, cost: 5000, quote: "Clear system status indication." },
                    touch: { time: 1, dose: 0, cost: 10000, quote: "Display artifacts. Software update needed." }
                },
                4: {
                    system: { time: 3, dose: 0, cost: 30000, quote: "3am, alarms everywhere, can't find isolation valve." },
                    task: { time: 0, dose: 0, cost: 5000, quote: "Found controls immediately. Good design." },
                    touch: { time: 5, dose: 0, cost: 50000, quote: "Touchscreen's frozen. Again. Mid-event." }
                },
                5: {
                    system: { time: 1, dose: 0, cost: 10000, quote: "Panel removal straightforward." },
                    task: { time: 1, dose: 0, cost: 10000, quote: "Standard panel removal." },
                    touch: { time: 2, dose: 0, cost: 30000, quote: "Electronic waste. Special disposal." }
                }
            }
        },
        pipeConnections: {
            title: 'Pipe Connections',
            desc: 'How should pipe joints be designed?',
            options: [
                { id: 'flanged', name: 'Flanged', desc: 'Bolted flanges. Easy disassembly.', cost: 160000, quality: 'good' },
                { id: 'mixed', name: 'Mixed', desc: 'Flanges accessible, welded elsewhere.', cost: 170000, quality: 'ok' },
                { id: 'welded', name: 'All Welded', desc: 'Continuous welds. Max integrity.', cost: 180000, quality: 'poor' }
            ],
            outcomes: {
                2: {
                    flanged: { time: 2, dose: 1, cost: 20000, quote: "Flanged connections. Someone thought ahead." },
                    mixed: { time: 4, dose: 2, cost: 40000, quote: "Some flanges, some welds. Could be worse." },
                    welded: { time: 8, dose: 4, cost: 80000, quote: "All welded. Cutting and re-welding then." }
                },
                3: {
                    flanged: { time: 1, dose: 0.5, cost: 10000, quote: "Can remove sections for detailed inspection." },
                    mixed: { time: 2, dose: 1, cost: 20000, quote: "Some joints accessible, others not." },
                    welded: { time: 3, dose: 2, cost: 35000, quote: "In-situ only. Limited coverage." }
                },
                4: {
                    flanged: { time: 0, dose: 0, cost: 5000, quote: "Quick isolation possible in emergencies." },
                    mixed: { time: 1, dose: 0, cost: 10000, quote: "Most isolation points accessible." },
                    welded: { time: 2, dose: 0, cost: 20000, quote: "Can't isolate quickly. Shut down more than needed." }
                },
                5: {
                    flanged: { time: 3, dose: 1, cost: 40000, quote: "Unbolt, remove, done. How it should be." },
                    mixed: { time: 6, dose: 3, cost: 100000, quote: "Flanges easy, welds need cutting. Mixed bag." },
                    welded: { time: 10, dose: 5, cost: 180000, quote: "Every joint needs cutting. Takes forever." }
                }
            }
        },
        pipeRouting: {
            title: 'Pipe Routing',
            desc: 'How should pipes run through concrete?',
            options: [
                { id: 'embedded', name: 'Embedded', desc: 'Cast into structural concrete.', cost: 140000, quality: 'poor' },
                { id: 'ducted', name: 'Accessible Ducts', desc: 'Removable duct covers.', cost: 165000, quality: 'good' },
                { id: 'tunnel', name: 'Walk-In Tunnel', desc: 'Large tunnel for all services.', cost: 280000, quality: 'wasteful' }
            ],
            outcomes: {
                2: {
                    embedded: { time: 0, dose: 0, cost: 5000, quote: "Can't access these pipes. Hope nothing fails." },
                    ducted: { time: 2, dose: 1, cost: 20000, quote: "Duct covers off, full access. Proper design." },
                    tunnel: { time: 1, dose: 0.5, cost: 15000, quote: "Walk-in is nice. Did we need this much?" }
                },
                3: {
                    embedded: { time: 0, dose: 0, cost: 5000, quote: "Embedded in concrete. Guessing what's in there." },
                    ducted: { time: 2, dose: 0.5, cost: 15000, quote: "Full visual and probe access." },
                    tunnel: { time: 1, dose: 0.3, cost: 12000, quote: "Easy inspection access." }
                },
                4: {
                    embedded: { time: 2, dose: 0, cost: 20000, quote: "Leak detected. Can't find it. Somewhere in concrete." },
                    ducted: { time: 0, dose: 0, cost: 5000, quote: "Quick visual confirms system status." },
                    tunnel: { time: 0, dose: 0, cost: 5000, quote: "Easy walkthrough." }
                },
                5: {
                    embedded: { time: 15, dose: 8, cost: 300000, quote: "Embedded. Six months extra, half a million more." },
                    ducted: { time: 4, dose: 2, cost: 60000, quote: "Pull covers, extract pipes. Straightforward." },
                    tunnel: { time: 3, dose: 1, cost: 50000, quote: "Easy access. Tunnel needs decon though." }
                }
            }
        },
        materialSpec: {
            title: 'Material Spec',
            desc: 'What material for primary circuit pipes?',
            options: [
                { id: 'standard', name: 'Standard SS', desc: '2,500 ppm cobalt. Industry standard.', cost: 200000, quality: 'poor' },
                { id: 'lowCobalt', name: 'Low-Cobalt SS', desc: '<500 ppm cobalt. Less activation.', cost: 250000, quality: 'good' },
                { id: 'exotic', name: 'Exotic Alloy', desc: 'High-performance nickel alloy.', cost: 400000, quality: 'poor' }
            ],
            outcomes: {
                2: {
                    standard: { time: 1, dose: 2, cost: 15000, quote: "Standard steel. Hot to work on but expected." },
                    lowCobalt: { time: 1, dose: 0.5, cost: 12000, quote: "Low-cobalt. Noticeably lower dose rates." },
                    exotic: { time: 2, dose: 1, cost: 25000, quote: "Special procedures for this alloy." }
                },
                3: {
                    standard: { time: 1, dose: 1.5, cost: 12000, quote: "Standard material. Higher background." },
                    lowCobalt: { time: 1, dose: 0.3, cost: 10000, quote: "Clean material, easy to work around." },
                    exotic: { time: 1, dose: 0.5, cost: 15000, quote: "Good properties but finicky to inspect." }
                },
                4: {
                    standard: { time: 0, dose: 0.5, cost: 5000, quote: "No operational difference." },
                    lowCobalt: { time: 0, dose: 0.1, cost: 5000, quote: "Lower dose during rounds." },
                    exotic: { time: 0, dose: 0.2, cost: 5000, quote: "Performs well operationally." }
                },
                5: {
                    standard: { time: 8, dose: 10, cost: 200000, quote: "2,500 ppm cobalt. Decades to cool down." },
                    lowCobalt: { time: 4, dose: 2, cost: 80000, quote: "Low activation. Can handle it sooner." },
                    exotic: { time: 6, dose: 3, cost: 150000, quote: "Special disposal for this alloy." }
                }
            }
        }
    },
    
    transitions: {
        2: { years: '15 YEARS LATER', year: '2040', text: ['Thornbury Point has been generating power for 14 years.', 'Your design drawings are yellowed paper in a filing cabinet.', 'But your decisions are very much alive.', 'Time for the first major maintenance outage.'] },
        3: { years: '15 YEARS LATER', year: '2055', text: ['Thirty years of operation.', 'Regulators want proof everything is still safe.', 'Every weld, every pipe needs inspection.'] },
        4: { years: '15 YEARS LATER', year: '2070', text: ['Forty-five years. The plant shows its age.', 'Tonight, alarms will test your control room design.'] },
        5: { years: '15 YEARS LATER', year: '2085', text: ['Sixty years. Reactor shut down for good.', 'Now comes the hard part: taking it apart safely.', 'Every 2025 decision led to this moment.'] }
    }
};

// ============================================
// STATE
// ============================================
const STATE = {
    phase: 1,
    choices: {},      // Design choices from phase 1
    completed: {},    // Completed elements per phase
    totals: { cost: 0, dose: 0, time: 0 }
};

// ============================================
// INTRO
// ============================================
let currentSlide = 1;
const totalSlides = 4;

function updateSlide() {
    document.querySelectorAll('.intro-slide').forEach(s => s.classList.remove('active'));
    document.querySelector(`.intro-slide[data-slide="${currentSlide}"]`).classList.add('active');
    
    document.querySelectorAll('.intro-dot').forEach((d, i) => {
        d.classList.remove('active', 'done');
        if (i + 1 === currentSlide) d.classList.add('active');
        else if (i + 1 < currentSlide) d.classList.add('done');
    });
    
    document.getElementById('btnIntroNext').textContent = currentSlide === totalSlides ? 'Begin ‚Üí' : 'Continue ‚Üí';
}

function nextSlide() {
    if (currentSlide < totalSlides) {
        currentSlide++;
        updateSlide();
    } else {
        endIntro();
    }
}

function endIntro() {
    document.getElementById('cinematicIntro').classList.add('hidden');
    document.getElementById('gameScreen').classList.add('active');
    startPhase(1);
}

document.getElementById('btnIntroNext').onclick = nextSlide;
document.getElementById('btnSkip').onclick = endIntro;
document.querySelectorAll('.intro-dot').forEach(d => {
    d.onclick = () => { currentSlide = parseInt(d.dataset.dot); updateSlide(); };
});

// ============================================
// GAME
// ============================================
function startPhase(phaseNum) {
    STATE.phase = phaseNum;
    STATE.completed[phaseNum] = {};
    
    const phase = DATA.phases[phaseNum];
    
    // Update header
    document.getElementById('phaseName').textContent = `PHASE ${phaseNum}: ${phase.name}`;
    document.getElementById('phaseYear').textContent = phase.year;
    
    // Stats display
    if (phaseNum === 1) {
        document.getElementById('topStats').innerHTML = `<div class="stat">üí∞ <span class="stat-value" id="statBudget">¬£${phase.budget.toLocaleString()}</span></div>`;
    } else {
        document.getElementById('topStats').innerHTML = `
            <div class="stat">üí∞ <span class="stat-value">¬£0</span></div>
            <div class="stat">‚ò¢Ô∏è <span class="stat-value">0 mSv</span></div>
            <div class="stat">‚è±Ô∏è <span class="stat-value">0 days</span></div>
        `;
    }
    
    // Character banner
    const banner = document.getElementById('characterBanner');
    if (phaseNum > 1 && phase.char) {
        const char = DATA.characters[phase.char];
        banner.className = `character-banner visible ${phase.char}`;
        document.getElementById('charPortrait').innerHTML = char.portrait 
            ? `<img src="${char.portrait}" alt="${char.name}">` 
            : char.emoji;
        document.getElementById('charName').textContent = char.name;
        document.getElementById('charRole').textContent = char.role;
    } else {
        banner.classList.remove('visible');
    }
    
    // Reset hotspots
    document.querySelectorAll('.hotspot-dot').forEach(d => {
        d.classList.remove('done', 'issue');
    });
    
    // Update progress
    document.querySelectorAll('.progress-dot').forEach((d, i) => {
        d.classList.remove('current', 'done');
        if (i + 1 === phaseNum) d.classList.add('current');
        else if (i + 1 < phaseNum) d.classList.add('done');
    });
    
    document.getElementById('progressFill').style.width = `${(phaseNum - 1) * 25}%`;
    
    // Hide next stage button
    document.getElementById('btnNextStage').classList.remove('visible');
    
    updateProgressLabel();
}

function updateProgressLabel() {
    const done = Object.keys(STATE.completed[STATE.phase] || {}).length;
    document.getElementById('progressLabel').textContent = `${done} of 6 complete`;
    
    if (done === 6) {
        document.getElementById('btnNextStage').classList.add('visible');
    }
}

// ============================================
// HOTSPOT CLICKS
// ============================================
document.querySelectorAll('.hotspot').forEach(h => {
    h.onclick = () => {
        const el = h.dataset.element;
        if (STATE.completed[STATE.phase]?.[el]) return;
        
        if (STATE.phase === 1) {
            showDesignModal(el);
        } else {
            showOutcomeModal(el);
        }
    };
});

// ============================================
// MODALS
// ============================================
function openModal() {
    document.getElementById('modalOverlay').classList.add('active');
}

function closeModal() {
    document.getElementById('modalOverlay').classList.remove('active');
}

document.getElementById('modalClose').onclick = closeModal;
document.getElementById('modalOverlay').onclick = (e) => {
    if (e.target.id === 'modalOverlay') closeModal();
};

function showDesignModal(elementId) {
    const el = DATA.elements[elementId];
    document.getElementById('modalTitle').textContent = el.title;
    
    let html = `<p class="modal-description">${el.desc}</p><div class="choice-list">`;
    el.options.forEach(opt => {
        const sel = STATE.choices[elementId] === opt.id ? 'selected' : '';
        html += `
            <div class="choice-item ${sel}" data-id="${opt.id}">
                <div class="choice-image">[Image: ${opt.name}]</div>
                <div class="choice-top">
                    <span class="choice-name">${opt.name}</span>
                    <span class="choice-cost">¬£${opt.cost.toLocaleString()}</span>
                </div>
                <p class="choice-desc">${opt.desc}</p>
            </div>
        `;
    });
    html += '</div>';
    
    document.getElementById('modalBody').innerHTML = html;
    
    let selected = STATE.choices[elementId] || null;
    document.querySelectorAll('.choice-item').forEach(item => {
        item.onclick = () => {
            document.querySelectorAll('.choice-item').forEach(i => i.classList.remove('selected'));
            item.classList.add('selected');
            selected = item.dataset.id;
        };
    });
    
    const btn = document.getElementById('modalConfirm');
    btn.textContent = 'Confirm';
    btn.onclick = () => {
        if (!selected) return;
        
        const opt = el.options.find(o => o.id === selected);
        
        // Refund old if changing
        if (STATE.choices[elementId]) {
            const old = el.options.find(o => o.id === STATE.choices[elementId]);
            STATE.totals.cost -= old.cost;
        }
        
        STATE.choices[elementId] = selected;
        STATE.completed[1][elementId] = true;
        STATE.totals.cost += opt.cost;
        
        // Update hotspot
        const dot = document.querySelector(`[data-element="${elementId}"] .hotspot-dot`);
        dot.classList.add('done');
        
        // Update budget
        const remaining = DATA.phases[1].budget - STATE.totals.cost;
        document.getElementById('statBudget').textContent = `¬£${remaining.toLocaleString()}`;
        
        updateProgressLabel();
        closeModal();
    };
    
    openModal();
}

function showOutcomeModal(elementId) {
    const el = DATA.elements[elementId];
    const choice = STATE.choices[elementId];
    const outcome = el.outcomes[STATE.phase][choice];
    const opt = el.options.find(o => o.id === choice);
    const char = DATA.characters[DATA.phases[STATE.phase].char];
    
    document.getElementById('modalTitle').textContent = el.title;
    
    const html = `
        <div class="outcome-section">
            <div class="outcome-character">
                <div class="char-portrait">${char.portrait ? `<img src="${char.portrait}">` : char.emoji}</div>
                <div>
                    <div class="outcome-name">${char.name}</div>
                    <p class="outcome-quote">"${outcome.quote}"</p>
                </div>
            </div>
            
            <div class="outcome-stats">
                <div class="outcome-stat">
                    <div class="outcome-stat-value ${outcome.time > 5 ? 'bad' : ''}">${outcome.time} days</div>
                    <div class="outcome-stat-label">Time</div>
                </div>
                <div class="outcome-stat">
                    <div class="outcome-stat-value ${outcome.dose > 3 ? 'bad' : ''}">${outcome.dose} mSv</div>
                    <div class="outcome-stat-label">Dose</div>
                </div>
                <div class="outcome-stat">
                    <div class="outcome-stat-value ${outcome.cost > 80000 ? 'bad' : ''}">¬£${outcome.cost.toLocaleString()}</div>
                    <div class="outcome-stat-label">Cost</div>
                </div>
            </div>
            
            <div class="outcome-recall">
                <strong>Your 2025 choice:</strong> ${opt.name}
            </div>
        </div>
    `;
    
    document.getElementById('modalBody').innerHTML = html;
    
    const btn = document.getElementById('modalConfirm');
    btn.textContent = 'Continue';
    btn.onclick = () => {
        STATE.completed[STATE.phase][elementId] = true;
        STATE.totals.cost += outcome.cost;
        STATE.totals.dose += outcome.dose;
        STATE.totals.time += outcome.time;
        
        // Update hotspot
        const dot = document.querySelector(`[data-element="${elementId}"] .hotspot-dot`);
        if (outcome.time > 5 || outcome.dose > 3 || outcome.cost > 80000) {
            dot.classList.add('issue');
        } else {
            dot.classList.add('done');
        }
        
        updateProgressLabel();
        closeModal();
    };
    
    openModal();
}

// ============================================
// NEXT STAGE
// ============================================
document.getElementById('btnNextStage').onclick = showSummary;

function showSummary() {
    const phase = DATA.phases[STATE.phase];
    
    document.getElementById('sumTitle').textContent = `${phase.name} Complete`;
    document.getElementById('sumSubtitle').textContent = `Year ${phase.year}`;
    
    // Stats
    let statsHtml = '';
    if (STATE.phase === 1) {
        statsHtml = `
            <div class="summary-stat"><div class="summary-stat-icon">üí∞</div><div class="summary-stat-value">¬£${STATE.totals.cost.toLocaleString()}</div><div class="summary-stat-label">Spent</div></div>
            <div class="summary-stat"><div class="summary-stat-icon">üìã</div><div class="summary-stat-value">6</div><div class="summary-stat-label">Decisions</div></div>
            <div class="summary-stat"><div class="summary-stat-icon">üìÖ</div><div class="summary-stat-value">60 yrs</div><div class="summary-stat-label">Ahead</div></div>
            <div class="summary-stat"><div class="summary-stat-icon">üë•</div><div class="summary-stat-value">4</div><div class="summary-stat-label">People</div></div>
        `;
    } else {
        statsHtml = `
            <div class="summary-stat"><div class="summary-stat-icon">üí∞</div><div class="summary-stat-value">¬£${STATE.totals.cost.toLocaleString()}</div><div class="summary-stat-label">Total Cost</div></div>
            <div class="summary-stat"><div class="summary-stat-icon">‚ò¢Ô∏è</div><div class="summary-stat-value">${STATE.totals.dose.toFixed(1)} mSv</div><div class="summary-stat-label">Total Dose</div></div>
            <div class="summary-stat"><div class="summary-stat-icon">‚è±Ô∏è</div><div class="summary-stat-value">${STATE.totals.time} days</div><div class="summary-stat-label">Total Time</div></div>
            <div class="summary-stat"><div class="summary-stat-icon">üìä</div><div class="summary-stat-value">${STATE.phase}/5</div><div class="summary-stat-label">Phase</div></div>
        `;
    }
    document.getElementById('sumStats').innerHTML = statsHtml;
    
    // Decisions
    let decHtml = '';
    Object.keys(DATA.elements).forEach(elId => {
        const el = DATA.elements[elId];
        const choiceId = STATE.choices[elId];
        const opt = el.options.find(o => o.id === choiceId);
        const tagClass = opt.quality === 'good' ? 'good' : opt.quality === 'ok' ? 'ok' : 'poor';
        decHtml += `
            <div class="decision-row">
                <span class="decision-element">${el.title}</span>
                <div class="decision-result">
                    <span>${opt.name}</span>
                    <span class="result-tag ${tagClass}">${opt.quality.toUpperCase()}</span>
                </div>
            </div>
        `;
    });
    document.getElementById('sumDecisions').innerHTML = decHtml;
    
    // Button
    document.getElementById('btnNextPhase').textContent = STATE.phase === 5 ? 'View Results ‚Üí' : 'Next Phase ‚Üí';
    
    document.getElementById('summaryScreen').classList.add('active');
}

document.getElementById('btnNextPhase').onclick = () => {
    document.getElementById('summaryScreen').classList.remove('active');
    
    if (STATE.phase >= 5) {
        showResults();
    } else {
        showTransition();
    }
};

function showTransition() {
    const nextPhase = STATE.phase + 1;
    const trans = DATA.transitions[nextPhase];
    
    document.getElementById('transYears').textContent = trans.years;
    document.getElementById('transYear').textContent = trans.year;
    document.getElementById('transText').innerHTML = trans.text.map(t => `<p>${t}</p>`).join('');
    
    document.getElementById('transitionScreen').classList.add('active');
}

document.getElementById('btnTransContinue').onclick = () => {
    document.getElementById('transitionScreen').classList.remove('active');
    startPhase(STATE.phase + 1);
};

function showResults() {
    // Calculate grade
    let good = 0;
    Object.keys(DATA.elements).forEach(elId => {
        const opt = DATA.elements[elId].options.find(o => o.id === STATE.choices[elId]);
        if (opt.quality === 'good') good++;
    });
    
    let grade;
    if (good >= 5) grade = 'A';
    else if (good >= 4) grade = 'B';
    else if (good >= 2) grade = 'C';
    else grade = 'D';
    
    document.getElementById('resGrade').textContent = grade;
    document.getElementById('resGrade').className = `results-grade ${grade}`;
    
    document.getElementById('resTotalCost').textContent = `¬£${STATE.totals.cost.toLocaleString()}`;
    document.getElementById('resTotalDose').textContent = `${STATE.totals.dose.toFixed(1)} mSv`;
    document.getElementById('resTotalTime').textContent = `${STATE.totals.time} days`;
    
    document.getElementById('resultsScreen').classList.add('active');
}
</script>
</body>
</html>
