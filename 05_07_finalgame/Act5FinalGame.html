<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The 60-Year Journey | The Nuclear House</title>
    <style>
        :root {
            --white: #f7f8fa;
            --light-grey: #d0d9e0;
            --mid-grey: #9babc2;
            --slate: #4a5d6b;
            --dark-slate: #364451;
            --deep-navy: #1f2937;
            --green: #92d050;
            --blue: #00b0f0;
            --orange: #cc5500;
            --red: #dc2626;
            --amber: #f59e0b;
            --dave-colour: #cc5500;
            --sarah-colour: #00b0f0;
            --mike-colour: #92d050;
            --janet-colour: #9babc2;
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --shadow-card: 0 4px 6px rgba(0, 0, 0, 0.3);
            --shadow-modal: 0 10px 25px rgba(0, 0, 0, 0.5);
            --shadow-hover: 0 6px 12px rgba(0, 0, 0, 0.4);
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--deep-navy);
            color: var(--light-grey);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4 { color: var(--white); font-weight: 600; }
        button { font-family: inherit; cursor: pointer; border: none; transition: all var(--transition-fast); }
        
        /* ============================================
           CINEMATIC INTRO
           ============================================ */
        .cinematic-container {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            z-index: 1000;
            background: #000;
            overflow: hidden;
        }
        
        .cinematic-container.hidden { display: none; }
        
        .cinematic-slide {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease, visibility 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cinematic-slide.active { opacity: 1; visibility: visible; }
        
        .slide-background {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            filter: brightness(0.4);
        }
        
        .slide-background.no-image {
            background: linear-gradient(135deg, #0a1628 0%, #1a2a3a 50%, #0d1a2d 100%);
            filter: none;
        }
        
        .slide-content {
            position: relative;
            z-index: 10;
            max-width: 800px;
            padding: var(--space-2xl);
            text-align: center;
        }
        
        .cinematic-logo { margin-bottom: var(--space-xl); animation: fadeInUp 1s ease 0.3s both; }
        .cinematic-logo img { max-width: 280px; height: auto; filter: drop-shadow(0 0 20px rgba(255,255,255,0.2)); }
        
        .cinematic-company {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: var(--blue);
            margin-bottom: var(--space-lg);
            animation: fadeInUp 1s ease 0.5s both;
        }
        
        .cinematic-title {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: var(--space-lg);
            line-height: 1.1;
            text-shadow: 0 4px 30px rgba(0,0,0,0.5);
            animation: fadeInUp 1s ease 0.7s both;
        }
        
        .cinematic-subtitle {
            font-size: 1.25rem;
            color: var(--light-grey);
            line-height: 1.6;
            margin-bottom: var(--space-xl);
            animation: fadeInUp 1s ease 0.9s both;
        }
        
        .narrative-text {
            background: rgba(31, 41, 55, 0.85);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: var(--space-xl) var(--space-2xl);
            border-left: 4px solid var(--blue);
            text-align: left;
            max-width: 650px;
            margin: 0 auto;
            animation: fadeInUp 1s ease 0.5s both;
        }
        
        .narrative-text p { font-size: 1.125rem; line-height: 1.8; color: var(--light-grey); margin-bottom: var(--space-md); }
        .narrative-text p:last-child { margin-bottom: 0; }
        .narrative-text strong { color: var(--white); }
        .narrative-text .highlight { color: var(--green); font-weight: 600; }
        
        .narrative-year {
            font-size: 4rem;
            font-weight: 700;
            color: var(--blue);
            margin-bottom: var(--space-lg);
            text-shadow: 0 0 40px rgba(0, 176, 240, 0.3);
            animation: fadeInUp 1s ease 0.3s both;
        }
        
        .narrative-location {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--mid-grey);
            margin-bottom: var(--space-md);
            animation: fadeInUp 1s ease 0.4s both;
        }
        
        .budget-display {
            display: inline-block;
            background: linear-gradient(135deg, var(--green), #6ab82e);
            color: var(--deep-navy);
            padding: var(--space-md) var(--space-xl);
            border-radius: var(--radius-md);
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: var(--space-lg);
            animation: pulseGlow 2s ease-in-out infinite, fadeInUp 1s ease 1.1s both;
        }
        
        .slide-indicators {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: var(--space-sm);
            z-index: 20;
        }
        
        .slide-indicator {
            width: 40px; height: 4px;
            background: var(--slate);
            border-radius: 2px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .slide-indicator.active { background: var(--blue); box-shadow: 0 0 10px rgba(0, 176, 240, 0.5); }
        .slide-indicator.completed { background: var(--green); }
        
        .cinematic-nav {
            position: absolute;
            bottom: 40px;
            left: 0; right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-lg);
            z-index: 20;
        }
        
        .cinematic-btn {
            padding: var(--space-md) var(--space-2xl);
            font-size: 1rem;
            font-weight: 600;
            border-radius: var(--radius-md);
            transition: all 0.3s ease;
        }
        
        .cinematic-btn.primary { background: var(--blue); color: var(--deep-navy); }
        .cinematic-btn.primary:hover { background: #33c0f5; transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 176, 240, 0.4); }
        .cinematic-btn.secondary { background: transparent; color: var(--mid-grey); border: 1px solid var(--slate); }
        .cinematic-btn.secondary:hover { color: var(--white); border-color: var(--white); }
        
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 20px rgba(0, 176, 240, 0.3); } 50% { box-shadow: 0 0 40px rgba(0, 176, 240, 0.6); } }
        
        /* ============================================
           HEADER & LAYOUT
           ============================================ */
        .app-container { display: flex; flex-direction: column; min-height: 100vh; }
        
        .header {
            position: fixed; top: 0; left: 0; right: 0; height: 60px;
            background: var(--deep-navy); border-bottom: 1px solid var(--dark-slate);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 var(--space-lg); z-index: 100;
        }
        
        .header-logo img { height: 36px; width: auto; }
        
        .header-stage { font-size: 0.875rem; color: var(--mid-grey); text-transform: uppercase; letter-spacing: 0.5px; }
        .header-stage strong { color: var(--white); }
        
        .meters-bar { display: flex; gap: var(--space-lg); font-size: 0.875rem; }
        .meter { display: flex; align-items: center; gap: var(--space-xs); }
        .meter-value { color: var(--white); font-weight: 500; font-variant-numeric: tabular-nums; }
        .meter-value.good { color: var(--green); }
        .meter-value.warning { color: var(--amber); }
        .meter-value.critical { color: var(--red); }
        
        .main-content { flex: 1; margin-top: 60px; padding: var(--space-xl); display: flex; flex-direction: column; align-items: center; }
        
        /* Timeline */
        .timeline-bar {
            position: fixed; top: 60px; left: 0; right: 0; height: 8px;
            background: var(--dark-slate); z-index: 99;
        }
        
        .timeline-fill { height: 100%; background: linear-gradient(90deg, var(--blue), var(--green)); width: 0%; transition: width 0.5s ease; }
        
        .timeline-markers {
            position: absolute; top: 0; left: 0; right: 0; height: 100%;
            display: flex; justify-content: space-between; padding: 0 10%;
        }
        
        .timeline-marker {
            width: 16px; height: 16px; border-radius: 50%;
            background: var(--slate); border: 3px solid var(--deep-navy);
            transform: translateY(-4px);
            transition: all 0.3s ease;
        }
        
        .timeline-marker.active { background: var(--blue); box-shadow: 0 0 10px rgba(0, 176, 240, 0.5); }
        .timeline-marker.completed { background: var(--green); }
        
        /* ============================================
           MAIN GAME SCREEN
           ============================================ */
        .screen { display: none; width: 100%; max-width: 1200px; animation: fadeIn 0.5s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .stage-header { text-align: center; margin-bottom: var(--space-xl); }
        .stage-header h2 { margin-bottom: var(--space-sm); }
        .stage-header p { color: var(--mid-grey); }
        
        .stage-info-bar {
            display: flex; justify-content: center; align-items: center; gap: var(--space-xl);
            background: var(--dark-slate); padding: var(--space-md) var(--space-xl);
            border-radius: var(--radius-md); margin-bottom: var(--space-xl);
        }
        
        .info-item { text-align: center; }
        .info-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; color: var(--mid-grey); }
        .info-value { font-size: 1.25rem; font-weight: 600; color: var(--white); }
        .info-value.good { color: var(--green); }
        .info-value.warning { color: var(--amber); }
        .info-value.critical { color: var(--red); }
        
        /* Character Banner */
        .character-banner {
            display: flex; align-items: center; gap: var(--space-lg);
            background: var(--dark-slate); border-radius: var(--radius-lg);
            padding: var(--space-lg); margin-bottom: var(--space-xl);
            border-left: 4px solid var(--blue);
        }
        
        .character-banner.dave { border-left-color: var(--dave-colour); }
        .character-banner.sarah { border-left-color: var(--sarah-colour); }
        .character-banner.mike { border-left-color: var(--mike-colour); }
        .character-banner.janet { border-left-color: var(--janet-colour); }
        
        .character-portrait {
            width: 70px; height: 70px; border-radius: var(--radius-md);
            background: var(--slate); display: flex; align-items: center; justify-content: center;
            font-size: 2rem; flex-shrink: 0; overflow: hidden;
        }
        
        .character-portrait img { width: 100%; height: 100%; object-fit: cover; }
        
        .character-info h3 { margin-bottom: var(--space-xs); font-size: 1.125rem; }
        .character-role { color: var(--mid-grey); font-size: 0.875rem; margin-bottom: var(--space-sm); }
        .character-quote { font-style: italic; color: var(--light-grey); }
        
        /* Plant Diagram */
        .plant-diagram {
            background: var(--dark-slate); border-radius: var(--radius-lg);
            overflow: hidden; position: relative;
        }
        
        .plant-image-wrapper { position: relative; width: 100%; }
        .plant-bg-image { width: 100%; height: auto; display: block; }
        
        /* Hotspots */
        .hotspot {
            position: absolute; cursor: pointer;
            transform: translate(-50%, -50%); z-index: 10;
        }
        
        .hotspot-marker {
            width: 48px; height: 48px; border-radius: 50%;
            background: rgba(0,176,240,0.25); border: 3px solid var(--blue);
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease; animation: hotspotPulse 2s infinite;
        }
        
        .hotspot-marker:hover { transform: scale(1.15); background: rgba(0,176,240,0.45); }
        
        .hotspot-marker.completed {
            background: rgba(146,208,80,0.35); border-color: var(--green);
            animation: none;
        }
        
        .hotspot-marker.completed::after { content: '‚úì'; color: var(--green); font-size: 1.2rem; font-weight: bold; }
        
        .hotspot-marker.problem {
            background: rgba(220, 38, 38, 0.35); border-color: var(--red);
            animation: none;
        }
        
        .hotspot-marker.problem::after { content: '!'; color: var(--red); font-size: 1.2rem; font-weight: bold; }
        
        .hotspot-label {
            position: absolute; top: 54px; left: 50%; transform: translateX(-50%);
            background: rgba(31,41,55,0.95); color: var(--white);
            padding: 4px 10px; border-radius: 4px; font-size: 0.75rem;
            font-weight: 500; white-space: nowrap; pointer-events: none;
            border: 1px solid var(--slate);
        }
        
        @keyframes hotspotPulse { 0%,100% { box-shadow: 0 0 0 0 rgba(0,176,240,0.4); } 50% { box-shadow: 0 0 0 14px rgba(0,176,240,0); } }
        
        /* Progress Footer */
        .stage-footer {
            text-align: center; margin-top: var(--space-xl);
        }
        
        .progress-text { color: var(--mid-grey); margin-bottom: var(--space-md); }
        
        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            gap: var(--space-sm); padding: var(--space-md) var(--space-xl);
            border-radius: var(--radius-md); font-size: 1rem; font-weight: 500;
        }
        
        .btn-primary { background: var(--blue); color: var(--deep-navy); }
        .btn-primary:hover { background: #33c0f5; box-shadow: var(--shadow-hover); transform: translateY(-1px); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-success { background: var(--green); color: var(--deep-navy); }
        
        /* ============================================
           MODAL
           ============================================ */
        .modal-overlay {
            display: none; position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.7); z-index: 200;
            align-items: center; justify-content: center;
            padding: var(--space-md);
        }
        
        .modal-overlay.active { display: flex; }
        
        .modal {
            background: var(--dark-slate); border-radius: var(--radius-xl);
            max-width: 650px; width: 100%; max-height: 90vh; overflow-y: auto;
            box-shadow: var(--shadow-modal); animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-header {
            padding: var(--space-lg); border-bottom: 1px solid var(--slate);
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .modal-header h3 { font-size: 1.25rem; }
        .modal-close { background: transparent; color: var(--mid-grey); font-size: 1.5rem; padding: var(--space-xs); line-height: 1; }
        .modal-close:hover { color: var(--white); }
        
        .modal-body { padding: var(--space-lg); }
        .modal-description { margin-bottom: var(--space-lg); color: var(--light-grey); }
        
        /* Design Choices (Stage 1) */
        .choice-cards { display: flex; flex-direction: column; gap: var(--space-md); }
        
        .choice-card {
            background: var(--slate); border-radius: var(--radius-md);
            padding: var(--space-md); cursor: pointer; border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .choice-card:hover { border-color: var(--blue); box-shadow: var(--shadow-hover); }
        .choice-card.selected { border-color: var(--green); background: rgba(146, 208, 80, 0.1); }
        
        .choice-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-sm); }
        .choice-name { color: var(--white); font-weight: 500; }
        .choice-cost { background: var(--dark-slate); padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-sm); font-weight: 600; color: var(--amber); font-size: 0.875rem; }
        .choice-description { color: var(--light-grey); font-size: 0.875rem; }
        
        .choice-image-placeholder {
            width: 100%; height: 80px; background: var(--dark-slate);
            border-radius: var(--radius-sm); margin-bottom: var(--space-sm);
            display: flex; align-items: center; justify-content: center;
            color: var(--mid-grey); font-size: 0.75rem;
        }
        
        .modal-footer {
            padding: var(--space-lg); border-top: 1px solid var(--slate);
            display: flex; justify-content: flex-end; gap: var(--space-md);
        }
        
        /* Outcome Display (Stages 2-5) */
        .outcome-display { text-align: center; }
        
        .outcome-character {
            display: flex; align-items: center; gap: var(--space-md);
            background: var(--slate); border-radius: var(--radius-md);
            padding: var(--space-md); margin-bottom: var(--space-lg);
            text-align: left;
        }
        
        .outcome-character .character-portrait { width: 60px; height: 60px; }
        .outcome-character .character-name { color: var(--white); font-weight: 500; }
        .outcome-dialogue { font-style: italic; color: var(--light-grey); margin-top: var(--space-xs); }
        
        .outcome-result {
            background: var(--slate); border-radius: var(--radius-md);
            padding: var(--space-lg); margin-bottom: var(--space-lg);
        }
        
        .outcome-result h4 { margin-bottom: var(--space-md); }
        
        .outcome-stats {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-md);
        }
        
        .outcome-stat { text-align: center; }
        .outcome-stat-value { font-size: 1.25rem; font-weight: 600; color: var(--white); }
        .outcome-stat-value.good { color: var(--green); }
        .outcome-stat-value.bad { color: var(--red); }
        .outcome-stat-label { font-size: 0.75rem; color: var(--mid-grey); text-transform: uppercase; }
        
        .design-recall {
            background: var(--dark-slate); border-radius: var(--radius-sm);
            padding: var(--space-sm) var(--space-md); margin-top: var(--space-md);
            font-size: 0.875rem; color: var(--mid-grey);
        }
        
        .design-recall strong { color: var(--white); }
        
        /* ============================================
           TRANSITION SCREEN
           ============================================ */
        .transition-screen {
            text-align: center; padding: var(--space-2xl) 0;
            max-width: 700px; margin: 0 auto;
        }
        
        .transition-years { font-size: 1rem; text-transform: uppercase; letter-spacing: 2px; color: var(--mid-grey); margin-bottom: var(--space-md); }
        .transition-year { font-size: 4rem; font-weight: 700; color: var(--white); margin-bottom: var(--space-xl); }
        
        .transition-text {
            background: var(--dark-slate); border-radius: var(--radius-lg);
            padding: var(--space-xl); margin-bottom: var(--space-xl); text-align: left;
        }
        
        .transition-text p { margin-bottom: var(--space-md); }
        .transition-text p:last-child { margin-bottom: 0; }
        
        /* ============================================
           SUMMARY SCREEN
           ============================================ */
        .summary-screen { max-width: 800px; margin: 0 auto; }
        .summary-header { text-align: center; margin-bottom: var(--space-xl); }
        
        .summary-stats {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .summary-stat {
            background: var(--dark-slate); border-radius: var(--radius-md);
            padding: var(--space-lg); text-align: center;
        }
        
        .summary-stat-icon { font-size: 1.5rem; margin-bottom: var(--space-sm); }
        .summary-stat-value { font-size: 1.5rem; font-weight: 600; color: var(--white); }
        .summary-stat-label { font-size: 0.75rem; color: var(--mid-grey); text-transform: uppercase; }
        
        .summary-decisions {
            background: var(--dark-slate); border-radius: var(--radius-lg);
            padding: var(--space-xl); margin-bottom: var(--space-xl);
        }
        
        .summary-decisions h3 { margin-bottom: var(--space-lg); }
        
        .decision-list { list-style: none; }
        .decision-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: var(--space-md) 0; border-bottom: 1px solid var(--slate);
        }
        .decision-item:last-child { border-bottom: none; }
        .decision-name { color: var(--white); }
        .decision-result { display: flex; align-items: center; gap: var(--space-sm); }
        
        .result-tag {
            padding: 2px var(--space-sm); border-radius: var(--radius-sm);
            font-size: 0.75rem; font-weight: 500; text-transform: uppercase;
        }
        .result-tag.good { background: var(--green); color: var(--deep-navy); }
        .result-tag.ok { background: var(--amber); color: var(--deep-navy); }
        .result-tag.poor { background: var(--red); color: var(--white); }
        
        .summary-footer { text-align: center; }
        
        /* ============================================
           RESULTS SCREEN
           ============================================ */
        .results-screen { max-width: 900px; margin: 0 auto; text-align: center; }
        
        .results-grade {
            font-size: 6rem; font-weight: 700; margin-bottom: var(--space-lg);
        }
        
        .results-grade.excellent { color: var(--green); }
        .results-grade.good { color: var(--blue); }
        .results-grade.average { color: var(--amber); }
        .results-grade.poor { color: var(--red); }
        
        .results-title { margin-bottom: var(--space-xl); }
        
        .results-summary {
            background: var(--dark-slate); border-radius: var(--radius-lg);
            padding: var(--space-xl); margin-bottom: var(--space-xl); text-align: left;
        }
        
        .results-totals {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        
        .total-item { text-align: center; }
        .total-value { font-size: 1.75rem; font-weight: 600; color: var(--white); }
        .total-label { font-size: 0.875rem; color: var(--mid-grey); }
        
        /* Mobile */
        @media (max-width: 768px) {
            .cinematic-title { font-size: 2rem; }
            .narrative-text { padding: var(--space-lg); margin: 0 var(--space-md); }
            .meters-bar { display: none; }
            .stage-info-bar { flex-wrap: wrap; }
            .summary-stats { grid-template-columns: repeat(2, 1fr); }
            .results-totals { grid-template-columns: repeat(2, 1fr); }
            .outcome-stats { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- ============================================
         CINEMATIC INTRO
         ============================================ -->
    <div class="cinematic-container" id="cinematicIntro">
        <div class="cinematic-slide active" id="slide1">
            <div class="slide-background no-image"></div>
            <div class="slide-content">
                <div class="cinematic-logo">
                    <img src="../00_images/Logo_White_Nobackground.png" alt="The Nuclear House">
                </div>
                <p class="cinematic-company">Presents</p>
                <h1 class="cinematic-title">The 60-Year Journey</h1>
                <p class="cinematic-subtitle">An interactive experience in design for decommissioning</p>
            </div>
        </div>
        
        <div class="cinematic-slide" id="slide2">
            <div class="slide-background" style="background-image: url('images/gamebackground.png');"></div>
            <div class="slide-content">
                <p class="narrative-location">Somerset Coast, United Kingdom</p>
                <h2 class="narrative-year">2025</h2>
                <div class="narrative-text">
                    <p><strong>Thornbury Point Nuclear Power Station.</strong></p>
                    <p>A new generation of clean energy. Sixty years of operation ahead.</p>
                    <p>And someone needs to design it right.</p>
                </div>
            </div>
        </div>
        
        <div class="cinematic-slide" id="slide3">
            <div class="slide-background" style="background-image: url('images/gamebackground.png');"></div>
            <div class="slide-content">
                <div class="narrative-text">
                    <p><strong>Welcome to The Nuclear House.</strong></p>
                    <p>You've just been assigned your first major project: <span class="highlight">Section 4B</span> of Thornbury Point.</p>
                    <p>Primary coolant system auxiliaries. Pumps, pipes, welds, and a control room interface.</p>
                    <p>It's not glamorous. But it's important.</p>
                </div>
            </div>
        </div>
        
        <div class="cinematic-slide" id="slide4">
            <div class="slide-background" style="background-image: url('images/gamebackground.png');"></div>
            <div class="slide-content">
                <div class="narrative-text">
                    <p>Your design will be built, operated, inspected, and eventually decommissioned over the next <strong>sixty years</strong>.</p>
                    <p>The decisions you make today will affect people you'll never meet, solving problems you can't yet imagine.</p>
                    <p>Four people will inherit your choices. Their success ‚Äî or failure ‚Äî depends on what you decide now.</p>
                </div>
            </div>
        </div>
        
        <div class="cinematic-slide" id="slide5">
            <div class="slide-background no-image"></div>
            <div class="slide-content">
                <div class="narrative-text" style="text-align: center; border-left: none; border: 2px solid var(--blue);">
                    <p><strong>Your assignment:</strong></p>
                    <p>Six design decisions. Each one has consequences ‚Äî some obvious, some hidden.</p>
                    <p>The plant will operate for sixty years. Your drawings will be here long after you've gone.</p>
                    <div class="budget-display">Your Budget: ¬£800,000</div>
                    <p style="margin-top: var(--space-lg);"><strong>Choose wisely.</strong></p>
                </div>
            </div>
        </div>
        
        <div class="slide-indicators" id="slideIndicators">
            <div class="slide-indicator active" data-slide="1"></div>
            <div class="slide-indicator" data-slide="2"></div>
            <div class="slide-indicator" data-slide="3"></div>
            <div class="slide-indicator" data-slide="4"></div>
            <div class="slide-indicator" data-slide="5"></div>
        </div>
        
        <div class="cinematic-nav">
            <button class="cinematic-btn secondary" id="btnSkipIntro">Skip Intro</button>
            <button class="cinematic-btn primary" id="btnNextSlide">Continue ‚Üí</button>
        </div>
    </div>
    
    <!-- ============================================
         MAIN APP
         ============================================ -->
    <div class="app-container">
        <header class="header">
            <div class="header-logo">
                <img src="../00_images/Logo_White_Nobackground.png" alt="The Nuclear House">
            </div>
            <div class="header-stage" id="headerStage"><strong>STAGE 1:</strong> DESIGN</div>
            <div class="meters-bar" id="metersBar">
                <div class="meter"><span>üí∞</span><span class="meter-value" id="meterBudget">¬£800,000</span></div>
                <div class="meter"><span>‚ò¢Ô∏è</span><span class="meter-value" id="meterDose">0 mSv</span></div>
                <div class="meter"><span>‚è±Ô∏è</span><span class="meter-value" id="meterTime">0 days</span></div>
            </div>
        </header>
        
        <div class="timeline-bar" id="timelineBar">
            <div class="timeline-fill" id="timelineFill"></div>
            <div class="timeline-markers">
                <div class="timeline-marker active" data-stage="1" title="2025 Design"></div>
                <div class="timeline-marker" data-stage="2" title="2040 Maintenance"></div>
                <div class="timeline-marker" data-stage="3" title="2055 Inspection"></div>
                <div class="timeline-marker" data-stage="4" title="2070 Operations"></div>
                <div class="timeline-marker" data-stage="5" title="2085 Decommissioning"></div>
            </div>
        </div>
        
        <main class="main-content">
            <!-- MAIN GAME SCREEN (used for all stages) -->
            <section class="screen active" id="screenGame">
                <div class="stage-header">
                    <h2 id="stageTitle">Section 4B Design Phase</h2>
                    <p id="stageSubtitle">Click on each element to make your design selection</p>
                </div>
                
                <div class="stage-info-bar" id="stageInfoBar">
                    <div class="info-item">
                        <div class="info-label">Budget</div>
                        <div class="info-value" id="infoBudget">¬£800,000</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Spent</div>
                        <div class="info-value" id="infoSpent">¬£0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Remaining</div>
                        <div class="info-value good" id="infoRemaining">¬£800,000</div>
                    </div>
                </div>
                
                <!-- Character banner (shown in stages 2-5) -->
                <div class="character-banner" id="characterBanner" style="display: none;">
                    <div class="character-portrait" id="charPortrait">üë∑</div>
                    <div class="character-details">
                        <div class="character-info">
                            <h3 id="charName">Dave Morton</h3>
                            <p class="character-role" id="charRole">Maintenance Supervisor</p>
                        </div>
                        <p class="character-quote" id="charQuote">"Right then. Section 4B. Let's see what we're working with."</p>
                    </div>
                </div>
                
                <!-- Plant Diagram with Hotspots -->
                <div class="plant-diagram" id="plantDiagram">
                    <div class="plant-image-wrapper">
                        <img src="images/gamebackground.png" alt="Section 4B Layout" class="plant-bg-image">
                        
                        <div class="hotspot" data-element="pumpAccess" style="left: 18%; top: 52%;">
                            <div class="hotspot-marker" id="markerPump"></div>
                            <span class="hotspot-label">Pump Access</span>
                        </div>
                        
                        <div class="hotspot" data-element="weldClearance" style="left: 42%; top: 46%;">
                            <div class="hotspot-marker" id="markerWeld"></div>
                            <span class="hotspot-label">Weld Clearance</span>
                        </div>
                        
                        <div class="hotspot" data-element="controlPanel" style="left: 85%; top: 42%;">
                            <div class="hotspot-marker" id="markerControl"></div>
                            <span class="hotspot-label">Control Panel</span>
                        </div>
                        
                        <div class="hotspot" data-element="pipeConnections" style="left: 56%; top: 52%;">
                            <div class="hotspot-marker" id="markerConnections"></div>
                            <span class="hotspot-label">Pipe Connections</span>
                        </div>
                        
                        <div class="hotspot" data-element="pipeRouting" style="left: 62%; top: 82%;">
                            <div class="hotspot-marker" id="markerRouting"></div>
                            <span class="hotspot-label">Pipe Routing</span>
                        </div>
                        
                        <div class="hotspot" data-element="materialSpec" style="left: 32%; top: 58%;">
                            <div class="hotspot-marker" id="markerMaterial"></div>
                            <span class="hotspot-label">Material Spec</span>
                        </div>
                    </div>
                </div>
                
                <div class="stage-footer">
                    <p class="progress-text" id="progressText">0 of 6 elements completed</p>
                    <button class="btn btn-primary" id="btnCompleteStage" disabled>Complete Stage ‚Üí</button>
                </div>
            </section>
            
            <!-- TRANSITION SCREEN -->
            <section class="screen transition-screen" id="screenTransition">
                <p class="transition-years" id="transitionYears">15 YEARS LATER</p>
                <h2 class="transition-year" id="transitionYear">2040</h2>
                <div class="transition-text" id="transitionText">
                    <p>Thornbury Point has been generating power for 14 years.</p>
                    <p>Your design drawings are yellowed paper in a filing cabinet somewhere.</p>
                    <p>But your decisions? Those are very much alive.</p>
                </div>
                <button class="btn btn-primary" id="btnContinueTransition">Continue ‚Üí</button>
            </section>
            
            <!-- SUMMARY SCREEN -->
            <section class="screen summary-screen" id="screenSummary">
                <div class="summary-header">
                    <h2 id="summaryTitle">Design Phase Complete</h2>
                    <p id="summarySubtitle">Your decisions have been submitted</p>
                </div>
                
                <div class="summary-stats" id="summaryStats">
                    <div class="summary-stat">
                        <div class="summary-stat-icon">üí∞</div>
                        <div class="summary-stat-value" id="sumBudgetUsed">¬£0</div>
                        <div class="summary-stat-label">Spent</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-icon">‚ò¢Ô∏è</div>
                        <div class="summary-stat-value" id="sumDose">0 mSv</div>
                        <div class="summary-stat-label">Dose</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-icon">‚è±Ô∏è</div>
                        <div class="summary-stat-value" id="sumTime">0 days</div>
                        <div class="summary-stat-label">Time</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-icon">‚ö†Ô∏è</div>
                        <div class="summary-stat-value" id="sumIssues">0</div>
                        <div class="summary-stat-label">Issues</div>
                    </div>
                </div>
                
                <div class="summary-decisions">
                    <h3>Decisions Made</h3>
                    <ul class="decision-list" id="summaryDecisions"></ul>
                </div>
                
                <div class="summary-footer">
                    <button class="btn btn-primary" id="btnNextStage">Continue to Next Stage ‚Üí</button>
                </div>
            </section>
            
            <!-- FINAL RESULTS SCREEN -->
            <section class="screen results-screen" id="screenResults">
                <div class="results-grade" id="resultsGrade">B+</div>
                <h2 class="results-title">Journey Complete</h2>
                
                <div class="results-summary">
                    <h3>60 Years of Consequences</h3>
                    <div class="results-totals">
                        <div class="total-item">
                            <div class="total-value" id="totalBudget">¬£0</div>
                            <div class="total-label">Total Spent</div>
                        </div>
                        <div class="total-item">
                            <div class="total-value" id="totalDose">0 mSv</div>
                            <div class="total-label">Total Dose</div>
                        </div>
                        <div class="total-item">
                            <div class="total-value" id="totalTime">0 days</div>
                            <div class="total-label">Total Time</div>
                        </div>
                        <div class="total-item">
                            <div class="total-value" id="totalIncidents">0</div>
                            <div class="total-label">Incidents</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="location.reload()">Play Again</button>
            </section>
        </main>
    </div>
    
    <!-- ============================================
         MODAL
         ============================================ -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Element Title</h3>
                <button class="modal-close" id="modalClose">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content injected by JS -->
            </div>
            <div class="modal-footer" id="modalFooter">
                <button class="btn btn-primary" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // GAME DATA
        // ============================================
        const GameData = {
            stages: {
                1: { name: 'DESIGN', year: 2025, budget: 800000 },
                2: { name: 'MAINTENANCE', year: 2040, budget: 400000, character: 'dave' },
                3: { name: 'INSPECTION', year: 2055, budget: 250000, character: 'sarah' },
                4: { name: 'OPERATIONS', year: 2070, budget: 200000, character: 'mike' },
                5: { name: 'DECOMMISSIONING', year: 2085, budget: 1200000, character: 'janet' }
            },
            
            characters: {
                dave: {
                    name: 'Dave Morton',
                    role: 'Maintenance Supervisor',
                    portrait: 'images/dave.png',
                    introQuote: "Right then. Section 4B. First major outage. Let's see what we're working with."
                },
                sarah: {
                    name: 'Sarah Okonkwo',
                    role: 'Principal Inspector',
                    portrait: 'üîç',
                    introQuote: "In-service inspection time. Let's see if I can actually reach what needs examining."
                },
                mike: {
                    name: 'Mike Brennan',
                    role: 'Shift Operations Manager',
                    portrait: 'üë®‚Äçüíº',
                    introQuote: "3am alarm scenario. Let's hope this panel layout makes sense."
                },
                janet: {
                    name: 'Janet Cole',
                    role: 'Decommissioning Project Lead',
                    portrait: 'images/janet.png',
                    introQuote: "Sixty years. Let's see what 2025 left us to deal with."
                }
            },
            
            elements: {
                pumpAccess: {
                    title: 'Pump Access',
                    description: 'How should the primary coolant pump be positioned within Section 4B?',
                    options: [
                        { 
                            id: 'corner', 
                            name: 'Corner Position', 
                            description: 'Pump tucked in corner to maximise floor space. 1.8m clearance.',
                            cost: 120000, 
                            quality: 'poor',
                            // Future: image placeholder
                        },
                        { 
                            id: 'openBay', 
                            name: 'Open Bay', 
                            description: 'Pump in open bay with 2m clearance all sides, under crane rails.',
                            cost: 150000, 
                            quality: 'good'
                        },
                        { 
                            id: 'dedicatedRoom', 
                            name: 'Dedicated Shielded Room', 
                            description: 'Pump in dedicated shielded room with airlock. Over-specified.',
                            cost: 290000, 
                            quality: 'wasteful'
                        }
                    ],
                    outcomes: {
                        2: { // Maintenance
                            corner: { time: 8, dose: 4, cost: 80000, comment: "Who signed off on this? The pump's in a corner. What were they thinking?" },
                            openBay: { time: 3, dose: 1, cost: 30000, comment: "Full crane coverage. Lovely. In and out, job done." },
                            dedicatedRoom: { time: 4, dose: 0.5, cost: 40000, comment: "Nice room, but did we really need all this for a standard pump?" }
                        },
                        3: { // Inspection
                            corner: { time: 4, dose: 2, cost: 40000, comment: "Can barely fit the equipment in here. Limited coverage." },
                            openBay: { time: 2, dose: 0.5, cost: 20000, comment: "Full access. This is how it should be done." },
                            dedicatedRoom: { time: 2, dose: 0.3, cost: 25000, comment: "Good access, though the airlock slows things down." }
                        },
                        4: { // Operations
                            corner: { time: 2, dose: 1, cost: 20000, comment: "Emergency access is tight. Adds precious seconds in a crisis." },
                            openBay: { time: 1, dose: 0.2, cost: 10000, comment: "Clear sightlines, easy access. Good for emergencies." },
                            dedicatedRoom: { time: 1, dose: 0.1, cost: 15000, comment: "The airlock is overkill but at least it's accessible." }
                        },
                        5: { // Decommissioning
                            corner: { time: 12, dose: 5, cost: 200000, comment: "Tight space means manual cutting. This will take months." },
                            openBay: { time: 5, dose: 2, cost: 80000, comment: "Straight lift out. This is coming apart clean." },
                            dedicatedRoom: { time: 6, dose: 1, cost: 100000, comment: "Easy removal, but now we've got this room to decontaminate too." }
                        }
                    }
                },
                weldClearance: {
                    title: 'Weld Clearance',
                    description: 'What clearance should be provided around pipe welds for inspection access?',
                    options: [
                        { id: '50mm', name: '50mm (Code Minimum)', description: 'Minimum clearance permitted by design code.', cost: 90000, quality: 'poor' },
                        { id: '150mm', name: '150mm Clearance', description: 'Adequate clearance for all standard inspection probes.', cost: 95000, quality: 'good' },
                        { id: '300mm', name: '300mm + Scaffolding', description: 'Generous clearance with permanent scaffolding.', cost: 180000, quality: 'wasteful' }
                    ],
                    outcomes: {
                        2: {
                            '50mm': { time: 6, dose: 3, cost: 60000, comment: "50mm clearance. Just because you can doesn't mean you should." },
                            '150mm': { time: 2, dose: 1, cost: 20000, comment: "Proper clearance. Makes the job straightforward." },
                            '300mm': { time: 2, dose: 0.5, cost: 25000, comment: "Plenty of room, but that scaffolding's got contamination now." }
                        },
                        3: {
                            '50mm': { time: 5, dose: 3, cost: 50000, comment: "I'm going to have to write 'limited coverage' on this report." },
                            '150mm': { time: 2, dose: 0.5, cost: 20000, comment: "150mm clearance. Adequate probe positioning. No issues." },
                            '300mm': { time: 1, dose: 0.3, cost: 15000, comment: "Easy access, but the scaffolding is in the way of some angles." }
                        },
                        4: {
                            '50mm': { time: 1, dose: 0.5, cost: 10000, comment: "Hard to see the weld indicators on the panel." },
                            '150mm': { time: 0, dose: 0, cost: 5000, comment: "Good visibility of the inspection points." },
                            '300mm': { time: 0, dose: 0, cost: 5000, comment: "No operational issues." }
                        },
                        5: {
                            '50mm': { time: 8, dose: 4, cost: 150000, comment: "Can't get cutting equipment in. Manual removal required." },
                            '150mm': { time: 3, dose: 1, cost: 50000, comment: "Standard removal. No surprises." },
                            '300mm': { time: 4, dose: 2, cost: 80000, comment: "Now we've got contaminated scaffolding to deal with too." }
                        }
                    }
                },
                controlPanel: {
                    title: 'Control Panel Layout',
                    description: 'How should the Section 4B control panel be organised?',
                    options: [
                        { id: 'systemBased', name: 'System-Based Layout', description: 'Controls grouped by system. Logical for engineers.', cost: 85000, quality: 'poor' },
                        { id: 'taskBased', name: 'Task-Based Layout', description: 'Controls grouped by operator workflow. Emergency sequence flows left-to-right.', cost: 95000, quality: 'good' },
                        { id: 'touchscreen', name: 'Touchscreen Interface', description: 'Sleek touchscreen displays. Impressive in demonstrations.', cost: 180000, quality: 'poor' }
                    ],
                    outcomes: {
                        2: {
                            systemBased: { time: 1, dose: 0, cost: 5000, comment: "Panel's fine for routine work." },
                            taskBased: { time: 0, dose: 0, cost: 5000, comment: "Easy to isolate systems. Logical layout." },
                            touchscreen: { time: 2, dose: 0, cost: 15000, comment: "Touch screens need calibration. Again." }
                        },
                        3: {
                            systemBased: { time: 0, dose: 0, cost: 5000, comment: "No inspection issues with the panel." },
                            taskBased: { time: 0, dose: 0, cost: 5000, comment: "Clear indication of system status." },
                            touchscreen: { time: 1, dose: 0, cost: 10000, comment: "Display showing artifacts. Software update needed." }
                        },
                        4: {
                            systemBased: { time: 3, dose: 0, cost: 30000, comment: "3am, alarms everywhere, and I can't find the isolation valve." },
                            taskBased: { time: 0, dose: 0, cost: 5000, comment: "Found the right controls immediately. That's good design." },
                            touchscreen: { time: 5, dose: 0, cost: 50000, comment: "Touchscreen's frozen. Again. In the middle of an event." }
                        },
                        5: {
                            systemBased: { time: 1, dose: 0, cost: 10000, comment: "Panel removal is straightforward." },
                            taskBased: { time: 1, dose: 0, cost: 10000, comment: "Standard panel removal." },
                            touchscreen: { time: 2, dose: 0, cost: 30000, comment: "Electronic waste. Special disposal required." }
                        }
                    }
                },
                pipeConnections: {
                    title: 'Pipe Connections',
                    description: 'How should pipe joints be designed?',
                    options: [
                        { id: 'flanged', name: 'Flanged Connections', description: 'Bolted flanges at all joints. Easy to disassemble.', cost: 160000, quality: 'good' },
                        { id: 'mixed', name: 'Mixed Flanged/Welded', description: 'Flanges at accessible points, welded elsewhere.', cost: 170000, quality: 'ok' },
                        { id: 'welded', name: 'All Welded Joints', description: 'Continuous welded construction. Maximum integrity.', cost: 180000, quality: 'poor' }
                    ],
                    outcomes: {
                        2: {
                            flanged: { time: 2, dose: 1, cost: 20000, comment: "Flanged connections. Someone was thinking ahead." },
                            mixed: { time: 4, dose: 2, cost: 40000, comment: "Some flanges, some welds. Could be worse." },
                            welded: { time: 8, dose: 4, cost: 80000, comment: "All welded. So we're cutting and re-welding then. Brilliant." }
                        },
                        3: {
                            flanged: { time: 1, dose: 0.5, cost: 10000, comment: "Can remove sections for detailed inspection." },
                            mixed: { time: 2, dose: 1, cost: 20000, comment: "Some joints accessible, others not." },
                            welded: { time: 3, dose: 2, cost: 35000, comment: "In-situ inspection only. Limited coverage." }
                        },
                        4: {
                            flanged: { time: 0, dose: 0, cost: 5000, comment: "Quick isolation possible in emergencies." },
                            mixed: { time: 1, dose: 0, cost: 10000, comment: "Most isolation points accessible." },
                            welded: { time: 2, dose: 0, cost: 20000, comment: "Can't isolate quickly. Had to shut down more than necessary." }
                        },
                        5: {
                            flanged: { time: 3, dose: 1, cost: 40000, comment: "Unbolt, remove, done. This is how it should be." },
                            mixed: { time: 6, dose: 3, cost: 100000, comment: "Flanges easy, welds need cutting. Mixed bag." },
                            welded: { time: 10, dose: 5, cost: 180000, comment: "Every joint needs cutting. This is going to take forever." }
                        }
                    }
                },
                pipeRouting: {
                    title: 'Pipe Routing',
                    description: 'How should pipes be routed through the concrete structure?',
                    options: [
                        { id: 'embedded', name: 'Embedded in Concrete', description: 'Pipes cast directly into structural concrete.', cost: 140000, quality: 'poor' },
                        { id: 'ducted', name: 'Accessible Ducts', description: 'Pipes run through removable duct covers.', cost: 165000, quality: 'good' },
                        { id: 'tunnel', name: 'Walk-In Tunnel', description: 'Large accessible tunnel for all services.', cost: 280000, quality: 'wasteful' }
                    ],
                    outcomes: {
                        2: {
                            embedded: { time: 0, dose: 0, cost: 5000, comment: "Can't access these pipes. Hope nothing goes wrong." },
                            ducted: { time: 2, dose: 1, cost: 20000, comment: "Duct covers off, full access. Proper design." },
                            tunnel: { time: 1, dose: 0.5, cost: 15000, comment: "Walk-in access is nice, but did we need this much space?" }
                        },
                        3: {
                            embedded: { time: 0, dose: 0, cost: 5000, comment: "Embedded in concrete. So we're guessing what's in there." },
                            ducted: { time: 2, dose: 0.5, cost: 15000, comment: "Full visual and probe access. No issues." },
                            tunnel: { time: 1, dose: 0.3, cost: 12000, comment: "Easy inspection access." }
                        },
                        4: {
                            embedded: { time: 2, dose: 0, cost: 20000, comment: "Leak detected. Can't find it. It's in the concrete somewhere." },
                            ducted: { time: 0, dose: 0, cost: 5000, comment: "Quick visual check confirms system status." },
                            tunnel: { time: 0, dose: 0, cost: 5000, comment: "Easy walkthrough inspection." }
                        },
                        5: {
                            embedded: { time: 15, dose: 8, cost: 300000, comment: "Embedded in concrete. That's another six months and half a million." },
                            ducted: { time: 4, dose: 2, cost: 60000, comment: "Pull the covers, extract the pipes. Straightforward." },
                            tunnel: { time: 3, dose: 1, cost: 50000, comment: "Easy access, but now we've got this tunnel to decontaminate." }
                        }
                    }
                },
                materialSpec: {
                    title: 'Material Specification',
                    description: 'What material for primary circuit pipework?',
                    options: [
                        { id: 'standardSS', name: 'Standard Stainless Steel', description: 'Type 304/316, ~2,500 ppm cobalt. Industry standard.', cost: 200000, quality: 'poor' },
                        { id: 'lowCobalt', name: 'Low-Cobalt Stainless', description: 'Cobalt below 500 ppm. Reduces activation.', cost: 250000, quality: 'good' },
                        { id: 'exoticAlloy', name: 'Exotic Nickel Alloy', description: 'High-performance nickel alloy. Premium specification.', cost: 400000, quality: 'poor' }
                    ],
                    outcomes: {
                        2: {
                            standardSS: { time: 1, dose: 2, cost: 15000, comment: "Standard steel. Hot to work on but expected." },
                            lowCobalt: { time: 1, dose: 0.5, cost: 12000, comment: "Low-cobalt. Noticeably lower dose rates." },
                            exoticAlloy: { time: 2, dose: 1, cost: 25000, comment: "Special procedures for this alloy. Slower work." }
                        },
                        3: {
                            standardSS: { time: 1, dose: 1.5, cost: 12000, comment: "Standard material. Higher background." },
                            lowCobalt: { time: 1, dose: 0.3, cost: 10000, comment: "Clean material, easy to work around." },
                            exoticAlloy: { time: 1, dose: 0.5, cost: 15000, comment: "Good material properties but finicky to inspect." }
                        },
                        4: {
                            standardSS: { time: 0, dose: 0.5, cost: 5000, comment: "No operational difference." },
                            lowCobalt: { time: 0, dose: 0.1, cost: 5000, comment: "Lower dose during operator rounds." },
                            exoticAlloy: { time: 0, dose: 0.2, cost: 5000, comment: "Performs well operationally." }
                        },
                        5: {
                            standardSS: { time: 8, dose: 10, cost: 200000, comment: "2,500 ppm cobalt. Waiting decades for it to cool down." },
                            lowCobalt: { time: 4, dose: 2, cost: 80000, comment: "Low activation. Can handle it much sooner." },
                            exoticAlloy: { time: 6, dose: 3, cost: 150000, comment: "Special disposal requirements for this alloy." }
                        }
                    }
                }
            },
            
            transitions: {
                2: {
                    years: '15 YEARS LATER',
                    year: '2040',
                    text: [
                        'Thornbury Point has been generating power for 14 years.',
                        'Your design drawings are yellowed paper in a filing cabinet somewhere. Your name is in a title block nobody reads anymore.',
                        'But your decisions? Those are very much alive.',
                        'It\'s time for the first major maintenance outage.'
                    ]
                },
                3: {
                    years: '15 YEARS LATER',
                    year: '2055',
                    text: [
                        'Thirty years of operation. The plant is middle-aged now.',
                        'Regulators want proof that everything is still safe. Every weld, every pipe, every component.',
                        'Time for a detailed in-service inspection.'
                    ]
                },
                4: {
                    years: '15 YEARS LATER',
                    year: '2070',
                    text: [
                        'Forty-five years. The plant is showing its age.',
                        'But it\'s still generating power, still earning its keep.',
                        'Tonight, the alarms will test whether your control room design was worth it.'
                    ]
                },
                5: {
                    years: '15 YEARS LATER',
                    year: '2085',
                    text: [
                        'Sixty years. The reactor has been shut down for good.',
                        'Now comes the hard part: taking it all apart safely.',
                        'Every decision you made in 2025 has led to this moment.'
                    ]
                }
            }
        };
        
        // ============================================
        // GAME STATE
        // ============================================
        const GameState = {
            currentStage: 1,
            designChoices: {},
            completedElements: {},
            totals: {
                budget: 0,
                dose: 0,
                time: 0,
                incidents: 0
            },
            stageTotals: {}
        };
        
        // ============================================
        // CINEMATIC CONTROLLER
        // ============================================
        const CinematicController = {
            currentSlide: 1,
            totalSlides: 5,
            
            init() {
                document.getElementById('btnNextSlide').addEventListener('click', () => this.nextSlide());
                document.getElementById('btnSkipIntro').addEventListener('click', () => this.endIntro());
                
                document.querySelectorAll('.slide-indicator').forEach(ind => {
                    ind.addEventListener('click', () => this.goToSlide(parseInt(ind.dataset.slide)));
                });
                
                document.addEventListener('keydown', (e) => {
                    if (!document.getElementById('cinematicIntro').classList.contains('hidden')) {
                        if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'Enter') {
                            e.preventDefault();
                            this.nextSlide();
                        } else if (e.key === 'Escape') {
                            this.endIntro();
                        }
                    }
                });
                
                document.querySelector('.header').style.display = 'none';
                document.querySelector('.timeline-bar').style.display = 'none';
            },
            
            goToSlide(num) {
                document.getElementById(`slide${this.currentSlide}`).classList.remove('active');
                this.currentSlide = num;
                document.getElementById(`slide${this.currentSlide}`).classList.add('active');
                this.updateIndicators();
                this.updateButton();
            },
            
            nextSlide() {
                if (this.currentSlide >= this.totalSlides) {
                    this.endIntro();
                } else {
                    this.goToSlide(this.currentSlide + 1);
                }
            },
            
            updateIndicators() {
                document.querySelectorAll('.slide-indicator').forEach((ind, i) => {
                    ind.classList.remove('active', 'completed');
                    if (i + 1 === this.currentSlide) ind.classList.add('active');
                    else if (i + 1 < this.currentSlide) ind.classList.add('completed');
                });
            },
            
            updateButton() {
                const btn = document.getElementById('btnNextSlide');
                btn.textContent = this.currentSlide >= this.totalSlides ? 'Begin Design ‚Üí' : 'Continue ‚Üí';
            },
            
            endIntro() {
                const container = document.getElementById('cinematicIntro');
                container.style.opacity = '0';
                container.style.transition = 'opacity 0.5s ease';
                setTimeout(() => {
                    container.classList.add('hidden');
                    document.querySelector('.header').style.display = 'flex';
                    document.querySelector('.timeline-bar').style.display = 'block';
                    GameController.startStage(1);
                }, 500);
            }
        };
        
        // ============================================
        // GAME CONTROLLER
        // ============================================
        const GameController = {
            init() {
                // Hotspot clicks
                document.querySelectorAll('.hotspot').forEach(hotspot => {
                    hotspot.addEventListener('click', () => {
                        const element = hotspot.dataset.element;
                        this.handleHotspotClick(element);
                    });
                });
                
                // Modal close
                document.getElementById('modalClose').addEventListener('click', () => this.closeModal());
                document.getElementById('modalOverlay').addEventListener('click', (e) => {
                    if (e.target.id === 'modalOverlay') this.closeModal();
                });
                
                // Stage complete button
                document.getElementById('btnCompleteStage').addEventListener('click', () => this.completeStage());
                
                // Transition continue
                document.getElementById('btnContinueTransition').addEventListener('click', () => {
                    this.showScreen('screenGame');
                    this.startStage(GameState.currentStage);
                });
                
                // Next stage from summary
                document.getElementById('btnNextStage').addEventListener('click', () => this.goToNextStage());
            },
            
            startStage(stageNum) {
                GameState.currentStage = stageNum;
                GameState.completedElements[stageNum] = {};
                GameState.stageTotals[stageNum] = { budget: 0, dose: 0, time: 0 };
                
                const stage = GameData.stages[stageNum];
                
                // Update header
                document.getElementById('headerStage').innerHTML = `<strong>STAGE ${stageNum}:</strong> ${stage.name}`;
                
                // Update timeline
                document.querySelectorAll('.timeline-marker').forEach((marker, i) => {
                    marker.classList.remove('active', 'completed');
                    if (i + 1 === stageNum) marker.classList.add('active');
                    else if (i + 1 < stageNum) marker.classList.add('completed');
                });
                document.getElementById('timelineFill').style.width = `${(stageNum - 1) * 25}%`;
                
                // Update stage header
                if (stageNum === 1) {
                    document.getElementById('stageTitle').textContent = 'Section 4B Design Phase';
                    document.getElementById('stageSubtitle').textContent = 'Click on each element to make your design selection';
                    document.getElementById('characterBanner').style.display = 'none';
                    
                    // Show budget info
                    document.getElementById('stageInfoBar').innerHTML = `
                        <div class="info-item"><div class="info-label">Budget</div><div class="info-value">¬£${stage.budget.toLocaleString()}</div></div>
                        <div class="info-item"><div class="info-label">Spent</div><div class="info-value" id="infoSpent">¬£0</div></div>
                        <div class="info-item"><div class="info-label">Remaining</div><div class="info-value good" id="infoRemaining">¬£${stage.budget.toLocaleString()}</div></div>
                    `;
                } else {
                    const char = GameData.characters[stage.character];
                    document.getElementById('stageTitle').textContent = `${stage.year} ${stage.name.charAt(0) + stage.name.slice(1).toLowerCase()}`;
                    document.getElementById('stageSubtitle').textContent = 'Click on each element to see how your design decisions play out';
                    
                    // Show character banner
                    const banner = document.getElementById('characterBanner');
                    banner.style.display = 'flex';
                    banner.className = `character-banner ${stage.character}`;
                    document.getElementById('charPortrait').innerHTML = char.portrait.startsWith('images/') 
                        ? `<img src="${char.portrait}" alt="${char.name}">` 
                        : char.portrait;
                    document.getElementById('charName').textContent = char.name;
                    document.getElementById('charRole').textContent = char.role;
                    document.getElementById('charQuote').textContent = `"${char.introQuote}"`;
                    
                    // Show stage info
                    document.getElementById('stageInfoBar').innerHTML = `
                        <div class="info-item"><div class="info-label">Budget</div><div class="info-value">¬£${stage.budget.toLocaleString()}</div></div>
                        <div class="info-item"><div class="info-label">Time</div><div class="info-value" id="infoTime">0 days</div></div>
                        <div class="info-item"><div class="info-label">Dose</div><div class="info-value" id="infoDose">0 mSv</div></div>
                    `;
                }
                
                // Reset hotspots
                document.querySelectorAll('.hotspot-marker').forEach(marker => {
                    marker.classList.remove('completed', 'problem');
                });
                
                this.updateProgress();
                this.showScreen('screenGame');
            },
            
            handleHotspotClick(elementId) {
                if (GameState.completedElements[GameState.currentStage][elementId]) return;
                
                if (GameState.currentStage === 1) {
                    this.showDesignModal(elementId);
                } else {
                    this.showOutcomeModal(elementId);
                }
            },
            
            showDesignModal(elementId) {
                const element = GameData.elements[elementId];
                
                document.getElementById('modalTitle').textContent = element.title;
                
                let html = `<p class="modal-description">${element.description}</p>`;
                html += '<div class="choice-cards">';
                
                element.options.forEach(opt => {
                    const selected = GameState.designChoices[elementId] === opt.id ? 'selected' : '';
                    html += `
                        <div class="choice-card ${selected}" data-choice="${opt.id}">
                            <div class="choice-image-placeholder">Image: ${opt.name}</div>
                            <div class="choice-header">
                                <span class="choice-name">${opt.name}</span>
                                <span class="choice-cost">¬£${opt.cost.toLocaleString()}</span>
                            </div>
                            <p class="choice-description">${opt.description}</p>
                        </div>
                    `;
                });
                
                html += '</div>';
                document.getElementById('modalBody').innerHTML = html;
                
                // Choice selection
                let selectedChoice = GameState.designChoices[elementId] || null;
                document.querySelectorAll('.choice-card').forEach(card => {
                    card.addEventListener('click', () => {
                        document.querySelectorAll('.choice-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        selectedChoice = card.dataset.choice;
                    });
                });
                
                // Confirm button
                document.getElementById('modalFooter').innerHTML = '<button class="btn btn-primary" id="modalConfirm">Confirm Selection</button>';
                document.getElementById('modalConfirm').addEventListener('click', () => {
                    if (selectedChoice) {
                        this.confirmDesignChoice(elementId, selectedChoice);
                    }
                });
                
                this.openModal();
            },
            
            confirmDesignChoice(elementId, choiceId) {
                const element = GameData.elements[elementId];
                const option = element.options.find(o => o.id === choiceId);
                
                // If changing choice, refund old cost
                if (GameState.designChoices[elementId]) {
                    const oldOption = element.options.find(o => o.id === GameState.designChoices[elementId]);
                    GameState.totals.budget -= oldOption.cost;
                }
                
                GameState.designChoices[elementId] = choiceId;
                GameState.completedElements[1][elementId] = true;
                GameState.totals.budget += option.cost;
                
                // Update hotspot
                const marker = document.querySelector(`[data-element="${elementId}"] .hotspot-marker`);
                marker.classList.add('completed');
                
                // Update budget display
                const spent = GameState.totals.budget;
                const remaining = GameData.stages[1].budget - spent;
                document.getElementById('infoSpent').textContent = `¬£${spent.toLocaleString()}`;
                const remEl = document.getElementById('infoRemaining');
                remEl.textContent = `¬£${remaining.toLocaleString()}`;
                remEl.className = 'info-value ' + (remaining < 0 ? 'critical' : remaining < 100000 ? 'warning' : 'good');
                
                this.updateProgress();
                this.closeModal();
            },
            
            showOutcomeModal(elementId) {
                const element = GameData.elements[elementId];
                const stage = GameState.currentStage;
                const char = GameData.characters[GameData.stages[stage].character];
                const designChoice = GameState.designChoices[elementId];
                const outcome = element.outcomes[stage][designChoice];
                const designOption = element.options.find(o => o.id === designChoice);
                
                document.getElementById('modalTitle').textContent = element.title;
                
                let html = `
                    <div class="outcome-display">
                        <div class="outcome-character">
                            <div class="character-portrait">${char.portrait.startsWith('images/') ? `<img src="${char.portrait}" alt="${char.name}">` : char.portrait}</div>
                            <div>
                                <div class="character-name">${char.name}</div>
                                <p class="outcome-dialogue">"${outcome.comment}"</p>
                            </div>
                        </div>
                        
                        <div class="outcome-result">
                            <h4>Impact</h4>
                            <div class="outcome-stats">
                                <div class="outcome-stat">
                                    <div class="outcome-stat-value ${outcome.time > 5 ? 'bad' : ''}">${outcome.time} days</div>
                                    <div class="outcome-stat-label">Time</div>
                                </div>
                                <div class="outcome-stat">
                                    <div class="outcome-stat-value ${outcome.dose > 3 ? 'bad' : ''}">${outcome.dose} mSv</div>
                                    <div class="outcome-stat-label">Dose</div>
                                </div>
                                <div class="outcome-stat">
                                    <div class="outcome-stat-value ${outcome.cost > 100000 ? 'bad' : ''}">¬£${outcome.cost.toLocaleString()}</div>
                                    <div class="outcome-stat-label">Cost</div>
                                </div>
                            </div>
                            <div class="design-recall">
                                <strong>Your 2025 decision:</strong> ${designOption.name}
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalBody').innerHTML = html;
                document.getElementById('modalFooter').innerHTML = '<button class="btn btn-primary" id="modalConfirm">Continue</button>';
                document.getElementById('modalConfirm').addEventListener('click', () => {
                    this.confirmOutcome(elementId, outcome);
                });
                
                this.openModal();
            },
            
            confirmOutcome(elementId, outcome) {
                const stage = GameState.currentStage;
                
                GameState.completedElements[stage][elementId] = true;
                GameState.stageTotals[stage].budget += outcome.cost;
                GameState.stageTotals[stage].dose += outcome.dose;
                GameState.stageTotals[stage].time += outcome.time;
                
                GameState.totals.budget += outcome.cost;
                GameState.totals.dose += outcome.dose;
                GameState.totals.time += outcome.time;
                
                // Update hotspot appearance based on outcome severity
                const marker = document.querySelector(`[data-element="${elementId}"] .hotspot-marker`);
                if (outcome.time > 5 || outcome.dose > 3 || outcome.cost > 100000) {
                    marker.classList.add('problem');
                } else {
                    marker.classList.add('completed');
                }
                
                // Update info bar
                if (document.getElementById('infoTime')) {
                    document.getElementById('infoTime').textContent = `${GameState.stageTotals[stage].time} days`;
                }
                if (document.getElementById('infoDose')) {
                    document.getElementById('infoDose').textContent = `${GameState.stageTotals[stage].dose} mSv`;
                }
                
                this.updateProgress();
                this.closeModal();
            },
            
            updateProgress() {
                const stage = GameState.currentStage;
                const completed = Object.keys(GameState.completedElements[stage] || {}).length;
                document.getElementById('progressText').textContent = `${completed} of 6 elements completed`;
                document.getElementById('btnCompleteStage').disabled = completed < 6;
            },
            
            completeStage() {
                this.showSummary();
            },
            
            showSummary() {
                const stage = GameState.currentStage;
                const stageData = GameData.stages[stage];
                
                document.getElementById('summaryTitle').textContent = `${stageData.name.charAt(0) + stageData.name.slice(1).toLowerCase()} Complete`;
                document.getElementById('summarySubtitle').textContent = `Year ${stageData.year}`;
                
                // Stats
                if (stage === 1) {
                    document.getElementById('sumBudgetUsed').textContent = `¬£${GameState.totals.budget.toLocaleString()}`;
                    document.getElementById('sumDose').textContent = '-';
                    document.getElementById('sumTime').textContent = '-';
                    document.getElementById('sumIssues').textContent = '-';
                } else {
                    const st = GameState.stageTotals[stage];
                    document.getElementById('sumBudgetUsed').textContent = `¬£${st.budget.toLocaleString()}`;
                    document.getElementById('sumDose').textContent = `${st.dose} mSv`;
                    document.getElementById('sumTime').textContent = `${st.time} days`;
                    
                    // Count issues (high values)
                    let issues = 0;
                    Object.keys(GameData.elements).forEach(elId => {
                        const outcome = GameData.elements[elId].outcomes[stage][GameState.designChoices[elId]];
                        if (outcome.time > 5 || outcome.dose > 3 || outcome.cost > 100000) issues++;
                    });
                    document.getElementById('sumIssues').textContent = issues;
                }
                
                // Decision list
                let decisionsHtml = '';
                Object.keys(GameData.elements).forEach(elId => {
                    const el = GameData.elements[elId];
                    const choiceId = GameState.designChoices[elId];
                    const option = el.options.find(o => o.id === choiceId);
                    
                    let tagClass = option.quality === 'good' ? 'good' : option.quality === 'ok' ? 'ok' : 'poor';
                    
                    decisionsHtml += `
                        <li class="decision-item">
                            <span class="decision-name">${el.title}</span>
                            <div class="decision-result">
                                <span>${option.name}</span>
                                <span class="result-tag ${tagClass}">${option.quality.toUpperCase()}</span>
                            </div>
                        </li>
                    `;
                });
                document.getElementById('summaryDecisions').innerHTML = decisionsHtml;
                
                // Button text
                if (stage === 5) {
                    document.getElementById('btnNextStage').textContent = 'View Final Results ‚Üí';
                } else {
                    document.getElementById('btnNextStage').textContent = 'Continue to Next Stage ‚Üí';
                }
                
                this.showScreen('screenSummary');
            },
            
            goToNextStage() {
                if (GameState.currentStage >= 5) {
                    this.showFinalResults();
                } else {
                    GameState.currentStage++;
                    this.showTransition();
                }
            },
            
            showTransition() {
                const trans = GameData.transitions[GameState.currentStage];
                document.getElementById('transitionYears').textContent = trans.years;
                document.getElementById('transitionYear').textContent = trans.year;
                document.getElementById('transitionText').innerHTML = trans.text.map(t => `<p>${t}</p>`).join('');
                this.showScreen('screenTransition');
            },
            
            showFinalResults() {
                // Calculate grade
                let goodChoices = 0;
                Object.keys(GameData.elements).forEach(elId => {
                    const option = GameData.elements[elId].options.find(o => o.id === GameState.designChoices[elId]);
                    if (option.quality === 'good') goodChoices++;
                });
                
                let grade, gradeClass;
                if (goodChoices >= 5) { grade = 'A'; gradeClass = 'excellent'; }
                else if (goodChoices >= 4) { grade = 'B'; gradeClass = 'good'; }
                else if (goodChoices >= 3) { grade = 'C'; gradeClass = 'average'; }
                else { grade = 'D'; gradeClass = 'poor'; }
                
                document.getElementById('resultsGrade').textContent = grade;
                document.getElementById('resultsGrade').className = `results-grade ${gradeClass}`;
                
                document.getElementById('totalBudget').textContent = `¬£${GameState.totals.budget.toLocaleString()}`;
                document.getElementById('totalDose').textContent = `${GameState.totals.dose.toFixed(1)} mSv`;
                document.getElementById('totalTime').textContent = `${GameState.totals.time} days`;
                document.getElementById('totalIncidents').textContent = GameState.totals.incidents;
                
                this.showScreen('screenResults');
            },
            
            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
            },
            
            openModal() {
                document.getElementById('modalOverlay').classList.add('active');
            },
            
            closeModal() {
                document.getElementById('modalOverlay').classList.remove('active');
            }
        };
        
        // ============================================
        // INIT
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            CinematicController.init();
            GameController.init();
        });
    </script>
</body>
</html>
